import{a as bt,e as Ct}from"./chunk-HD7OORPX.js";import{a as Z,b as Y,c as J,d as ht,e as be,f as xt}from"./chunk-D2BCPON4.js";import{b as ut,c as _t}from"./chunk-B2YIIQ5G.js";import{a as he,b as gt}from"./chunk-Y7VT7NVC.js";import{a as U}from"./chunk-O5WKCLKG.js";import{b as D,c as X,d as xe}from"./chunk-WESTYKRX.js";import{a as mt,c as Fe,d as pt}from"./chunk-DEF5ACRI.js";import{a as ft}from"./chunk-5JTGT5DU.js";import{a as R}from"./chunk-H2O7B6BZ.js";import{a as O}from"./chunk-M6MDGVAZ.js";import{B as dt,C as ct,c as H,d as T,e as A,f as z,h as ue,i as _e,k as E,l as st,m as j,o as ot,p as ve,q as fe,r as ge,s as rt,t as at,u as lt}from"./chunk-GWDAXWU7.js";import{$b as W,Ba as ne,Ca as Q,Da as a,Ea as K,Ha as M,Hb as q,Ia as Xe,Ib as P,Jb as L,Na as r,Oa as o,Pa as p,Rb as nt,Ta as b,Ua as _,Ub as te,Va as d,X as qe,Ya as y,Za as ee,aa as He,ab as Ze,ba as g,bb as Ye,bc as se,ca as h,cb as Je,cc as G,db as Me,eb as c,ec as vt,fb as V,g as je,ga as ie,gb as v,h as Be,hb as w,ib as Qe,jb as Ke,kb as et,lb as tt,ma as me,na as I,nb as it,oa as Te,ob as f,pa as s,pb as Ue,sa as C,sb as S,ta as k,tb as N,ua as We,ub as F,vb as pe,w as $e,ya as u}from"./chunk-3BHHYQXT.js";var ke=class{constructor(){}};var oe=class{constructor(){}};var Ce=class{constructor(l){this.text=l}};var Re=t=>({"show active":t}),Ut=t=>({disable:t}),De=t=>["/perfil",t],Le=t=>({"is-invalid":t});function Dt(t,l){if(t&1&&(r(0,"div")(1,"h5",24),c(2),o()()),t&2){let e=d();M("card-header bg-",e.lesson_states[e.lesson.state].class,""),s(2),w(" ",e.title," - ",e.lesson.title," ")}}function Nt(t,l){if(t&1&&(r(0,"div",25),p(1,"i",26),c(2),o()),t&2){let e=d();s(2),v(" ",e.deletedMsg," ")}}function At(t,l){if(t&1&&(r(0,"div",27),p(1,"i",28),c(2),o()),t&2){let e=d();s(2),v(" ",e.errorMsg," ")}}function zt(t,l){if(t&1&&(r(0,"div",29),p(1,"i",28),c(2),o()),t&2){let e=d();s(2),v(" ",e.warningMsg," ")}}function jt(t,l){if(t&1&&(r(0,"div",30),p(1,"i",26),c(2),o()),t&2){let e=d();s(2),v(" ",e.successMsg," ")}}function Bt(t,l){if(t&1){let e=b();r(0,"div",41),p(1,"i",42),r(2,"div",43)(3,"button",44),_("click",function(){g(e);let i=d().index,m=d(2);return h(m.getIndex(i))}),c(4,"Eliminar Conversaci\xF3n"),o()()()}}function $t(t,l){if(t&1){let e=b();r(0,"div",39),_("click",function(){let i=g(e).$implicit,m=d(2);return h(m.restartValues(i))}),c(1),u(2,Bt,5,0,"div",40),o()}if(t&2){let e=l.$implicit,n=l.index,i=d(2);Q("href","#",i.removeSpaces(e),""),ee("id","",i.removeSpaces(e),"-tab"),a("ngClass",f(8,Re,n==0)),ne("aria-controls",i.removeSpaces(e)),s(),v(" ",e," "),s(),a("ngIf",i.selectedGroup==e&&i.showResources())}}function qt(t,l){if(t&1){let e=b();r(0,"div",45),_("click",function(){g(e);let i=d(2);return h(i.restartValues(i))}),p(1,"i",46),c(2," Crear conversaci\xF3n "),o()}if(t&2){let e=d(2);a("ngClass",f(2,Re,e.lesson.expert_comments.length==0))("ngClass",f(4,Ut,e.submitted))}}function Ht(t,l){t&1&&p(0,"img",71)}function Wt(t,l){if(t&1&&p(0,"img",72),t&2){let e=d(2).$implicit,n=d(3);y("src",n.url+"get-image-user/"+e.author.picture,I)}}function Xt(t,l){if(t&1&&(r(0,"div",52)(1,"a",53)(2,"div",54),u(3,Ht,1,0,"img",55)(4,Wt,1,1,"img",56),o()()()),t&2){let e=d().$implicit;s(),a("routerLink",f(3,De,e.author._id)),s(2),a("ngIf",!e.author.picture),s(),a("ngIf",e.author.picture)}}function Zt(t,l){t&1&&(r(0,"span",75),c(1," \xB7 editado"),o())}function Yt(t,l){if(t&1&&(r(0,"a",80),p(1,"i",81),c(2),o()),t&2){let e=d(3).$implicit,n=d(3);ee("title","Descargar : ",e.file.fileName,""),y("href",n.url+"get-lesson/"+e.file.fileName,I),s(2),v(" ",e.file.fileName," ")}}function Jt(t,l){if(t&1){let e=b();r(0,"div",82)(1,"button",83),_("click",function(){g(e);let i=d(3).$implicit,m=d(3);return h(m.startEditMessage(i))}),p(2,"i",84),c(3," Editar "),o(),r(4,"button",85),_("click",function(){g(e);let i=d(3).$implicit,m=d(3);return h(m.deleteMessage(i))}),p(5,"i",86),c(6," Eliminar "),o()()}}function Qt(t,l){if(t&1&&(r(0,"div"),p(1,"p",77),S(2,"linky"),u(3,Yt,3,4,"a",78)(4,Jt,7,0,"div",79),o()),t&2){let e=d(2).$implicit,n=d(3);s(),y("innerHTML",N(2,3,e.text),me),s(2),a("ngIf",e.file),s(),a("ngIf",n.canEditMessage(e))}}function Kt(t,l){if(t&1){let e=b();p(0,"textarea",87),r(1,"div")(2,"button",88),_("click",function(){g(e);let i=d(5);return h(i.saveEditMessage())}),p(3,"i",89),c(4," Guardar "),o(),r(5,"button",90),_("click",function(){g(e);let i=d(5);return h(i.cancelEditMessage())}),c(6," Cancelar "),o()()}if(t&2){let e=d(5);a("formControl",e.editingText)}}function ei(t,l){if(t&1&&(r(0,"div",73)(1,"h6",74)(2,"a",53)(3,"strong"),c(4),o()(),p(5,"br"),r(6,"small",75),c(7),S(8,"amDateFormat"),S(9,"amFromUnix"),S(10,"amLocale"),S(11,"amDateFormat"),u(12,Zt,2,0,"span",61),o()(),u(13,Qt,5,5,"div",76)(14,Kt,7,1,"ng-template",null,0,pe),o()),t&2){let e=Me(15),n=d().$implicit,i=d(3);s(2),a("routerLink",f(18,De,n.author._id)),s(2),w(" ",n.author.name," ",n.author.surname," "),s(3),v(" ",F(8,7,n.created_at,"LLL")||F(11,15,F(10,12,N(9,10,n.created_at),"es"),"LLL")," "),s(5),a("ngIf",n.edited),s(),a("ngIf",i.editingMessage!==n)("ngIfElse",e)}}function ti(t,l){if(t&1&&(r(0,"div",68),u(1,Xt,5,5,"div",69)(2,ei,16,20,"div",70),o()),t&2){let e=l.$implicit;s(),a("ngIf",e.author!=null),s(),a("ngIf",e.author!=null)}}function ii(t,l){t&1&&p(0,"img",71)}function ni(t,l){if(t&1&&p(0,"img",72),t&2){let e=d(3);y("src",e.url+"get-image-user/"+e.identity.picture,I)}}function si(t,l){t&1&&(r(0,"div"),c(1," El campo comentario es obligatorio. "),o())}function oi(t,l){if(t&1&&(r(0,"div"),c(1),o()),t&2){let e=d(4);s(),v(" El archivo es demasiado grande, el tama\xF1o maximo permitido es de ",e.MAX_FILE_SIZE,"MB. ")}}function ri(t,l){if(t&1&&(r(0,"div",91),u(1,si,2,0,"div",92)(2,oi,2,1,"div",92),o()),t&2){let e=d(3);s(),a("ngIf",e.message.errors&&e.message.errors.required),s(),a("ngIf",e.maxSizeError)}}function ai(t,l){if(t&1&&(r(0,"small",75),p(1,"i",81),c(2),o()),t&2){let e=d(3);s(2),v(" ",e.filesToUpload[0].name," ")}}function li(t,l){if(t&1){let e=b();r(0,"div",47)(1,"div",3)(2,"div",4)(3,"div",48)(4,"div",49),u(5,ti,3,2,"div",50),r(6,"div",51)(7,"div",52)(8,"a",53)(9,"div",54),u(10,ii,1,0,"img",55)(11,ni,1,1,"img",56),o()()(),r(12,"div",57)(13,"div",58),p(14,"textarea",59),u(15,ri,3,2,"div",60),o(),u(16,ai,3,1,"small",61),o(),r(17,"div",62)(18,"label",63),p(19,"i",64),r(20,"input",65),_("change",function(i){g(e);let m=d(2);return h(m.fileChangeEvent(i))}),o()(),p(21,"br"),r(22,"button",66),_("click",function(){let i=g(e).$implicit,m=d(2);return h(m.onSubmit(i))}),p(23,"i",67),o()()()()()()()()}if(t&2){let e=l.$implicit,n=l.index,i=d(2);Q("aria-labelledby","",i.removeSpaces(e),"-tab"),y("id",i.removeSpaces(e)),a("ngClass",f(13,Re,n==0)),s(5),a("ngForOf",i.getMessages(e)),s(3),a("routerLink",f(15,De,i.identity._id)),s(2),a("ngIf",!i.identity.picture),s(),a("ngIf",i.identity.picture),s(3),a("formControl",i.message)("ngClass",f(17,Le,i.submitted&&i.message.errors)),s(),a("ngIf",i.submitted&&i.message.errors||i.maxSizeError),s(),a("ngIf",i.filesToUpload.length>0),s(4),a("formControl",i.files)}}function di(t,l){t&1&&(r(0,"div"),c(1," El campo t\xEDtulo es obligatorio. "),o())}function ci(t,l){if(t&1&&(r(0,"div",91),u(1,di,2,0,"div",92),o()),t&2){let e=d(3);s(),a("ngIf",e.name.errors.required)}}function mi(t,l){t&1&&(r(0,"div"),c(1," El campo comentario es obligatorio. "),o())}function pi(t,l){if(t&1&&(r(0,"div",91),u(1,mi,2,0,"div",92),o()),t&2){let e=d(3);s(),a("ngIf",e.message.errors.required)}}function ui(t,l){if(t&1&&(r(0,"div",104)(1,"div",105,1),c(3),o()()),t&2){let e=d(3);s(),K("width",e.barWidth),s(2),V(e.barWidth)}}function _i(t,l){t&1&&(r(0,"div"),c(1," Debes agregar al menos un archivo. "),o())}function vi(t,l){if(t&1&&(r(0,"div"),c(1),o()),t&2){let e=d(4);s(),v(" El archivo es demasiado grande, el tama\xF1o maximo permitido es de ",e.MAX_FILE_SIZE,"MB. ")}}function fi(t,l){if(t&1&&(r(0,"div",91),u(1,_i,2,0,"div",92)(2,vi,2,1,"div",92),o()),t&2){let e=d(3);s(),a("ngIf",e.files.errors&&e.files.errors.required),s(),a("ngIf",e.maxSizeError)}}function gi(t,l){if(t&1){let e=b();r(0,"div",93)(1,"div",3)(2,"div",4)(3,"div",94)(4,"div",2)(5,"form")(6,"div",95)(7,"label",96)(8,"strong"),c(9,"T\xEDtulo*"),o()(),p(10,"input",97),u(11,ci,2,1,"div",60),o(),r(12,"div",95)(13,"label",98)(14,"strong"),c(15,"Comentario*"),o()(),p(16,"textarea",99),u(17,pi,2,1,"div",60),o(),r(18,"div",95)(19,"label",100)(20,"strong"),c(21,"Archivos"),o()(),r(22,"input",101),_("change",function(i){g(e);let m=d(2);return h(m.fileChangeEvent(i))}),o(),u(23,ui,4,3,"div",102)(24,fi,3,2,"div",60),o(),r(25,"button",103),_("click",function(){g(e);let i=d(2);return h(i.onSubmit())}),c(26,"Guardar"),o()()()()()()()}if(t&2){let e=d(2);a("ngClass",f(12,Re,e.lesson.expert_comments.length==0)),s(10),a("formControl",e.name)("ngClass",f(14,Le,e.submitted&&e.name.errors)),s(),a("ngIf",e.submitted&&e.name.errors),s(5),a("formControl",e.message)("ngClass",f(16,Le,e.submitted&&e.message.errors)),s(),a("ngIf",e.submitted&&e.message.errors),s(5),a("formControl",e.files)("ngClass",f(18,Le,e.submitted&&e.files.errors||e.maxSizeError)),s(),a("ngIf",e.filesToUpload!=null||e.barWidth!="0%"),s(),a("ngIf",e.submitted&&e.files.errors||e.maxSizeError),s(),a("disabled",e.submitted)}}function hi(t,l){if(t&1&&(r(0,"div",3)(1,"div",31)(2,"div",32),u(3,$t,3,10,"div",33)(4,qt,3,6,"div",34),o()(),r(5,"div",35)(6,"div",36),u(7,li,24,19,"div",37)(8,gi,27,20,"div",38),o()()()),t&2){let e=d();s(3),a("ngForOf",e.groups),s(),a("ngIf",e.identity._id==e.lesson.expert._id),s(3),a("ngForOf",e.groups),s(),a("ngIf",e.identity._id==e.lesson.expert._id)}}function xi(t,l){t&1&&(r(0,"div",3)(1,"div",4)(2,"div",106)(3,"div",107)(4,"h4",75),c(5," No se han agregado comentarios del facilitador en esta lecci\xF3n. "),o()()()()())}var St=(()=>{class t{constructor(e,n,i,m){this._userService=e,this._lessonService=n,this._uploadService=i,this._route=m,this.lesson_states=D,this.icon_style=xe,this.barWidth="0%",this.submitted=!1,this.added=new ie,this.MAX_FILE_SIZE=20,this.maxSize=20*1024*1024,this.maxSizeError=!1,this.deletedMsg="Se ha eliminado la conversaci\xF3n",this.editingMessage=null,this.editingText=new E(""),this.pollingHandle=null,this.filesToUpload=[],this.title="Comentarios facilitador",this.identity=this._userService.getIdentity(),this.token=this._userService.getToken(),this.url=O.url,this.groups=[],this.errorMsg="Hubo un error. Intentalo de nuevo m\xE1s tarde.",this.successMsg="Se ha creado la conversaci\xF3n del Facilitador correctamente.",this.warningMsg="Se estan subiendo los archivos, por favor espera y evita cerrar esta ventana.",this.name=new E("",T.required),this.message=new E("",T.required),this.files=new E("")}ngOnInit(){this.getGroups(),this.selectedGroup=this.groups[0],this._route.parent?.url.subscribe(e=>{let n=e&&e.length>0?e[0]:null;this.parentUrl=n&&n.path||this._route.parent?.snapshot?.routeConfig?.path?.split("/")?.[0]||""}),this.startPolling()}disableForm(e){e==!0?(this.name.disable(),this.files.disable()):(this.name.enable(),this.files.enable())}getGroups(){this.groups=[],this.lesson.expert_comments.length>0&&this.lesson.expert_comments.forEach(e=>{this.groups.includes(e.conversationTitle)||this.groups.push(e.conversationTitle)})}getIndex(e){this.index=e}eliminar(){this.lesson.expert_comments.splice(this.index,1),this._lessonService.editLesson(this.token,this.lesson).subscribe(e=>{e.lesson&&e.lesson._id&&(this.lesson=e.lesson,this.getGroups(),this.selectedGroup=this.groups[0],this.status="deleted")},e=>{e!=null?(this.status="error",console.log(e)):this.status="error"})}restartValues(e){this.selectedGroup=e,this.status=null,this.maxSizeError=!1,this.submitted=!1,this.filesToUpload=[],this.getGroups()}getMessages(e){let n=[];return this.lesson.expert_comments.length>0&&(n=this.lesson.expert_comments.filter(i=>i.conversationTitle==e)),n}removeSpaces(e){return e.replace(/[\s\(\).,!"#$%&\/='¡¿áéíóú:0123456789a]/g,"")}fileChangeEvent(e){if(this.filesToUpload=e.target.files,this.filesToUpload.length>0)for(let n=0;n<this.filesToUpload.length;n++)if(this.maxSize<this.filesToUpload[n].size){this.maxSizeError=!0;return}else this.maxSizeError=!1}onSubmit(e=null){let n,i;this.submitted=!0,this.disableForm(!0),i=new Ce(this.message.value),e?(i.conversationTitle=e,this.name.setValue("dummy")):i.conversationTitle=this.name.value,!(this.name.invalid||this.files.invalid||this.message.invalid||this.maxSizeError)&&(this.filesToUpload.length>0&&(n=new oe,n.fileName=this.filesToUpload[0].name,n.created_at=this.filesToUpload[0].lastModified/1e3,n.mimetype=this.filesToUpload[0].type),i.created_at=new Date,i.file=n,this._lessonService.addExpertComment(this.token,this.lesson._id,{text:this.message.value,conversationTitle:i.conversationTitle,file:n||null}).subscribe({next:m=>{m&&m.lesson&&m.lesson._id?(this.lesson=m.lesson,this.status="success",this.submitted=!1,this.name.reset(),this.files.reset(),this.message.reset(),this.getGroups(),this.disableForm(!1)):(this.status="error",this.submitted=!1,this.disableForm(!1))},error:()=>{this.status="error",this.submitted=!1,this.disableForm(!1)}}))}showResources(){let e;return this.lesson.expert&&this.lesson.expert._id==this.identity._id&&["proposed","assigned","development","test"].includes(this.lesson.state)?e=!0:(e=!1,this.parentUrl=="admin"&&(e=!0)),e}canEditMessage(e){let n=e?.author&&e.author._id===this.identity._id,i=this.parentUrl==="admin";return!!(n||i)}startEditMessage(e){this.canEditMessage(e)&&(this.editingMessage=e,this.editingText.setValue(e.text||""))}cancelEditMessage(){this.editingMessage=null,this.editingText.reset("")}saveEditMessage(){if(!this.editingMessage)return;let e=(this.editingText.value||"").toString().trim();if(!e)return;let n=this.editingMessage._id;this._lessonService.editLessonMessage(this.token,this.lesson._id,n,{text:e,scope:"expert_comments"}).subscribe({next:i=>{i?.lesson?._id&&(this.lesson=i.lesson,this.getGroups()),this.editingMessage=null,this.editingText.reset("")},error:()=>{this.editingMessage=null,this.editingText.reset("")}})}deleteMessage(e){if(!this.canEditMessage(e))return;let n=this.lesson.expert_comments.findIndex(i=>i===e);n>=0&&(this.lesson.expert_comments.splice(n,1),this.editLesson(this.lesson))}startPolling(){this.pollingHandle||(this.pollingHandle=setInterval(()=>{this.submitted||this.editingMessage||this.lesson?._id&&this._lessonService.getLesson(this.token,this.lesson._id).subscribe({next:e=>{e?.lesson?._id&&(this.lesson=e.lesson,this.getGroups())},error:()=>{}})},1e4))}ngOnDestroy(){this.pollingHandle&&(clearInterval(this.pollingHandle),this.pollingHandle=null)}editLesson(e){this._lessonService.editLesson(this.token,e).subscribe(n=>{n.lesson&&n.lesson._id?this.filesToUpload.length==0?(this.lesson=n.lesson,this.status="success",this.submitted=!1,this.name.reset(),this.files.reset(),this.message.reset(),this.getGroups(),this.disableForm(!1)):this.filesToUpload.length>0&&this._uploadService.makeFileRequest(this.url+"upload-lesson/"+this.lesson._id,[],this.filesToUpload,this.token,"files").subscribe(i=>{switch(i.type){case te.UploadProgress:this.status="warning",this.barWidth=Math.round(i.loaded/i.total*100).toString()+"%";break;case te.Response:console.log("User successfully added!",i.body),this.submitted=!1,this.disableForm(!1),this.lesson=n.lesson,this.status="success",this.name.reset(),this.files.reset(),this.message.reset(),this.getGroups(),this.status="success",this.barWidth="0%"}},i=>{this.status="error",this.barWidth="0%",this.submitted=!1,this.disableForm(!1),console.log(i)}):(this.status="error",this.submitted=!1,this.barWidth="0%")},n=>{n!=null&&(this.status="error",this.submitted=!1,console.log(n))})}canDeactivate(){return this.name.value!=""||this.files.length>0?(console.log("falseName or file: ",this.name.value),!1):this.submitted==!0?(console.log("edit "),!1):!0}static{this.\u0275fac=function(n){return new(n||t)(C(R),C(U),C(he),C(W))}}static{this.\u0275cmp=k({type:t,selectors:[["review"]],hostBindings:function(n,i){n&1&&_("beforeunload",function(){return i.canDeactivate()},!1,Te)},inputs:{lesson:"lesson"},outputs:{added:"added"},standalone:!1,decls:27,vars:7,consts:[["editFormRev",""],["progress",""],[1,"card-body"],[1,"row"],[1,"col"],[1,"card","mb-3","text-center"],[3,"class",4,"ngIf"],["class","alert alert-primary fade show text-center","role","alert",4,"ngIfSuccessMessage","ngIf"],["class","alert alert-danger fade show text-center","role","alert",4,"ngIfSuccessMessage","ngIf"],["class","alert alert-warning fade show text-center","role","alert",4,"ngIfSuccessMessage","ngIf"],["class","alert alert-success fade show text-center","role","alert",4,"ngIfSuccessMessage","ngIf"],["class","row",4,"ngIf"],["id","deleteModal","tabindex","-1","role","dialog","aria-labelledby","Eliminar conversacion","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-dialog-centered"],[1,"modal-content"],[1,"modal-header"],["id","eliminarConv",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],["role","alert",1,"alert","alert-warning","mb-0"],[1,"fas","fa-exclamation-triangle","icon-message","me-2"],[1,"modal-footer"],["data-bs-dismiss","modal",1,"btn","btn-danger",3,"click"],["data-bs-dismiss","modal",1,"btn","btn-primary","text-white"],[1,"mb-0","text-white"],["role","alert",1,"alert","alert-primary","fade","show","text-center"],[1,"fas","fa-check-circle","icon-message","me-2"],["role","alert",1,"alert","alert-danger","fade","show","text-center"],[1,"fas","fa-times-circle","icon-message","me-2"],["role","alert",1,"alert","alert-warning","fade","show","text-center"],["role","alert",1,"alert","alert-success","fade","show","text-center"],[1,"col-4"],["id","v-pills-tab","role","tablist","aria-orientation","vertical",1,"border","rounded","nav","flex-column","nav-pills"],["class","nav-link","data-bs-toggle","pill","role","tab","aria-selected","true","style","display: flex;",3,"ngClass","id","click",4,"ngFor","ngForOf"],["class","nav-link","id","addGroup-tab","data-bs-toggle","pill","href","#addGroup","role","tab","aria-controls","addGroup","aria-selected","false",3,"ngClass","click",4,"ngIf"],[1,"col-8"],["id","v-pills-tabContent",1,"tab-content"],["class","tab-pane fade","role","tabpanel",3,"ngClass","id",4,"ngFor","ngForOf"],["class","tab-pane fade","id","addGroup","role","tabpanel","aria-labelledby","addGroup-tab",3,"ngClass",4,"ngIf"],["data-bs-toggle","pill","role","tab","aria-selected","true",1,"nav-link",2,"display","flex",3,"click","ngClass","id"],["class","iconOpt",4,"ngIf"],[1,"iconOpt"],["type","button","id","dropdownMenu2","data-bs-toggle","dropdown","aria-haspopup","true","aria-expanded","false",1,"fas","fa-ellipsis-v"],["aria-labelledby","dropdownMenu2",1,"dropdown-menu"],["type","button","data-bs-toggle","modal","data-bs-target","#deleteModal","aria-label","delete",1,"dropdown-item",3,"click"],["id","addGroup-tab","data-bs-toggle","pill","href","#addGroup","role","tab","aria-controls","addGroup","aria-selected","false",1,"nav-link",3,"click","ngClass"],[1,"fas","fa-plus"],["role","tabpanel",1,"tab-pane","fade",3,"ngClass","id"],[1,"card",2,"max-height","60vh","overflow","auto"],[1,"card-body","py-1"],["class","row mt-2",4,"ngFor","ngForOf"],[1,"row","mt-3"],[1,"col-auto"],["data-bs-dismiss","modal",1,"text-primary",3,"routerLink"],[1,"flex-shrink-0","rounded-circle","border-1","overflow-hidden",2,"width","40px","height","40px"],["class","img-fluid","src","assets/images/user-default.png",4,"ngIf"],["class","img-fluid",3,"src",4,"ngIf"],[1,"col","px-0"],[1,"mb-3","mb-1"],["rows","2","placeholder","Escribe un comentario...","id","message","autofocus","",1,"form-control",3,"formControl","ngClass"],["class","invalid-feedback",4,"ngIf"],["class","text-muted",4,"ngIf"],[1,"col-auto","ps-3","pe-0"],["for","files","title","Adjuntar archivo",1,"btn","btn-sm","text-success"],[1,"fas","fa-paperclip",2,"cursor","pointer"],["type","file","name","files","id","files","enctype","multipart/form-data",1,"form-control",2,"display","none",3,"change","formControl"],["title","Enviar mensaje",1,"btn","btn-sm","btn-success",3,"click"],[1,"fas","fa-paper-plane"],[1,"row","mt-2"],["class","col-auto",4,"ngIf"],["class","col bg-light rounded-left p-2",4,"ngIf"],["src","assets/images/user-default.png",1,"img-fluid"],[1,"img-fluid",3,"src"],[1,"col","bg-light","rounded-left","p-2"],[1,"mb-1"],[1,"text-muted"],[4,"ngIf","ngIfElse"],[1,"card-text",3,"innerHTML"],["target","_blank",3,"title","href",4,"ngIf"],["class","mt-2",4,"ngIf"],["target","_blank",3,"title","href"],[1,"fas","fa-paperclip"],[1,"mt-2"],[1,"btn","btn-sm","btn-outline-primary","me-2",3,"click"],[1,"fas","fa-edit"],[1,"btn","btn-sm","btn-outline-danger",3,"click"],[1,"fas","fa-trash"],["rows","2",1,"form-control","mb-2",3,"formControl"],[1,"btn","btn-sm","btn-success","me-2",3,"click"],[1,"fas","fa-save"],[1,"btn","btn-sm","btn-secondary",3,"click"],[1,"invalid-feedback"],[4,"ngIf"],["id","addGroup","role","tabpanel","aria-labelledby","addGroup-tab",1,"tab-pane","fade",3,"ngClass"],[1,"card",2,"height","70vh","overflow","auto"],[1,"mb-3"],["for","name"],["type","text","id","name","autocomplete","off",1,"form-control",3,"formControl","ngClass"],["for","message"],["rows","3","placeholder","Escribe un comentario...","id","message",1,"form-control",3,"formControl","ngClass"],["for","files"],["type","file","name","files","id","files","enctype","multipart/form-data",1,"form-control",3,"change","formControl","ngClass"],["class","progress",4,"ngIf"],["type","submit",1,"btn","btn-success","mb-2","float-right",3,"click","disabled"],[1,"progress"],["role","progressbar","aria-valuenow","barWidth","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","progress-bar-striped","progress-bar-animated"],[1,"card"],[1,"card-body","text-start"]],template:function(n,i){n&1&&(r(0,"div",2)(1,"div",3)(2,"div",4)(3,"div",5),u(4,Dt,3,5,"div",6),o()()(),u(5,Nt,3,1,"div",7)(6,At,3,1,"div",8)(7,zt,3,1,"div",9)(8,jt,3,1,"div",10)(9,hi,9,4,"div",11)(10,xi,6,0,"div",11),o(),r(11,"div",12)(12,"div",13)(13,"div",14)(14,"div",15)(15,"h5",16),c(16,"Eliminar conversaci\xF3n"),o(),p(17,"button",17),o(),r(18,"div",18)(19,"div",19),p(20,"i",20),c(21," \xBFEstas seguro que quieres eliminar la conversaci\xF3n? Perder\xE1s el acceso a los archivos que se hayan compartido dentro de la conversaci\xF3n "),o()(),r(22,"div",21)(23,"button",22),_("click",function(){return i.eliminar()}),c(24,"S\xED"),o(),r(25,"button",23),c(26,"No"),o()()()()()),n&2&&(s(4),a("ngIf",i.lesson.state),s(),a("ngIf",i.status==="deleted"),s(),a("ngIf",i.status==="error"),s(),a("ngIf",i.status==="warning"),s(),a("ngIf",i.status==="success"),s(),a("ngIf",i.lesson.expert_comments.length>0||i.identity._id==i.lesson.expert._id),s(),a("ngIf",i.lesson.expert_comments.length<=0&&i.identity._id!=i.lesson.expert._id))},dependencies:[q,P,L,j,H,A,z,_e,ve,G,Z,Y,J,be],styles:[".disable[_ngcontent-%COMP%]{pointer-events:none;opacity:2}.iconOpt[_ngcontent-%COMP%]{position:absolute;right:13%;float:right;color:#fff;cursor:pointer}"]})}}return t})();var Pe=t=>({"show active":t}),Ci=t=>({disable:t}),Ne=t=>["/perfil",t],Ve=t=>({"is-invalid":t});function yi(t,l){if(t&1&&(r(0,"div")(1,"h5",21),c(2),o()()),t&2){let e=d();M("card-header bg-",e.lesson_states[e.lesson.state].class,""),s(2),w(" ",e.title," - ",e.lesson.title," ")}}function Ei(t,l){if(t&1&&(r(0,"div",22),p(1,"i",23),c(2),o()),t&2){let e=d();s(2),v(" ",e.deletedMsg," ")}}function Si(t,l){if(t&1){let e=b();r(0,"div",34),p(1,"i",35),r(2,"div",36)(3,"button",37),_("click",function(){g(e);let i=d().index,m=d(2);return h(m.getIndex(i))}),c(4,"Eliminar Conversaci\xF3n"),o()()()}}function Ii(t,l){if(t&1){let e=b();r(0,"div",32),_("click",function(){let i=g(e).$implicit,m=d(2);return h(m.restartValues(i))}),c(1),u(2,Si,5,0,"div",33),o()}if(t&2){let e=l.$implicit,n=l.index,i=d(2);Q("href","#",i.removeSpaces(e),""),ee("id","",i.removeSpaces(e),"-tab"),a("ngClass",f(8,Pe,n==0)),ne("aria-controls",i.removeSpaces(e)),s(),v(" ",e," "),s(),a("ngIf",i.selectedGroup==e&&i.showResources())}}function wi(t,l){if(t&1){let e=b();r(0,"div",38),_("click",function(){g(e);let i=d(2);return h(i.restartValues(i))}),p(1,"i",39),c(2," Crear conversaci\xF3n "),o()}if(t&2){let e=d(2);a("ngClass",f(2,Pe,e.lesson.conversations.length==0))("ngClass",f(4,Ci,e.submitted))}}function Ti(t,l){t&1&&p(0,"img",64)}function Mi(t,l){if(t&1&&p(0,"img",65),t&2){let e=d(2).$implicit,n=d(3);y("src",n.url+"get-image-user/"+e.author.picture,I)}}function Fi(t,l){if(t&1&&(r(0,"div",45)(1,"a",46)(2,"div",47),u(3,Ti,1,0,"img",48)(4,Mi,1,1,"img",49),o()()()),t&2){let e=d().$implicit;s(),a("routerLink",f(3,Ne,e.author._id)),s(2),a("ngIf",!e.author.picture),s(),a("ngIf",e.author.picture)}}function ki(t,l){t&1&&(r(0,"span",68),c(1," \xB7 editado"),o())}function Li(t,l){if(t&1&&(r(0,"a",73),p(1,"i",74),c(2),o()),t&2){let e=d(3).$implicit,n=d(3);ee("title","Descargar : ",e.file.fileName,""),y("href",n.url+"get-lesson/"+e.file.fileName,I),s(2),v(" ",e.file.fileName," ")}}function Oi(t,l){if(t&1){let e=b();r(0,"div",75)(1,"button",76),_("click",function(){g(e);let i=d(3).$implicit,m=d(3);return h(m.startEditMessage(i))}),p(2,"i",77),c(3," Editar "),o(),r(4,"button",78),_("click",function(){g(e);let i=d(3).$implicit,m=d(3);return h(m.deleteMessage(i))}),p(5,"i",79),c(6," Eliminar "),o()()}}function Ri(t,l){if(t&1&&(r(0,"div"),p(1,"p",70),S(2,"linky"),u(3,Li,3,4,"a",71)(4,Oi,7,0,"div",72),o()),t&2){let e=d(2).$implicit,n=d(3);s(),y("innerHTML",N(2,3,e.text),me),s(2),a("ngIf",e.file),s(),a("ngIf",n.canEditMessage(e))}}function Vi(t,l){if(t&1){let e=b();p(0,"textarea",80),r(1,"div")(2,"button",81),_("click",function(){g(e);let i=d(3).$implicit,m=d(2);return h(m.saveEditMessage(i))}),p(3,"i",82),c(4," Guardar "),o(),r(5,"button",83),_("click",function(){g(e);let i=d(5);return h(i.cancelEditMessage())}),c(6," Cancelar "),o()()}if(t&2){let e=d(5);a("formControl",e.editingText)}}function Pi(t,l){if(t&1&&(r(0,"div",66)(1,"h6",67)(2,"a",46)(3,"strong"),c(4),o()(),p(5,"br"),r(6,"small",68),c(7),S(8,"amDateFormat"),S(9,"amFromUnix"),S(10,"amLocale"),S(11,"amDateFormat"),u(12,ki,2,0,"span",54),o()(),u(13,Ri,5,5,"div",69)(14,Vi,7,1,"ng-template",null,0,pe),o()),t&2){let e=Me(15),n=d().$implicit,i=d(3);s(2),a("routerLink",f(18,Ne,n.author._id)),s(2),w(" ",n.author.name," ",n.author.surname," "),s(3),v(" ",F(8,7,n.created_at,"LLL")||F(11,15,F(10,12,N(9,10,n.created_at),"es"),"LLL")," "),s(5),a("ngIf",n.edited),s(),a("ngIf",i.editingMessage!==n)("ngIfElse",e)}}function Gi(t,l){if(t&1&&(r(0,"div",61),u(1,Fi,5,5,"div",62)(2,Pi,16,20,"div",63),o()),t&2){let e=l.$implicit;s(),a("ngIf",e.author!=null),s(),a("ngIf",e.author!=null)}}function Ui(t,l){t&1&&p(0,"img",64)}function Di(t,l){if(t&1&&p(0,"img",65),t&2){let e=d(3);y("src",e.url+"get-image-user/"+e.identity.picture,I)}}function Ni(t,l){t&1&&(r(0,"div"),c(1," El campo mensaje es obligatorio. "),o())}function Ai(t,l){if(t&1&&(r(0,"div"),c(1),o()),t&2){let e=d(4);s(),v(" El archivo es demasiado grande, el tama\xF1o maximo permitido es de ",e.MAX_FILE_SIZE,"MB. ")}}function zi(t,l){if(t&1&&(r(0,"div",84),u(1,Ni,2,0,"div",85)(2,Ai,2,1,"div",85),o()),t&2){let e=d(3);s(),a("ngIf",e.message.errors&&e.message.errors.required),s(),a("ngIf",e.maxSizeError)}}function ji(t,l){if(t&1&&(r(0,"small",68),p(1,"i",74),c(2),o()),t&2){let e=d(3);s(2),v(" ",e.filesToUpload[0].name," ")}}function Bi(t,l){if(t&1){let e=b();r(0,"div",40)(1,"div",3)(2,"div",4)(3,"div",41)(4,"div",42),u(5,Gi,3,2,"div",43),r(6,"div",44)(7,"div",45)(8,"a",46)(9,"div",47),u(10,Ui,1,0,"img",48)(11,Di,1,1,"img",49),o()()(),r(12,"div",50)(13,"div",51),p(14,"textarea",52),u(15,zi,3,2,"div",53),o(),u(16,ji,3,1,"small",54),o(),r(17,"div",55)(18,"label",56),p(19,"i",57),r(20,"input",58),_("change",function(i){g(e);let m=d(2);return h(m.fileChangeEvent(i))}),o()(),p(21,"br"),r(22,"button",59),_("click",function(){let i=g(e).$implicit,m=d(2);return h(m.onSubmit(i))}),p(23,"i",60),o()()()()()()()()}if(t&2){let e=l.$implicit,n=l.index,i=d(2);Q("aria-labelledby","",i.removeSpaces(e),"-tab"),y("id",i.removeSpaces(e)),a("ngClass",f(13,Pe,n==0)),s(5),a("ngForOf",i.getMessages(e)),s(3),a("routerLink",f(15,Ne,i.identity._id)),s(2),a("ngIf",!i.identity.picture),s(),a("ngIf",i.identity.picture),s(3),a("formControl",i.message)("ngClass",f(17,Ve,i.submitted&&i.message.errors)),s(),a("ngIf",i.submitted&&i.message.errors||i.maxSizeError),s(),a("ngIf",i.filesToUpload.length>0),s(4),a("formControl",i.files)}}function $i(t,l){if(t&1&&(r(0,"div",102),p(1,"i",103),c(2),o()),t&2){let e=d(3);s(2),v(" ",e.errorMsg," ")}}function qi(t,l){if(t&1&&(r(0,"div",104),p(1,"i",23),c(2),o()),t&2){let e=d(3);s(2),v(" ",e.successMsg," ")}}function Hi(t,l){if(t&1&&(r(0,"div",105),p(1,"i",23),c(2),o()),t&2){let e=d(3);s(2),v(" ",e.warningMsg," ")}}function Wi(t,l){t&1&&(r(0,"div"),c(1," El campo t\xEDtulo es obligatorio. "),o())}function Xi(t,l){if(t&1&&(r(0,"div",84),u(1,Wi,2,0,"div",85),o()),t&2){let e=d(3);s(),a("ngIf",e.name.errors.required)}}function Zi(t,l){t&1&&(r(0,"div"),c(1," El campo mensaje es obligatorio. "),o())}function Yi(t,l){if(t&1&&(r(0,"div",84),u(1,Zi,2,0,"div",85),o()),t&2){let e=d(3);s(),a("ngIf",e.message.errors.required)}}function Ji(t,l){if(t&1&&(r(0,"div",106)(1,"div",107,1),c(3),o()()),t&2){let e=d(3);s(),K("width",e.barWidth),s(2),V(e.barWidth)}}function Qi(t,l){t&1&&(r(0,"div"),c(1," Debes agregar al menos un archivo. "),o())}function Ki(t,l){if(t&1&&(r(0,"div"),c(1),o()),t&2){let e=d(4);s(),v(" El archivo es demasiado grande, el tama\xF1o maximo permitido es de ",e.MAX_FILE_SIZE,"MB. ")}}function en(t,l){if(t&1&&(r(0,"div",84),u(1,Qi,2,0,"div",85)(2,Ki,2,1,"div",85),o()),t&2){let e=d(3);s(),a("ngIf",e.files.errors&&e.files.errors.required),s(),a("ngIf",e.maxSizeError)}}function tn(t,l){t&1&&p(0,"span",108)}function nn(t,l){if(t&1){let e=b();r(0,"div",86)(1,"div",3)(2,"div",4)(3,"div",87)(4,"div",2),u(5,$i,3,1,"div",88)(6,qi,3,1,"div",89)(7,Hi,3,1,"div",90),r(8,"form")(9,"div",91)(10,"label",92)(11,"strong"),c(12,"T\xEDtulo*"),o()(),p(13,"input",93),u(14,Xi,2,1,"div",53),o(),r(15,"div",91)(16,"label",94)(17,"strong"),c(18,"Mensaje*"),o()(),p(19,"textarea",95),u(20,Yi,2,1,"div",53),o(),r(21,"div",91)(22,"label",96)(23,"strong"),c(24,"Archivos"),o()(),r(25,"input",97),_("change",function(i){g(e);let m=d(2);return h(m.fileChangeEvent(i))}),o(),u(26,Ji,4,3,"div",98)(27,en,3,2,"div",53),o(),r(28,"button",99),_("click",function(){g(e);let i=d(2);return h(i.onSubmit())}),u(29,tn,1,0,"span",100),r(30,"span",101),c(31,"Guardar"),o(),c(32," Guardar "),o()()()()()()()}if(t&2){let e=d(2);a("ngClass",f(16,Pe,e.lesson.conversations.length==0)),s(5),a("ngIf",e.status==="error"),s(),a("ngIf",e.status==="success"),s(),a("ngIf",e.status==="warning"),s(6),a("formControl",e.name)("ngClass",f(18,Ve,e.submitted&&e.name.errors)),s(),a("ngIf",e.submitted&&e.name.errors),s(5),a("formControl",e.message)("ngClass",f(20,Ve,e.submitted&&e.message.errors)),s(),a("ngIf",e.submitted&&e.message.errors),s(5),a("formControl",e.files)("ngClass",f(22,Ve,e.submitted&&e.files.errors||e.maxSizeError)),s(),a("ngIf",e.filesToUpload!=null||e.barWidth!="0%"),s(),a("ngIf",e.submitted&&e.files.errors||e.maxSizeError),s(),a("disabled",e.submitted),s(),a("ngIf",e.loading&&!e.name.invalid&&!e.files.invalid&&!e.message.invalid)}}function sn(t,l){if(t&1&&(r(0,"div",3)(1,"div",24)(2,"div",25),u(3,Ii,3,10,"div",26)(4,wi,3,6,"div",27),o()(),r(5,"div",28)(6,"div",29),u(7,Bi,24,19,"div",30)(8,nn,33,24,"div",31),o()()()),t&2){let e=d();s(3),a("ngForOf",e.groups),s(),a("ngIf",e.showResources()),s(3),a("ngForOf",e.groups),s(),a("ngIf",e.showResources())}}function on(t,l){t&1&&(r(0,"div",3)(1,"div",4)(2,"div",109)(3,"div",110)(4,"h4",68),c(5," No se han creado conversaciones en esta lecci\xF3n. "),o()()()()())}var It=(()=>{class t{constructor(e,n,i,m,x){this._userService=e,this._lessonService=n,this._uploadService=i,this._router=m,this._route=x,this.barWidth="0%",this.lesson_states=D,this.icon_style=xe,this.submitted=!1,this.deletedMsg="Se ha eliminado la conversaci\xF3n",this.added=new ie,this.MAX_FILE_SIZE=20,this.maxSize=20*1024*1024,this.maxSizeError=!1,this.loading=!1,this.editingMessage=null,this.editingText=new E(""),this.pollingHandle=null,this.filesToUpload=[],this.title="Conversaci\xF3n",this.identity=this._userService.getIdentity(),this.token=this._userService.getToken(),this.url=O.url,this.groups=[],this.errorMsg="Hubo un error agregando la conversaci\xF3n. Intentalo de nuevo m\xE1s tarde.",this.successMsg="Se ha creado la conversaci\xF3n correctamente.",this.warningMsg="Se estan subiendo los archivos, por favor espera mientras finaliza y evita cerrar esta ventana.",this.name=new E("",T.required),this.message=new E("",T.required),this.files=new E("")}ngOnInit(){this.getGroups(),this.selectedGroup=this.groups[0],this._route.parent?.url.subscribe(e=>{let n=e&&e.length>0?e[0]:null;this.parentUrl=n&&n.path||this._route.parent?.snapshot?.routeConfig?.path?.split("/")?.[0]||""}),this.startPolling()}getGroups(){this.groups=[],this.lesson.conversations.length>0&&this.lesson.conversations.forEach(e=>{this.groups.includes(e.conversationTitle)||this.groups.push(e.conversationTitle)})}restartValues(e){this.selectedGroup=e,this.status=null,this.maxSizeError=!1,this.submitted=!1,this.filesToUpload=[],this.getGroups()}ngDoCheck(){this.selectedGroup&&this.getMessages(this.selectedGroup)}showResources(){let e;return this.lesson.leader&&this.lesson.leader._id==this.identity._id&&["proposed","assigned","development","test"].includes(this.lesson.state)?e=!0:(e=!1,this.parentUrl=="admin"&&(e=!0)),e}getMessages(e){let n=[];return this.lesson.conversations.length>0&&(n=this.lesson.conversations.filter(i=>i.conversationTitle==e)),n}removeSpaces(e){return e.replace(/[\s\(\).,!"#$%&\/='¡¿áéíóú:0123456789a]/g,"")}getIndex(e){this.index=e}eliminar(){this.lesson.conversations.splice(this.index,1),this._lessonService.editLesson(this.token,this.lesson).subscribe(e=>{e.lesson&&e.lesson._id&&(this.lesson=e.lesson,this.getGroups(),this.selectedGroup=this.groups[0],this.status="deleted")},e=>{e!=null?(this.status="error",console.log(e)):this.status="error"})}fileChangeEvent(e){if(this.filesToUpload=e.target.files,this.filesToUpload.length>0)for(let n=0;n<this.filesToUpload.length;n++)if(this.maxSize<this.filesToUpload[n].size){this.maxSizeError=!0;return}else this.maxSizeError=!1}onSubmit(e=null){let n,i;this.submitted=!0,this.disableForm(this.submitted),i=new Ce(this.message.value),!(this.name.invalid||this.files.invalid||this.message.invalid||this.maxSizeError)&&(e?(i.conversationTitle=e,this.name.setValue("dummy")):i.conversationTitle=this.name.value,this.filesToUpload.length>0&&(n=new oe,n.fileName=this.filesToUpload[0].name,n.created_at=this.filesToUpload[0].lastModified/1e3,n.mimetype=this.filesToUpload[0].type),i.created_at=new Date,i.file=n,this._lessonService.addLessonMessage(this.token,this.lesson._id,{text:this.message.value,conversationTitle:i.conversationTitle,file:n||null}).subscribe({next:m=>{m&&m.lesson&&m.lesson._id?(this.lesson=m.lesson,this.status="success",this.submitted=!1,this.name.reset(),this.files.reset(),this.message.reset(),this.getGroups(),this.disableForm(!1)):(this.status="error",this.submitted=!1,this.disableForm(!1))},error:()=>{this.status="error",this.submitted=!1,this.disableForm(!1)}}))}disableForm(e){e==!0?(this.name.disable(),this.message.disable(),this.files.disable()):(this.name.enable(),this.message.enable(),this.files.enable())}editLesson(e){this.loading=!0,this._lessonService.editLesson(this.token,e).subscribe({next:n=>{n.lesson&&n.lesson._id?(this.lesson=n.lesson,this.filesToUpload.length===0?(this.status="success",this.submitted=!1,this.name.reset(),this.files.reset(),this.message.reset(),this.getGroups(),this.disableForm(!1),this.loading=!1):this.filesToUpload.length>0?this._uploadService.makeFileRequest(this.url+"upload-lesson/"+this.lesson._id,[],this.filesToUpload,this.token,"files").subscribe(i=>{switch(i.type){case te.UploadProgress:this.status="warning",this.barWidth=Math.round(i.loaded/i.total*100).toString()+"%";break;case te.Response:console.log("User successfully added!",i.body),this.submitted=!1,this.disableForm(!1),this.name.reset(),this.files.reset(),this.message.reset(),this.getGroups(),this.status="success",this.barWidth="0%",this.loading=!1}},i=>{this.status="error",this.barWidth="0%",this.submitted=!1,this.loading=!1,console.log(i)}):(this.status="error",this.submitted=!1,this.loading=!1)):(this.status="error",this.submitted=!1,this.loading=!1,this.errorMsg="Error al actualizar la lecci\xF3n. Respuesta inv\xE1lida del servidor.")},error:n=>{this.status="error",this.submitted=!1,this.loading=!1,console.error("Error updating lesson conversation:",n),n.status===500?this.errorMsg="Error interno del servidor. Por favor, verifica que todos los campos est\xE9n correctamente completados.":n.status===400?this.errorMsg=n.error?.message||"Datos inv\xE1lidos. Por favor, revisa los campos del formulario.":n.status===404?this.errorMsg="La lecci\xF3n no fue encontrada.":this.errorMsg=n.error?.message||"Hubo un error creando la conversaci\xF3n. Int\xE9ntalo de nuevo m\xE1s tarde."}})}canEditMessage(e){let n=e?.author&&e.author._id===this.identity._id,i=this.parentUrl==="admin";return!!(n||i)}startEditMessage(e){this.canEditMessage(e)&&(this.editingMessage=e,this.editingText.setValue(e.text||""))}cancelEditMessage(){this.editingMessage=null,this.editingText.reset("")}saveEditMessage(e){if(!this.editingMessage)return;let n=(this.editingText.value||"").toString().trim();if(!n)return;let i=this.editingMessage._id;this._lessonService.editLessonMessage(this.token,this.lesson._id,i,{text:n,scope:"conversations"}).subscribe({next:m=>{m?.lesson?._id&&(this.lesson=m.lesson,this.getGroups()),this.editingMessage=null,this.editingText.reset("")},error:()=>{this.editingMessage=null,this.editingText.reset("")}})}deleteMessage(e){if(!this.canEditMessage(e))return;let n=this.lesson.conversations.findIndex(i=>i===e);n>=0&&(this.lesson.conversations.splice(n,1),this.editLesson(this.lesson))}startPolling(){this.pollingHandle||(this.pollingHandle=setInterval(()=>{this.submitted||this.loading||this.editingMessage||this.lesson?._id&&this._lessonService.getLesson(this.token,this.lesson._id).subscribe({next:e=>{e?.lesson?._id&&(this.lesson=e.lesson,this.getGroups())},error:()=>{}})},1e4))}ngOnDestroy(){this.pollingHandle&&(clearInterval(this.pollingHandle),this.pollingHandle=null)}static{this.\u0275fac=function(n){return new(n||t)(C(R),C(U),C(he),C(se),C(W))}}static{this.\u0275cmp=k({type:t,selectors:[["conversation"]],inputs:{lesson:"lesson"},outputs:{added:"added"},standalone:!1,decls:24,vars:4,consts:[["editForm",""],["progress",""],[1,"card-body"],[1,"row"],[1,"col"],[1,"card","mb-3","text-center"],[3,"class",4,"ngIf"],["class","alert alert-primary fade show text-center","role","alert",4,"ngIfSuccessMessage","ngIf"],["class","row",4,"ngIf"],["id","deleteModal","tabindex","-1","role","dialog","aria-labelledby","Eliminar conversacion","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-dialog-centered"],[1,"modal-content"],[1,"modal-header"],["id","eliminarConv",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],["role","alert",1,"alert","alert-warning","mb-0"],[1,"fas","fa-exclamation-triangle","icon-message","me-2"],[1,"modal-footer"],["data-bs-dismiss","modal",1,"btn","btn-danger",3,"click"],["data-bs-dismiss","modal",1,"btn","btn-primary","text-white"],[1,"mb-0","text-white"],["role","alert",1,"alert","alert-primary","fade","show","text-center"],[1,"fas","fa-check-circle","icon-message","me-2"],[1,"col-4"],["id","v-pills-tab","role","tablist","aria-orientation","vertical",1,"border","rounded","nav","flex-column","nav-pills"],["class","nav-link","data-bs-toggle","pill","role","tab","aria-selected","true","style","display: flex;",3,"ngClass","id","click",4,"ngFor","ngForOf"],["class","nav-link","style","cursor: pointer;","id","addGroup-tab","data-bs-toggle","pill","href","#addGroup","role","tab","aria-controls","addGroup","aria-selected","false",3,"ngClass","click",4,"ngIf"],[1,"col-8"],["id","v-pills-tabContent",1,"tab-content"],["class","tab-pane fade","role","tabpanel",3,"ngClass","id",4,"ngFor","ngForOf"],["class","tab-pane fade","id","addGroup","role","tabpanel","aria-labelledby","addGroup-tab",3,"ngClass",4,"ngIf"],["data-bs-toggle","pill","role","tab","aria-selected","true",1,"nav-link",2,"display","flex",3,"click","ngClass","id"],["class","iconOpt",4,"ngIf"],[1,"iconOpt"],["type","button","id","dropdownMenu2","data-bs-toggle","dropdown","aria-haspopup","true","aria-expanded","false",1,"fas","fa-ellipsis-v"],["aria-labelledby","dropdownMenu2",1,"dropdown-menu"],["type","button","data-bs-toggle","modal","data-bs-target","#deleteModal","aria-label","delete",1,"dropdown-item",3,"click"],["id","addGroup-tab","data-bs-toggle","pill","href","#addGroup","role","tab","aria-controls","addGroup","aria-selected","false",1,"nav-link",2,"cursor","pointer",3,"click","ngClass"],[1,"fas","fa-plus"],["role","tabpanel",1,"tab-pane","fade",3,"ngClass","id"],[1,"card",2,"max-height","60vh","overflow","auto"],[1,"card-body","py-1"],["class","row mt-2",4,"ngFor","ngForOf"],[1,"row","mt-3"],[1,"col-auto"],["data-bs-dismiss","modal",1,"text-primary",3,"routerLink"],[1,"flex-shrink-0","rounded-circle","border-1","overflow-hidden",2,"width","40px","height","40px"],["class","img-fluid","src","assets/images/user-default.png",4,"ngIf"],["class","img-fluid",3,"src",4,"ngIf"],[1,"col","px-0"],[1,"mb-3","mb-1"],["rows","2","placeholder","Escribe un mensaje...","id","message","autofocus","",1,"form-control",3,"formControl","ngClass"],["class","invalid-feedback",4,"ngIf"],["class","text-muted",4,"ngIf"],[1,"col-auto","ps-3","pe-0"],["for","files","title","Adjuntar archivo",1,"btn","btn-sm","text-success"],[1,"fas","fa-paperclip",2,"cursor","pointer"],["type","file","name","files","id","files","enctype","multipart/form-data",1,"form-control",2,"display","none",3,"change","formControl"],["title","Enviar mensaje",1,"btn","btn-sm","btn-success",3,"click"],[1,"fas","fa-paper-plane"],[1,"row","mt-2"],["class","col-auto",4,"ngIf"],["class","col bg-light rounded-left p-2",4,"ngIf"],["src","assets/images/user-default.png",1,"img-fluid"],[1,"img-fluid",3,"src"],[1,"col","bg-light","rounded-left","p-2"],[1,"mb-1"],[1,"text-muted"],[4,"ngIf","ngIfElse"],[1,"card-text",3,"innerHTML"],["target","_blank",3,"title","href",4,"ngIf"],["class","mt-2",4,"ngIf"],["target","_blank",3,"title","href"],[1,"fas","fa-paperclip"],[1,"mt-2"],[1,"btn","btn-sm","btn-outline-primary","me-2",3,"click"],[1,"fas","fa-edit"],[1,"btn","btn-sm","btn-outline-danger",3,"click"],[1,"fas","fa-trash"],["rows","2",1,"form-control","mb-2",3,"formControl"],[1,"btn","btn-sm","btn-success","me-2",3,"click"],[1,"fas","fa-save"],[1,"btn","btn-sm","btn-secondary",3,"click"],[1,"invalid-feedback"],[4,"ngIf"],["id","addGroup","role","tabpanel","aria-labelledby","addGroup-tab",1,"tab-pane","fade",3,"ngClass"],[1,"card",2,"height","60vh","overflow","auto"],["class","alert alert-danger fade show text-center","role","alert",4,"ngIfSuccessMessage","ngIf"],["class","alert alert-success fade show text-center","role","alert",4,"ngIfSuccessMessage","ngIf"],["class","alert alert-warning fade show text-center","role","alert",4,"ngIfSuccessMessage","ngIf"],[1,"mb-3"],["for","name"],["type","text","id","name","autocomplete","off",1,"form-control",3,"formControl","ngClass"],["for","message"],["rows","3","placeholder","Escribe un mensaje...","id","message",1,"form-control",3,"formControl","ngClass"],["for","files"],["type","file","name","files","id","files","enctype","multipart/form-data",1,"form-control",3,"change","formControl","ngClass"],["class","progress",4,"ngIf"],["type","submit",1,"btn","btn-success","mb-2","float-right",3,"click","disabled"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],[1,"sr-only"],["role","alert",1,"alert","alert-danger","fade","show","text-center"],[1,"fas","fa-times-circle","icon-message","me-2"],["role","alert",1,"alert","alert-success","fade","show","text-center"],["role","alert",1,"alert","alert-warning","fade","show","text-center"],[1,"progress"],["role","progressbar","aria-valuenow","barWidth","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","progress-bar-striped","progress-bar-animated"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"],[1,"card"],[1,"card-body","text-start"]],template:function(n,i){n&1&&(r(0,"div",2)(1,"div",3)(2,"div",4)(3,"div",5),u(4,yi,3,5,"div",6),o()()(),u(5,Ei,3,1,"div",7)(6,sn,9,4,"div",8)(7,on,6,0,"div",8),o(),r(8,"div",9)(9,"div",10)(10,"div",11)(11,"div",12)(12,"h5",13),c(13,"Eliminar conversaci\xF3n"),o(),p(14,"button",14),o(),r(15,"div",15)(16,"div",16),p(17,"i",17),c(18," \xBFEstas seguro que quieres eliminar la conversaci\xF3n? Perder\xE1s el acceso a los archivos que se hayan compartido dentro de la conversaci\xF3n "),o()(),r(19,"div",18)(20,"button",19),_("click",function(){return i.eliminar()}),c(21,"S\xED"),o(),r(22,"button",20),c(23,"No"),o()()()()()),n&2&&(s(4),a("ngIf",i.lesson.state),s(),a("ngIf",i.status==="deleted"),s(),a("ngIf",i.lesson.conversations.length>0||i.identity._id==i.lesson.leader._id),s(),a("ngIf",i.lesson.conversations.length<=0&&i.identity._id!=i.lesson.leader._id))},dependencies:[q,P,L,j,H,A,z,_e,ve,G,Z,Y,J,be],styles:[".disable[_ngcontent-%COMP%]{pointer-events:none;opacity:2}.iconOpt[_ngcontent-%COMP%]{position:absolute;right:13%;float:right;color:#fff;cursor:pointer}"]})}}return t})();var an=t=>({active:t}),wt=t=>({disable:t}),Ae=t=>({"show active":t}),Ge=t=>({"is-invalid":t});function ln(t,l){if(t&1&&(r(0,"div")(1,"h5",22),c(2),o()()),t&2){let e=d();M("card-header bg-",e.lesson_states[e.lesson.state].class,""),s(2),w(" ",e.title," - ",e.lesson.title," ")}}function dn(t,l){if(t&1&&(r(0,"div",23),p(1,"i",24),c(2),o()),t&2){let e=d();s(2),v(" ",e.deletedMsg," ")}}function cn(t,l){if(t&1&&(r(0,"div",25),p(1,"i",24),c(2),o()),t&2){let e=d();s(2),v(" ",e.warningMsgF," ")}}function mn(t,l){if(t&1&&(r(0,"div",26),p(1,"i",24),c(2),o()),t&2){let e=d();s(2),v(" ",e.successMsgEdit," ")}}function pn(t,l){if(t&1&&(r(0,"div",26),p(1,"i",24),c(2),o()),t&2){let e=d();s(2),v(" ",e.successMsg," ")}}function un(t,l){if(t&1){let e=b();r(0,"section",37)(1,"a",38)(2,"i",39),_("click",function(i){g(e);let m=d().$implicit,x=d(2);return h(x.initEditGroup(i,m))}),o()(),r(3,"a",40)(4,"i",41),_("click",function(i){g(e);let m=d().$implicit,x=d(2);return h(x.confirmDeleteGroup(i,m))}),o()()()}}function _n(t,l){if(t&1){let e=b();r(0,"div",35),_("click",function(i){let m=g(e).$implicit,x=d(2);return h(x.handleTabClick(i,m))}),c(1),u(2,un,5,0,"section",36),o()}if(t&2){let e=l.$implicit,n=l.index,i=d(2);Q("href","#",i.removeSpaces(e),""),ee("id","",i.removeSpaces(e),"-tab"),a("ngClass",f(9,an,n==0&&!i.addingNewGroup))("ngClass",f(11,wt,i.loading)),ne("aria-controls",i.removeSpaces(e)),s(),v(" ",e," "),s(),a("ngIf",i.selectedGroup==e&&i.showResources())}}function vn(t,l){if(t&1){let e=b();r(0,"div",42),_("click",function(i){g(e);let m=d(2);return h(m.handleAddGroupTabClick(i))}),p(1,"i",43),c(2," Agregar grupo de recursos "),o()}if(t&2){let e=d(2);a("ngClass",f(2,Ae,e.lesson.files.length==0||e.addingNewGroup))("ngClass",f(4,wt,e.loading))}}function fn(t,l){if(t&1&&(r(0,"div",23),p(1,"i",24),c(2),o()),t&2){let e=d(3);s(2),v(" ",e.deletedMsgF," ")}}function gn(t,l){if(t&1&&(r(0,"div",56),p(1,"i",57),c(2),o()),t&2){let e=d(4);s(2),v(" ",e.errorMsgEdit," ")}}function hn(t,l){if(t&1&&(r(0,"div",26),p(1,"i",24),c(2),o()),t&2){let e=d(4);s(2),v(" ",e.successMsgEdit," ")}}function xn(t,l){if(t&1&&(r(0,"div",58),p(1,"i",24),c(2),o()),t&2){let e=d(4);s(2),v(" ",e.warningMsg," ")}}function bn(t,l){t&1&&(r(0,"div"),c(1," El campo nombre es obligatorio. "),o())}function Cn(t,l){if(t&1&&(r(0,"div",59),u(1,bn,2,0,"div",47),o()),t&2){let e=d(4);s(),a("ngIf",e.name.errors.required)}}function yn(t,l){if(t&1){let e=b();r(0,"section"),u(1,gn,3,1,"div",49)(2,hn,3,1,"div",50)(3,xn,3,1,"div",51),r(4,"div",52)(5,"label",53)(6,"strong"),c(7,"Nombre*"),o()(),r(8,"input",54),_("change",function(){g(e);let i=d(3);return h(i.onChanges())}),o(),u(9,Cn,2,1,"div",55),o()()}if(t&2){let e=d(3);s(),a("ngIf",e.status==="error"),s(),a("ngIf",e.status==="success"),s(),a("ngIf",e.status==="warning"),s(5),a("formControl",e.name)("disabled",e.loading)("ngClass",f(7,Ge,e.submitted&&e.name.errors)),s(),a("ngIf",e.submitted&&e.name.errors)}}function En(t,l){if(t&1&&(r(0,"div",65)(1,"div",66,0),c(3),o()()),t&2){let e=d(4);s(),K("width",e.barWidth),s(2),V(e.barWidth)}}function Sn(t,l){t&1&&(r(0,"div"),c(1," Debes agregar al menos un archivo. "),o())}function In(t,l){if(t&1&&(r(0,"div"),c(1),o()),t&2){let e=d(5);s(),v(" El archivo es demasiado grande, el tama\xF1o maximo permitido es de ",e.MAX_FILE_SIZE,"MB. ")}}function wn(t,l){if(t&1&&(r(0,"div",59),u(1,Sn,2,0,"div",47)(2,In,2,1,"div",47),o()),t&2){let e=d(4);s(),a("ngIf",e.files.errors&&e.files.errors.required),s(),a("ngIf",e.maxSizeError)}}function Tn(t,l){t&1&&p(0,"span",67)}function Mn(t,l){if(t&1){let e=b();r(0,"section")(1,"div",52)(2,"label",60)(3,"strong"),c(4,"Archivos"),o()(),r(5,"input",61),_("change",function(i){g(e);let m=d(3);return h(m.fileChangeEvent(i))}),o(),u(6,En,4,3,"div",62)(7,wn,3,2,"div",55),o(),r(8,"button",63),_("click",function(){g(e);let i=d().$implicit,m=d(2);return h(m.onSubmit(i))}),u(9,Tn,1,0,"span",64),c(10," Guardar "),o()()}if(t&2){let e=d(3);s(5),a("disabled",e.loading)("formControl",e.files)("ngClass",f(7,Ge,e.submitted&&e.files.errors||e.maxSizeError)),s(),a("ngIf",e.loading||e.barWidth!="0%"),s(),a("ngIf",e.submitted&&e.files.errors||e.maxSizeError),s(),a("disabled",e.loading),s(),a("ngIf",e.loading)}}function Fn(t,l){if(t&1){let e=b();r(0,"a",71),_("click",function(){g(e);let i=d().$implicit,m=d(3);return h(m.confirmDeleteFile(i._id,i.fileName))}),p(1,"i",72),o()}}function kn(t,l){if(t&1&&(r(0,"p")(1,"a",68),p(2,"i",69),c(3),o(),u(4,Fn,2,0,"a",70),o()),t&2){let e=l.$implicit,n=d(3);s(),ee("title","Descargar : ",e.fileName,""),y("href",n.url+"get-lesson/"+e.fileName,I),s(2),v(" ",e.fileName," "),s(),a("ngIf",n.editMode&&n.showResources())}}function Ln(t,l){if(t&1&&(r(0,"div",44)(1,"div",2)(2,"div",3)(3,"div",45)(4,"div",1),u(5,fn,3,1,"div",46)(6,yn,10,9,"section",47)(7,Mn,11,9,"section",47)(8,kn,5,5,"p",48),o()()()()()),t&2){let e=l.$implicit,n=l.index,i=d(2);Q("aria-labelledby","",i.removeSpaces(e),"-tab"),y("id",i.removeSpaces(e)),a("ngClass",f(8,Ae,n==0&&!i.addingNewGroup&&i.groups.length>0)),s(5),a("ngIf",i.status==="deletedF"),s(),a("ngIf",i.editMode&&i.showResources()),s(),a("ngIf",i.editMode&&i.showResources()),s(),a("ngForOf",i.getfiles(e))}}function On(t,l){t&1&&(r(0,"div",78),p(1,"i",79),r(2,"div"),c(3," Est\xE1s creando un "),r(4,"strong"),c(5,"nuevo grupo de recursos"),o(),c(6,". 1) Escribe el "),r(7,"strong"),c(8,"Nombre"),o(),c(9," del grupo. 2) Selecciona uno o m\xE1s "),r(10,"strong"),c(11,"Archivos"),o(),c(12,". 3) Presiona "),r(13,"strong"),c(14,"Guardar"),o(),c(15,". "),o()())}function Rn(t,l){if(t&1&&(r(0,"div",56),p(1,"i",57),c(2),o()),t&2){let e=d(3);s(2),v(" ",e.errorMsg," ")}}function Vn(t,l){if(t&1&&(r(0,"div",23),p(1,"i",24),c(2),o()),t&2){let e=d(3);s(2),v(" ",e.deletedMsg," ")}}function Pn(t,l){if(t&1&&(r(0,"div",26),p(1,"i",24),c(2),o()),t&2){let e=d(3);s(2),v(" ",e.successMsg," ")}}function Gn(t,l){if(t&1&&(r(0,"div",58),p(1,"i",24),c(2),o()),t&2){let e=d(3);s(2),v(" ",e.warningMsg," ")}}function Un(t,l){t&1&&(r(0,"div"),c(1," El campo nombre es obligatorio. "),o())}function Dn(t,l){if(t&1&&(r(0,"div",59),u(1,Un,2,0,"div",47),o()),t&2){let e=d(3);s(),a("ngIf",e.name.errors.required)}}function Nn(t,l){if(t&1&&(r(0,"div",65)(1,"div",66,0),c(3),o()()),t&2){let e=d(3);s(),K("width",e.barWidth),s(2),V(e.barWidth)}}function An(t,l){t&1&&(r(0,"div"),c(1," Debes agregar al menos un archivo. "),o())}function zn(t,l){if(t&1&&(r(0,"div"),c(1),o()),t&2){let e=d(4);s(),v(" El archivo es demasiado grande, el tama\xF1o maximo permitido es de ",e.MAX_FILE_SIZE,"MB. ")}}function jn(t,l){if(t&1&&(r(0,"div",59),u(1,An,2,0,"div",47)(2,zn,2,1,"div",47),o()),t&2){let e=d(3);s(),a("ngIf",e.files.errors&&e.files.errors.required),s(),a("ngIf",e.maxSizeError)}}function Bn(t,l){t&1&&p(0,"span",67)}function $n(t,l){if(t&1){let e=b();r(0,"div",73)(1,"div",2)(2,"div",3)(3,"div",45)(4,"div",1),u(5,On,16,0,"div",74)(6,Rn,3,1,"div",49)(7,Vn,3,1,"div",46)(8,Pn,3,1,"div",50)(9,Gn,3,1,"div",75),r(10,"form")(11,"div",52)(12,"label",53)(13,"strong"),c(14,"Nombre*"),o()(),r(15,"input",76),_("change",function(){g(e);let i=d(2);return h(i.onChanges())})("input",function(){g(e);let i=d(2);return h(i.onChanges())}),o(),u(16,Dn,2,1,"div",55),o(),r(17,"div",52)(18,"label",60)(19,"strong"),c(20,"Archivos"),o()(),r(21,"input",61),_("change",function(i){g(e);let m=d(2);return h(m.fileChangeEvent(i))}),o(),r(22,"small",77),c(23,"Puedes seleccionar varios archivos a la vez."),o(),u(24,Nn,4,3,"div",62)(25,jn,3,2,"div",55),o(),r(26,"button",63),_("click",function(){g(e);let i=d(2);return h(i.onSubmit())}),u(27,Bn,1,0,"span",64),c(28," Guardar "),o()()()()()()()}if(t&2){let e=d(2);a("ngClass",f(17,Ae,e.lesson.files.length==0||e.addingNewGroup)),s(5),a("ngIf",e.addingNewGroup),s(),a("ngIf",e.status==="error"),s(),a("ngIf",e.status==="deleted"),s(),a("ngIf",e.status==="success"),s(),a("ngIf",e.status==="warning"),s(6),a("formControl",e.name)("disabled",e.loading)("ngClass",f(19,Ge,e.submitted&&e.name.errors)),s(),a("ngIf",e.submitted&&e.name.errors),s(5),a("disabled",e.loading)("formControl",e.files)("ngClass",f(21,Ge,e.submitted&&e.files.errors||e.maxSizeError)),s(3),a("ngIf",e.loading||e.barWidth!="0%"),s(),a("ngIf",e.submitted&&e.files.errors||e.maxSizeError),s(),a("disabled",e.loading),s(),a("ngIf",e.loading)}}function qn(t,l){if(t&1&&(r(0,"div",2)(1,"div",27)(2,"div",28),u(3,_n,3,13,"div",29)(4,vn,3,6,"div",30),o()(),r(5,"div",31)(6,"div",32),u(7,Ln,9,10,"div",33)(8,$n,29,23,"div",34),o()()()),t&2){let e=d();s(3),a("ngForOf",e.groups),s(),a("ngIf",e.showResources()),s(3),a("ngForOf",e.groups),s(),a("ngIf",e.showResources())}}function Hn(t,l){t&1&&(r(0,"div",2)(1,"div",3)(2,"div",45)(3,"div",80)(4,"h4",81),c(5," No se han agregado recursos a esta lecci\xF3n. "),o()()()()())}var Tt=(()=>{class t{constructor(e,n,i,m,x){this._userService=e,this._lessonService=n,this._uploadService=i,this._router=m,this._route=x,this.lesson_states=D,this.icon_style=xe,this.submitted=!1,this.warningMsgF="Se esta eliminando el grupo",this.deletedMsgF="Se ha eliminado el archivo",this.editMode=!1,this.added=new ie,this.MAX_FILE_SIZE=20,this.maxSize=20*1024*1024,this.maxSizeError=!1,this.barWidth="0%",this.unsaved=[],this.addingNewGroup=!1,this.confirmLeaveMessage="",this.filesToUpload=[],this.filesUploaded=[],this.title="Recursos de la lecci\xF3n",this.identity=this._userService.getIdentity(),this.token=this._userService.getToken(),this.url=O.url,this.groups=[],this.errorMsg="Hubo un error agregando el grupo. Intentalo de nuevo m\xE1s tarde.",this.successMsg="Se ha creado el grupo de recursos correctamente.",this.errorMsgEdit="Hubo un error editando el grupo. Intentalo de nuevo m\xE1s tarde.",this.successMsgEdit="Se ha editado el grupo de recursos correctamente.",this.warningMsg="Se estan subiendo los archivos, por favor espera y evita cerrar esta ventana.",this.deletedMsg="Se ha eliminado el grupo de recursos",this.name=new E("",T.required),this.files=new E("",T.required)}ngOnInit(){this.getGroups(),this.selectedGroup=this.groups[0],this._route.parent?.url.subscribe(e=>{let n=e&&e.length>0?e[0]:null;this.parentUrl=n&&n.path||this._route.parent?.snapshot?.routeConfig?.path?.split("/")?.[0]||""})}getGroups(){this.groups=[],this.lesson.files.length>0&&this.lesson.files.forEach(e=>{this.groups.includes(e.groupTitle)||this.groups.push(e.groupTitle)})}restartValues(e){this.selectedGroup=e,this.status=null,this.maxSizeError=!1,this.submitted=!1,this.editMode==!0&&(this.lesson.files=this.unsaved),this.editMode=!1,this.name.reset(),this.files.reset(),this.files.setValidators(T.required),this.getGroups(),this.addingNewGroup=!1}startAddGroup(){this.restartValues(null),this.addingNewGroup=!0}disableForm(e){e==!0?(this.name.disable(),this.files.disable()):(this.name.enable(),this.files.enable())}deleteFile(e){let n=[];this.lesson.files.forEach(i=>{i._id!=e&&n.push(i)}),this.unsaved=this.lesson.files,this.lesson.files=n,this.lesson.files.length===0&&(this.addingNewGroup=!0)}confirmDeleteFile(e,n){let i=n?`\xBFDeseas eliminar el archivo "${n}"? Los cambios se aplicar\xE1n al guardar.`:"\xBFDeseas eliminar este archivo? Los cambios se aplicar\xE1n al guardar.";window.confirm(i)&&this.deleteFile(e)}getfiles(e){let n=[];return this.lesson.files.length>0&&(n=this.lesson.files.filter(i=>i.groupTitle==e)),n}removeSpaces(e){return e.replace(/[\s\(\).,!"#$%&\/='¡¿áéíóú:0123456789a]/g,"")}fileChangeEvent(e){if(this.filesToUpload=e.target.files,this.filesToUpload.length>0)for(let n=0;n<this.filesToUpload.length;n++)if(this.maxSize<this.filesToUpload[n].size){this.maxSizeError=!0;return}else this.maxSizeError=!1}deleteGroup(e){let n=[];n=this.lesson.files.filter(i=>i.groupTitle!=e),console.log(n),this.lesson.files=n,this.groups.splice(this.groups.indexOf(e),1),this.lesson.files.length===0&&(this.addingNewGroup=!0),this.editLesson(this.lesson,"deleted")}initEditGroup(e,n){e.stopPropagation(),this.editMode=!0,this.name.setValue(n),this.files.clearValidators(),this.files.updateValueAndValidity()}confirmDeleteGroup(e,n){e.stopPropagation();let i=`\xBFDeseas eliminar  el grupo de recursos"${n}" y todos sus archivos?`;window.confirm(i)&&this.deleteGroup(n)}onSubmit(e=null){this.loading=!0;let n;if(this.submitted=!0,this.name.invalid||this.files.invalid||this.maxSizeError){this.loading=!1;return}if(this.filesToUpload.length>0)for(let i=0;i<this.filesToUpload.length;i++)n=new oe,n.groupTitle=this.name.value,n.fileName=this.filesToUpload[i].name,n.created_at=this.filesToUpload[i].lastModified/1e3,n.mimetype=this.filesToUpload[i].type,this.filesUploaded.push(n);this.lesson.files=this.lesson.files.concat(this.filesUploaded),this.filesUploaded=[],e!=null&&e!=this.name.value&&(this.filesUploaded=this.lesson.files.map(i=>(i.groupTitle==e&&(i.groupTitle=this.name.value),i)),this.lesson.files=this.filesUploaded,this.filesUploaded=[]),this.editLesson(this.lesson,"success",e)}editLesson(e,n=null,i=null){n==="deleted"&&(this.status="warningD"),n==="success"&&(this.status="warning"),this._lessonService.editLesson(this.token,e).subscribe({next:m=>{m.lesson&&m.lesson._id?(this.lesson=m.lesson,this.filesToUpload.length>0&&this._uploadService.makeFileRequest(this.url+"upload-lesson/"+this.lesson._id,[],this.filesToUpload,this.token,"files").subscribe({next:x=>{switch(x.type){case te.UploadProgress:this.barWidth=Math.round(x.loaded/x.total*100).toString()+"%";break;case te.Response:console.log("User successfully added!",x.body),this.submitted=!1,this.status=n,this.barWidth="0%",this.files.reset(),this.filesToUpload=[],this.editMode||this.name.reset(),this.loading=!1;break}},error:x=>{this.status="error",this.barWidth="0%",this.submitted=!1,console.log(x)}}),this.filesToUpload.length===0&&(this.files.reset(),this.submitted=!1,this.getGroups(),this.loading=!1,this.status=n,this.editMode||this.name.reset()),this.editMode===!0&&(this.editMode=!1,this.status="successE",this.selectedGroup=i,this.loading=!1),n==="deleted"&&(this.status="deletedD",this.loading=!1)):(this.status="error",this.loading=!1)},error:m=>{this.status="error",this.loading=!1,console.error("Error updating lesson resources:",m),m.status===500?this.errorMsg="Error interno del servidor. Por favor, verifica que todos los archivos sean v\xE1lidos.":m.status===400?this.errorMsg=m.error?.message||"Datos inv\xE1lidos. Por favor, revisa los archivos seleccionados.":m.status===404?this.errorMsg="La lecci\xF3n no fue encontrada.":this.errorMsg=m.error?.message||"Hubo un error agregando los recursos. Int\xE9ntalo de nuevo m\xE1s tarde."}}),this.submitted=!1}handleBeforeUnload(e){let n=this.loading||this.barWidth!=="0%",i=this.name?.value&&this.name.value!==""||this.filesToUpload&&this.filesToUpload.length>0||this.editMode||this.submitted;(n||i)&&(e.preventDefault(),e.returnValue="")}showResources(){let e;return this.lesson.leader&&this.lesson.leader._id==this.identity._id&&["proposed","assigned","development","test"].includes(this.lesson.state)?e=!0:(e=!1,this.parentUrl=="admin"&&(e=!0)),e}onChanges(){this.name.valueChanges.subscribe({next:e=>{e&&(this.status=null,this.submitted=!1)}})}openConfirmLeave(e){return this.confirmLeaveMessage=e,new Promise(n=>{setTimeout(()=>{try{let i=document.getElementById("confirmLeaveModal");if(!i){let Gt=window.confirm(e);n(Gt);return}let m=window.bootstrap?.Modal?.getInstance(i);m||(m=new window.bootstrap.Modal(i,{backdrop:"static",keyboard:!1}));let x=i.querySelector("[data-confirm]"),B=i.querySelector("[data-cancel]"),$=()=>{x?.removeEventListener("click",ze),B?.removeEventListener("click",we),i.removeEventListener("hidden.bs.modal",we)},ze=()=>{$(),n(!0),m.hide()},we=()=>{$(),n(!1)};x?.addEventListener("click",ze),B?.addEventListener("click",we),i.addEventListener("hidden.bs.modal",we),m.show()}catch(i){console.error("Error al abrir modal de confirmaci\xF3n de salida:",i);let m=window.confirm(e);n(m)}},0)})}handleTabClick(e,n){let i=this.loading||this.barWidth!=="0%",m=this.name?.value&&this.name.value!==""||this.filesToUpload&&this.filesToUpload.length>0||this.editMode||this.submitted;if(i||m){e.preventDefault(),e.stopPropagation();let x=i?"Hay una carga de archivos en progreso. Si cambias de pesta\xF1a se cancelar\xE1. \xBFDeseas continuar?":"Tienes cambios sin guardar. \xBFDeseas descartar y continuar?";this.openConfirmLeave(x).then(B=>{B&&this.restartValues(n)});return}this.restartValues(n)}handleAddGroupTabClick(e){let n=this.loading||this.barWidth!=="0%",i=this.name?.value&&this.name.value!==""||this.filesToUpload&&this.filesToUpload.length>0||this.editMode||this.submitted;if(n||i){e.preventDefault(),e.stopPropagation();let m=n?"Hay una carga de archivos en progreso. Si cambias de pesta\xF1a se cancelar\xE1. \xBFDeseas continuar?":"Tienes cambios sin guardar. \xBFDeseas descartar y continuar?";this.openConfirmLeave(m).then(x=>{x&&(this.editMode&&(this.lesson.files=this.unsaved,this.editMode=!1),this.startAddGroup())});return}this.startAddGroup()}static{this.\u0275fac=function(n){return new(n||t)(C(R),C(U),C(he),C(se),C(W))}}static{this.\u0275cmp=k({type:t,selectors:[["resources"]],hostBindings:function(n,i){n&1&&_("beforeunload",function(x){return i.handleBeforeUnload(x)},!1,Te)},inputs:{lesson:"lesson"},outputs:{added:"added"},standalone:!1,decls:27,vars:8,consts:[["progress",""],[1,"card-body"],[1,"row"],[1,"col"],[1,"card","mb-3","text-center"],[3,"class",4,"ngIf"],["class","alert alert-primary fade show text-center","role","alert",4,"ngIf"],["class","alert alert-info fade show text-center","role","alert",4,"ngIf"],["class","alert alert-success fade show text-center","role","alert",4,"ngIf"],["class","row",4,"ngIf"],["id","confirmLeaveModal","tabindex","-1","aria-labelledby","confirmLeaveTitle","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],["id","confirmLeaveTitle",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],["role","alert",1,"alert","alert-warning","mb-0"],[1,"fas","fa-exclamation-triangle","me-2"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal","data-cancel","",1,"btn","btn-secondary"],["type","button","data-confirm","",1,"btn","btn-primary"],[1,"mb-0","text-white"],["role","alert",1,"alert","alert-primary","fade","show","text-center"],[1,"fas","fa-check-circle","icon-message","me-2"],["role","alert",1,"alert","alert-info","fade","show","text-center"],["role","alert",1,"alert","alert-success","fade","show","text-center"],[1,"col-5"],["id","v-pills-tab","role","tablist","aria-orientation","vertical",1,"border","rounded","nav","flex-column","nav-pills"],["class","nav-link","data-bs-toggle","pill","role","tab","aria-selected","true",3,"ngClass","id","click",4,"ngFor","ngForOf"],["class","nav-link","style","cursor: pointer;","id","addGroup-tab","data-bs-toggle","pill","href","#addGroup","role","tab","aria-controls","addGroup","aria-selected","false",3,"ngClass","click",4,"ngIf"],[1,"col-7"],["id","v-pills-tabContent",1,"tab-content"],["class","tab-pane fade","role","tabpanel",3,"ngClass","id",4,"ngFor","ngForOf"],["class","tab-pane fade","id","addGroup","role","tabpanel","aria-labelledby","addGroup-tab",3,"ngClass",4,"ngIf"],["data-bs-toggle","pill","role","tab","aria-selected","true",1,"nav-link",3,"click","ngClass","id"],["class","float-right",4,"ngIf"],[1,"float-right"],["title","Editar grupo (cambiar nombre o archivos)","aria-label","Editar grupo","data-bs-toggle","tooltip","data-bs-placement","top",1,"resource-edit","me-1"],[1,"fas","fa-edit",3,"click"],["title","Eliminar grupo (se borrar\xE1n sus archivos)","aria-label","Eliminar grupo","data-bs-toggle","tooltip","data-bs-placement","top",1,"resource-delete","ms-1"],[1,"fas","fa-trash",3,"click"],["id","addGroup-tab","data-bs-toggle","pill","href","#addGroup","role","tab","aria-controls","addGroup","aria-selected","false",1,"nav-link",2,"cursor","pointer",3,"click","ngClass"],[1,"fas","fa-plus"],["role","tabpanel",1,"tab-pane","fade",3,"ngClass","id"],[1,"card"],["class","alert alert-primary fade show text-center","role","alert",4,"ngIfSuccessMessage","ngIf"],[4,"ngIf"],[4,"ngFor","ngForOf"],["class","alert alert-danger fade show text-center","role","alert",4,"ngIfSuccessMessage","ngIf"],["class","alert alert-success fade show text-center","role","alert",4,"ngIfSuccessMessage","ngIf"],["class","alert alert-warning fade show text-center","role","alert",4,"ngIf"],[1,"form-group"],["for","name"],["type","text","id","name","autocomplete","off",1,"form-control",3,"change","formControl","disabled","ngClass"],["class","invalid-feedback",4,"ngIf"],["role","alert",1,"alert","alert-danger","fade","show","text-center"],[1,"fas","fa-times-circle","icon-message","me-2"],["role","alert",1,"alert","alert-warning","fade","show","text-center"],[1,"invalid-feedback"],["for","resourcesFiles"],["multiple","","type","file","name","files","id","resourcesFiles","enctype","multipart/form-data",1,"form-control",3,"change","disabled","formControl","ngClass"],["class","progress",4,"ngIf"],["type","submit",1,"btn","btn-success","mb-2","float-end",3,"click","disabled"],["class","spinner-border spinner-border-sm me-2","role","status","aria-hidden","true",4,"ngIf"],[1,"progress"],["role","progressbar","aria-valuenow","barWidth","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","progress-bar-striped","progress-bar-animated"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-2"],["target","_blank",3,"title","href"],[1,"fas","fa-paperclip"],["class","resource-delete mx-1 float-right text-muted","title","Eliminar recurso","aria-label","Eliminar recurso","data-bs-toggle","tooltip","data-bs-placement","top",3,"click",4,"ngIf"],["title","Eliminar recurso","aria-label","Eliminar recurso","data-bs-toggle","tooltip","data-bs-placement","top",1,"resource-delete","mx-1","float-right","text-muted",3,"click"],[1,"fas","fa-trash"],["id","addGroup","role","tabpanel","aria-labelledby","addGroup-tab",1,"tab-pane","fade",3,"ngClass"],["class","alert alert-info d-flex align-items-center","role","alert",4,"ngIf"],["class","alert alert-warning fade show text-center","role","alert",4,"ngIfSuccessMessage","ngIf"],["type","text","id","name","autocomplete","off","placeholder","Ej: Primer modelo de lecci\xF3n",1,"form-control",3,"change","input","formControl","disabled","ngClass"],[1,"form-text","text-muted"],["role","alert",1,"alert","alert-info","d-flex","align-items-center"],[1,"fas","fa-info-circle","me-2"],[1,"card-body","text-start"],[1,"text-muted"]],template:function(n,i){n&1&&(r(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4),u(4,ln,3,5,"div",5),o(),u(5,dn,3,1,"div",6)(6,cn,3,1,"div",7)(7,mn,3,1,"div",8)(8,pn,3,1,"div",8),o()(),u(9,qn,9,4,"div",9)(10,Hn,6,0,"div",9),o(),r(11,"div",10)(12,"div",11)(13,"div",12)(14,"div",13)(15,"h5",14),c(16,"\xBFSalir de esta p\xE1gina?"),o(),p(17,"button",15),o(),r(18,"div",16)(19,"div",17),p(20,"i",18),c(21),o()(),r(22,"div",19)(23,"button",20),c(24,"Cancelar"),o(),r(25,"button",21),c(26,"Salir"),o()()()()()),n&2&&(s(4),a("ngIf",i.lesson.state),s(),a("ngIf",i.status==="deletedD"),s(),a("ngIf",i.status==="warningD"),s(),a("ngIf",i.status==="successE"),s(),a("ngIf",i.status==="success"),s(),a("ngIf",i.lesson.files.length>0||i.showResources()),s(),a("ngIf",i.lesson.files.length<=0&&!i.showResources()),s(11),v(" ",i.confirmLeaveMessage||"Tienes cambios sin guardar o una carga en progreso. Si sales ahora, podr\xEDas perder los cambios o cancelar la carga."," "))},dependencies:[q,P,L,j,H,A,z,_e,ve],styles:[".disable[_ngcontent-%COMP%]{pointer-events:none;opacity:2}.resource-edit[_ngcontent-%COMP%], .resource-delete[_ngcontent-%COMP%]{cursor:pointer}.resource-edit[_ngcontent-%COMP%]:hover{color:#0d6efd}.resource-delete[_ngcontent-%COMP%]:hover{color:#dc3545}"]})}}return t})();var Zn=["confirmCompletedTpl"],Ee=t=>({"is-invalid":t}),Yn=()=>({standalone:!0}),Mt=t=>["/perfil",t];function Jn(t,l){if(t&1&&(r(0,"div")(1,"h5",10),c(2),o()()),t&2){let e=d();M("card-header bg-",e.lesson_states[e.lesson.state].class,""),s(2),w(" ",e.title," - ",e.lesson.title," ")}}function Qn(t,l){if(t&1&&(r(0,"div",11),p(1,"i",12),c(2),o()),t&2){let e=d();s(2),v(" ",e.errorMsg," ")}}function Kn(t,l){if(t&1&&(r(0,"div",13),p(1,"i",14),c(2),o()),t&2){let e=d();s(2),v(" ",e.successMsg," ")}}function es(t,l){t&1&&(r(0,"div"),c(1," El campo t\xEDtulo es obligatorio. "),o())}function ts(t,l){if(t&1&&(r(0,"div",58),u(1,es,2,0,"div",34),o()),t&2){let e=d(2);s(),a("ngIf",e.f.title.errors.required)}}function is(t,l){t&1&&(r(0,"div"),c(1," El campo resumen es obligatorio. "),o())}function ns(t,l){if(t&1&&(r(0,"div",58),u(1,is,2,0,"div",34),o()),t&2){let e=d(2);s(),a("ngIf",e.f.resume.errors.required)}}function ss(t,l){t&1&&(r(0,"div"),c(1," El campo justificaci\xF3n es obligatorio. "),o())}function os(t,l){if(t&1&&(r(0,"div",58),u(1,ss,2,0,"div",34),o()),t&2){let e=d(2);s(),a("ngIf",e.f.justification.errors.required)}}function rs(t,l){t&1&&(r(0,"div"),c(1," El campo referencias es obligatorio. "),o())}function as(t,l){if(t&1&&(r(0,"div",58),u(1,rs,2,0,"div",34),o()),t&2){let e=d(2);s(),a("ngIf",e.f.references.errors.required)}}function ls(t,l){t&1&&(r(0,"div",58),c(1," El campo estado es obligatorio. "),o())}function ds(t,l){if(t&1&&(r(0,"div"),u(1,ls,2,0,"div",20),o()),t&2){let e=d(2);s(),a("ngIf",e.f.state.errors.required)}}function cs(t,l){t&1&&(r(0,"div")(1,"small",59),c(2," Recuerda que al menos debe haber un recurso de tipo texto y un modelo para dar por terminada la lecci\xF3n. "),o()())}function ms(t,l){if(t&1){let e=b();r(0,"span",62),c(1),r(2,"button",63),_("click",function(){let i=g(e).$implicit,m=d(3);return h(m.removeLevel(i))}),o()()}if(t&2){let e=l.$implicit;s(),v(" ",e.value," ")}}function ps(t,l){if(t&1&&(r(0,"div",60),u(1,ms,3,1,"span",61),o()),t&2){let e=d(2);s(),a("ngForOf",e.selectedLevels)}}function us(t,l){if(t&1){let e=b();r(0,"button",66),_("click",function(){let i=g(e).$implicit,m=d(3);return h(m.selectLevel(i))}),p(1,"i",67),c(2),o()}if(t&2){let e=l.$implicit;s(2),v(" ",e.value," ")}}function _s(t,l){if(t&1&&(r(0,"div",64),u(1,us,3,1,"button",65),o()),t&2){let e=d(2);s(),a("ngForOf",e.filteredLevels)}}function vs(t,l){t&1&&(r(0,"div",68),c(1," Debes seleccionar al menos un nivel acad\xE9mico. "),o())}function fs(t,l){t&1&&p(0,"img",69)}function gs(t,l){if(t&1&&p(0,"img",70),t&2){let e=d(2);y("src",e.url+"get-image-user/"+e.lesson.author.picture,I)}}function hs(t,l){if(t&1){let e=b();r(0,"div",71)(1,"h5",72),c(2,"Confirmar env\xEDo para publicaci\xF3n"),o(),r(3,"button",73),_("click",function(){g(e);let i=d(2);return h(i.cancelCompleted())}),o()(),r(4,"div",74)(5,"p",75),c(6," Vas a marcar esta lecci\xF3n como "),r(7,"strong"),c(8,"Terminada"),o(),c(9," y enviar para su publicaci\xF3n. "),o(),r(10,"ul",76)(11,"li"),c(12,"Una vez enviada para ser publicada, "),r(13,"strong"),c(14,"no podr\xE1s editar"),o(),c(15," la lecci\xF3n."),o(),r(16,"li"),c(17,"El l\xEDder ni los integrantes "),r(18,"strong"),c(19,"no tendr\xE1n acceso"),o(),c(20," a Conversaci\xF3n ni a Comentarios del facilitador."),o()()(),r(21,"div",77)(22,"button",78),_("click",function(){g(e);let i=d(2);return h(i.cancelCompleted())}),c(23,"Cancelar"),o(),r(24,"button",79),_("click",function(){g(e);let i=d(2);return h(i.confirmCompletedAndSave())}),c(25,"Entiendo, continuar"),o()()}}function xs(t,l){if(t&1){let e=b();r(0,"div",2)(1,"div",15)(2,"div",16)(3,"div",1)(4,"div",17)(5,"label",18)(6,"h5"),c(7,"T\xEDtulo*"),o()(),r(8,"textarea",19),c(9,"                            "),o(),u(10,ts,2,1,"div",20),o(),r(11,"div",17)(12,"label",18)(13,"h5"),c(14,"Resumen*"),o()(),r(15,"textarea",21),c(16,"                                    "),o(),u(17,ns,2,1,"div",20),o(),r(18,"div",17)(19,"label",18)(20,"h5"),c(21,"Justificaci\xF3n*"),o()(),r(22,"textarea",22),c(23,"                                    "),o(),u(24,os,2,1,"div",20),o(),r(25,"div",17)(26,"label",18)(27,"h5"),c(28,"Referencias*"),o()(),r(29,"textarea",23),c(30,"                                "),o(),u(31,as,2,1,"div",20),o()()()(),r(32,"div",24)(33,"div",25)(34,"div",1)(35,"div",17)(36,"label",26)(37,"strong"),c(38,"Estado"),o()(),r(39,"div",27)(40,"select",28)(41,"option",29),c(42,"Propuesta"),o(),r(43,"option",30),c(44,"Asignada"),o(),r(45,"option",31),c(46,"Desarrollo"),o(),r(47,"option",32),c(48,"Prueba"),o(),r(49,"option",33),c(50,"Terminada"),o()(),u(51,ds,2,1,"div",34)(52,cs,3,0,"div",34),o()()()(),r(53,"div",25)(54,"div",1)(55,"h6",35)(56,"strong"),c(57,"\xC1reas de conocimiento"),o()(),r(58,"div",36),p(59,"ng-select",37),o(),r(60,"h6",38)(61,"strong"),c(62,"Niveles Acad\xE9micos"),r(63,"span",39),c(64,"*"),o()()(),u(65,ps,2,1,"div",40),r(66,"div",41)(67,"input",42),tt("ngModelChange",function(i){g(e);let m=d();return et(m.levelInput,i)||(m.levelInput=i),h(i)}),_("input",function(){g(e);let i=d();return h(i.onLevelInputChange())}),o(),u(68,_s,2,1,"div",43),o(),r(69,"small",44),c(70," Seleccionar uno o m\xE1s niveles acad\xE9micos. "),o(),u(71,vs,2,0,"div",45),o()(),r(72,"div",25)(73,"div",46)(74,"div",35)(75,"strong"),c(76,"Propuesto por"),o()(),r(77,"div",36)(78,"div",47)(79,"div",48)(80,"a",49)(81,"button",50),u(82,fs,1,0,"img",51)(83,gs,1,1,"img",52),o()()(),r(84,"div",53)(85,"h6",54)(86,"a",55)(87,"strong"),c(88),o(),p(89,"br"),r(90,"small",56),c(91),S(92,"amFromUnix"),S(93,"amLocale"),S(94,"amDateFormat"),o()()()()()()()(),r(95,"div",17)(96,"button",57),c(97,"Guardar cambios"),o()(),u(98,hs,26,0,"ng-template",null,0,pe),o()()}if(t&2){let e=d();s(8),a("ngClass",f(35,Ee,e.submitted&&e.f.title.errors)),s(2),a("ngIf",e.submitted&&e.f.title.errors),s(5),a("ngClass",f(37,Ee,e.submitted&&e.f.resume.errors)),s(2),a("ngIf",e.submitted&&e.f.resume.errors),s(5),a("ngClass",f(39,Ee,e.submitted&&e.f.justification.errors)),s(2),a("ngIf",e.submitted&&e.f.justification.errors),s(5),a("ngClass",f(41,Ee,e.submitted&&e.f.references.errors)),s(2),a("ngIf",e.submitted&&e.f.references.errors),s(9),a("ngClass",f(43,Ee,e.submitted&&e.f.state.errors)),s(11),a("ngIf",e.submitted&&e.f.state.errors),s(),a("ngIf",e.f.state.value=="completed"),s(7),a("items",e.areas)("multiple",!0)("hideSelected",!0),s(6),a("ngIf",e.selectedLevels.length>0),s(2),Ke("ngModel",e.levelInput),a("ngModelOptions",it(45,Yn))("ngClass",f(46,Ee,e.submitted&&e.f.level.errors)),s(),a("ngIf",e.showLevelDropdown),s(3),a("ngIf",e.submitted&&e.f.level.errors),s(10),a("routerLink",f(48,Mt,e.lesson.author._id)),s(),a("ngIf",!e.lesson.author.picture),s(),a("ngIf",e.lesson.author.picture),s(3),a("routerLink",f(50,Mt,e.lesson.author._id)),s(2),w(" ",e.lesson.author.name," ",e.lesson.author.surname," "),s(3),V(F(94,32,F(93,29,N(92,27,e.lesson.created_at),"es"),"LLL"))}}var Ft=(()=>{class t{constructor(e,n,i){this._userService=e,this._lessonService=n,this.modalService=i,this.edited=new ie,this.academic_level=X,this.academicLevels=Object.entries(X).map(([m,x])=>({key:m,value:x})),this.lesson_states=D,this.levelInput="",this.filteredLevels=[],this.selectedLevels=[],this.showLevelDropdown=!1,this.confirmedCompleted=!1,this.title="Editar lecci\xF3n",this.url=O.url,this.token=this._userService.getToken(),this.errorMsg="Hubo un error editando la lecci\xF3n. Intentalo de nuevo m\xE1s tarde.",this.successMsg="Se editado la lecci\xF3n correctamente.",this.lessonForm=new ue({title:new E("",T.required),resume:new E("",T.required),justification:new E("",T.required),references:new E("",T.required),state:new E("",T.required),areas:new E(""),level:new E([],T.required)})}get f(){return this.lessonForm.controls}ngOnInit(){this.initializeLevels(),this.lessonForm.patchValue({title:this.lesson.title,resume:this.lesson.resume,justification:this.lesson.justification,references:this.lesson.references,state:this.lesson.state,areas:this.lesson.knowledge_area,level:this.selectedLevels.map(e=>e.value)})}ngAfterViewInit(){this.setupClickOutsideListener()}initializeLevels(){if(this.lesson.level&&Array.isArray(this.lesson.level))this.selectedLevels=this.lesson.level.map(e=>{let n=Object.entries(X).find(([i,m])=>i===e);if(n||(n=Object.entries(X).find(([i,m])=>i===e.toUpperCase())),!n){let m={garden:"GARDEN",school:"SCHOOL",highschool:"MIDDLESCHOOL",middleschool:"MIDDLESCHOOL",baccalaureate:"HIGHSCHOOL",university:"UNIVERSITY",graduate:"GRADUATE"}[e.toLowerCase()];m&&(n=Object.entries(X).find(([x,B])=>x===m))}return n?{key:n[0],value:n[1]}:null}).filter(Boolean);else if(this.lesson.level){let e=Object.entries(X).find(([n,i])=>n===this.lesson.level);e||(e=Object.entries(X).find(([n,i])=>n===this.lesson.level.toUpperCase())),this.selectedLevels=e?[{key:e[0],value:e[1]}]:[]}else console.warn("No hay nivel definido, usando nivel por defecto"),this.selectedLevels=[{key:"UNIVERSITY",value:"Universitario"}];this.updateLevelFormControl()}onSubmit(){let e=[];if(this.submitted=!0,this.lessonForm.invalid){console.error("Formulario inv\xE1lido:",this.lessonForm.errors);return}if(this.lesson.status!="completed"&&(this.lesson.visible=!1),this.lessonForm.value.areas&&Array.isArray(this.lessonForm.value.areas))this.lessonForm.value.areas.forEach(i=>{i&&i._id?(e.push(i._id),console.log("\xC1rea agregada:",i._id,i.name)):typeof i=="string"&&(e.push(i),console.log("\xC1rea ID agregada:",i))});else if(this.lessonForm.value.areas){let i=this.lessonForm.value.areas;i._id?(e.push(i._id),console.log("\xC1rea \xFAnica agregada:",i._id,i.name)):typeof i=="string"&&(e.push(i),console.log("\xC1rea ID \xFAnica agregada:",i))}else console.warn("Areas no es un array v\xE1lido:",this.lessonForm.value.areas);if(this.lesson.knowledge_area=Array.isArray(e)?e:[],this.selectedLevels&&this.selectedLevels.length>0?this.lesson.level=this.selectedLevels.map(i=>i.key):(console.warn("No hay niveles seleccionados, usando nivel por defecto"),this.lesson.level=["university"]),Array.isArray(this.lesson.level)||(this.lesson.level=[this.lesson.level]),!this.lessonForm.value.title||!this.lessonForm.value.resume){this.status="error",this.errorMsg="Los campos t\xEDtulo y resumen son obligatorios.";return}this.lesson.title=this.lessonForm.value.title,this.lesson.resume=this.lessonForm.value.resume,this.lesson.references=this.lessonForm.value.references,this.lesson.justification=this.lessonForm.value.justification;let n=this.lesson.state;if(console.log("Estado anterior:",n),console.log("Estado del formulario:",this.lessonForm.value.state),this.lesson.state=this.lessonForm.value.state,console.log("Estado asignado:",this.lesson.state),console.log("Enviando actualizaci\xF3n de lecci\xF3n (edit):",{id:this.lesson._id,title:this.lesson.title,level:this.lesson.level,selectedLevels:this.selectedLevels,knowledge_area:this.lesson.knowledge_area,state:this.lesson.state}),n!=="completed"&&this.lesson.state==="completed"&&!this.confirmedCompleted){this.modalService.open(this.confirmCompletedTpl,{size:"md",backdrop:"static",keyboard:!1});return}this.saveLesson(),document.scrollingElement.scrollTop=0}confirmCompletedAndSave(){this.confirmedCompleted=!0,this.modalService.dismissAll(),this.saveLesson()}cancelCompleted(){this.confirmedCompleted=!1,this.modalService.dismissAll()}saveLesson(){this.submitted=!0;let e=Date.now();this._lessonService.editLesson(this.token,this.lesson).subscribe({next:n=>{let i=Date.now()-e;if(console.log(`Respuesta del servidor recibida en ${i}ms:`,n),n&&(n.lesson||n._id)){let m=n.lesson||n;m&&(m._id||m.id)?(this.status="success",this.submitted=!1,this.edited.emit(),console.log("Lecci\xF3n editada exitosamente:",m._id||m.id),n.lesson&&Object.assign(this.lesson,n.lesson),setTimeout(()=>{console.log("Recargando p\xE1gina para reflejar cambios y salir del modo edici\xF3n..."),window.location.reload()},1500)):(this.status="error",this.errorMsg="Error al actualizar la lecci\xF3n. Respuesta inv\xE1lida del servidor.",console.error("Respuesta inv\xE1lida del servidor:",n))}else this.status="error",this.errorMsg="Error al actualizar la lecci\xF3n. Respuesta vac\xEDa del servidor.",console.error("Respuesta vac\xEDa del servidor:",n)},error:n=>{this.status="error",console.error("Error updating lesson:",n),console.error("Error status:",n.status),console.error("Error body:",n.error),n.status===500?(console.warn("Error 500 detectado. Los datos podr\xEDan haberse guardado correctamente."),this.errorMsg="Hubo un problema con la respuesta del servidor, pero los cambios podr\xEDan haberse guardado. Por favor, refresca la p\xE1gina para verificar."):n.status===400?this.errorMsg=n.error?.message||"Datos inv\xE1lidos. Por favor, revisa los campos del formulario.":n.status===404?this.errorMsg="La lecci\xF3n no fue encontrada.":n.status===0?this.errorMsg="Error de conexi\xF3n. Por favor, verifica tu conexi\xF3n a internet.":this.errorMsg=n.error?.message||"Hubo un error editando la lecci\xF3n. Int\xE9ntalo de nuevo m\xE1s tarde.",console.error("Error message:",this.errorMsg)}}),this.confirmedCompleted=!1}onChanges(){this.lessonForm.valueChanges.subscribe({next:e=>{e&&(this.status=null,this.submitted=!1)}})}onLevelInputChange(){let e=this.levelInput.toLowerCase().trim();if(e.length===0){this.filteredLevels=[],this.showLevelDropdown=!1;return}let n=this.selectedLevels.map(i=>i.value);this.filteredLevels=this.academicLevels.filter(i=>!n.includes(i.value)&&i.value.toLowerCase().includes(e)),this.showLevelDropdown=this.filteredLevels.length>0}selectLevel(e){this.selectedLevels.some(n=>n.key===e.key)||(this.selectedLevels.push(e),this.updateLevelFormControl()),this.levelInput="",this.showLevelDropdown=!1}removeLevel(e){this.selectedLevels=this.selectedLevels.filter(n=>n.key!==e.key),this.updateLevelFormControl()}updateLevelFormControl(){let e=this.selectedLevels.map(n=>n.value);this.lessonForm.patchValue({level:e})}setupClickOutsideListener(){document.addEventListener("click",e=>{e.target.closest(".level-autocomplete")||(this.showLevelDropdown=!1)})}static{this.\u0275fac=function(n){return new(n||t)(C(R),C(U),C(ut))}}static{this.\u0275cmp=k({type:t,selectors:[["edit"]],viewQuery:function(n,i){if(n&1&&Ze(Zn,5),n&2){let m;Ye(m=Je())&&(i.confirmCompletedTpl=m.first)}},inputs:{lesson:"lesson",areas:"areas"},outputs:{edited:"edited"},standalone:!1,decls:9,vars:5,consts:[["confirmCompletedTpl",""],[1,"card-body"],[1,"row"],[1,"col"],[1,"card","mb-3","text-center"],[3,"class",4,"ngIf"],["class","alert alert-danger fade show text-center","role","alert",4,"ngIfSuccessMessage","ngIf"],["class","alert alert-success fade show text-center","role","alert",4,"ngIfSuccessMessage","ngIf"],[3,"ngSubmit","input","formGroup"],["class","row",4,"ngIf"],[1,"mb-0","text-white"],["role","alert",1,"alert","alert-danger","fade","show","text-center"],[1,"fas","fa-times-circle","icon-message","me-2"],["role","alert",1,"alert","alert-success","fade","show","text-center"],[1,"fas","fa-check-circle","icon-message","me-2"],[1,"col-7"],[1,"card"],[1,"form-group"],["for","text",1,"form-label"],["id","source","rows","3","formControlName","title",1,"form-control",3,"ngClass"],["class","invalid-feedback",4,"ngIf"],["id","source","rows","5","formControlName","resume",1,"form-control",3,"ngClass"],["id","source","rows","5","formControlName","justification",1,"form-control",3,"ngClass"],["id","source","rows","5","formControlName","references",1,"form-control",3,"ngClass"],[1,"col-5"],[1,"card","mb-3"],["for","title",1,"form-label"],[1,""],["id","level","formControlName","state",1,"form-control",3,"ngClass"],["value","proposed"],["value","assigned"],["value","development"],["value","test"],["value","completed"],[4,"ngIf"],[1,"card-title"],[1,"card-text"],["bindLabel","name","formControlName","areas","notFoundText","No se encontro",3,"items","multiple","hideSelected"],[1,"card-title","mt-2"],[1,"text-danger"],["class","selected-items-container mb-2",4,"ngIf"],[1,"level-autocomplete","position-relative"],["type","text","placeholder","Escribe para buscar los niveles acad\xE9micos.","autocomplete","off",1,"form-control",3,"ngModelChange","input","ngModel","ngModelOptions","ngClass"],["class","dropdown-menu show position-absolute w-100 mt-1","style","z-index: 1050; max-height: 200px; overflow-y: auto;",4,"ngIf"],[1,"form-text","text-muted"],["class","invalid-feedback d-block",4,"ngIf"],[1,"card-body","proposed-by;","text-color:","#5078a0","!important"],[1,"row","p-1"],[1,"col-auto","pe-0"],[1,"text-primary"],[1,"btn","flex-shrink-0","rounded-circle","overflow-hidden","p-0",2,"width","40px","height","40px",3,"routerLink"],["class","img-fluid","src","assets/images/user-default.png",4,"ngIf"],["class","img-fluid",3,"src",4,"ngIf"],[1,"col","rounded","px-2"],[1,"mb-1"],[1,"text-primary",3,"routerLink"],[1,"text-muted"],["type","submit",1,"btn","btn-success","w-100"],[1,"invalid-feedback"],[1,"text-warning"],[1,"selected-items-container","mb-2"],["class","badge bg-success me-1 mb-1 selected-chip",4,"ngFor","ngForOf"],[1,"badge","bg-success","me-1","mb-1","selected-chip"],["type","button","aria-label","Eliminar",1,"btn-close","btn-close-white","ms-1",3,"click"],[1,"dropdown-menu","show","position-absolute","w-100","mt-1",2,"z-index","1050","max-height","200px","overflow-y","auto"],["type","button","class","dropdown-item",3,"click",4,"ngFor","ngForOf"],["type","button",1,"dropdown-item",3,"click"],[1,"fas","fa-graduation-cap","me-2"],[1,"invalid-feedback","d-block"],["src","assets/images/user-default.png",1,"img-fluid"],[1,"img-fluid",3,"src"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Cerrar",1,"btn-close",3,"click"],[1,"modal-body"],[1,"mb-2"],[1,"mb-0"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(n,i){n&1&&(r(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4),u(4,Jn,3,5,"div",5),o()()(),u(5,Qn,3,1,"div",6)(6,Kn,3,1,"div",7),r(7,"form",8),_("ngSubmit",function(){return i.onSubmit()})("input",function(){return i.onChanges()}),u(8,xs,100,52,"div",9),o()()),n&2&&(s(4),a("ngIf",i.lesson.state),s(),a("ngIf",i.status==="error"),s(),a("ngIf",i.status==="success"),s(),a("formGroup",i.lessonForm),s(),a("ngIf",i.lesson.resume!=null))},dependencies:[q,P,L,j,at,lt,H,rt,A,z,st,fe,ge,G,Fe,Z,Y,J],styles:[".selected-chip[_ngcontent-%COMP%]{display:inline-flex;align-items:center;padding:.375rem .75rem;font-size:.875rem;border-radius:.375rem}.selected-chip[_ngcontent-%COMP%]   .btn-close[_ngcontent-%COMP%]{font-size:.75rem;padding:0;margin:0;width:1rem;height:1rem;opacity:.8}.selected-chip[_ngcontent-%COMP%]   .btn-close[_ngcontent-%COMP%]:hover{opacity:1}","@media (prefers-color-scheme: dark){.proposed-by[_ngcontent-%COMP%], .proposed-by[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:not(img){color:#fff!important}}[data-bs-theme=dark][_ngcontent-%COMP%]   .proposed-by[_ngcontent-%COMP%], [data-bs-theme=dark][_ngcontent-%COMP%]   .proposed-by[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:not(img){color:#fff!important}.bg-dark[_ngcontent-%COMP%]   .proposed-by[_ngcontent-%COMP%], .bg-dark[_ngcontent-%COMP%]   .proposed-by[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:not(img), .text-bg-dark[_ngcontent-%COMP%]   .proposed-by[_ngcontent-%COMP%], .text-bg-dark[_ngcontent-%COMP%]   .proposed-by[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:not(img), .card.bg-dark[_ngcontent-%COMP%]   .proposed-by[_ngcontent-%COMP%], .card.bg-dark[_ngcontent-%COMP%]   .proposed-by[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:not(img){color:#fff!important}"]})}}return t})();var Se=t=>["/perfil",t];function Cs(t,l){if(t&1&&(r(0,"div")(1,"h5",10),c(2),o()()),t&2){let e=d();M("card-header bg-",e.lesson_states[e.lesson.state].class,""),s(2),w(" ",e.title," - ",e.lesson.title," ")}}function ys(t,l){if(t&1&&(r(0,"div",11),p(1,"i",12),c(2),o()),t&2){let e=d();s(2),v(" ",e.errorMsg," ")}}function Es(t,l){if(t&1&&(r(0,"div",13),p(1,"i",14),c(2),o()),t&2){let e=d();s(2),v(" ",e.successMsg," ")}}function Ss(t,l){t&1&&p(0,"img",31)}function Is(t,l){if(t&1&&p(0,"img",32),t&2){let e=d(4);y("src",e.url+"get-image-user/"+e.lesson.leader.picture,I)}}function ws(t,l){if(t&1&&(r(0,"div",19)(1,"div",2)(2,"div",8)(3,"div",21)(4,"div",22)(5,"a",23)(6,"button",24),u(7,Ss,1,0,"img",25)(8,Is,1,1,"img",26),o()()(),r(9,"div",27)(10,"h6",28)(11,"a",29)(12,"strong",30),c(13),o()()()()()()()()),t&2){let e=d(3);s(6),a("routerLink",f(6,Se,e.lesson.leader._id)),s(),a("ngIf",!e.lesson.leader.picture),s(),a("ngIf",e.lesson.leader.picture),s(3),a("routerLink",f(8,Se,e.lesson.leader._id)),s(2),w(" ",e.lesson.leader.name," ",e.lesson.leader.surname," ")}}function Ts(t,l){t&1&&(r(0,"div",19)(1,"div",2)(2,"strong"),c(3,"Facilitador"),o()()())}function Ms(t,l){t&1&&p(0,"img",31)}function Fs(t,l){if(t&1&&p(0,"img",32),t&2){let e=d(4);y("src",e.url+"get-image-user/"+e.lesson.expert.picture,I)}}function ks(t,l){if(t&1&&(r(0,"div",19)(1,"div",2)(2,"div",8)(3,"div",21)(4,"div",22)(5,"a",33)(6,"button",24),u(7,Ms,1,0,"img",25)(8,Fs,1,1,"img",26),o()()(),r(9,"div",27)(10,"h6",28)(11,"a",29)(12,"strong",30),c(13),o()()()()()()()()),t&2){let e=d(3);s(6),a("routerLink",f(6,Se,e.lesson.expert._id)),s(),a("ngIf",!e.lesson.expert.picture),s(),a("ngIf",e.lesson.expert.picture),s(3),a("routerLink",f(8,Se,e.lesson.expert._id)),s(2),w(" ",e.lesson.expert.name," ",e.lesson.expert.surname," ")}}function Ls(t,l){t&1&&p(0,"img",31)}function Os(t,l){if(t&1&&p(0,"img",32),t&2){let e=d(2).$implicit,n=d(4);y("src",n.url+"get-image-user/"+e.picture,I)}}function Rs(t,l){if(t&1&&(r(0,"div",37)(1,"div",22)(2,"a",38)(3,"button",24),u(4,Ls,1,0,"img",25)(5,Os,1,1,"img",26),o()()(),r(6,"div",27)(7,"h6",28)(8,"a",29)(9,"strong",30),c(10),o()()()()()),t&2){let e=d().$implicit;s(3),a("routerLink",f(6,Se,e._id)),s(),a("ngIf",!e.picture),s(),a("ngIf",e.picture),s(3),a("routerLink",f(8,Se,e._id)),s(2),w(" ",e.name," ",e.surname," ")}}function Vs(t,l){if(t&1&&(r(0,"div",35),u(1,Rs,11,10,"div",36),o()),t&2){let e=l.$implicit,n=d(4);s(),a("ngIf",n.lesson.leader&&e._id!=n.lesson.leader._id&&n.lesson.expert&&e._id!=n.lesson.expert._id)}}function Ps(t,l){if(t&1&&(r(0,"div",21),u(1,Vs,2,1,"div",34),o()),t&2){let e=d(3);s(),a("ngForOf",e.lesson.development_group)}}function Gs(t,l){if(t&1&&(r(0,"div",1)(1,"div",17)(2,"div",1)(3,"div",2)(4,"strong"),c(5,"L\xEDder"),o()()(),u(6,ws,14,10,"div",18)(7,Ts,4,0,"div",18)(8,ks,14,10,"div",18),o(),r(9,"div",17)(10,"div",1)(11,"div",2)(12,"strong"),c(13,"Integrantes"),o()()(),r(14,"div",19)(15,"div",2)(16,"div",8),u(17,Ps,2,1,"div",20),o()()()()()),t&2){let e=d(2);s(6),a("ngIf",e.lesson.leader),s(),a("ngIf",e.lesson.expert),s(),a("ngIf",e.lesson.expert),s(9),a("ngIf",e.lesson.development_group.length>0)}}function Us(t,l){if(t&1&&(r(0,"div",15),u(1,Gs,18,4,"div",16),o()),t&2){let e=d();s(),a("ngIf",e.lesson.leader)}}function Ds(t,l){t&1&&(r(0,"div",15)(1,"h4",39),c(2," No se ha asignado el grupo de desarrollo. "),o()())}function Ns(t,l){t&1&&p(0,"img",31)}function As(t,l){if(t&1&&p(0,"img",32),t&2){let e=d().item,n=d(2);y("src",n.url+"get-image-user/"+e.picture,I)}}function zs(t,l){if(t&1&&(r(0,"div",47),u(1,Ns,1,0,"img",25)(2,As,1,1,"img",26),o(),c(3),p(4,"br")),t&2){let e=l.item,n=d(2);s(),a("ngIf",!e.picture),s(),a("ngIf",e.picture),s(),Qe(" ",e.name," ",e.surname," - ",n.labelP[e.role].label," ")}}function js(t,l){t&1&&p(0,"img",31)}function Bs(t,l){if(t&1&&p(0,"img",32),t&2){let e=d().item,n=d(2);y("src",n.url+"get-image-user/"+e.picture,I)}}function $s(t,l){if(t&1&&(r(0,"div",47),u(1,js,1,0,"img",25)(2,Bs,1,1,"img",26),o(),c(3),p(4,"br")),t&2){let e=l.item;s(),a("ngIf",!e.picture),s(),a("ngIf",e.picture),s(),w(" ",e.name," ",e.surname," ")}}function qs(t,l){t&1&&p(0,"img",31)}function Hs(t,l){if(t&1&&p(0,"img",32),t&2){let e=d().item,n=d(2);y("src",n.url+"get-image-user/"+e.picture,I)}}function Ws(t,l){if(t&1&&(r(0,"div",47),u(1,qs,1,0,"img",25)(2,Hs,1,1,"img",26),o(),c(3),p(4,"br")),t&2){let e=l.item;s(),a("ngIf",!e.picture),s(),a("ngIf",e.picture),s(),w(" ",e.name," ",e.surname," ")}}function Xs(t,l){if(t&1){let e=b();r(0,"div",15)(1,"div",1)(2,"div",17)(3,"div",1)(4,"div",2)(5,"strong"),c(6,"Integrantes"),o()()(),r(7,"div",19)(8,"div",2)(9,"ng-select",40),_("change",function(){g(e);let i=d();return i.onChanges(),h(i.membersChanges())}),u(10,zs,5,5,"ng-template",41),o()()()(),r(11,"div",17)(12,"div",1)(13,"div",2)(14,"strong"),c(15,"L\xEDder"),o()()(),r(16,"div",19)(17,"div",2)(18,"ng-select",42),_("change",function(){g(e);let i=d();return h(i.onChanges())}),u(19,$s,5,4,"ng-template",41),o()()(),r(20,"div",19)(21,"div",2)(22,"strong"),c(23,"Facilitador"),o()()(),r(24,"div",19)(25,"div",2)(26,"ng-select",43),_("change",function(){g(e);let i=d();return h(i.onChanges())}),u(27,Ws,5,4,"ng-template",41),o()()()()(),r(28,"div",1)(29,"div",44)(30,"div",45)(31,"button",46),c(32,"Guardar cambios"),o()()()()()}if(t&2){let e=d();s(9),a("items",e.users)("multiple",!0)("hideSelected",!0),s(9),a("items",e.leaderUsers)("multiple",!1)("hideSelected",!0),s(8),a("items",e.expertUsers)("multiple",!1)("hideSelected",!0)}}var kt=(()=>{class t{constructor(e,n,i,m){this._route=e,this._router=n,this._userService=i,this._lessonService=m,this.lesson_states=D,this.labelP=Ct,this.readonly=!1,this.token=this._userService.getToken(),this.title="Grupo de desarrollo",this.url=O.url,this.errorMsg="Hubo un error agregando el grupo de desarrollo a la lecci\xF3n. Intentalo de nuevo m\xE1s tarde.",this.successMsg="Se ha agregado el grupo de desarrallo de la lecci\xF3n correctamente.",this.groupForm=new ue({expert:new E(""),leader:new E(""),members:new E("")})}initExpertSelect(){this.expertUsers=this.users.filter(e=>e.role=="expert"||e.role=="admin"||e.role=="delegated_admin"||e.canAdvise)}initLeaderSelect(){this.lesson.development_group.length==0?this.leaderUsers=[]:this.leaderUsers=this.groupForm.value.members}setSelectedLeader(){this.lesson.development_group.length>0?this.lesson.leader&&(this.lesson.development_group.filter(n=>n._id==this.lesson.leader._id).length>0?this.groupForm.patchValue({leader:this.lesson.leader}):this.groupForm.patchValue({leader:null})):this.groupForm.patchValue({leader:null}),this.groupForm.value.members.length>0?(this.groupForm.controls.leader.enable(),this.groupForm.value.leader&&(this.groupForm.value.members.filter(n=>n._id==this.groupForm.value.leader._id).length>0?this.groupForm.patchValue({leader:this.groupForm.value.leader}):this.groupForm.patchValue({leader:null}))):(this.groupForm.controls.leader.disable(),this.groupForm.patchValue({leader:null}))}ngOnInit(){this.initExpertSelect(),this._route.parent?.url.subscribe(e=>{let n=e&&e.length>0?e[0]:null;this.parentUrl=n&&n.path||this._route.parent?.snapshot?.routeConfig?.path?.split("/")?.[0]||""});try{let e=this._router?.url||"";if(e.includes("/admin"))this.parentUrl="admin";else if(!this.parentUrl){let n=e.split("?")[0].split("#")[0].split("/").filter(Boolean)[0]||"";this.parentUrl=n}}catch{}this.lesson.development_group&&this.groupForm.patchValue({members:this.lesson.development_group}),this.lesson.expert&&this.groupForm.patchValue({expert:this.lesson.expert}),this.setSelectedLeader(),this.initLeaderSelect()}belongsTo(e){this.lesson.development_group||(this.lesson.development_group=[]),this.lesson.development_group.find(i=>i._id==e._id)?console.log("ya pertenece al grupo"):this.lesson.development_group.some(m=>m._id===e._id)||(this.lesson.development_group.push(e),this.groupForm.patchValue({members:this.lesson.development_group}),console.log("Experto agregado al grupo de desarrollo"))}onSubmit(){if(this.submitted=!0,!this.groupForm.value.expert||!this.groupForm.value.members||this.groupForm.value.members.length===0){this.status="error",this.errorMsg="Debes seleccionar un experto y al menos un miembro del grupo.";return}this.lesson.development_group||(this.lesson.development_group=[]),this.lesson.development_group=this.groupForm.value.members,this.lesson.expert=this.groupForm.value.expert._id,this.lesson.leader=this.groupForm.value.leader?this.groupForm.value.leader._id:null,this.belongsTo(this.groupForm.value.expert),console.log("Enviando actualizaci\xF3n de lecci\xF3n:",{id:this.lesson._id,development_group:this.lesson.development_group,expert:this.lesson.expert,leader:this.lesson.leader}),this._lessonService.editLesson(this.token,this.lesson).subscribe({next:e=>{e.lesson&&e.lesson._id?(this.status="success",this.submitted=!1,console.log("Lecci\xF3n actualizada exitosamente")):(this.status="error",this.errorMsg="Error al actualizar la lecci\xF3n. Respuesta inv\xE1lida del servidor.")},error:e=>{this.status="error",console.error("Error updating lesson:",e),e.status===500?this.errorMsg="Error interno del servidor. Por favor, verifica que todos los campos est\xE9n correctamente completados.":e.status===400?this.errorMsg=e.error?.message||"Datos inv\xE1lidos. Por favor, revisa los campos del formulario.":e.status===404?this.errorMsg="La lecci\xF3n no fue encontrada.":this.errorMsg=e.error?.message||"Hubo un error agregando el grupo de desarrollo a la lecci\xF3n. Int\xE9ntalo de nuevo m\xE1s tarde."}}),document.scrollingElement.scrollTop=0}onChanges(){this.status=null,this.submitted=!1}membersChanges(){this.leaderUsers=this.groupForm.value.members,this.setSelectedLeader()}static{this.\u0275fac=function(n){return new(n||t)(C(W),C(se),C(R),C(U))}}static{this.\u0275cmp=k({type:t,selectors:[["group"]],inputs:{users:"users",lesson:"lesson"},standalone:!1,decls:14,vars:7,consts:[[1,"card-body","group-dark-names"],[1,"row"],[1,"col"],[1,"card","mb-3","text-center"],[3,"class",4,"ngIf"],["class","alert alert-danger fade show text-center","role","alert",4,"ngIf"],["class","alert alert-success fade show text-center","role","alert",4,"ngIf"],[3,"ngSubmit","formGroup"],[1,"card"],["class","card-body text-start",4,"ngIf"],[1,"mb-0","text-white"],["role","alert",1,"alert","alert-danger","fade","show","text-center"],[1,"fas","fa-times-circle","icon-message","me-2"],["role","alert",1,"alert","alert-success","fade","show","text-center"],[1,"fas","fa-check-circle","icon-message","me-2"],[1,"card-body","text-start"],["class","row",4,"ngIf"],[1,"col-6"],["class","row mt-2",4,"ngIf"],[1,"row","mt-2"],["class","row p-1",4,"ngIf"],[1,"row","p-1"],[1,"col-auto","pe-0"],[1,"text-primary;"],[1,"btn","flex-shrink-0","rounded-circle","overflow-hidden","p-0",2,"width","40px","height","40px",3,"routerLink"],["class","img-fluid","src","assets/images/user-default.png",4,"ngIf"],["class","img-fluid",3,"src",4,"ngIf"],[1,"col","rounded","px-2"],[1,"mb-1"],[1,"text-primary",3,"routerLink"],[1,"name-text"],["src","assets/images/user-default.png",1,"img-fluid"],[1,"img-fluid",3,"src"],[1,"text-primary"],["class","col-12",4,"ngFor","ngForOf"],[1,"col-12"],["class","row mt-1",4,"ngIf"],[1,"row","mt-1"],[1,"text-primary","ms-1"],[1,"text-muted"],["bindLabel","name","formControlName","members","notFoundText","No se encontro",3,"change","items","multiple","hideSelected"],["ng-option-tmp",""],["bindLabel","name","formControlName","leader","notFoundText","No se encontro",3,"change","items","multiple","hideSelected"],["bindLabel","name","formControlName","expert","notFoundText","No se encontro",3,"change","items","multiple","hideSelected"],[1,"col-12","mt-4"],[1,"form-group"],["type","submit",1,"btn","btn-success","float-right"],[1,"flex-shrink-0","rounded-circle","border-1","overflow-hidden","me-2","float-left",2,"width","30px","height","30px"]],template:function(n,i){n&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),u(4,Cs,3,5,"div",4),o()()(),u(5,ys,3,1,"div",5)(6,Es,3,1,"div",6),r(7,"form",7),_("ngSubmit",function(){return i.onSubmit()}),r(8,"div",1)(9,"div",2)(10,"div",8),u(11,Us,2,1,"div",9)(12,Ds,3,0,"div",9)(13,Xs,33,9,"div",9),o()()()()()),n&2&&(s(4),a("ngIf",i.lesson.state),s(),a("ngIf",i.status==="error"),s(),a("ngIf",i.status==="success"),s(),a("formGroup",i.groupForm),s(4),a("ngIf",i.lesson.development_group.length>0&&i.parentUrl!="admin"),s(),a("ngIf",i.lesson.development_group.length<=0&&i.parentUrl!="admin"),s(),a("ngIf",i.parentUrl=="admin"))},dependencies:[P,L,j,A,z,fe,ge,G,Fe,mt],styles:[':not([data-bs-theme="dark"])[_nghost-%COMP%]   .group-dark-names[_ngcontent-%COMP%]   .name-text[_ngcontent-%COMP%], :not([data-bs-theme="dark"])   [_nghost-%COMP%]   .group-dark-names[_ngcontent-%COMP%]   .name-text[_ngcontent-%COMP%], .group-dark-names[_ngcontent-%COMP%]   .name-text[_ngcontent-%COMP%]{color:#5078a0!important}[data-bs-theme="dark"][_nghost-%COMP%]   .group-dark-names[_ngcontent-%COMP%]   .name-text[_ngcontent-%COMP%], [data-bs-theme="dark"]   [_nghost-%COMP%]   .group-dark-names[_ngcontent-%COMP%]   .name-text[_ngcontent-%COMP%], .bg-dark[_ngcontent-%COMP%]   .group-dark-names[_ngcontent-%COMP%]   .name-text[_ngcontent-%COMP%], .text-bg-dark[_ngcontent-%COMP%]   .group-dark-names[_ngcontent-%COMP%]   .name-text[_ngcontent-%COMP%], .card.bg-dark[_ngcontent-%COMP%]   .group-dark-names[_ngcontent-%COMP%]   .name-text[_ngcontent-%COMP%]{color:#fff!important}.group-dark-names[_ngcontent-%COMP%]   a.text-primary[_ngcontent-%COMP%]{text-decoration:none}.group-dark-names[_ngcontent-%COMP%]   a.text-primary[_ngcontent-%COMP%]:hover{text-decoration:underline;text-underline-offset:2px}']})}}return t})();var Ys=t=>({"is-invalid":t}),Lt=t=>["/perfil",t];function Js(t,l){if(t&1&&(r(0,"div")(1,"h5",36),c(2),o()()),t&2){let e=d();M("card-header bg-",e.lesson_states[e.lesson.state].class,""),s(2),w(" ",e.title," - ",e.lesson.title," ")}}function Qs(t,l){if(t&1&&(r(0,"small"),p(1,"i",39),c(2),o()),t&2){let e=d(2);s(2),v(" ",e.errorMsg," ")}}function Ks(t,l){if(t&1&&(r(0,"small"),p(1,"i",39),c(2),o()),t&2){let e=d(2);s(2),v(" ",e.userAlreadyCommentedMsg," ")}}function eo(t,l){if(t&1&&(r(0,"div",37),u(1,Qs,3,1,"small",38)(2,Ks,3,1,"small",38),o()),t&2){let e=d();s(),a("ngIf",e.status==="error"),s(),a("ngIf",e.userAlreadyCommented)}}function to(t,l){if(t&1&&(r(0,"div",40)(1,"small"),p(2,"i",41),c(3),o()()),t&2){let e=d();s(3),v(" ",e.successMsg,"")}}function io(t,l){t&1&&p(0,"img",42)}function no(t,l){if(t&1&&p(0,"img",43),t&2){let e=d();y("src",e.url+"get-image-user/"+e.identity.picture,I)}}function so(t,l){t&1&&(r(0,"div",46),c(1," Debes elegir el n\xFAmero de estrellas para calificar el recurso. "),o())}function oo(t,l){if(t&1&&(r(0,"div",44),u(1,so,2,0,"div",45),o()),t&2){let e=d();s(),a("ngIf",e.ratingForm.controls.rating.errors.required)}}function ro(t,l){t&1&&p(0,"img",42)}function ao(t,l){if(t&1&&p(0,"img",43),t&2){let e=d(2).$implicit,n=d();y("src",n.url+"get-image-user/"+e.user.picture,I)}}function lo(t,l){if(t&1&&(r(0,"div",50)(1,"a",51)(2,"div",52),u(3,ro,1,0,"img",25)(4,ao,1,1,"img",26),o()()()),t&2){let e=d().$implicit;s(),a("routerLink",f(3,Lt,e.user._id)),s(2),a("ngIf",!e.user.picture),s(),a("ngIf",e.user.picture)}}function co(t,l){if(t&1&&(r(0,"div",53)(1,"h6",54)(2,"a",51)(3,"strong"),c(4),o()(),p(5,"br"),r(6,"small",55),c(7),S(8,"amFromUnix"),S(9,"amLocale"),S(10,"amDateFormat"),o(),r(11,"button",56),p(12,"i",57),c(13),o()(),r(14,"p",58),c(15),o()()),t&2){let e=d().$implicit;s(2),a("routerLink",f(14,Lt,e.user._id)),s(2),w(" ",e.user.name," ",e.user.surname," "),s(3),v(" ",F(10,11,F(9,8,N(8,6,e.created_at),"es"),"LLL")," "),s(6),v(" ",e.score," "),s(2),v(" ",e.text," ")}}function mo(t,l){if(t&1&&(r(0,"div",47),u(1,lo,5,5,"div",48)(2,co,16,16,"div",49),o()),t&2){let e=l.$implicit;s(),a("ngIf",e.user!=null),s(),a("ngIf",e.user!=null)}}var Ot=(()=>{class t{constructor(e,n,i){this._userService=e,this._lessonService=n,this._commentService=i,this.lesson_states=D,this.formSubscription=new Be,this.submitted=!1,this.userAlreadyCommented=null,this.title="Calificaciones y comentarios",this.url=O.url,this.identity=this._userService.getIdentity(),this.token=this._userService.getToken(),this.userAlreadyCommentedMsg="No es posible calificar la misma lecci\xF3n m\xE1s de una vez.",this.errorMsg="Hubo un error al guardar la calificaci\xF3n de la lecci\xF3n. Intentalo de nuevo m\xE1s tarde.",this.successMsg="Se ha enviado la calificaci\xF3n correctamente. Muchas gracias por participar.",this.ratingForm=new ue({rating:new E("",T.required),text:new E("")})}ngOnChanges(){this.restartValues()}ngOnInit(){this.formSubscription.add(this.ratingForm.valueChanges.subscribe(n=>{n&&(this.status=null,this.submitted=!1,this.userAlreadyCommented=null)}));let e=this.ratingForm.get("rating");e&&this.formSubscription.add(e.valueChanges.subscribe(n=>{console.log("[Rating] valueChanges rating",{raw:n,parsed:parseFloat(n)})}))}ngOnDestroy(){this.formSubscription&&this.formSubscription.unsubscribe()}restartValues(){this.status=null,this.submitted=!1,this.userAlreadyCommented=null}onSubmit(){return je(this,null,function*(){if(this.restartValues(),this.userAlreadyCommented=Array.isArray(this.lesson?.comments)?this.lesson.comments.find(m=>m&&m.user&&this.identity._id==m.user._id):null,this.submitted=!0,this.userAlreadyCommented||this.ratingForm.invalid)return;this.comment=new bt(this.ratingForm.value.text,this.identity._id);let e=this.ratingForm.value.rating,n=parseFloat(e);console.log("[Rating] onSubmit -> selected rating",{raw:e,parsed:n,form:this.ratingForm.value}),this.comment.score=n;let i=null;try{i=yield $e(this._commentService.addComment(this.token,this.comment)),console.log("[Rating] addComment response",i)}catch(m){this.status="error",console.error("[Rating] addComment error",m)}if(i&&i.comment._id){let m=Array.isArray(this.lesson.comments)?this.lesson.comments.length:0,B=((Number(this.lesson.score)||0)*m+Number(i.comment.score))/(m+1);console.log("[Rating] average recompute",{beforeCount:m,currentScore:Number(this.lesson.score)||0,added:Number(i.comment.score),newAverage:B}),this.lesson.score=B,Array.isArray(this.lesson.comments)||(this.lesson.comments=[]),this.lesson.comments.push(i.comment._id),this._lessonService.editLesson(this.token,this.lesson).subscribe($=>{console.log("[Rating] editLesson response",$),$&&$.lesson&&$.lesson._id&&(this.status="success",this.lesson=$.lesson,this.ratingForm.reset())},$=>{this.status="error",console.error("[Rating] editLesson error",$)})}else this.status="error";this.submitted=!1})}onChanges(){this.ratingForm.valueChanges.subscribe(e=>{e&&(this.status=null,this.submitted=!1,this.userAlreadyCommented=null)})}static{this.\u0275fac=function(n){return new(n||t)(C(R),C(U),C(gt))}}static{this.\u0275cmp=k({type:t,selectors:[["rating"]],inputs:{lesson:"lesson"},standalone:!1,features:[He],decls:38,vars:11,consts:[[1,"card-body"],[1,"row"],[1,"col"],[1,"card","mb-3","text-center"],[3,"class",4,"ngIf"],[1,"col-5"],[1,"card"],[1,"card-body","text-center"],[3,"ngSubmit","formGroup"],["class","alert alert-danger fade show text-center","role","alert",4,"ngIf"],["class","alert alert-success fade show text-center","role","alert",4,"ngIf"],["aria-label","Calificaci\xF3n por estrellas",1,"my-2","clasificacion"],["id","rate-5","type","radio","name","rating","value","5","formControlName","rating"],["for","rate-5","title","5","aria-label","5"],["id","rate-4","type","radio","name","rating","value","4","formControlName","rating"],["for","rate-4","title","4","aria-label","4"],["id","rate-3","type","radio","name","rating","value","3","formControlName","rating"],["for","rate-3","title","3","aria-label","3"],["id","rate-2","type","radio","name","rating","value","2","formControlName","rating"],["for","rate-2","title","2","aria-label","2"],["id","rate-1","type","radio","name","rating","value","1","formControlName","rating"],["for","rate-1","title","1","aria-label","1"],[1,"mb-3","row","mt-3"],[1,"col-auto","align-items-center"],[1,"flex-shrink-0","rounded-circle","border-1","overflow-hidden","me-2",2,"width","40px","height","40px"],["class","img-fluid","src","assets/images/user-default.png",4,"ngIf"],["class","img-fluid",3,"src",4,"ngIf"],[1,"col","ps-0","align-items-center"],["formControlName","text","rows","2","placeholder","Escribe un comentario...",1,"form-control",3,"ngClass"],["class","invalid-feedback",4,"ngIf"],[1,"text-end"],["type","submit",1,"btn","btn-warning"],[1,"col-7"],[1,"card",2,"height","60vh","overflow","auto"],[1,"card-body","py-1"],["class","row mt-2",4,"ngFor","ngForOf"],[1,"mb-0","text-white"],["role","alert",1,"alert","alert-danger","fade","show","text-center"],[4,"ngIf"],[1,"fas","fa-times-circle","icon-message","me-2"],["role","alert",1,"alert","alert-success","fade","show","text-center"],[1,"fas","fa-check-circle","icon-message","me-2"],["src","assets/images/user-default.png",1,"img-fluid"],[1,"img-fluid",3,"src"],[1,"invalid-feedback"],["class","text-start",4,"ngIf"],[1,"text-start"],[1,"row","mt-2"],["class","col-auto",4,"ngIf"],["class","col bg-light rounded-left p-2",4,"ngIf"],[1,"col-auto"],["data-bs-dismiss","modal",1,"text-primary",3,"routerLink"],[1,"flex-shrink-0","rounded-circle","border-1","overflow-hidden",2,"width","40px","height","40px"],[1,"col","bg-light","rounded-left","p-2"],[1,"mb-1"],[1,"text-muted"],[1,"btn","btn-warning","py-0","me-1","float-end"],[1,"fas","fa-star"],[1,"card-text"]],template:function(n,i){n&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),u(4,Js,3,5,"div",4),o()()(),r(5,"div",1)(6,"div",5)(7,"div",6)(8,"div",7)(9,"form",8),_("ngSubmit",function(){return i.onSubmit()}),u(10,eo,3,2,"div",9)(11,to,4,1,"div",10),r(12,"div",11),p(13,"input",12)(14,"label",13)(15,"input",14)(16,"label",15)(17,"input",16)(18,"label",17)(19,"input",18)(20,"label",19)(21,"input",20)(22,"label",21),o(),r(23,"div",22)(24,"div",23)(25,"div",24),u(26,io,1,0,"img",25)(27,no,1,1,"img",26),o()(),r(28,"div",27),p(29,"textarea",28),u(30,oo,2,1,"div",29),o()(),r(31,"div",30)(32,"button",31),c(33,"Enviar calificaci\xF3n"),o()()()()()(),r(34,"div",32)(35,"div",33)(36,"div",34),u(37,mo,3,2,"div",35),o()()()()()),n&2&&(s(4),a("ngIf",i.lesson.state),s(5),a("formGroup",i.ratingForm),s(),a("ngIf",i.status==="error"||i.userAlreadyCommented),s(),a("ngIf",i.status==="success"),s(15),a("ngIf",!i.identity.picture),s(),a("ngIf",i.identity.picture),s(2),a("ngClass",f(9,Ys,i.submitted&&i.ratingForm.controls.rating.errors&&!i.userAlreadyCommented)),s(),a("ngIf",i.submitted&&i.ratingForm.controls.rating.errors&&!i.userAlreadyCommented),s(7),a("ngForOf",i.lesson.comments))},dependencies:[q,P,L,j,H,ot,A,z,fe,ge,G,Z,Y,J],styles:['.clasificacion[_ngcontent-%COMP%]{--star-size: 1.4rem;display:inline-flex;flex-direction:row;direction:rtl;unicode-bidi:bidi-override;gap:0;align-items:center;line-height:var(--star-size)}.clasificacion[_ngcontent-%COMP%]   input[type=radio][_ngcontent-%COMP%]{display:none}.clasificacion[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{position:relative;display:inline-block;width:var(--star-size);height:var(--star-size);cursor:pointer;color:#c7c7c7}.clasificacion[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:before{content:"\\f005";font-family:"Font Awesome 5 Free";font-weight:900;font-size:var(--star-size);line-height:var(--star-size)}.clasificacion[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:hover, .clasificacion[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:hover ~ label[_ngcontent-%COMP%], .clasificacion[_ngcontent-%COMP%]   input[type=radio][_ngcontent-%COMP%]:checked ~ label[_ngcontent-%COMP%]{color:#ffc107}']})}}return t})();var Rt=t=>["/perfil",t];function uo(t,l){t&1&&(r(0,"div",0)(1,"div",3)(2,"div",4)(3,"span",5),c(4,"Loading..."),o()()()())}function _o(t,l){if(t&1&&(r(0,"div")(1,"h5",14),c(2),o()()),t&2){let e=d(2);M("card-header bg-",e.lesson_states[e.lesson.state].class,""),s(2),v(" ",e.lesson.title," ")}}function vo(t,l){if(t&1&&(r(0,"div",15)(1,"div",16),p(2,"i"),r(3,"small",17),c(4,"Progreso:"),o(),r(5,"div",18),p(6,"div",19),o(),r(7,"small",20),c(8),o()()()),t&2){let e,n,i=d(2);s(2),Xe("",(e=i.getCurrentConfig())==null?null:e.icon," text-",(e=i.getCurrentConfig())==null?null:e.color," me-2"),s(4),M("progress-bar bg-",(n=i.getCurrentConfig())==null?null:n.color,""),K("width",i.getCurrentProgress(),"%"),ne("aria-valuenow",i.getCurrentProgress()),s(2),v("",i.getCurrentProgress(),"%")}}function fo(t,l){if(t&1){let e=b();r(0,"div",21)(1,"div",22),p(2,"i"),r(3,"div",23)(4,"strong"),c(5),o(),r(6,"p",24),c(7),o()(),r(8,"button",25),_("click",function(){g(e);let i=d(2);return h(i.dismissMotivationalMessage())}),o()()()}if(t&2){let e,n,i,m=d(2);M("alert alert-",(e=m.getCurrentConfig())==null?null:e.color," alert-dismissible fade show mb-3"),s(2),M("",(n=m.getCurrentConfig())==null?null:n.icon," me-3 mt-1"),s(3),V(m.lesson_states[m.lesson.state].label),s(2),V((i=m.getCurrentConfig())==null?null:i.message)}}function go(t,l){if(t&1&&(r(0,"p",49),c(1),o()),t&2){let e=l.$implicit;s(),v(" ",e," ")}}function ho(t,l){if(t&1&&(r(0,"p",49),c(1),o()),t&2){let e=l.$implicit;s(),v(" ",e," ")}}function xo(t,l){if(t&1&&(r(0,"section",50)(1,"h5",28),c(2," Justificaci\xF3n "),o(),u(3,ho,2,1,"p",29),o()),t&2){let e=d(3);s(3),a("ngForOf",e.lesson.justification.split(`
`))}}function bo(t,l){if(t&1&&(r(0,"p",49),p(1,"span",51),S(2,"linky"),o()),t&2){let e=l.$implicit;s(),y("innerHTML",N(2,1,e),me)}}function Co(t,l){if(t&1&&(r(0,"div",33)(1,"div",52)(2,"h6",53)(3,"strong"),c(4,"Estado"),o()(),r(5,"div",39)(6,"h1"),c(7),o()()()()),t&2){let e=d(3);s(6),M("badge bg-",e.lesson_states[e.lesson.state].class,""),s(),v(" ",e.lesson_states[e.lesson.state].label,"")}}function yo(t,l){if(t&1&&(r(0,"label",54),c(1),o()),t&2){let e=l.$implicit;y("title",(e==null?null:e.name)||e),s(),V((e==null?null:e.name)||e)}}function Eo(t,l){if(t&1&&(r(0,"label",55),c(1),o()),t&2){let e=l.$implicit,n=d(3);y("title",n.academic_level[e]),s(),V(n.academic_level[e])}}function So(t,l){t&1&&(r(0,"span",20),c(1,"No asignado"),o())}function Io(t,l){t&1&&p(0,"img",56)}function wo(t,l){if(t&1&&p(0,"img",57),t&2){let e=d(3);y("src",e.url+"get-image-user/"+e.lesson.author.picture,I)}}function To(t,l){if(t&1&&(r(0,"div",7)(1,"div",26)(2,"div",27)(3,"div",0)(4,"h5",28),c(5," Resumen "),o(),u(6,go,2,1,"p",29)(7,xo,4,1,"section",30),r(8,"h5",28),c(9," Referencias "),o(),u(10,bo,3,3,"p",29),o()()(),r(11,"div",31),u(12,Co,8,4,"div",32),r(13,"div",33)(14,"div",0)(15,"h6",28)(16,"strong"),c(17,"\xC1reas de conocimiento"),o()(),r(18,"div",34),u(19,yo,2,2,"label",35),o(),r(20,"h6",28)(21,"strong"),c(22,"Nivel acad\xE9mico"),o()(),r(23,"div",34),u(24,Eo,2,2,"label",36)(25,So,2,0,"span",37),o()()(),r(26,"div",33)(27,"div",38)(28,"div",28)(29,"strong"),c(30,"Propuesto por"),o()(),r(31,"div",39)(32,"div",40)(33,"div",41)(34,"a",42)(35,"button",43),u(36,Io,1,0,"img",44)(37,wo,1,1,"img",45),o()()(),r(38,"div",46)(39,"h6",47)(40,"a",48)(41,"strong"),c(42),o(),p(43,"br"),r(44,"small",20),c(45),S(46,"amFromUnix"),S(47,"amLocale"),S(48,"amDateFormat"),o()()()()()()()()()()),t&2){let e=d(2);s(6),a("ngForOf",e.lesson.resume.split(`
`)),s(),a("ngIf",e.lesson.justification),s(3),a("ngForOf",e.lesson.references.split(`
`)),s(2),a("ngIf",e.identity.role=="admin"||e.identity.role=="delegated_admin"||e.identity.role=="lesson_manager"),s(7),a("ngForOf",e.lesson.knowledge_area),s(5),a("ngForOf",e.lesson.level),s(),a("ngIf",!e.lesson.level||e.lesson.level.length===0),s(10),a("routerLink",f(22,Rt,e.lesson.author._id)),s(),a("ngIf",!e.lesson.author.picture),s(),a("ngIf",e.lesson.author.picture),s(3),a("routerLink",f(24,Rt,e.lesson.author._id)),s(2),w(" ",e.lesson.author.name," ",e.lesson.author.surname," "),s(3),V(F(48,19,F(47,16,N(46,14,e.lesson.created_at),"es"),"LLL"))}}function Mo(t,l){if(t&1&&(r(0,"section",6)(1,"div",7)(2,"div",8)(3,"div",9),u(4,_o,3,4,"div",10)(5,vo,9,11,"div",11),o(),u(6,fo,9,8,"div",12),o()(),u(7,To,49,26,"div",13),o()),t&2){let e=d();s(4),a("ngIf",e.lesson.state),s(),a("ngIf",e.lesson.state),s(),a("ngIf",e.lesson.state&&e.showMotivationalMessage&&e.getCurrentConfig()&&e.isLessonMember()),s(),a("ngIf",e.lesson.resume!=null)}}var Vt=(()=>{class t{constructor(e){this._userService=e,this.academic_level=X,this.lesson_states=D,this.loading=!0,this.showMotivationalMessage=!0,this.progressConfig={proposed:{progress:20,message:"\xA1Excelente! Tu propuesta ha sido recibida. El equipo administrativo la est\xE1 revisando. \xA1Pronto tendr\xE1s noticias!",icon:"fas fa-lightbulb",color:"secondary"},assigned:{progress:40,message:"\xA1Felicitaciones! Tu lecci\xF3n ha sido asignada. Es momento de formar tu equipo de desarrollo y comenzar a trabajar.",icon:"fas fa-users",color:"warning"},development:{progress:60,message:"\xA1Est\xE1n en pleno desarrollo! El equipo est\xE1 trabajando duro. \xA1Sigan as\xED, est\xE1n haciendo un gran trabajo!",icon:"fas fa-code",color:"info"},test:{progress:80,message:"\xA1Ya casi terminan! La lecci\xF3n est\xE1 en fase de pruebas. \xA1El \xFAltimo esfuerzo los llevar\xE1 al \xE9xito!",icon:"fas fa-flask",color:"primary"},completed:{progress:100,message:"\xA1Incre\xEDble! \xA1Han completado la lecci\xF3n exitosamente! Su trabajo contribuye al crecimiento de toda la comunidad educativa.",icon:"fas fa-trophy",color:"success"}},this.url=O.url,this.identity=this._userService.getIdentity()}ngOnInit(){this.loading=!1,this.lesson&&this.lesson.level&&!Array.isArray(this.lesson.level)&&(this.lesson.level=[this.lesson.level]),this.checkMotivationalMessageStatus()}getCurrentProgress(){return this.lesson?.state&&this.progressConfig[this.lesson.state]?.progress||0}getCurrentConfig(){return this.lesson?.state?this.progressConfig[this.lesson.state]:null}checkMotivationalMessageStatus(){if(!this.lesson?._id)return;let e=`motivational_message_${this.lesson._id}_${this.lesson.state}`,n=localStorage.getItem(e);this.showMotivationalMessage=!n}dismissMotivationalMessage(){if(!this.lesson?._id)return;let e=`motivational_message_${this.lesson._id}_${this.lesson.state}`;localStorage.setItem(e,"read"),this.showMotivationalMessage=!1}isLessonMember(){if(!this.identity||!this.lesson)return!1;let e=String(this.identity?._id||this.identity?.id||"");if(!e)return!1;let n=this.lesson.leader,i=n?String(n._id||n.id||n):"";return i&&i===e?!0:(Array.isArray(this.lesson.development_group)?this.lesson.development_group:[]).some(x=>{let B=String(x&&(x._id||x.id)||x&&x.user&&(x.user._id||x.user.id||x.user)||"");return!!B&&B===e})}static{this.\u0275fac=function(n){return new(n||t)(C(R))}}static{this.\u0275cmp=k({type:t,selectors:[["lesson-details"]],inputs:{lesson:"lesson"},standalone:!1,decls:3,vars:2,consts:[[1,"card-body"],["class","card-body",4,"ngIf"],["id","lesson-content",4,"ngIf"],[1,"text-muted","text-center"],["role","status",1,"spinner-border",2,"width","3rem","height","3rem"],[1,"sr-only"],["id","lesson-content"],[1,"row"],[1,"col"],[1,"card","mb-3","text-center"],[3,"class",4,"ngIf"],["class","card-body py-2",4,"ngIf"],["role","alert",3,"class",4,"ngIf"],["class","row",4,"ngIf"],[1,"mb-0","text-white"],[1,"card-body","py-2"],[1,"d-flex","align-items-center","mb-2"],[1,"text-muted","me-2"],[1,"progress","flex-grow-1","me-2",2,"height","8px"],["role","progressbar","aria-valuemin","0","aria-valuemax","100"],[1,"text-muted"],["role","alert"],[1,"d-flex","align-items-start"],[1,"flex-grow-1"],[1,"mb-0","mt-1"],["type","button","aria-label","Cerrar mensaje",1,"btn-close",3,"click"],[1,"col-8"],[1,"card"],[1,"card-title"],["class","card-text text-justify",4,"ngFor","ngForOf"],["class","mb-3",4,"ngIf"],[1,"col-4"],["class","card mb-3",4,"ngIf"],[1,"card","mb-3"],[1,"card-text",2,"display","flex","flex-wrap","wrap"],["class","badge bg-success me-1 text-truncate",3,"title",4,"ngFor","ngForOf"],["class","badge bg-info me-1 text-truncate",3,"title",4,"ngFor","ngForOf"],["class","text-muted",4,"ngIf"],[1,"card-body","proposed-by"],[1,"card-text"],[1,"row","p-1"],[1,"col-auto","pe-0"],[1,"text-primary"],[1,"btn","flex-shrink-0","rounded-circle","overflow-hidden","p-0",2,"width","40px","height","40px",3,"routerLink"],["class","img-fluid","src","assets/images/user-default.png",4,"ngIf"],["class","img-fluid",3,"src",4,"ngIf"],[1,"col","rounded","px-2"],[1,"mb-1"],[1,"text-primary",3,"routerLink"],[1,"card-text","text-justify"],[1,"mb-3"],[3,"innerHTML"],[1,"card-body","text-center"],[1,"card-title","mb-1"],[1,"badge","bg-success","me-1","text-truncate",3,"title"],[1,"badge","bg-info","me-1","text-truncate",3,"title"],["src","assets/images/user-default.png",1,"img-fluid"],[1,"img-fluid",3,"src"]],template:function(n,i){n&1&&(r(0,"div",0),u(1,uo,5,0,"div",1)(2,Mo,8,4,"section",2),o()),n&2&&(s(),a("ngIf",i.loading),s(),a("ngIf",!i.loading))},dependencies:[P,L,G,Z,Y,J,be],styles:[':not([data-bs-theme="dark"])[_nghost-%COMP%]   .proposed-by[_ngcontent-%COMP%], :not([data-bs-theme="dark"])   [_nghost-%COMP%]   .proposed-by[_ngcontent-%COMP%], :not([data-bs-theme="dark"])[_nghost-%COMP%]   .proposed-by[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:not(img), :not([data-bs-theme="dark"])   [_nghost-%COMP%]   .proposed-by[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:not(img), .proposed-by[_ngcontent-%COMP%], .proposed-by[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:not(img){color:#5078a0!important}[data-bs-theme="dark"][_nghost-%COMP%]   .proposed-by[_ngcontent-%COMP%], [data-bs-theme="dark"]   [_nghost-%COMP%]   .proposed-by[_ngcontent-%COMP%], [data-bs-theme="dark"][_nghost-%COMP%]   .proposed-by[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:not(img), [data-bs-theme="dark"]   [_nghost-%COMP%]   .proposed-by[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:not(img), .bg-dark[_ngcontent-%COMP%]   .proposed-by[_ngcontent-%COMP%], .bg-dark[_ngcontent-%COMP%]   .proposed-by[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:not(img), .text-bg-dark[_ngcontent-%COMP%]   .proposed-by[_ngcontent-%COMP%], .text-bg-dark[_ngcontent-%COMP%]   .proposed-by[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:not(img), .card.bg-dark[_ngcontent-%COMP%]   .proposed-by[_ngcontent-%COMP%], .card.bg-dark[_ngcontent-%COMP%]   .proposed-by[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:not(img){color:#fff!important}.proposed-by[_ngcontent-%COMP%]   a.text-primary[_ngcontent-%COMP%]{text-decoration:none}.proposed-by[_ngcontent-%COMP%]   a.text-primary[_ngcontent-%COMP%]:hover{text-decoration:underline;text-underline-offset:2px}']})}}return t})();var Pt=(t,l)=>["/",t,"leccion",l];function ko(t,l){if(t&1){let e=b();r(0,"button",20),_("click",function(){g(e);let i=d();return h(i.setSelectedOption("edit"))}),p(1,"i",21),o()}}function Lo(t,l){if(t&1){let e=b();r(0,"button",22),_("click",function(){g(e);let i=d();return h(i.setSelectedOption("conversation"))}),p(1,"i",23),o()}}function Oo(t,l){if(t&1){let e=b();r(0,"button",24),_("click",function(){g(e);let i=d();return h(i.setSelectedOption("review"))}),p(1,"i",25),o()}}function Ro(t,l){if(t&1){let e=b();r(0,"button",26),_("click",function(){g(e);let i=d();return h(i.setSelectedOption("details"))}),p(1,"i",27),o()}if(t&2){let e=d();a("routerLink",Ue(1,Pt,e.parentUrl,e.lesson.father_lesson))}}function Vo(t,l){if(t&1&&(r(0,"span",28)(1,"span"),c(2),o()()),t&2){let e=d();s(2),v("V. ",e.lesson.version.toFixed(1),"")}}function Po(t,l){if(t&1&&(r(0,"button",29),p(1,"i",30),o()),t&2){let e=d();a("routerLink",Ue(1,Pt,e.parentUrl,e.lesson.son_lesson._id))}}function Go(t,l){if(t&1&&(r(0,"span",35),c(1),o()),t&2){let e=d(2);s(),v(" ",e.lesson.score.toFixed(2),"")}}function Uo(t,l){if(t&1){let e=b();r(0,"button",31),_("click",function(){g(e);let i=d();return h(i.setSelectedOption("rating"))}),r(1,"div",32),p(2,"i",33),u(3,Go,2,1,"span",34),o()()}if(t&2){let e=d();s(3),a("ngIf",e.lesson.score!=null&&e.lesson.score>0)}}function Do(t,l){if(t&1&&p(0,"lesson-details",36),t&2){let e=d();a("lesson",e.lesson)}}function No(t,l){if(t&1){let e=b();r(0,"edit",37),_("edited",function(i){g(e);let m=d();return h(m.setNeedReload(i))}),o()}if(t&2){let e=d();a("areas",e.areas)("lesson",e.lesson)}}function Ao(t,l){if(t&1&&p(0,"group",38),t&2){let e=d();a("users",e.users)("lesson",e.lesson)}}function zo(t,l){if(t&1&&p(0,"rating",36),t&2){let e=d();a("lesson",e.lesson)}}function jo(t,l){if(t&1&&p(0,"conversation",36),t&2){let e=d();a("lesson",e.lesson)}}function Bo(t,l){if(t&1&&p(0,"review",36),t&2){let e=d();a("lesson",e.lesson)}}function $o(t,l){if(t&1){let e=b();r(0,"resources",39),_("added",function(i){g(e);let m=d();return h(m.setNeedReload(i))}),o()}if(t&2){let e=d();a("lesson",e.lesson)}}var Zr=(()=>{class t{constructor(e,n,i,m,x){this._userService=e,this._lessonService=n,this._router=i,this._route=m,this._bDService=x,this.selectedOption="details",this.lesson=new ke,this.users=[],this.title="Leccion en",this.url=O.url,this.token=this._userService.getToken(),this.identity=this._userService.getIdentity()}ngOnInit(){this.loadLesson(),this.getUsers(),this.getAllAreas();let e=this._router.url||"";if(e.startsWith("/admin"))this.parentUrl="admin";else if(e.startsWith("/inicio"))this.parentUrl="inicio";else{let i=(this._route.snapshot.pathFromRoot||[]).map(m=>m.routeConfig?.path).filter(Boolean).find(m=>m.startsWith("admin")||m.startsWith("inicio"));this.parentUrl=i&&i.split("/")?.[0]||"inicio"}}ngDoCheck(){this.needReloadData&&(this.loadLesson(),this.needReloadData=!1)}getAllAreas(){this.areas=JSON.parse(localStorage.getItem("areas")),this.areas||this._bDService.getAllKnowledgeAreas().subscribe(e=>{e.areas&&(this.areas=e.areas,localStorage.setItem("areas",JSON.stringify(this.areas)))},e=>{console.log(e)})}loadLesson(){this._route.params.subscribe(e=>{let n=e.id;this.getLesson(n)})}getLesson(e){this._lessonService.getLesson(this.token,e).subscribe(n=>{n.lesson?(this.status="success",this.lesson=n.lesson):(this.status="error",this._router.navigate([this.parentUrl,"lecciones"]))},n=>{console.error("Error loading lesson:",n),this._router.navigate([this.parentUrl,"lecciones"])})}setSelectedOption(e){if(this.selectedOption==="resources")try{let n=document.querySelector("resources"),i=n?n.__ngContext__:null}catch{}this.selectedOption=e,this.needReloadData=!0}setNeedReload(e){this.needReloadData=!0}isInTheDevelopmentGroup(){let e;return this.lesson.development_group&&(e=this.lesson.development_group.find(n=>this.identity._id==n._id)),!!(e||this.lesson.expert&&this.lesson.expert._id==this.identity)}showCommentsOrConversations(){return this.lesson?.state==="completed"?this.isAdminPanelViewerAllowed():!(this.isInTheDevelopmentGroup()||this.isInAdminContext())||this.lesson?.state==="proposed"?!1:!!(this.lesson?.expert&&this.lesson?.leader)}isAdminPanelViewerAllowed(){let e=this.identity?.role||"",n=["admin","delegated_admin","lesson_manager"];return this.isInAdminContext()&&n.includes(e)}isInAdminContext(){try{return(this._router.url||"").startsWith("/admin")?!0:(this._route.snapshot.pathFromRoot||[]).map(i=>i.routeConfig?.path).filter(Boolean).some(i=>i.startsWith("admin"))}catch{return!1}}showEdit(){let e;return this.lesson.leader&&this.identity._id==this.lesson.leader._id&&["proposed","assigned","development","test"].includes(this.lesson.state)?e=!0:(e=!1,console.log("parentUrl",this.parentUrl),this.parentUrl=="admin"&&(e=!0)),e}getUsers(){this._userService.getAllUsers().subscribe(e=>{this.users=e.users},e=>{console.log(e)})}static{this.\u0275fac=function(n){return new(n||t)(C(R),C(U),C(se),C(W),C(ft))}}static{this.\u0275cmp=k({type:t,selectors:[["lesson"]],standalone:!1,decls:23,vars:14,consts:[[1,"card"],[1,"card-header","p-1"],["title","Detalles lecci\xF3n",1,"btn","float-left",3,"click"],[1,"fas","fa-home","text-primary","icon-message"],["title","Recursos de la lecci\xF3n",1,"btn","border-left",3,"click"],[1,"fas","fa-boxes","icon-message","text-primary"],["title","Grupo de desarrollo",1,"btn","border-left",3,"click"],[1,"fas","fa-users","icon-message","text-primary"],[1,"btn-group","text-primary","float-right"],["class","btn","title","Editar",3,"click",4,"ngIf"],["class","btn border-left","title","Conversaci\xF3n",3,"click",4,"ngIf"],["class","btn border-left","title","Comentarios del facilitador",3,"click",4,"ngIf"],["class","btn btn-primary","title","Versi\xF3n anterior",3,"routerLink","click",4,"ngIf"],["class","btn btn-primary",4,"ngIf"],["class","btn btn-primary","title","Versi\xF3n siguiente",3,"routerLink",4,"ngIf"],["class","btn border-left ms-2","title","Calificar lecci\xF3n",3,"click",4,"ngIf"],[3,"lesson",4,"ngIf"],[3,"areas","lesson","edited",4,"ngIf"],[3,"users","lesson",4,"ngIf"],[3,"lesson","added",4,"ngIf"],["title","Editar",1,"btn",3,"click"],[1,"fas","fa-edit","icon-message","text-primary"],["title","Conversaci\xF3n",1,"btn","border-left",3,"click"],[1,"fas","fa-comment-dots","icon-message","text-primary"],["title","Comentarios del facilitador",1,"btn","border-left",3,"click"],[1,"fas","fa-clipboard-list","icon-message","text-primary"],["title","Versi\xF3n anterior",1,"btn","btn-primary",3,"click","routerLink"],[1,"fas","fa-angle-left","icon-message"],[1,"btn","btn-primary"],["title","Versi\xF3n siguiente",1,"btn","btn-primary",3,"routerLink"],[1,"fas","fa-angle-right","icon-message"],["title","Calificar lecci\xF3n",1,"btn","border-left","ms-2",3,"click"],[1,"vl"],[1,"fas","fa-star","icon-message","text-warning"],["class","score-contrast",4,"ngIf"],[1,"score-contrast"],[3,"lesson"],[3,"edited","areas","lesson"],[3,"users","lesson"],[3,"added","lesson"]],template:function(n,i){n&1&&(r(0,"div",0)(1,"div",1)(2,"button",2),_("click",function(){return i.setSelectedOption("details")}),p(3,"i",3),o(),r(4,"button",4),_("click",function(){return i.setSelectedOption("resources")}),p(5,"i",5),o(),r(6,"button",6),_("click",function(){return i.setSelectedOption("group")}),p(7,"i",7),o(),r(8,"div",8),u(9,ko,2,0,"button",9)(10,Lo,2,0,"button",10)(11,Oo,2,0,"button",11)(12,Ro,2,4,"button",12)(13,Vo,3,1,"span",13)(14,Po,2,4,"button",14)(15,Uo,4,1,"button",15),o()(),u(16,Do,1,1,"lesson-details",16)(17,No,1,2,"edit",17)(18,Ao,1,2,"group",18)(19,zo,1,1,"rating",16)(20,jo,1,1,"conversation",16)(21,Bo,1,1,"review",16)(22,$o,1,1,"resources",19),o()),n&2&&(s(9),a("ngIf",i.showEdit()),s(),a("ngIf",i.showCommentsOrConversations()),s(),a("ngIf",i.showCommentsOrConversations()),s(),a("ngIf",i.lesson.father_lesson),s(),a("ngIf",i.lesson.version),s(),a("ngIf",i.lesson.son_lesson&&(i.lesson.son_lesson.visible||i.parentUrl=="admin")),s(),a("ngIf",(!i.isInTheDevelopmentGroup()||i.parentUrl=="admin")&&i.lesson.state=="completed"),s(),a("ngIf",i.lesson&&i.selectedOption=="details"),s(),a("ngIf",i.lesson&&i.selectedOption=="edit"),s(),a("ngIf",i.lesson&&i.selectedOption=="group"),s(),a("ngIf",i.lesson&&i.selectedOption=="rating"),s(),a("ngIf",i.lesson&&i.selectedOption=="conversation"),s(),a("ngIf",i.lesson&&i.selectedOption=="review"&&i.lesson.expert),s(),a("ngIf",i.lesson&&i.selectedOption=="resources"))},dependencies:[L,G,St,It,Tt,Ft,kt,Ot,Vt],styles:[".border-left[_ngcontent-%COMP%]{border-left:1px solid #95a5a6!important}h4[_ngcontent-%COMP%]{line-height:unset}","@media (prefers-color-scheme: dark){.score-contrast[_ngcontent-%COMP%]{color:#7c76ac!important}}[data-bs-theme=dark][_ngcontent-%COMP%]   .score-contrast[_ngcontent-%COMP%], .bg-dark[_ngcontent-%COMP%]   .score-contrast[_ngcontent-%COMP%], .text-bg-dark[_ngcontent-%COMP%]   .score-contrast[_ngcontent-%COMP%]{color:#fff!important}"]})}}return t})();var Ea=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=We({type:t})}static{this.\u0275inj=qe({imports:[nt,dt,ct,vt,pt,ht,xt,_t]})}}return t})();export{ke as a,Zr as b,Ea as c};
