import{a as Xt}from"./chunk-SSVOYPUW.js";import{a as at,b as Zt,c as Qt}from"./chunk-YLBCBPX7.js";import{a as Ht,b as Ue,c as Jt}from"./chunk-CWPA2WES.js";import{a as Yt}from"./chunk-TCGBOSDO.js";import{a as Wt}from"./chunk-HD7OORPX.js";import{a as ce,b as me,c as pe,d as zt,f as Gt}from"./chunk-D2BCPON4.js";import{a as Bt}from"./chunk-ZERUOUEI.js";import{a as Fe}from"./chunk-VFNNQMDM.js";import"./chunk-B2YIIQ5G.js";import{a as Ne}from"./chunk-2MHAFAH5.js";import{a as Ut}from"./chunk-NWXDY4ZK.js";import{a as nt}from"./chunk-DQWET3CU.js";import{a as it,b as ot}from"./chunk-XW57BAVQ.js";import"./chunk-4MSQXD5K.js";import{a as ne}from"./chunk-ZJPTCXQ3.js";import{a as jt,b as Kt}from"./chunk-27IZBTZL.js";import{b as $e,c as X,d as rt}from"./chunk-MN65NYX4.js";import{d as Rt}from"./chunk-DEF5ACRI.js";import{a as ie}from"./chunk-3S656WEL.js";import{a as qt}from"./chunk-5P7CLSZR.js";import{a as T}from"./chunk-O2KZDLK6.js";import{a as V}from"./chunk-KOZA5XXI.js";import{B as Vt,C as Dt,b as At,c as j,d as A,e as K,f as Q,g as Mt,h as Ee,i as De,j as He,k as I,l as Le,m as ee,o as Pt,p as Re,q as xe,r as be,s as se,t as le,u as de,z as Ot}from"./chunk-GWDAXWU7.js";import{$b as te,Ba as Ft,Da as s,Ea as Pe,Fa as we,H as Se,Ha as W,Hb as he,Ib as $,Jb as O,M as mt,Mb as Oe,Na as r,Oa as o,Pa as u,Q as Et,Qa as D,R as H,Ra as R,Rb as Tt,S as Qe,Ta as x,Ua as v,Ub as Ve,Va as c,X as et,Ya as S,Za as ae,_ as pt,_a as ut,a as Y,aa as It,ac as Nt,b as ye,ba as g,bc as z,ca as h,cc as G,db as k,dc as $t,eb as l,ec as _t,fb as w,g as Ze,ga as _e,gb as f,hb as J,j as Ae,jb as fe,kb as ve,lb as ge,na as N,nb as B,ob as b,pa as a,sa as y,sb as E,t as Me,ta as P,tb as q,u as Ge,ua as tt,ub as F,vb as L,wa as Lt,xb as kt,ya as p}from"./chunk-3BHHYQXT.js";var ei=[{id:"start",buttonClass:"btn-info",iconClass:"fa-home",spanContent:"Inicio",routerLink:"/inicio",subOptions:[]},{id:"lesson",buttonClass:"btn-warning pl-3",iconClass:"fa-file-alt",spanContent:"Lecciones",routerLink:"/inicio/lecciones",subOptions:[{text:"Todas las lecciones",routerLink:"/inicio/lecciones"},{text:"Convocatorias",routerLink:"/inicio/convocatorias"},{text:"Mis lecciones",routerLink:"/inicio/mis-lecciones"},{text:"Asesorar lecciones",routerLink:"/inicio/asesorar-lecciones"}]},{id:"resources",buttonClass:"btn-danger pl-3",iconClass:"fa-paperclip",spanContent:"Repositorio",routerLink:"/inicio/recursos",subOptions:[]},{id:"user",buttonClass:"btn-success",iconClass:"fa-user-friends",spanContent:"Usuarios",routerLink:"/inicio/usuarios",subOptions:[]}];var Oi=t=>["/perfil",t],Vi=()=>["/login"],Di=()=>["/inicio"],Ri=()=>["/inicio/usuarios"],ti=()=>["/inicio/lecciones"],Ni=()=>["/inicio/convocatorias"],$i=()=>["/inicio/mis-lecciones"],Ui=()=>["/inicio/asesorar-lecciones"],Bi=()=>["/inicio/recursos"],qi=()=>["/academia"];function ji(t,d){t&1&&u(0,"img",19)}function Ki(t,d){if(t&1&&u(0,"img",20),t&2){let e=c();S("src",e.url+"get-image-user/"+e.identity.picture,N)}}function zi(t,d){t&1&&(r(0,"li",28)(1,"a",29),l(2,"Asesorar lecciones"),o()()),t&2&&(a(),s("routerLink",B(1,Ui)))}function Gi(t,d){if(t&1&&(D(0),r(1,"button",22)(2,"div"),u(3,"i",23),r(4,"span",14),l(5,"Lecciones"),o()(),u(6,"i",24),o(),r(7,"div",25)(8,"div",26)(9,"ul",27)(10,"li",28)(11,"a",29),l(12,"Todas las lecciones"),o()(),r(13,"li",28)(14,"a",29),l(15,"Convocatorias"),o()(),r(16,"li",28)(17,"a",29),l(18,"Mis lecciones"),o()(),p(19,zi,3,2,"li",30),o()()(),R()),t&2){let e=c(2);a(11),s("routerLink",B(4,ti)),a(3),s("routerLink",B(5,Ni)),a(3),s("routerLink",B(6,$i)),a(2),s("ngIf",e.identity.role=="expert"||e.identity.canAdvise||e.identity.role=="admin"||e.identity.role=="delegated_admin"||e.identity.role=="lesson_manager")}}function Hi(t,d){t&1&&(r(0,"button",31)(1,"div"),u(2,"i",23),r(3,"span",14),l(4,"Lecciones"),o()()()),t&2&&s("routerLink",B(1,ti))}function Wi(t,d){if(t&1&&(r(0,"div",11),p(1,Gi,20,7,"ng-container",21)(2,Hi,5,2,"ng-template",null,0,L),o()),t&2){let e=k(3),i=c();a(),s("ngIf",i.identity.role!="guest")("ngIfElse",e)}}function Ji(t,d){t&1&&(r(0,"div",11)(1,"button",32)(2,"div"),u(3,"i",33),r(4,"span",14),l(5,"Repositorio"),o()()()()),t&2&&(a(),s("routerLink",B(1,Bi)))}function Yi(t,d){t&1&&(r(0,"span",37),u(1,"i",38),l(2," Estudiante "),o())}function Xi(t,d){if(t&1&&(r(0,"div",11)(1,"button",34)(2,"div"),u(3,"i",35),r(4,"span",14),l(5,"RedDin\xE1mica Acad\xE9mica"),o(),p(6,Yi,3,0,"span",36),o()()()),t&2){let e=c();a(),s("routerLink",B(2,qi)),a(5),s("ngIf",e.identity&&(e.identity.role=="student"||e.identity.role=="guest"))}}var ii=(()=>{class t{constructor(e,i){this._userService=e,this._router=i,this.menuOptions=ei,this.title="Home",this.identity=this._userService.getIdentity(),this.url=V.url}ngOnInit(){if(!this.identity){console.log("Usuario no autenticado, redirigiendo al login"),this._router.navigate(["/login"]);return}}ngDoCheck(){let e=this._userService.getIdentity();e!==this.identity&&(this.identity=e,this.identity||(console.log("Identidad perdida, redirigiendo al login"),this._router.navigate(["/login"])))}static{this.\u0275fac=function(i){return new(i||t)(y(T),y(z))}}static{this.\u0275cmp=P({type:t,selectors:[["home"]],standalone:!1,decls:29,vars:14,consts:[["guestUser",""],[1,"container"],[1,"row","py-3"],[1,"col-3",2,"position","relative"],["id","menu",1,"accordion","home-sidebar",2,"width","253px","position","fixed"],[1,"card","rounded",3,"routerLink"],[1,"card-header","d-flex","align-items-center","px-2",2,"cursor","pointer","background","#ffffff","color","#333"],[1,"rounded-circle","border-1","flex-shrink-0","overflow-hidden",2,"width","40px","height","40px"],["class","img-fluid","src","assets/images/user-default.png",4,"ngIf"],["class","img-fluid",3,"src",4,"ngIf"],[1,"text-center","mb-0","ms-1","text-truncate",2,"color","inherit","font-size","1rem","font-weight","600","line-height","1.2"],[1,"card","mt-2","rounded"],["type","button","data-bs-toggle","collapse","data-bs-target","#start","aria-expanded","true","aria-controls","start",1,"btn","nav-link","w-100","text-start","d-flex","justify-content-between","py-2","btn-info",3,"routerLink"],[1,"text-ligth","fas","fa-home"],[1,"ms-2"],["class","card mt-2 rounded",4,"ngIf"],["type","button","data-bs-toggle","collapse","data-bs-target","#user","aria-expanded","true","aria-controls","user",1,"btn","nav-link","w-100","text-start","d-flex","justify-content-between","py-2","btn-success",3,"routerLink"],[1,"text-ligth","fas","fa-user-friends"],[1,"col-9","ps-0"],["src","assets/images/user-default.png",1,"img-fluid"],[1,"img-fluid",3,"src"],[4,"ngIf","ngIfElse"],["type","button","data-bs-toggle","collapse","data-bs-target","#lesson","aria-expanded","false","aria-controls","lesson",1,"btn","nav-link","w-100","text-start","d-flex","justify-content-between","py-2","btn-warning","ps-3"],[1,"text-ligth","fas","fa-file-alt"],[1,"text-ligth","fas","fa-sort-down"],["id","lesson",1,"collapse"],[1,"card-body","py-2","px-0"],[1,"nav","flex-column"],["subclass","nav-item"],["routerLinkActive","active",1,"nav-link","dropdown-item","text-start",3,"routerLink"],["subclass","nav-item",4,"ngIf"],["type","button","data-bs-toggle","collapse","data-bs-target","#lesson","aria-expanded","false","aria-controls","lesson",1,"btn","nav-link","w-100","text-start","d-flex","justify-content-between","py-2","btn-warning","ps-3",3,"routerLink"],["type","button","data-bs-toggle","collapse","data-bs-target","#resources","aria-expanded","true","aria-controls","resources",1,"btn","nav-link","w-100","text-start","d-flex","justify-content-between","btn-danger","ps-3",3,"routerLink"],[1,"text-ligth","fas","fa-paperclip"],["type","button",1,"btn","nav-link","w-100","text-start","d-flex","justify-content-between","py-2","btn-info",3,"routerLink"],[1,"text-ligth","fas","fa-graduation-cap"],["class","badge bg-warning text-dark ms-2",4,"ngIf"],[1,"badge","bg-warning","text-dark","ms-2"],[1,"fas","fa-user-graduate"]],template:function(i,n){i&1&&(r(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"a",6)(6,"div",7),p(7,ji,1,0,"img",8)(8,Ki,1,1,"img",9),o(),r(9,"h4",10)(10,"strong"),l(11),o()()()(),r(12,"div",11)(13,"button",12)(14,"div"),u(15,"i",13),r(16,"span",14),l(17,"Inicio"),o()()()(),p(18,Wi,4,2,"div",15)(19,Ji,6,2,"div",15),r(20,"div",11)(21,"button",16)(22,"div"),u(23,"i",17),r(24,"span",14),l(25,"Usuarios"),o()()()(),p(26,Xi,7,3,"div",15),o()(),r(27,"div",18),u(28,"router-outlet"),o()()()),i&2&&(a(4),s("routerLink",n.identity?b(9,Oi,n.identity._id):B(11,Vi)),a(3),s("ngIf",!n.identity||!n.identity.picture),a(),s("ngIf",n.identity&&n.identity.picture),a(3),w(n.identity?n.identity.name+" "+n.identity.surname:"Usuario"),a(2),s("routerLink",B(12,Di)),a(5),s("ngIf",n.identity&&n.identity.actived),a(),s("ngIf",n.identity&&n.identity.actived),a(2),s("routerLink",B(13,Ri)),a(5),s("ngIf",n.identity&&n.identity.actived))},dependencies:[O,Nt,G,$t],styles:[".home-sidebar[_ngcontent-%COMP%]{position:fixed!important;top:76px!important;left:110px!important;width:253px!important;max-height:calc(100vh - 90px)!important;overflow-y:auto!important;z-index:98!important}.container[_ngcontent-%COMP%]{padding-top:30px;margin-top:15px}.container[_ngcontent-%COMP%] > .row[_ngcontent-%COMP%] > .col-3[_ngcontent-%COMP%]{position:relative;min-height:100vh}.container[_ngcontent-%COMP%] > .row[_ngcontent-%COMP%] > .col-9.ps-0[_ngcontent-%COMP%]{padding-left:15px!important;padding-top:10px}@media (max-width: 992px){.home-sidebar[_ngcontent-%COMP%]{width:240px!important;left:10px!important}}@media (max-width: 768px){.home-sidebar[_ngcontent-%COMP%]{position:relative!important;top:auto!important;left:auto!important;width:100%!important;max-height:none!important;margin-bottom:20px}}.home-sidebar[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]{transition:all .3s ease!important;border-radius:12px!important}.home-sidebar[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]:hover{transform:translateY(-2px)!important;box-shadow:0 8px 25px #00000026!important}.theme-dark[_ngcontent-%COMP%]   .home-sidebar[_ngcontent-%COMP%]{background:#2c3e50f2!important;border-color:#ffffff1a!important}.theme-dark[_ngcontent-%COMP%]   .home-sidebar[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]{background:#34495ecc!important;color:#ecf0f1!important;border-color:#ffffff1a!important}.theme-dark[_ngcontent-%COMP%]   .home-sidebar[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]:hover{background:#34495e!important;box-shadow:0 8px 25px #0000004d!important}"]})}}return t})();var nn=t=>({"is-invalid":t});function on(t,d){t&1&&(r(0,"div",48)(1,"h2",49),l(2,"Bienvenido a "),r(3,"strong",50),l(4," RedDin\xE1mica "),o()(),u(5,"hr",51),r(6,"h2")(7,"p",52),l(8," Recuerda que para poder ver la secci\xF3n de recursos y lecciones del sitio debes esperar a que el administrador revise tu registro. Tambi\xE9n deber\xE1s volver a iniciar sesi\xF3n una vez se haya activado tu cuenta. "),o()()())}function rn(t,d){t&1&&u(0,"img",53)}function an(t,d){if(t&1&&u(0,"img",54),t&2){let e=c();S("src",e.url+"get-image-user/"+e.identity.picture,N)}}function sn(t,d){if(t&1&&(r(0,"div",55)(1,"div",56,0),l(3),o()()),t&2){let e=c();a(),Pe("width",e.barWidth),a(2),w(e.barWidth)}}function ln(t,d){t&1&&(r(0,"div"),l(1," Es necesario escribir algo o cargar una imagen para poder crear la publicaci\xF3n. "),o())}function dn(t,d){t&1&&(r(0,"div"),l(1," Archivo inv\xE1lido, solo se permite cargar im\xE1genes con extensi\xF3n jpg, png o gif. "),o())}function cn(t,d){if(t&1&&(r(0,"div"),l(1),o()),t&2){let e=c(2);a(),f(" El archivo es demasiado grande, el tama\xF1o maximo permitido es de ",e.MAX_FILE_SIZE,"MB. ")}}function mn(t,d){if(t&1&&(r(0,"div",57),p(1,ln,2,0,"div",58)(2,dn,2,0,"div",58)(3,cn,2,1,"div",58),o()),t&2){let e=c();a(),s("ngIf",e.formError),a(),s("ngIf",e.typeError),a(),s("ngIf",e.maxSizeError)}}function pn(t,d){if(t&1&&(r(0,"small",59),u(1,"i",60),l(2),o()),t&2){let e=c();a(2),f(" ",e.filesToUpload[0].name," ")}}function un(t,d){t&1&&(r(0,"div",61),u(1,"i",62),l(2," Hubo un error creando la publicaci\xF3n. Intentalo de nuevo. "),o())}function _n(t,d){t&1&&(r(0,"div",63),u(1,"i",64),l(2," La publicaci\xF3n se esta subiendo, por favor evita cerrar. "),o())}function fn(t,d){t&1&&(r(0,"div",65),u(1,"i",64),l(2," La publicaci\xF3n se ha creado correctamente. "),o())}function vn(t,d){t&1&&(r(0,"div",7)(1,"h4",59),l(2," No hay publicaciones que mostrar. Comparte lo que quieras con los miembros de RedDin\xE1mica. "),u(3,"i",66),o()())}function gn(t,d){t&1&&(r(0,"div",7)(1,"div",67)(2,"div",68)(3,"span",69),l(4,"Loading..."),o()()()())}function hn(t,d){if(t&1){let e=x();r(0,"div",70)(1,"app-publication-card",71),v("onDelete",function(n){g(e);let m=c();return h(m.setDelete(n))})("onDeleteComment",function(n){g(e);let m=c();return h(m.setDeleteComment(n))})("onError",function(n){g(e);let m=c();return h(m.setErrorMessage(n))}),o()()}if(t&2){let e=d.$implicit,i=c();s("id","publication-"+e._id),Ft("data-publication-id",e._id),a(),s("publication",e)("identity",i.identity)("showDeleteButton",!0)}}function xn(t,d){if(t&1){let e=x();r(0,"button",75),v("click",function(){g(e);let n=c(2);return h(n.viewMore())}),l(1,"Ver m\xE1s publicaciones"),o()}}function bn(t,d){t&1&&(r(0,"div",76),u(1,"i",77),l(2," Has visto todas las publicaciones disponibles "),o())}function Cn(t,d){if(t&1&&(r(0,"div",72),p(1,xn,2,0,"button",73)(2,bn,3,0,"div",74),o()),t&2){let e=c();a(),s("ngIf",!e.noMore),a(),s("ngIf",e.noMore&&e.publications.length>0)}}var Je=(()=>{class t{constructor(e,i,n,m,_,C,M){this._userService=e,this._publicationService=i,this._commentService=n,this._uploadService=m,this._route=_,this._router=C,this.fb=M,this.publications=[],this.submitted=!1,this.noMore=!1,this.MAX_FILE_SIZE=20,this.maxSize=20*1024*1024,this.maxSizeError=!1,this.loading=!0,this.unsubscribe$=new Ae,this.barWidth="0%",this.formError=!1,this.typeError=!1,this.errorMessage="",this.errorMessageTimeout=null,this.title="Bienvenidos a",this.identity=this._userService.getIdentity(),this.token=this._userService.getToken(),this.url=V.url,this.filesToUpload=[],this.createForm(),this.page=1,this.getPublications(this.page),this.handleNavigationFromNotifications()}handleNavigationFromNotifications(){this._route.fragment.pipe(H(this.unsubscribe$)).subscribe(e=>{if(e&&e.startsWith("publication-")){let i=e.replace("publication-","");console.log("Scrolling to publication:",i),setTimeout(()=>{this.scrollToPublication(i)},1e3)}}),this._route.queryParams.pipe(H(this.unsubscribe$)).subscribe(e=>{e.highlight&&console.log("Highlighting element type:",e.highlight)})}scrollToPublication(e){let i=document.querySelector(`#publication-${e}`)||document.querySelector(`[data-publication-id="${e}"]`);i?(i.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),i.classList.add("highlight-notification"),setTimeout(()=>{i.classList.remove("highlight-notification")},3e3),console.log("Scrolled to publication:",e)):(console.log("Publication element not found, trying to load more publications"),this.loadPublicationById(e))}loadPublicationById(e){!this.noMore&&this.page<this.pages&&(this.viewMore(),setTimeout(()=>{this.scrollToPublication(e)},500))}get f(){return this.postForm.controls}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}onChanges(){this.postForm.get("textPost").valueChanges.pipe(H(this.unsubscribe$)).subscribe(e=>{e&&(this.status=null,this.submitted=!1)})}createForm(){this.postForm=this.fb.group({textPost:[""],filePost:[""]}),this.commentForm=this.fb.group({text:["",A.required]})}getPublications(e,i=!1){this._publicationService.getPublications(this.token,e,10,5).pipe(H(this.unsubscribe$),Se(n=>(console.error("Error loading publications:",n),this.noMore=!0,this.loading=!1,Me(null))),mt(()=>{this.loading=!1})).subscribe({next:n=>{n&&(n.publications&&n.publications.length>0?(this.publications=this.publications.concat(n.publications),this.page=e,n.publications.length<10&&(this.noMore=!0)):this.noMore=!0)},error:n=>{console.error("Error en suscripci\xF3n:",n),this.noMore=!0}})}setUpload(){this.status=null,this.submitted=!1}fileChangeEvent(e){this.filesToUpload=e.target.files}onSubmit(){if(this.submitted=!0,this.status=null,!this.postForm.value.textPost&&this.filesToUpload.length<=0){this.formError=!0;return}if(this.filesToUpload[0]){if(!["image/jpeg","image/gif","image/png"].includes(this.filesToUpload[0].type)){this.typeError=!0;return}if(this.filesToUpload[0].size>this.maxSize){this.maxSizeError=!0;return}}this.formError=!1,this.typeError=!1,this.maxSizeError=!1;let e=new Ht(this.postForm.value.textPost,this.identity._id);this._publicationService.addPost(this.token,e).pipe(Et(i=>{if(!i.publication)throw new Error("Publication failed");return this.status="success",this.filesToUpload.length>0?this._uploadService.makeFileRequest(`${this.url}upload-file-post/${i.publication._id}`,[],this.filesToUpload,this.token,"image").pipe(Qe(n=>{switch(n.type){case Ve.UploadProgress:this.status="warning",this.barWidth=`${Math.round(100*n.loaded/n.total)}%`;break;case Ve.Response:console.log("File successfully uploaded!",n.body),this.barWidth="0%",this.status="success";break}}),Se(n=>(console.error(n),this.status="error",this.barWidth="0%",Ge(()=>new Error("File upload failed"))))):Me(i)}),Se(i=>(console.error(i),this.status="error",Ge(()=>new Error("Publication or file upload failed")))),mt(()=>{this.submitted=!1,this.postForm.reset(),this.getPublications(this.page),setTimeout(()=>this.status=null,5e3)})).subscribe()}setDelete(e){this.tempPublicationId=e;let i=document.getElementById("delete");i&&new window.bootstrap.Modal(i).show()}deletePost(){this._publicationService.removePost(this.token,this.tempPublicationId).pipe(H(this.unsubscribe$),Qe(e=>{if(!e.publication)throw new Error("Failed to delete the publication");this.removePublicationFromList(e.publication._id||this.tempPublicationId),this.tempPublicationId=null,this.clearErrorMessage()}),Se(e=>(console.error(e),this.setErrorMessage("Failed to delete the publication. Please try again."),Ge(()=>new Error("Failed to delete the publication"))))).subscribe({error:e=>{console.error("Deletion failed",e)}})}removePublicationFromList(e){if(!e||!Array.isArray(this.publications))return;let i=this.publications.findIndex(n=>n&&n._id===e);i!==-1&&this.publications.splice(i,1)}setErrorMessage(e){this.errorMessageTimeout&&clearTimeout(this.errorMessageTimeout),this.errorMessage=e,this.errorMessageTimeout=setTimeout(()=>{this.errorMessage="",this.errorMessageTimeout=null},5e3)}clearErrorMessage(){this.errorMessage="",this.errorMessageTimeout&&(clearTimeout(this.errorMessageTimeout),this.errorMessageTimeout=null)}setDeleteComment(e){this.tempCommentId=e;let i=document.getElementById("deleteComment");i&&new window.bootstrap.Modal(i).show()}deleteComment(){this._commentService.removeComment(this.token,this.tempCommentId).pipe(H(this.unsubscribe$),Qe(e=>{if(!e.comment)throw new Error("Failed to delete the comment");this.removeCommentFromPublications(this.tempCommentId),this.tempCommentId=null}),Se(e=>(console.error(e),this.setErrorMessage("Failed to delete the comment. Please try again."),Ge(()=>new Error("Failed to delete the comment"))))).subscribe({next:()=>{console.log("Comment deleted successfully")},error:e=>{console.error("Deletion of comment failed",e)}})}removeCommentFromPublications(e){if(!(!e||!Array.isArray(this.publications))){for(let i of this.publications)if(i?.comments&&Array.isArray(i.comments)&&this.removeCommentFromList(i.comments,e))break}}removeCommentFromList(e,i){if(!Array.isArray(e)||!i)return!1;let n=e.findIndex(m=>m&&m._id===i);if(n!==-1)return e.splice(n,1),!0;for(let m of e)if(m?.replies&&Array.isArray(m.replies)&&this.removeCommentFromList(m.replies,i))return!0;return!1}viewMore(){if(this.noMore||this.page>=this.pages){console.log("No more publications to load");return}this.page+=1,this.page>=this.pages&&(this.noMore=!0),this.getPublications(this.page,!0)}newLines(e){let i="";return e&&e.split(`
`).forEach(n=>{i+=`<p>${n}</p>`}),i}checkNoMorePublications(e,i,n,m){let _=e>=i,C=n===0,M=e>1&&n<m,U=i>0&&e>i;return _||C||M||U}resetPagination(){this.page=1,this.noMore=!1,this.publications=[],this.total=0,this.pages=0}static{this.\u0275fac=function(i){return new(i||t)(y(T),y(nt),y(ot),y(it),y(te),y(z),y(Ot))}}static{this.\u0275cmp=P({type:t,selectors:[["main"]],standalone:!1,decls:69,vars:18,consts:[["progress",""],["id","top"],["class","bg-white py-5 mb-2 px-4 rounded border",4,"ngIf"],["id","new-post",1,"card","mb-2"],["enctype","multipart/form-data",3,"ngSubmit","formGroup"],[1,"card-header"],["for","textPost",1,"card-title","m-0",2,"font-size","1.5em"],[1,"card-body"],[1,"row","mb-0","justify-content-center"],[1,"col-2","align-items-center"],[1,"nav-link","d-flex"],[1,"flex-shrink-0","rounded-circle","border-1","overflow-hidden","me-2",2,"width","55px","height","55px"],["class","img-fluid","src","assets/images/user-default.png",4,"ngIf"],["class","img-fluid",3,"src",4,"ngIf"],[1,"col-10","ps-0"],["formControlName","textPost","id","textPost","rows","3",1,"form-control",3,"input","ngClass"],["class","progress",4,"ngIf"],["class","invalid-feedback",4,"ngIf"],["class","text-muted",4,"ngIf"],[1,"text-end","py-1","px-0","bg-transparent"],[1,"row","mb-0","d-flex","align-items-center"],[1,"col-9"],["class","alert alert-danger fade show text-center m-0","role","alert",4,"ngIfSuccessMessage","ngIf"],["class","alert alert-warning fade show text-center m-0","role","alert",4,"ngIfSuccessMessage","ngIf"],["class","alert alert-success fade show text-center m-0","role","alert",4,"ngIfSuccessMessage","ngIf"],[1,"col-1","bg-transparent"],["title","Cargar imagen","for","filePost",1,"m-0",2,"font-size","2.2em"],[1,"fas","fa-image","text-success",2,"cursor","pointer"],["formControlName","filePost","type","file","id","filePost","name","image",1,"form-control",2,"display","none",3,"change","click"],[1,"col","bg-transparent"],["type","submit",1,"btn","btn-success","w-100",3,"disabled"],["class","card-body",4,"ngIf"],["class","publication-card",3,"id",4,"ngFor","ngForOf"],["class","text-center",4,"ngIf"],["id","delete","tabindex","-1","role","dialog","aria-labelledby","deletePublicationTitle","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-dialog-centered"],[1,"modal-content"],[1,"modal-header"],["id","deleteTitle",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],["role","alert",1,"alert","alert-warning","mb-0"],[1,"fas","fa-exclamation-triangle","icon-message","me-2"],[1,"modal-footer"],["data-bs-dismiss","modal",1,"btn","btn-danger",3,"click"],["data-bs-dismiss","modal",1,"btn","btn-secondary"],["id","deleteComment","tabindex","-1","role","dialog","aria-labelledby","deleteCommentTitle","aria-hidden","true",1,"modal","fade"],["id","deleteCommentTitle",1,"modal-title"],[1,"bg-white","py-5","mb-2","px-4","rounded","border"],[1,""],[1,"display-4","text-primary","fw-bolder","rd"],[1,"my-2","text-primary",2,"border","3px solid"],[1,"text-muted",2,"margin-top","25px","text-emphasis-color","red"],["src","assets/images/user-default.png",1,"img-fluid"],[1,"img-fluid",3,"src"],[1,"progress"],["role","progressbar","aria-valuenow","barWidth","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","progress-bar-striped","progress-bar-animated"],[1,"invalid-feedback"],[4,"ngIf"],[1,"text-muted"],[1,"fas","fa-paperclip"],["role","alert",1,"alert","alert-danger","fade","show","text-center","m-0"],[1,"fas","fa-times-circle","icon-message","me-2"],["role","alert",1,"alert","alert-warning","fade","show","text-center","m-0"],[1,"fas","fa-check-circle","icon-message","me-2"],["role","alert",1,"alert","alert-success","fade","show","text-center","m-0"],[1,"fas","fa-laugh","icon-message"],[1,"text-muted","text-center"],["role","status",1,"spinner-border",2,"width","3rem","height","3rem"],[1,"visually-hidden"],[1,"publication-card",3,"id"],[3,"onDelete","onDeleteComment","onError","publication","identity","showDeleteButton"],[1,"text-center"],["class","btn btn-primary",3,"click",4,"ngIf"],["class","text-muted mt-3",4,"ngIf"],[1,"btn","btn-primary",3,"click"],[1,"text-muted","mt-3"],[1,"fas","fa-check-circle","me-2"]],template:function(i,n){i&1&&(u(0,"span",1),p(1,on,9,0,"div",2),r(2,"div",3)(3,"form",4),v("ngSubmit",function(){return n.onSubmit()}),r(4,"div",5)(5,"label",6)(6,"strong"),l(7,"Crear publicaci\xF3n: "),o()()(),r(8,"div",7)(9,"div",8)(10,"div",9)(11,"a",10)(12,"div",11),p(13,rn,1,0,"img",12)(14,an,1,1,"img",13),o()()(),r(15,"div",14)(16,"textarea",15),v("input",function(){return n.onChanges()}),o(),p(17,sn,4,3,"div",16)(18,mn,4,3,"div",17)(19,pn,3,1,"small",18),o()(),r(20,"div",19)(21,"div",20)(22,"div",21),p(23,un,3,0,"div",22)(24,_n,3,0,"div",23)(25,fn,3,0,"div",24),o(),r(26,"div",25)(27,"label",26),u(28,"i",27),r(29,"input",28),v("change",function(_){return n.fileChangeEvent(_)})("click",function(){return n.setUpload()}),o()()(),r(30,"div",29)(31,"button",30),l(32,"Publicar"),o()()()()()()(),p(33,vn,4,0,"div",31)(34,gn,5,0,"div",31)(35,hn,2,5,"div",32)(36,Cn,3,2,"div",33),r(37,"div",34)(38,"div",35)(39,"div",36)(40,"div",37)(41,"h5",38),l(42,"Eliminar publicaci\xF3n"),o(),u(43,"button",39),o(),r(44,"div",40)(45,"div",41),u(46,"i",42),l(47," \xBFEst\xE1 seguro que desea eliminar la publicaci\xF3n? "),o()(),r(48,"div",43)(49,"button",44),v("click",function(){return n.deletePost()}),l(50,"S\xED"),o(),r(51,"button",45),l(52,"No"),o()()()()(),r(53,"div",46)(54,"div",35)(55,"div",36)(56,"div",37)(57,"h5",47),l(58,"Eliminar comentario"),o(),u(59,"button",39),o(),r(60,"div",40)(61,"div",41),u(62,"i",42),l(63," \xBFEst\xE1 seguro que desea eliminar el comentario? "),o()(),r(64,"div",43)(65,"button",44),v("click",function(){return n.deleteComment()}),l(66,"S\xED"),o(),r(67,"button",45),l(68,"No"),o()()()()()),i&2&&(a(),s("ngIf",!n.identity.actived),a(2),s("formGroup",n.postForm),a(10),s("ngIf",!n.identity.picture),a(),s("ngIf",n.identity.picture),a(2),s("ngClass",b(16,nn,n.submitted&&(n.formError||n.typeError||n.maxSizeError))),a(),s("ngIf",n.filesToUpload!=null||n.barWidth!="0%"),a(),s("ngIf",n.submitted&&(n.formError||n.typeError||n.maxSizeError)),a(),s("ngIf",n.filesToUpload.length>0),a(4),s("ngIf",n.status==="error"),a(),s("ngIf",n.status==="warning"),a(),s("ngIf",n.status==="success"),a(6),s("disabled",n.submitted),a(2),s("ngIf",n.publications.length==0&&!n.loading),a(),s("ngIf",n.loading),a(),s("ngForOf",n.publications),a(),s("ngIf",n.publications&&n.publications.length>0))},dependencies:[he,$,O,ee,j,K,Q,xe,be,Ue],styles:[".highlight-notification[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_highlightPulse 3s ease-in-out;border:2px solid #007bff!important;border-radius:8px!important;box-shadow:0 0 20px #007bff4d!important}@keyframes _ngcontent-%COMP%_highlightPulse{0%{background-color:#007bff1a;transform:scale(1)}50%{background-color:#007bff33;transform:scale(1.02)}to{background-color:transparent;transform:scale(1)}}.publication-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 12px #0000001a;transition:all .3s ease}.publication-card[_ngcontent-%COMP%]{transition:all .3s ease;position:relative}"]})}}return t})();var yn=t=>["/perfil",t];function Sn(t,d){t&1&&(r(0,"div",6)(1,"div",7)(2,"div",8)(3,"span",9),l(4,"Cargando publicaci\xF3n..."),o()(),r(5,"p",10),l(6,"Cargando publicaci\xF3n..."),o()()())}function wn(t,d){if(t&1){let e=x();r(0,"div",6)(1,"div",11)(2,"div",12),u(3,"i",13),l(4),o(),r(5,"div",14)(6,"button",15),v("click",function(){g(e);let n=c();return h(n.goBackToFeed())}),u(7,"i",16),l(8," Ir al inicio "),o()()()()}if(t&2){let e=c();a(4),f(" ",e.error," ")}}function En(t,d){if(t&1){let e=x();r(0,"div",17)(1,"div",18),u(2,"i",19),l(3," Est\xE1s viendo una publicaci\xF3n espec\xEDfica. Esta vista est\xE1 optimizada para comentarios y interacciones. "),o(),r(4,"div",20)(5,"app-publication-card",21),v("onDelete",function(n){g(e);let m=c();return h(m.onDeletePublication(n))})("onDeleteComment",function(n){g(e);let m=c();return h(m.onDeleteComment(n))})("onError",function(n){g(e);let m=c();return h(m.onError(n))}),o()(),r(6,"div",22)(7,"div",23)(8,"div",24)(9,"div",11)(10,"h6",25),u(11,"i",26),l(12," Interacciones "),o(),r(13,"p",27),l(14," Desde aqu\xED puedes comentar, dar me gusta y responder a otros usuarios de forma m\xE1s c\xF3moda. "),o()()()(),r(15,"div",23)(16,"div",24)(17,"div",11)(18,"h6",25),u(19,"i",28),l(20," Actualizaciones en tiempo real "),o(),r(21,"p",27),l(22," Los nuevos comentarios y respuestas aparecer\xE1n autom\xE1ticamente sin necesidad de recargar. "),o()()()()(),r(23,"div",22)(24,"div",29)(25,"div",30)(26,"button",31),v("click",function(){g(e);let n=c();return h(n.goBackToFeed())}),u(27,"i",32),l(28," Ver todas las publicaciones "),o(),r(29,"button",33),u(30,"i",34),l(31),o()()()()()}if(t&2){let e=c();a(5),s("publication",e.publication)("identity",e.identity)("showDeleteButton",e.identity&&e.identity._id===e.publication.user._id)("enableRealTimeUpdates",!0),a(24),s("routerLink",b(6,yn,e.publication.user._id)),a(2),f(" Ver perfil de ",e.publication.user.name," ")}}var ni=(()=>{class t{constructor(e,i,n,m){this._route=e,this._router=i,this._userService=n,this._publicationService=m,this.publication=null,this.loading=!0,this.error="",this.unsubscribe$=new Ae,this.identity=this._userService.getIdentity(),this.url=V.url}ngOnInit(){this._route.params.pipe(H(this.unsubscribe$)).subscribe(e=>{let i=e.id;i?this.loadPublication(i):(this.error="ID de publicaci\xF3n no v\xE1lido",this.loading=!1)})}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}loadPublication(e){let i=this._userService.getToken();if(!i){this._router.navigate(["/login"]);return}this._publicationService.getPublication(i,e,10,5).pipe(H(this.unsubscribe$),Se(n=>(console.error("Error loading publication:",n),this.error="No se pudo cargar la publicaci\xF3n. Es posible que haya sido eliminada.",this.loading=!1,Me(null)))).subscribe({next:n=>{n&&n.publication?(this.publication=n.publication,n.pagination&&(this.publication.pagination=n.pagination),this.loading=!1,this._route.queryParams.pipe(H(this.unsubscribe$)).subscribe(m=>{m.highlight==="comment"&&setTimeout(()=>{this.scrollToComments()},500)})):(this.error="Publicaci\xF3n no encontrada",this.loading=!1)},error:n=>{console.error("Error in publication subscription:",n),this.error="Error al cargar la publicaci\xF3n",this.loading=!1}})}scrollToComments(){let e=document.querySelector(".comments-section")||document.querySelector("#comments-form-"+this.publication._id);e&&e.scrollIntoView({behavior:"smooth",block:"start"})}onDeletePublication(e){if(!e){this.onError("ID de publicaci\xF3n inv\xE1lido");return}let i=this._userService.getToken();if(!i){this._router.navigate(["/login"]);return}this.loading=!0,this._publicationService.removePost(i,e).pipe(H(this.unsubscribe$),Se(n=>(console.error("Error deleting publication:",n),this.loading=!1,this.onError("No se pudo eliminar la publicaci\xF3n. Int\xE9ntalo nuevamente."),Me(null)))).subscribe(n=>{this.loading=!1,this._router.navigate(["/inicio"],{queryParams:{message:"Publicaci\xF3n eliminada exitosamente"}})})}onDeleteComment(e){this.publication&&this.publication._id&&this.loadPublication(this.publication._id)}onError(e){this.error=e,setTimeout(()=>{this.error=""},5e3)}goBackToFeed(){this._router.navigate(["/inicio"])}static{this.\u0275fac=function(i){return new(i||t)(y(te),y(z),y(T),y(nt))}}static{this.\u0275cmp=P({type:t,selectors:[["app-single-publication"]],standalone:!1,decls:8,vars:3,consts:[[1,"row","mb-3"],[1,"col"],[1,"btn","btn-outline-primary",3,"click"],[1,"fas","fa-arrow-left","me-2"],["class","card",4,"ngIf"],["class","single-publication-container",4,"ngIf"],[1,"card"],[1,"card-body","text-center"],["role","status",1,"spinner-border","text-primary"],[1,"sr-only"],[1,"mt-3","text-muted"],[1,"card-body"],["role","alert",1,"alert","alert-danger"],[1,"fas","fa-exclamation-triangle","me-2"],[1,"text-center"],[1,"btn","btn-primary",3,"click"],[1,"fas","fa-home","me-2"],[1,"single-publication-container"],["role","alert",1,"alert","alert-info","mb-3"],[1,"fas","fa-info-circle","me-2"],[1,"publication-spotlight"],[3,"onDelete","onDeleteComment","onError","publication","identity","showDeleteButton","enableRealTimeUpdates"],[1,"row","mt-4"],[1,"col-md-6"],[1,"card","bg-light"],[1,"card-title"],[1,"fas","fa-comments","me-2"],[1,"card-text","small","text-muted"],[1,"fas","fa-bolt","me-2"],[1,"col","text-center"],["role","group",1,"btn-group"],[1,"btn","btn-outline-secondary",3,"click"],[1,"fas","fa-stream","me-2"],[1,"btn","btn-outline-primary",3,"routerLink"],[1,"fas","fa-user","me-2"]],template:function(i,n){i&1&&(r(0,"div",0)(1,"div",1)(2,"button",2),v("click",function(){return n.goBackToFeed()}),u(3,"i",3),l(4," Volver al feed "),o()()(),p(5,Sn,7,0,"div",4)(6,wn,9,1,"div",4)(7,En,32,8,"div",5)),i&2&&(a(5),s("ngIf",n.loading),a(),s("ngIf",n.error&&!n.loading),a(),s("ngIf",n.publication&&!n.loading&&!n.error))},dependencies:[O,G,Ue],styles:['.single-publication-container[_ngcontent-%COMP%]{max-width:100%;margin:0 auto}.publication-spotlight[_ngcontent-%COMP%]{background:linear-gradient(135deg,#f8f9fa,#fff);border-radius:12px;padding:20px;box-shadow:0 8px 32px #0000001a;border:2px solid #e3f2fd;position:relative;overflow:hidden}.publication-spotlight[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:0;right:0;height:4px;background:linear-gradient(90deg,#007bff,#0056b3)}.publication-spotlight[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeInUp .6s ease-out}@keyframes _ngcontent-%COMP%_fadeInUp{0%{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}.btn-outline-primary[_ngcontent-%COMP%]{border-radius:25px;padding:8px 20px;font-weight:500;transition:all .3s ease}.btn-outline-primary[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 12px #007bff4d}.card.bg-light[_ngcontent-%COMP%]{border:none;border-radius:10px;transition:transform .3s ease}.card.bg-light[_ngcontent-%COMP%]:hover{transform:translateY(-3px);box-shadow:0 6px 20px #0000001a}.alert-info[_ngcontent-%COMP%]{border-left:4px solid #007bff;border-radius:0 8px 8px 0;background:linear-gradient(135deg,#e3f2fd,#f8f9ff)}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{border-radius:25px;margin:0 5px;transition:all .3s ease}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:hover{transform:translateY(-2px)}@media (max-width: 768px){.publication-spotlight[_ngcontent-%COMP%]{padding:15px;margin:0 10px}.btn-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin:0}}.spinner-border[_ngcontent-%COMP%]{width:3rem;height:3rem}.alert-danger[_ngcontent-%COMP%]{border-left:4px solid #dc3545;border-radius:0 8px 8px 0}.single-publication-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{transition:all .3s ease}.single-publication-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]:hover{box-shadow:0 4px 16px #0000001a}.publication-spotlight[_ngcontent-%COMP%]:after{content:"\\1f3af";position:absolute;top:10px;right:15px;font-size:20px;opacity:.7}']})}}return t})();var oi=[{id:"name",label:"Nombres",type:"text",attr:"name",required:!0},{id:"surname",label:"Apellidos",type:"text",attr:"surname",required:!0},{id:"email",label:"Correo electr\xF3nico",type:"text",attr:"email",required:!0},{id:"city",label:"Ciudad",type:"select",attr:"city",required:!1,autocomplete:!0},{id:"profession",label:"Profesi\xF3n",type:"select",attr:"profession",required:!1,autocomplete:!0},{id:"institution",label:"Instituci\xF3n",type:"select",attr:"institution",required:!1,autocomplete:!0},{id:"category",label:"Categor\xEDa",type:"select",attr:"role",required:!0}],ri=[{id:"name",label:"Nombres",type:"text",attr:"name"},{id:"surname",label:"Apellidos",type:"text",attr:"surname"},{id:"email",label:"Correo electr\xF3nico",type:"text",attr:"email"},{id:"about",label:"Descripci\xF3n",type:"textarea",attr:"about"},{id:"city",label:"Ciudad",type:"text",attr:"city"},{id:"profession",label:"Profesi\xF3n",type:"text",attr:"profession"},{id:"institution",label:"Instituci\xF3n",type:"text",attr:"institution"},{id:"postgraduate",label:"Postgrados",type:"textarea",attr:"postgraduate"},{id:"category",label:"Categor\xEDa",type:"select",attr:"role",required:!0}],ai=[{label:"Facilitador",value:"expert"},{label:"Docente",value:"teacher"},{label:"Estudiante",value:"student"},{label:"Invitado",value:"guest"},{label:"Administrador",value:"delegated_admin"}],si={teacher:{label:"Docente",class:"badge-success"},guest:{label:"Invitado",class:"badge-orange"},student:{label:"Estudiante",class:"badge-info"},expert:{label:"Facilitador",class:"badge-purple"},admin:{label:"Administrador",class:"badge-green"},delegated_admin:{label:"Administrador",class:"badge-green"},lesson_manager:{label:"Gestor de lecciones",class:"badge-pink"}};var Be=(()=>{class t{transform(e,i){return i?(i=i.toLowerCase(),e.filter(n=>n.name?n.name.toLowerCase().includes(i):n.title?n.title.toLowerCase().includes(i):!1)):e}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275pipe=Lt({name:"filter",type:t,pure:!0,standalone:!1})}}return t})();var li=t=>["/perfil",t],di=t=>["/inicio/usuarios",t];function In(t,d){if(t&1){let e=x();r(0,"div",28)(1,"div",29)(2,"input",30),v("click",function(){let n=g(e).$implicit,m=c();return h(m.setCategory(n.value))}),o(),r(3,"label",31),l(4),o()()()}if(t&2){let e=d.$implicit;a(2),S("id",e.value),a(),S("for",e.value),a(),f(" ",e.label," ")}}function Ln(t,d){t&1&&(r(0,"div",4)(1,"div",32)(2,"div",33)(3,"span",34),l(4,"Loading..."),o()()()())}function Fn(t,d){t&1&&u(0,"img",47)}function kn(t,d){if(t&1&&u(0,"img",48),t&2){let e=c(2).$implicit,i=c(2);S("src",i.url+"get-image-user/"+e.picture,N)}}function Tn(t,d){if(t&1&&(r(0,"span"),u(1,"i",49),l(2),o()),t&2){let e=c(2).$implicit,i=c(2);W("badge badge-role ",i.labelProfile[e.role].class,""),a(2),f("",i.labelProfile[e.role].label," ")}}function An(t,d){if(t&1){let e=x();r(0,"button",50),v("click",function(){g(e);let n=c(2).$implicit,m=c(2);return h(m.followUser(n._id))}),u(1,"i",51),l(2," Seguir "),o()}}function Mn(t,d){t&1&&(r(0,"span"),u(1,"i",54),l(2," Dejar de seguir "),o())}function Pn(t,d){t&1&&(r(0,"span"),u(1,"i",55),l(2," Siguiendo "),o())}function On(t,d){if(t&1){let e=x();r(0,"button",52),v("mouseenter",function(){g(e);let n=c(2).$implicit,m=c(2);return h(m.mouseEnter(n._id))})("mouseleave",function(){g(e);let n=c(4);return h(n.mouseLeave())})("click",function(){g(e);let n=c(2).$implicit,m=c(2);return h(m.getU(n._id))}),p(1,Mn,3,0,"span",53)(2,Pn,3,0,"ng-template",null,0,L),o()}if(t&2){let e=k(3),i=c(2).$implicit,n=c(2);we("btn-danger",i._id==n.followUserOver),a(),s("ngIf",i._id==n.followUserOver)("ngIfElse",e)}}function Vn(t,d){if(t&1&&(r(0,"div",1)(1,"div",4)(2,"div",37)(3,"div",38)(4,"div",39),p(5,Fn,1,0,"img",40)(6,kn,1,1,"img",41),o()(),r(7,"div",9)(8,"a",42)(9,"h5"),l(10),o()(),p(11,Tn,3,4,"span",43),o(),r(12,"div",44),p(13,An,3,0,"button",45)(14,On,4,4,"button",46),o()()()()),t&2){let e=c().$implicit,i=c(2);a(5),s("ngIf",!e.picture),a(),s("ngIf",e.picture),a(2),s("routerLink",b(8,li,e._id)),a(2),J("",e.name," ",e.surname,""),a(),s("ngIf",i.labelProfile[e.role]),a(2),s("ngIf",i.following.indexOf(e._id)<0),a(),s("ngIf",i.following.indexOf(e._id)>=0)}}function Dn(t,d){if(t&1&&(r(0,"div"),p(1,Vn,15,10,"div",36),o()),t&2){let e=d.$implicit,i=c(2);a(),s("ngIf",i.identity._id!=e._id)}}function Rn(t,d){if(t&1&&(r(0,"div"),p(1,Dn,2,1,"div",35),o()),t&2){let e=c();a(),s("ngForOf",e.users)}}function Nn(t,d){t&1&&u(0,"img",47)}function $n(t,d){if(t&1&&u(0,"img",48),t&2){let e=c(2).$implicit,i=c(2);S("src",i.url+"get-image-user/"+e.picture,N)}}function Un(t,d){if(t&1&&(r(0,"span"),u(1,"i",49),l(2),o()),t&2){let e=c(2).$implicit,i=c(2);W("badge badge-role ",i.labelProfile[e.role].class,""),a(2),f("",i.labelProfile[e.role].label," ")}}function Bn(t,d){if(t&1){let e=x();r(0,"button",50),v("click",function(){g(e);let n=c(2).$implicit,m=c(2);return h(m.followUser(n._id))}),u(1,"i",51),l(2," Seguir "),o()}}function qn(t,d){t&1&&(r(0,"span"),u(1,"i",54),l(2," Dejar de seguir "),o())}function jn(t,d){t&1&&(r(0,"span"),u(1,"i",55),l(2," Siguiendo "),o())}function Kn(t,d){if(t&1){let e=x();r(0,"button",52),v("mouseenter",function(){g(e);let n=c(2).$implicit,m=c(2);return h(m.mouseEnter(n._id))})("mouseleave",function(){g(e);let n=c(4);return h(n.mouseLeave())})("click",function(){g(e);let n=c(2).$implicit,m=c(2);return h(m.getU(n._id))}),p(1,qn,3,0,"span",53)(2,jn,3,0,"ng-template",null,0,L),o()}if(t&2){let e=k(3),i=c(2).$implicit,n=c(2);we("btn-danger",i._id==n.followUserOver),a(),s("ngIf",i._id==n.followUserOver)("ngIfElse",e)}}function zn(t,d){if(t&1&&(r(0,"div",1)(1,"div",4)(2,"div",37)(3,"div",38)(4,"div",39),p(5,Nn,1,0,"img",40)(6,$n,1,1,"img",41),o()(),r(7,"div",9)(8,"a",42)(9,"h5"),l(10),o()(),p(11,Un,3,4,"span",43),o(),r(12,"div",44),p(13,Bn,3,0,"button",45)(14,Kn,4,4,"button",46),o()()()()),t&2){let e=c().$implicit,i=c(2);a(5),s("ngIf",!e.picture),a(),s("ngIf",e.picture),a(2),s("routerLink",b(8,li,e._id)),a(2),J("",e.name," ",e.surname,""),a(),s("ngIf",i.labelProfile[e.role]),a(2),s("ngIf",i.following.indexOf(e._id)<0),a(),s("ngIf",i.following.indexOf(e._id)>=0)}}function Gn(t,d){if(t&1&&(r(0,"div"),p(1,zn,15,10,"div",36),o()),t&2){let e=d.$implicit,i=c(2);a(),s("ngIf",i.identity._id!=e._id)}}function Hn(t,d){if(t&1&&(r(0,"div"),p(1,Gn,2,1,"div",35),E(2,"filter"),o()),t&2){let e=c();a(),s("ngForOf",F(2,1,e.allUsers,e.filter.value))}}function Wn(t,d){if(t&1&&(r(0,"li",59)(1,"a",60),l(2,"Anterior"),o()()),t&2){let e=c(2);a(),s("routerLink",b(1,di,e.prevPage))}}function Jn(t,d){if(t&1&&(r(0,"li",59)(1,"a",61),l(2,"Siguiente"),o()()),t&2){let e=c(2);a(),s("routerLink",b(1,di,e.nextPage))}}function Yn(t,d){if(t&1&&(r(0,"nav",56)(1,"ul",57),p(2,Wn,3,3,"li",58)(3,Jn,3,3,"li",58),o()()),t&2){let e=c();a(2),s("ngIf",e.page>1),a(),s("ngIf",e.page<e.pages&&e.page!=e.pages)}}var vt=(()=>{class t{constructor(e,i,n,m,_){this._bDService=e,this._userService=i,this._followService=n,this._route=m,this._router=_,this.addFieldsForm=oi,this.editFieldsForm=ri,this.labelProfile=si,this.addCity=!1,this.submitted=!1,this.editSubmitted=!1,this.city=new Yt,this.profession=new jt(""),this.institution=new Kt,this.user=new qt,this.users=[],this.selectedCategory=[],this.loading=!0,this.unsubscribe$=new Ae,this.title="Usuarios",this.identity=i.getIdentity(),this.token=i.getToken(),this.categories=ai,this.url=V.url,this.addForm=new Ee({name:new I("",A.required),surname:new I("",A.required),email:new I("",[A.required,A.email]),profession:new I(""),institution:new I(""),city:new I(""),category:new I("",A.required)}),this.editForm=new Ee({name:new I(""),surname:new I(""),email:new I(""),profession:new I(""),institution:new I(""),about:new I(""),city:new I(""),category:new I(""),postgraduate:new I("")}),this.state=new I(""),this.country=new I(""),this.items={city:[],institution:[],profession:[]},this.filter=new I}ngOnInit(){this.getAllUsers(),this.getAllCities(),this.getAllInstitutions(),this.getAllProfessions(),this.actualPage()}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}get f(){return this.addForm.controls}get f2(){return this.editForm.controls}getAllCities(){this._bDService.getAllCities().pipe(H(this.unsubscribe$)).subscribe({next:e=>{e.cities&&(this.allCities=e.cities,localStorage.setItem("cities",JSON.stringify(this.allCities)))},error:e=>{console.error("Error fetching cities:",e)}})}getAllProfessions(){this.allProfessions=JSON.parse(localStorage.getItem("professions")),this.allProfessions||this._bDService.getAllProfessions().pipe(H(this.unsubscribe$)).subscribe({next:e=>{e.professions&&(this.allProfessions=e.professions,localStorage.setItem("professions",JSON.stringify(this.allProfessions)))},error:e=>{console.error("Error fetching professions:",e)}})}getAllInstitutions(){this.allInstitutions=JSON.parse(localStorage.getItem("institutions")),this.allInstitutions||this._bDService.getAllInstitutions().pipe(H(this.unsubscribe$)).subscribe({next:e=>{e.institutions&&(this.allInstitutions=e.institutions,localStorage.setItem("institutions",JSON.stringify(this.allInstitutions)))},error:e=>{console.error("Error fetching institutions:",e)}})}actualPage(){this._route.params.pipe(H(this.unsubscribe$)).subscribe(e=>{let i=+e.page||1;this.page=i,this.nextPage=i+1,this.prevPage=i-1,this.prevPage<=0&&(this.prevPage=1),this.getUsers(this.page)})}getUsers(e){this.loading=!0,this._userService.getUsers(e).pipe(H(this.unsubscribe$)).subscribe({next:i=>{i.users?(this.users=i.users,this.total=i.totalItems,this.pages=i.totalPages,this.followers=i.followers,this.following=i.following,e>this.pages&&this._router.navigate(["/inicio/usuarios"]),this.loading=!1):(this.loading=!1,console.log("No users found"))},error:i=>{this.loading=!1,console.error("Error fetching users:",i)}})}getAllUsers(){let e=[];this._userService.getAllUsers().pipe(H(this.unsubscribe$)).subscribe({next:i=>{i.users&&(this.allUsers=i.users,this.followers=i.followers,this.following=i.following,this.selectedCategory.length>0&&(this.selectedCategory.forEach(n=>{e=e.concat(this.allUsers.filter(m=>m.role===n))}),this.allUsers=e))},error:i=>{console.error("Error fetching all users:",i)}})}setCategory(e){this.selectedCategory.indexOf(e)>=0?(e=="delegated_admin"&&this.selectedCategory.splice(this.selectedCategory.indexOf("admin"),1),this.selectedCategory.splice(this.selectedCategory.indexOf(e),1)):(e=="delegated_admin"&&this.selectedCategory.push("admin"),this.selectedCategory.push(e)),this.getAllUsers()}mouseEnter(e){this.followUserOver=e}mouseLeave(){this.followUserOver=0}followUser(e){let i=new Jt;i.user=this.identity._id,i.followed=e,this._followService.addFollow(this.token,i).subscribe({next:n=>{n.follow&&this.following.push(n.follow.followed)},error:n=>{console.error("Failed to follow user:",n)}})}getU(e){console.log(e),this.TempU=e}unfollow(){this.unfollowUser(this.TempU),this.TempU=""}unfollowUser(e){this._followService.removeFollow(this.token,e).subscribe({next:i=>{let n=this.following.indexOf(e);n!==-1&&this.following.splice(n,1)},error:i=>{console.error("Failed to unfollow user:",i)}})}static{this.\u0275fac=function(i){return new(i||t)(y(ie),y(T),y(Ut),y(te),y(z))}}static{this.\u0275cmp=P({type:t,selectors:[["users"]],standalone:!1,decls:36,vars:7,consts:[["following",""],[1,"card"],[1,"card-header"],[1,"m-0","text-primary","font-weight-bolder","float-left"],[1,"card-body"],[1,"categories-form"],[1,"categories-container"],["class","category-item",4,"ngFor","ngForOf"],[1,"form-group","row"],[1,"col"],[1,"input-group","mb-2"],[1,"input-group-text"],["type","text","id","inlineFormInputGroup","placeholder","Filtro","autocomplete","off",1,"form-control",3,"formControl"],["class","card-body",4,"ngIf"],[4,"ngIf"],["class","mt-3","aria-label","Page navigation",4,"ngIf"],["id","unfollowU","tabindex","-1","role","dialog","aria-labelledby","unfollowUsuario","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-dialog-centered"],[1,"modal-content"],[1,"modal-header"],["id","unfollowUsr",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],["role","alert",1,"alert","alert-warning","mb-0"],[1,"fas","fa-exclamation-triangle","icon-message","me-2"],[1,"modal-footer"],["data-bs-dismiss","modal",1,"btn","btn-danger",3,"click"],["data-bs-dismiss","modal",1,"btn","btn-primary","text-white"],[1,"category-item"],[1,"form-check"],["type","checkbox",1,"form-check-input",3,"click","id"],[1,"form-check-label",3,"for"],[1,"text-muted","text-center"],["role","status",1,"spinner-border",2,"width","3rem","height","3rem"],[1,"sr-only"],[4,"ngFor","ngForOf"],["class","card",4,"ngIf"],[1,"row","align-items-center"],[1,"col-2"],[1,"picture","rounded-circle","border-4","overflow-hidden"],["class","img-fluid","src","assets/images/user-default.png",4,"ngIf"],["class","img-fluid",3,"src",4,"ngIf"],[1,"text-primary","user-name",3,"routerLink"],[3,"class",4,"ngIf"],[1,"col","text-center"],["type","button","class","btn btn-outline-primary btn-sm",3,"click",4,"ngIf"],["type","button","class","btn btn-primary btn-sm","data-bs-toggle","modal","data-bs-target","#unfollowU",3,"btn-danger","mouseenter","mouseleave","click",4,"ngIf"],["src","assets/images/user-default.png",1,"img-fluid"],[1,"img-fluid",3,"src"],[1,"fas","fa-user-tag","me-1"],["type","button",1,"btn","btn-outline-primary","btn-sm",3,"click"],[1,"fas","fa-plus-square","me-2"],["type","button","data-bs-toggle","modal","data-bs-target","#unfollowU",1,"btn","btn-primary","btn-sm",3,"mouseenter","mouseleave","click"],[4,"ngIf","ngIfElse"],[1,"fas","fa-minus-square","me-2"],[1,"fas","fa-check-square","me-2"],["aria-label","Page navigation",1,"mt-3"],[1,"pagination","justify-content-end"],["class","page-item",4,"ngIf"],[1,"page-item"],[1,"page-link","bg-primary",3,"routerLink"],[1,"page-link","bg-info",3,"routerLink"]],template:function(i,n){i&1&&(r(0,"div",1)(1,"div",2)(2,"h3",3),l(3),o()(),r(4,"div",4)(5,"form",5)(6,"div",6),p(7,In,5,3,"div",7),o()(),r(8,"div",8)(9,"div",9)(10,"form")(11,"div",10)(12,"div",11)(13,"div",11),l(14,"Filtrar:"),o()(),u(15,"input",12),o()()()(),p(16,Ln,5,0,"div",13)(17,Rn,2,1,"div",14)(18,Hn,3,4,"div",14)(19,Yn,4,2,"nav",15),o()(),r(20,"div",16)(21,"div",17)(22,"div",18)(23,"div",19)(24,"h5",20),l(25,"Dejar de seguir a esta persona"),o(),u(26,"button",21),o(),r(27,"div",22)(28,"div",23),u(29,"i",24),l(30," No ver\xE1s sus publicaciones ni su actividad en el inicio de Reddin\xE1mica, \xBFdeseas continuar? "),o()(),r(31,"div",25)(32,"button",26),v("click",function(){return n.unfollow()}),l(33,"S\xED"),o(),r(34,"button",27),l(35,"No"),o()()()()()),i&2&&(a(3),w(n.title),a(4),s("ngForOf",n.categories),a(8),s("formControl",n.filter),a(),s("ngIf",n.loading),a(),s("ngIf",!n.filter.value&&n.selectedCategory.length==0&&!n.loading),a(),s("ngIf",n.filter.value||n.selectedCategory.length>0),a(),s("ngIf",!n.filter.value&&n.selectedCategory.length==0))},dependencies:[$,O,ee,j,K,Q,De,Re,G,Be],styles:[".rounded-circle[_ngcontent-%COMP%]{width:80px;height:80px;background-color:#f5f5f5}.theme-dark[_nghost-%COMP%]   .user-name[_ngcontent-%COMP%], .theme-dark   [_nghost-%COMP%]   .user-name[_ngcontent-%COMP%]{color:#fff!important}"]})}}return t})();var gt=t=>({display:t}),ci=()=>({standalone:!0}),st=t=>({"is-invalid":t});function Xn(t,d){if(t&1&&(r(0,"div",41),u(1,"i",42),l(2),o()),t&2){let e=c();a(2),f(" ",e.errorMsg," ")}}function Zn(t,d){if(t&1){let e=x();r(0,"div",43),u(1,"i",44),l(2),r(3,"div",45)(4,"button",46),v("click",function(){g(e);let n=c();return h(n.createAnotherSuggestion())}),u(5,"i",47),l(6," Sugerir Otra Lecci\xF3n "),o(),r(7,"button",48),v("click",function(){g(e);let n=c();return h(n.closeAndRefresh())}),u(8,"i",39),l(9," Cerrar "),o()()()}if(t&2){let e=c();a(2),f(" ",e.successMsg," ")}}function Qn(t,d){t&1&&(r(0,"span",22),l(1,"*"),o())}function eo(t,d){if(t&1&&u(0,"input",54),t&2){let e=c().$implicit,i=c();S("id",e.id),S("formControlName",e.id),ae("placeholder","Ingresa ",e.label.toLowerCase(),""),s("ngClass",b(5,st,i.submitted&&i.f[e.id].errors))}}function to(t,d){if(t&1&&(r(0,"textarea",55),l(1,"                                "),o()),t&2){let e=c().$implicit,i=c();S("id",e.id),S("formControlName",e.id),ae("placeholder","Describe ",e.label.toLowerCase(),""),s("ngClass",b(5,st,i.submitted&&i.f[e.id].errors))}}function io(t,d){if(t&1&&(r(0,"div"),l(1),o()),t&2){let e=c(2).$implicit;a(),f(" El campo ",e.label," es obligatorio. ")}}function no(t,d){if(t&1&&(r(0,"div",56),p(1,io,2,1,"div",57),o()),t&2){let e=c().$implicit,i=c();a(),s("ngIf",i.f[e.id].errors.required)}}function oo(t,d){if(t&1&&(r(0,"div",20)(1,"label",49)(2,"strong"),l(3),p(4,Qn,2,0,"span",50),o()(),p(5,eo,1,7,"input",51)(6,to,2,7,"textarea",52)(7,no,2,1,"div",53),o()),t&2){let e=d.$implicit,i=c();a(),S("for",e.id),a(2),w(e.label),a(),s("ngIf",e.required),a(),s("ngIf",e.type=="text"),a(),s("ngIf",e.type==="textarea"),a(),s("ngIf",i.submitted&&i.f[e.id].errors)}}function ro(t,d){if(t&1){let e=x();r(0,"span",60),l(1),r(2,"button",61),v("click",function(){let n=g(e).$implicit,m=c(2);return h(m.removeKnowledgeArea(n))}),o()()}if(t&2){let e=d.$implicit;a(),f(" ",e.name," ")}}function ao(t,d){if(t&1&&(r(0,"div",58),p(1,ro,3,1,"span",59),o()),t&2){let e=c();a(),s("ngForOf",e.selectedKnowledgeAreas)}}function so(t,d){if(t&1){let e=x();r(0,"button",66),v("click",function(){let n=g(e).$implicit,m=c(2);return h(m.selectKnowledgeArea(n))}),u(1,"i",67),l(2),o()}if(t&2){let e=d.$implicit;a(2),f(" ",e.name," ")}}function lo(t,d){t&1&&u(0,"div",68)}function co(t,d){if(t&1){let e=x();r(0,"button",69),v("click",function(){g(e);let n=c(2);return h(n.addNewKnowledgeAreaFromInput())}),u(1,"i",70),l(2),o()}if(t&2){let e=c(2);a(2),f(' Crear "',e.knowledgeAreaInput,'" ')}}function mo(t,d){if(t&1&&(r(0,"div",62),p(1,so,3,1,"button",63)(2,lo,1,0,"div",64)(3,co,3,1,"button",65),o()),t&2){let e=c();a(),s("ngForOf",e.filteredKnowledgeAreas),a(),s("ngIf",e.knowledgeAreaInput.trim()&&e.filteredKnowledgeAreas.length===0),a(),s("ngIf",e.knowledgeAreaInput.trim()&&e.filteredKnowledgeAreas.length===0)}}function po(t,d){t&1&&(r(0,"div"),l(1," Debes seleccionar al menos un \xE1rea de conocimiento. "),o())}function uo(t,d){if(t&1&&(r(0,"div",71),p(1,po,2,0,"div",57),o()),t&2){let e=c();a(),s("ngIf",e.f.knowledge_area.errors.required)}}function _o(t,d){if(t&1){let e=x();r(0,"span",73),l(1),r(2,"button",61),v("click",function(){let n=g(e).$implicit,m=c(2);return h(m.removeLevel(n))}),o()()}if(t&2){let e=d.$implicit;a(),f(" ",e.value," ")}}function fo(t,d){if(t&1&&(r(0,"div",58),p(1,_o,3,1,"span",72),o()),t&2){let e=c();a(),s("ngForOf",e.selectedLevels)}}function vo(t,d){if(t&1){let e=x();r(0,"button",66),v("click",function(){let n=g(e).$implicit,m=c(2);return h(m.selectLevel(n))}),u(1,"i",74),l(2),o()}if(t&2){let e=d.$implicit;a(2),f(" ",e.value," ")}}function go(t,d){if(t&1&&(r(0,"div",62),p(1,vo,3,1,"button",63),o()),t&2){let e=c();a(),s("ngForOf",e.filteredLevels)}}function ho(t,d){t&1&&(r(0,"div"),l(1," Debes seleccionar al menos un nivel acad\xE9mico. "),o())}function xo(t,d){if(t&1&&(r(0,"div",71),p(1,ho,2,0,"div",57),o()),t&2){let e=c();a(),s("ngIf",e.f.level.errors.required)}}function bo(t,d){if(t&1&&(r(0,"span"),l(1),o()),t&2){let e=c().$implicit;a(),f(" - ",e.profession.name,"")}}function Co(t,d){if(t&1&&(r(0,"option",75),l(1),p(2,bo,2,1,"span",57),o()),t&2){let e=d.$implicit;s("value",e._id),a(),J(" ",e.name," ",e.surname," "),a(),s("ngIf",e.profession)}}function yo(t,d){if(t&1&&(r(0,"span",85),l(1),o()),t&2){let e=d.$implicit;a(),f(" ",e.name," ")}}function So(t,d){if(t&1&&(r(0,"div",82)(1,"strong"),l(2,"\xC1reas seleccionadas:"),o(),r(3,"div",83),p(4,yo,2,1,"span",84),o()()),t&2){let e=c(2);a(4),s("ngForOf",e.selectedKnowledgeAreas)}}function wo(t,d){if(t&1&&(r(0,"span",87),l(1),o()),t&2){let e=d.$implicit;a(),f(" ",e.value," ")}}function Eo(t,d){if(t&1&&(r(0,"div",82)(1,"strong"),l(2,"Niveles seleccionados:"),o(),r(3,"div",83),p(4,wo,2,1,"span",86),o()()),t&2){let e=c(2);a(4),s("ngForOf",e.selectedLevels)}}function Io(t,d){if(t&1&&(r(0,"div",14)(1,"strong"),l(2,"Facilitador sugerido:"),o(),r(3,"span",88),l(4),o()()),t&2){let e,i=c(2);a(4),f(" ",i.getFacilitatorName((e=i.addForm.get("suggested_facilitator"))==null?null:e.value)," ")}}function Lo(t,d){if(t&1&&(r(0,"div",76)(1,"div",77)(2,"h6",78),u(3,"i",79),l(4," Resumen de tu sugerencia "),o(),p(5,So,5,1,"div",80)(6,Eo,5,1,"div",80)(7,Io,5,1,"div",81),o()()),t&2){let e,i=c();a(5),s("ngIf",i.selectedKnowledgeAreas.length>0),a(),s("ngIf",i.selectedLevels.length>0),a(),s("ngIf",(e=i.addForm.get("suggested_facilitator"))==null?null:e.value)}}function Fo(t,d){t&1&&u(0,"span",92)}function ko(t,d){t&1&&u(0,"i",93)}function To(t,d){if(t&1&&(D(0),r(1,"button",89),p(2,Fo,1,0,"span",90)(3,ko,1,0,"i",91),l(4),o(),R()),t&2){let e=c();a(),s("disabled",e.loading||e.addForm.invalid),a(),s("ngIf",e.loading),a(),s("ngIf",!e.loading),a(),f(" ",e.loading?"Enviando...":e.submitLabel," ")}}function Ao(t,d){t&1&&u(0,"span",92)}function Mo(t,d){t&1&&u(0,"i",96)}function Po(t,d){if(t&1){let e=x();r(0,"button",94),v("click",function(){g(e);let n=c();return h(n.onResuggest())}),p(1,Ao,1,0,"span",90)(2,Mo,1,0,"i",95),l(3),o()}if(t&2){let e=c();s("disabled",e.loading||e.addForm.invalid),a(),s("ngIf",e.loading),a(),s("ngIf",!e.loading),a(),f(" ",e.loading?"Enviando...":"Sugerir nuevamente"," ")}}var pi=(()=>{class t{constructor(e,i,n,m,_){this._userService=e,this._lessonService=i,this._bDService=n,this._notificationService=m,this.cdr=_,this.loading=!1,this.knowledgeAreas=[],this.academicLevels=Object.entries(X).map(([C,M])=>({key:C,value:M})),this.facilitators=[],this.showSuccessActions=!1,this.newKnowledgeAreaName="",this.showAddKnowledgeArea=!1,this.knowledgeAreaInput="",this.filteredKnowledgeAreas=[],this.selectedKnowledgeAreas=[],this.showKnowledgeAreaDropdown=!1,this.levelInput="",this.filteredLevels=[],this.selectedLevels=[],this.showLevelDropdown=!1,this.submitLabel="Enviar Sugerencia",this.showModalRetries=0,this.isResuggest=!1,this.resuggestLessonId="",this.pendingPrefillData=null,this.added=new _e,this.title="Sugerir lecci\xF3n",this.identity=this._userService.getIdentity(),this.token=this._userService.getToken(),this.url=V.url,this.fields=[{id:"title",label:"T\xEDtulo",type:"text",required:!0},{id:"resume",label:"Resumen",type:"textarea",required:!0},{id:"justification",label:"Justificaci\xF3n",type:"textarea",required:!0},{id:"references",label:"Referencias",type:"textarea",required:!1}],this.errorMsg="Hubo un error al enviar la sugerencia para una lecci\xF3n. Int\xE9ntalo de nuevo m\xE1s tarde.",this.successMsg="Se ha enviado la sugerencia para la nueva lecci\xF3n correctamente. Gracias por tu sugerencia. Si deseas, puedes enviar otra sugerencia o cerrar este formulario.",this.addForm=new Ee({title:new I("",A.required),resume:new I("",A.required),justification:new I("",A.required),references:new I(""),knowledge_area:new I([],A.required),level:new I([],A.required),suggested_facilitator:new I("")})}ngOnInit(){this.loadKnowledgeAreas(),this.loadFacilitators()}ngAfterViewInit(){this.setupModalEvents(),setTimeout(()=>this.tryAutoOpenFromUrl(),0)}setupModalEvents(){let e=document.getElementById("add");e&&(e.addEventListener("shown.bs.modal",()=>{e.removeAttribute("aria-hidden");try{let i=localStorage.getItem("resuggestLessonPayload");i?(this.pendingPrefillData=JSON.parse(i),this.safePrefill(),localStorage.removeItem("resuggestLessonPayload")):this.pendingPrefillData&&this.safePrefill()}catch{}console.log("[SuggestLesson] shown \u2192 current form values:",this.addForm.value,{selectedKnowledgeAreas:this.selectedKnowledgeAreas,selectedLevels:this.selectedLevels})}),e.addEventListener("hidden.bs.modal",()=>{e.setAttribute("aria-hidden","true")}),e.addEventListener("show.bs.modal",()=>{e.removeAttribute("aria-hidden")}))}prefillFromLesson(e){if(e)try{this.isResuggest=!0,this.resuggestLessonId=String(e._id||e.id||""),console.log("[SuggestLesson] prefillFromLesson payload:",e),this.addForm.patchValue({title:e.title||"",resume:e.resume||"",justification:this.normalizeJustification(e.justification,e.justificationText),references:e.references||"",suggested_facilitator:e.suggested_facilitator&&(e.suggested_facilitator._id||e.suggested_facilitator)||""});let i=Array.isArray(e.knowledge_area)?e.knowledge_area.map(C=>typeof C=="string"?C:C?.name||"").filter(C=>!!C):[];this.selectedKnowledgeAreas=this.knowledgeAreas.filter(C=>i.includes(C.name)),this.updateKnowledgeAreaFormControl();let n=Array.isArray(e.level)?e.level:e.level?[e.level]:[],m=Object.entries(X),_=C=>{let M=m.find(([ke])=>ke===C);if(M)return{key:M[0],value:M[1]};let U=m.find(([,ke])=>ke===C);return U?{key:U[0],value:U[1]}:null};this.selectedLevels=n.map(_).filter(C=>!!C),this.updateLevelFormControl(),this.submitLabel="Sugerir nuevamente",this.status=null,this.submitted=!1,this.showSuccessActions=!1,this.cdr.detectChanges(),console.log("[SuggestLesson] after prefill \u2192 form:",this.addForm.value,{selectedKnowledgeAreas:this.selectedKnowledgeAreas,selectedLevels:this.selectedLevels})}catch(i){console.error("Error prellenando formulario de sugerencia:",i)}}normalizeJustification(e,i){if(!e&&i)return String(i);if(!e)return"";if(typeof e=="string")return e;try{let n=[];return e.methodology&&n.push(String(e.methodology)),e.objectives&&n.push(String(e.objectives)),n.join(`

`)}catch{return""}}safePrefill(){if(!this.pendingPrefillData){console.log("[SuggestLesson] safePrefill: no pendingPrefillData");return}if(!(Array.isArray(this.knowledgeAreas)&&this.knowledgeAreas.length>0)){console.log("[SuggestLesson] safePrefill: knowledgeAreas not ready, len=",this.knowledgeAreas?.length||0),setTimeout(()=>this.safePrefill(),100);return}let i=this.pendingPrefillData;this.pendingPrefillData=null,console.log("[SuggestLesson] safePrefill applying:",i),this.prefillFromLesson(i),this.cdr.detectChanges(),console.log("[SuggestLesson] safePrefill applied \u2192 form:",this.addForm.value,{selectedKnowledgeAreas:this.selectedKnowledgeAreas,selectedLevels:this.selectedLevels})}onResuggest(){if(this.submitted=!0,this.loading=!0,this.addForm.invalid||!this.resuggestLessonId){this.loading=!1;return}let e=Array.isArray(this.addForm.value.level)?this.addForm.value.level:[this.addForm.value.level],i=Object.entries(X).filter(([m,_])=>e.includes(_)).map(([m])=>m),n={_id:this.resuggestLessonId,title:this.addForm.value.title,resume:this.addForm.value.resume,justification:this.addForm.value.justification,references:this.addForm.value.references,knowledge_area:this.addForm.value.knowledge_area||[],level:i,suggested_facilitator:this.addForm.value.suggested_facilitator||"",state:"proposed",accepted:!1};this._lessonService.editLesson(this.token,n).subscribe({next:m=>{this.status="success",this.showSuccessActions=!0,this.loading=!1},error:m=>{this.status="error",this.loading=!1,console.error("Error re-sugiriendo lecci\xF3n:",m)}})}tryAutoOpenFromUrl(){try{let e=new URL(window.location.href.replace("#/","")),i=new URLSearchParams(e.search);if(!(String(i.get("openSuggestModal")||"").toLowerCase()==="true"))return;this.openModalWithRetry()}catch{}}openModalWithRetry(){try{let e=document.getElementById("add"),i=window.bootstrap?.Modal;if(!e||!i){if(this.showModalRetries<20){this.showModalRetries++,setTimeout(()=>this.openModalWithRetry(),100);return}return}let n=i.getInstance(e);if(n)try{n.dispose()}catch{}new i(e,{backdrop:"static",keyboard:!1}).show(),this.showModalRetries=0}catch{if(this.showModalRetries<20){this.showModalRetries++,setTimeout(()=>this.openModalWithRetry(),100);return}}}loadKnowledgeAreas(){this._bDService.getKnowledgeAreas().subscribe({next:e=>{e&&Array.isArray(e.areas)?(this.knowledgeAreas=e.areas,console.log("\xC1reas de conocimiento cargadas:",this.knowledgeAreas),this.safePrefill()):(this.knowledgeAreas=[],console.error("La respuesta de \xE1reas de conocimiento no es un array:",e))},error:e=>{console.error("Error al cargar las \xE1reas de conocimiento:",e),this.knowledgeAreas=[]}})}loadFacilitators(){this._userService.getAllUsers().subscribe({next:e=>{e&&e.users&&(this.facilitators=e.users.filter(i=>i.role==="expert"||i.role==="admin"||i.role==="delegated_admin"||i.canAdvise))},error:e=>{console.error("Error al cargar facilitadores:",e),this.facilitators=[]}})}get f(){return this.addForm.controls}restartValues(){this.status=null,this.submitted=!1,this.showSuccessActions=!1,this.addForm.reset(),this.addForm.patchValue({knowledge_area:[],level:[]}),this.newKnowledgeAreaName="",this.showAddKnowledgeArea=!1,this.selectedKnowledgeAreas=[],this.selectedLevels=[],this.knowledgeAreaInput="",this.levelInput="",this.showKnowledgeAreaDropdown=!1,this.showLevelDropdown=!1}closeModal(){try{let e=document.getElementById("add");if(e){let i=window.bootstrap?.Modal?.getInstance(e);i&&i.hide()}}catch(e){console.log("Error al cerrar modal:",e)}}createAnotherSuggestion(){this.status=null,this.showSuccessActions=!1,this.addForm.reset(),this.addForm.patchValue({knowledge_area:[],level:[]}),this.submitted=!1,this.loading=!1,this.selectedKnowledgeAreas=[],this.selectedLevels=[],this.knowledgeAreaInput="",this.levelInput="",this.showKnowledgeAreaDropdown=!1,this.showLevelDropdown=!1}closeAndRefresh(){this.restartValues(),this.closeModal(),this.added.emit()}onSubmit(){if(this.submitted=!0,this.loading=!0,this.addForm.invalid){this.loading=!1;return}this.lesson=new at,this.lesson.title=this.addForm.value.title,this.lesson.resume=this.addForm.value.resume,this.lesson.justification=this.addForm.value.justification,this.lesson.references=this.addForm.value.references,this.lesson.accepted=!1,this.lesson.author=this.identity._id,this.lesson.knowledge_area=Array.isArray(this.addForm.value.knowledge_area)?this.addForm.value.knowledge_area:[this.addForm.value.knowledge_area];let e=Array.isArray(this.addForm.value.level)?this.addForm.value.level:[this.addForm.value.level];this.lesson.level=Object.entries(X).filter(([i,n])=>e.includes(n)).map(([i,n])=>i),this.lesson.suggested_facilitator=this.addForm.value.suggested_facilitator,this.lesson.state="proposed",this._lessonService.addLesson(this.token,this.lesson).subscribe({next:i=>{i.lesson&&i.lesson._id?(this.status="success",this.showSuccessActions=!0,this.sendNotifications(i.lesson)):(this.status="error",console.log(i)),this.loading=!1},error:i=>{this.status="error",this.loading=!1,console.log(i)}}),document.querySelector(".modal-body")?.scrollTo(0,0),this.submitted=!1}onChanges(){this.addForm.valueChanges.subscribe({next:e=>{e&&(this.status=null,this.submitted=!1)}})}toggleAddKnowledgeArea(){this.showAddKnowledgeArea=!this.showAddKnowledgeArea,this.newKnowledgeAreaName=""}addNewKnowledgeArea(){if(!this.newKnowledgeAreaName.trim())return;let e=this.newKnowledgeAreaName.trim().toLowerCase(),i=this.knowledgeAreas.find(n=>n.name.toLowerCase()===e);if(i){let n=this.addForm.get("knowledge_area").value||[];n.includes(i._id)||this.addForm.get("knowledge_area").setValue([...n,i._id]),this.showAddKnowledgeArea=!1,this.newKnowledgeAreaName=""}else{let n={_id:"",name:this.newKnowledgeAreaName.trim(),used:!1};this._bDService.addKnowledgeArea(n).subscribe({next:m=>{if(m.area&&m.area._id){this.knowledgeAreas.push(m.area);let _=this.addForm.get("knowledge_area").value||[];this.addForm.get("knowledge_area").setValue([..._,m.area._id]),this.showAddKnowledgeArea=!1,this.newKnowledgeAreaName=""}},error:m=>{console.error("Error adding new knowledge area",m)}})}}sendNotifications(e){console.log("Enviando notificaciones para la lecci\xF3n:",e)}getKnowledgeAreaName(e){let i=this.knowledgeAreas.find(n=>n._id===e);return i?i.name:"Desconocida"}getFacilitatorName(e){let i=this.facilitators.find(n=>n._id===e);return i?`${i.name} ${i.surname}`:"Desconocido"}onKnowledgeAreaInputChange(){let e=this.knowledgeAreaInput.toLowerCase().trim();if(e.length===0){this.filteredKnowledgeAreas=[],this.showKnowledgeAreaDropdown=!1;return}let i=this.selectedKnowledgeAreas.map(n=>n._id);this.filteredKnowledgeAreas=this.knowledgeAreas.filter(n=>!i.includes(n._id)&&n.name.toLowerCase().includes(e)),this.showKnowledgeAreaDropdown=this.filteredKnowledgeAreas.length>0||e.length>0}selectKnowledgeArea(e){this.selectedKnowledgeAreas.find(i=>i._id===e._id)||(this.selectedKnowledgeAreas.push(e),this.updateKnowledgeAreaFormControl()),this.knowledgeAreaInput="",this.showKnowledgeAreaDropdown=!1,this.filteredKnowledgeAreas=[]}removeKnowledgeArea(e){this.selectedKnowledgeAreas=this.selectedKnowledgeAreas.filter(i=>i._id!==e._id),this.updateKnowledgeAreaFormControl()}addNewKnowledgeAreaFromInput(){let e=this.knowledgeAreaInput.trim();if(console.log("Nombre del \xE1rea:",e),!e)return;console.log("verify if area exists:",e);let i=this.knowledgeAreas.find(m=>m.name.toLowerCase()===e.toLowerCase());if(console.log("existingArea:",i),i){this.selectKnowledgeArea(i);return}console.log("crear nueva \xE1rea:",e);let n={_id:"",name:e,used:!1};console.log("newArea:",n),this._bDService.addKnowledgeArea(n).subscribe({next:m=>{console.log("response:",m),m.area&&m.area._id&&(this.knowledgeAreas.push(m.area),this.selectKnowledgeArea(m.area))},error:m=>{console.error("Error adding new knowledge area",m)}})}updateKnowledgeAreaFormControl(){let e=this.selectedKnowledgeAreas.map(i=>i._id);this.addForm.get("knowledge_area")?.setValue(e)}onLevelInputChange(){let e=this.levelInput.toLowerCase().trim();if(e.length===0){this.filteredLevels=[],this.showLevelDropdown=!1;return}let i=this.selectedLevels.map(n=>n.value);this.filteredLevels=this.academicLevels.filter(n=>!i.includes(n.value)&&n.value.toLowerCase().includes(e)),this.showLevelDropdown=this.filteredLevels.length>0}selectLevel(e){this.selectedLevels.find(i=>i.value===e.value)||(this.selectedLevels.push(e),this.updateLevelFormControl()),this.levelInput="",this.showLevelDropdown=!1,this.filteredLevels=[]}removeLevel(e){this.selectedLevels=this.selectedLevels.filter(i=>i.value!==e.value),this.updateLevelFormControl()}updateLevelFormControl(){let e=this.selectedLevels.map(i=>i.value);this.addForm.get("level")?.setValue(e)}setupClickOutsideListener(){document.addEventListener("click",e=>{let i=e.target;i.closest(".knowledge-area-autocomplete")||(this.showKnowledgeAreaDropdown=!1),i.closest(".level-autocomplete")||(this.showLevelDropdown=!1)})}static{this.\u0275fac=function(i){return new(i||t)(y(T),y(ne),y(ie),y(Ne),y(kt))}}static{this.\u0275cmp=P({type:t,selectors:[["suggest-lesson"]],outputs:{added:"added"},standalone:!1,decls:74,vars:35,consts:[["resuggestBtn",""],["id","add","tabindex","-1","aria-labelledby","addTitle","aria-hidden","true","data-bs-backdrop","static","data-bs-keyboard","false",1,"modal","fade"],[1,"modal-dialog","modal-xl","modal-dialog-scrollable"],["enctype","multipart/form-data",1,"modal-content",3,"ngSubmit","input","formGroup"],[1,"modal-header","bg-primary","text-white"],["id","addTitle",1,"modal-title"],[1,"fas","fa-lightbulb","me-2"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close","btn-close-white",3,"click"],[1,"modal-body"],["class","alert alert-danger fade show","role","alert",4,"ngIf"],["class","alert alert-success fade show","role","alert",4,"ngIf"],[1,"alert","alert-info","mb-4",3,"ngStyle"],[1,"fas","fa-info-circle","me-2"],[1,"mb-1","mt-2"],[1,"mb-0"],[3,"ngStyle"],[1,"row"],[1,"col-md-12"],["class","mb-3",4,"ngFor","ngForOf"],[1,"col-md-6"],[1,"mb-3"],[1,"form-label"],[1,"text-danger"],["class","selected-items-container mb-2",4,"ngIf"],[1,"knowledge-area-autocomplete","position-relative"],["type","text","placeholder","Escribe para buscar o agregar \xE1rea de conocimiento...","autocomplete","off",1,"form-control",3,"ngModelChange","input","keyup.enter","ngModel","ngModelOptions","ngClass"],["class","dropdown-menu show position-absolute w-100 mt-1","style","z-index: 1050; max-height: 200px; overflow-y: auto;",4,"ngIf"],[1,"form-text","text-muted"],["class","invalid-feedback d-block",4,"ngIf"],[1,"level-autocomplete","position-relative"],["type","text","placeholder","Escribe para buscar los niveles acad\xE9micos.","autocomplete","off",1,"form-control",3,"ngModelChange","input","ngModel","ngModelOptions","ngClass"],["for","suggested_facilitator",1,"form-label"],[1,"text-muted"],["formControlName","suggested_facilitator","id","suggested_facilitator",1,"form-select"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","card bg-light",4,"ngIf"],[1,"modal-footer",3,"ngStyle"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary",3,"click"],[1,"fas","fa-times","me-1"],[4,"ngIf","ngIfElse"],["role","alert",1,"alert","alert-danger","fade","show"],[1,"fas","fa-times-circle","me-2"],["role","alert",1,"alert","alert-success","fade","show"],[1,"fas","fa-check-circle","me-2"],[1,"mt-3","d-flex","justify-content-center","gap-2"],["type","button",1,"btn","btn-primary",3,"click"],[1,"fas","fa-plus","me-1"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"form-label",3,"for"],["class","text-danger",4,"ngIf"],["type","text","class","form-control","autocomplete","off",3,"id","formControlName","ngClass","placeholder",4,"ngIf"],["class","form-control","rows","3",3,"id","formControlName","ngClass","placeholder",4,"ngIf"],["class","invalid-feedback",4,"ngIf"],["type","text","autocomplete","off",1,"form-control",3,"id","formControlName","ngClass","placeholder"],["rows","3",1,"form-control",3,"id","formControlName","ngClass","placeholder"],[1,"invalid-feedback"],[4,"ngIf"],[1,"selected-items-container","mb-2"],["class","badge bg-primary me-1 mb-1 selected-chip",4,"ngFor","ngForOf"],[1,"badge","bg-primary","me-1","mb-1","selected-chip"],["type","button","aria-label","Eliminar",1,"btn-close","btn-close-white","ms-1",3,"click"],[1,"dropdown-menu","show","position-absolute","w-100","mt-1",2,"z-index","1050","max-height","200px","overflow-y","auto"],["type","button","class","dropdown-item",3,"click",4,"ngFor","ngForOf"],["class","dropdown-divider",4,"ngIf"],["type","button","class","dropdown-item text-success",3,"click",4,"ngIf"],["type","button",1,"dropdown-item",3,"click"],[1,"fas","fa-tag","me-2"],[1,"dropdown-divider"],["type","button",1,"dropdown-item","text-success",3,"click"],[1,"fas","fa-plus","me-2"],[1,"invalid-feedback","d-block"],["class","badge bg-success me-1 mb-1 selected-chip",4,"ngFor","ngForOf"],[1,"badge","bg-success","me-1","mb-1","selected-chip"],[1,"fas","fa-graduation-cap","me-2"],[3,"value"],[1,"card","bg-light"],[1,"card-body"],[1,"card-title"],[1,"fas","fa-eye","me-2"],["class","mb-2",4,"ngIf"],["class","mb-0",4,"ngIf"],[1,"mb-2"],[1,"mt-1"],["class","badge bg-primary me-1",4,"ngFor","ngForOf"],[1,"badge","bg-primary","me-1"],["class","badge bg-success me-1",4,"ngFor","ngForOf"],[1,"badge","bg-success","me-1"],[1,"badge","bg-info","ms-1"],["type","submit",1,"btn","btn-success",3,"disabled"],["class","spinner-border spinner-border-sm me-2","role","status","aria-hidden","true",4,"ngIf"],["class","fas fa-paper-plane me-1",4,"ngIf"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-2"],[1,"fas","fa-paper-plane","me-1"],["type","button",1,"btn","btn-primary",3,"click","disabled"],["class","fas fa-redo me-1",4,"ngIf"],[1,"fas","fa-redo","me-1"]],template:function(i,n){if(i&1){let m=x();r(0,"div",1)(1,"div",2)(2,"form",3),v("ngSubmit",function(){return g(m),h(n.onSubmit())})("input",function(){return g(m),h(n.onChanges())}),r(3,"div",4)(4,"h5",5),u(5,"i",6),l(6," Sugerir Nueva Lecci\xF3n "),o(),r(7,"button",7),v("click",function(){return g(m),h(n.restartValues())}),o()(),r(8,"div",8),p(9,Xn,3,1,"div",9)(10,Zn,10,1,"div",10),r(11,"div",11),u(12,"i",12),r(13,"strong"),l(14,"\xBFC\xF3mo funciona?"),o(),r(15,"p",13),l(16,"Esta opci\xF3n te permite solicitar o dar sugerencia de un tema sobre el cual consideras que se debe desarrollar una lecci\xF3n en la red."),o(),r(17,"p",14),l(18,"El administrador se encargar\xE1 de enviar una convocatoria p\xFAblica para formar el grupo de desarrollo de la lecci\xF3n."),o()(),r(19,"div",15)(20,"div",16)(21,"div",17),p(22,oo,8,6,"div",18),o()(),r(23,"div",16)(24,"div",19)(25,"div",20)(26,"label",21)(27,"strong"),l(28,"\xC1reas de Conocimiento"),r(29,"span",22),l(30,"*"),o()()(),p(31,ao,2,1,"div",23),r(32,"div",24)(33,"input",25),ge("ngModelChange",function(C){return g(m),ve(n.knowledgeAreaInput,C)||(n.knowledgeAreaInput=C),h(C)}),v("input",function(){return g(m),h(n.onKnowledgeAreaInputChange())})("keyup.enter",function(){return g(m),h(n.addNewKnowledgeAreaFromInput())}),o(),p(34,mo,4,3,"div",26),o(),r(35,"small",27),l(36," Escribe para buscar \xE1reas existentes o crear nuevas "),o(),p(37,uo,2,1,"div",28),o()(),r(38,"div",19)(39,"div",20)(40,"label",21)(41,"strong"),l(42,"Niveles Acad\xE9micos"),r(43,"span",22),l(44,"*"),o()()(),p(45,fo,2,1,"div",23),r(46,"div",29)(47,"input",30),ge("ngModelChange",function(C){return g(m),ve(n.levelInput,C)||(n.levelInput=C),h(C)}),v("input",function(){return g(m),h(n.onLevelInputChange())}),o(),p(48,go,2,1,"div",26),o(),r(49,"small",27),l(50," Seleccionar uno o m\xE1s niveles acad\xE9micos. e.g Preescolar - Primaria - Secundaria - Bachillerato - Universitario - Posgrado. "),o(),p(51,xo,2,1,"div",28),o()()(),r(52,"div",16)(53,"div",17)(54,"div",20)(55,"label",31)(56,"strong"),l(57,"Facilitador Sugerido "),r(58,"small",32),l(59,"(Opcional)"),o()()(),r(60,"select",33)(61,"option",34),l(62,"Selecciona un facilitador (opcional)"),o(),p(63,Co,3,4,"option",35),o(),r(64,"small",27),l(65," Si conoces a alguien que podr\xEDa liderar esta lecci\xF3n, puedes sugerirlo aqu\xED. Se le enviar\xE1 una notificaci\xF3n para que considere participar. "),o()()()(),p(66,Lo,8,3,"div",36),o()(),r(67,"div",37)(68,"button",38),v("click",function(){return g(m),h(n.restartValues())}),u(69,"i",39),l(70," Cancelar "),o(),p(71,To,5,4,"ng-container",40)(72,Po,4,4,"ng-template",null,0,L),o()()()()}if(i&2){let m=k(73);a(2),s("formGroup",n.addForm),a(7),s("ngIf",n.status==="error"),a(),s("ngIf",n.status==="success"&&n.showSuccessActions),a(),s("ngStyle",b(23,gt,n.showSuccessActions?"none":"block")),a(8),s("ngStyle",b(25,gt,n.showSuccessActions?"none":"block")),a(3),s("ngForOf",n.fields),a(9),s("ngIf",n.selectedKnowledgeAreas.length>0),a(2),fe("ngModel",n.knowledgeAreaInput),s("ngModelOptions",B(27,ci))("ngClass",b(28,st,n.submitted&&n.f.knowledge_area.errors)),a(),s("ngIf",n.showKnowledgeAreaDropdown),a(3),s("ngIf",n.submitted&&n.f.knowledge_area.errors),a(8),s("ngIf",n.selectedLevels.length>0),a(2),fe("ngModel",n.levelInput),s("ngModelOptions",B(30,ci))("ngClass",b(31,st,n.submitted&&n.f.level.errors)),a(),s("ngIf",n.showLevelDropdown),a(3),s("ngIf",n.submitted&&n.f.level.errors),a(12),s("ngForOf",n.facilitators),a(3),s("ngIf",n.selectedKnowledgeAreas.length>0||n.selectedLevels.length>0),a(),s("ngStyle",b(33,gt,n.showSuccessActions?"none":"flex")),a(4),s("ngIf",!n.isResuggest)("ngIfElse",m)}},dependencies:[he,$,O,Oe,ee,le,de,j,se,K,Q,Le,xe,be],styles:[".selected-chip[_ngcontent-%COMP%]{font-size:.875rem;padding:.375rem .5rem;display:inline-flex;align-items:center}.selected-chip[_ngcontent-%COMP%]   .btn-close[_ngcontent-%COMP%]{font-size:.7rem;width:.8rem;height:.8rem}.selected-items-container[_ngcontent-%COMP%]{min-height:2rem;padding:.375rem;border:1px solid #dee2e6;border-radius:.375rem;background-color:#f8f9fa}.dropdown-menu.show[_ngcontent-%COMP%]{display:block;border:1px solid #dee2e6;box-shadow:0 .125rem .25rem #00000013}.dropdown-item[_ngcontent-%COMP%]:hover{background-color:#e9ecef}.knowledge-area-autocomplete[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%], .level-autocomplete[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]{top:100%!important;left:0!important;right:0!important}"]})}}return t})();var ht=t=>({display:t}),ui=()=>({standalone:!0}),Ye=t=>({"is-invalid":t});function Vo(t,d){if(t&1&&(r(0,"div",39),u(1,"i",40),l(2),o()),t&2){let e=c();a(2),f(" ",e.errorMsg," ")}}function Do(t,d){if(t&1){let e=x();r(0,"div",41),u(1,"i",42),l(2),r(3,"div",43)(4,"button",44),v("click",function(){g(e);let n=c();return h(n.createAnotherExperience())}),u(5,"i",45),l(6," Enviar Otra Experiencia "),o(),r(7,"button",46),v("click",function(){g(e);let n=c();return h(n.closeAndRefresh())}),u(8,"i",35),l(9," Cerrar "),o()()()}if(t&2){let e=c();a(2),f(" ",e.successMsg," ")}}function Ro(t,d){t&1&&(r(0,"span",22),l(1,"*"),o())}function No(t,d){if(t&1&&u(0,"input",54),t&2){let e=c().$implicit,i=c();S("id",e.id),S("formControlName",e.id),ae("placeholder","Ingresa ",e.label.toLowerCase(),""),s("ngClass",b(5,Ye,i.submitted&&i.f[e.id].errors))}}function $o(t,d){if(t&1&&(r(0,"textarea",55),l(1,"                                "),o()),t&2){let e=c().$implicit,i=c();S("id",e.id),S("formControlName",e.id),ae("placeholder","Describe ",e.label.toLowerCase(),""),s("ngClass",b(5,Ye,i.submitted&&i.f[e.id].errors))}}function Uo(t,d){if(t&1&&(r(0,"option",58),l(1),o()),t&2){let e=d.$implicit;S("value",e.value),a(),f(" ",e.label," ")}}function Bo(t,d){if(t&1&&(r(0,"select",56),p(1,Uo,2,2,"option",57),o()),t&2){let e=c().$implicit,i=c();S("formControlName",e.id),S("id",e.id),s("ngClass",b(4,Ye,i.submitted&&i.f[e.id].errors)),a(),s("ngForOf",e.options)}}function qo(t,d){t&1&&(r(0,"small",27)(1,"strong"),l(2,"Desarrollo:"),o(),l(3," Para experiencias que deseas que pasen por el proceso de desarrollo de lecciones con asesor\xEDa de un experto. "),u(4,"br"),r(5,"strong"),l(6,"Consideraci\xF3n:"),o(),l(7," Si la lecci\xF3n se encuentra lo suficientemente madura para ser compartida con la red. "),o())}function jo(t,d){if(t&1&&(r(0,"div"),l(1),o()),t&2){let e=c(2).$implicit;a(),f(" El campo ",e.label," es obligatorio. ")}}function Ko(t,d){if(t&1&&(r(0,"div",59),p(1,jo,2,1,"div",60),o()),t&2){let e=c().$implicit,i=c();a(),s("ngIf",i.f[e.id].errors.required)}}function zo(t,d){if(t&1&&(r(0,"div",20)(1,"label",47)(2,"strong"),l(3),p(4,Ro,2,0,"span",48),o()(),p(5,No,1,7,"input",49)(6,$o,2,7,"textarea",50)(7,Bo,2,6,"select",51)(8,qo,8,0,"small",52)(9,Ko,2,1,"div",53),o()),t&2){let e=d.$implicit,i=c();a(),S("for",e.id),a(2),w(e.label),a(),s("ngIf",e.required),a(),s("ngIf",e.type=="text"),a(),s("ngIf",e.type==="textarea"),a(),s("ngIf",e.type=="select"),a(),s("ngIf",e.id=="type"),a(),s("ngIf",i.submitted&&i.f[e.id].errors)}}function Go(t,d){if(t&1){let e=x();r(0,"span",63),l(1),r(2,"button",64),v("click",function(){let n=g(e).$implicit,m=c(2);return h(m.removeKnowledgeArea(n))}),o()()}if(t&2){let e=d.$implicit;a(),f(" ",e.name," ")}}function Ho(t,d){if(t&1&&(r(0,"div",61),p(1,Go,3,1,"span",62),o()),t&2){let e=c();a(),s("ngForOf",e.selectedKnowledgeAreas)}}function Wo(t,d){if(t&1){let e=x();r(0,"button",69),v("click",function(){let n=g(e).$implicit,m=c(2);return h(m.selectKnowledgeArea(n))}),u(1,"i",70),l(2),o()}if(t&2){let e=d.$implicit;a(2),f(" ",e.name," ")}}function Jo(t,d){t&1&&u(0,"div",71)}function Yo(t,d){if(t&1){let e=x();r(0,"button",72),v("click",function(){g(e);let n=c(2);return h(n.addNewKnowledgeAreaFromInput())}),u(1,"i",73),l(2),o()}if(t&2){let e=c(2);a(2),f(' Crear "',e.knowledgeAreaInput,'" ')}}function Xo(t,d){if(t&1&&(r(0,"div",65),p(1,Wo,3,1,"button",66)(2,Jo,1,0,"div",67)(3,Yo,3,1,"button",68),o()),t&2){let e=c();a(),s("ngForOf",e.filteredKnowledgeAreas),a(),s("ngIf",e.knowledgeAreaInput.trim()&&e.filteredKnowledgeAreas.length===0),a(),s("ngIf",e.knowledgeAreaInput.trim()&&e.filteredKnowledgeAreas.length===0)}}function Zo(t,d){t&1&&(r(0,"div"),l(1," Debes seleccionar al menos un \xE1rea de conocimiento. "),o())}function Qo(t,d){if(t&1&&(r(0,"div",74),p(1,Zo,2,0,"div",60),o()),t&2){let e=c();a(),s("ngIf",e.f.knowledge_area.errors.required)}}function er(t,d){if(t&1){let e=x();r(0,"span",76),l(1),r(2,"button",64),v("click",function(){let n=g(e).$implicit,m=c(2);return h(m.removeLevel(n))}),o()()}if(t&2){let e=d.$implicit;a(),f(" ",e.value," ")}}function tr(t,d){if(t&1&&(r(0,"div",61),p(1,er,3,1,"span",75),o()),t&2){let e=c();a(),s("ngForOf",e.selectedLevels)}}function ir(t,d){if(t&1){let e=x();r(0,"button",69),v("click",function(){let n=g(e).$implicit,m=c(2);return h(m.selectLevel(n))}),u(1,"i",77),l(2),o()}if(t&2){let e=d.$implicit;a(2),f(" ",e.value," ")}}function nr(t,d){if(t&1&&(r(0,"div",65),p(1,ir,3,1,"button",66),o()),t&2){let e=c();a(),s("ngForOf",e.filteredLevels)}}function or(t,d){t&1&&(r(0,"div"),l(1," Debes seleccionar al menos un nivel acad\xE9mico. "),o())}function rr(t,d){if(t&1&&(r(0,"div",74),p(1,or,2,0,"div",60),o()),t&2){let e=c();a(),s("ngIf",e.f.level.errors.required)}}function ar(t,d){if(t&1&&(r(0,"span"),l(1),o()),t&2){let e=c().$implicit;a(),f(" - ",e.profession.name,"")}}function sr(t,d){if(t&1&&(r(0,"option",58),l(1),p(2,ar,2,1,"span",60),o()),t&2){let e=d.$implicit;s("value",e._id),a(),J(" ",e.name," ",e.surname," "),a(),s("ngIf",e.profession)}}function lr(t,d){if(t&1&&(r(0,"div",16)(1,"div",17)(2,"div",20)(3,"label",78)(4,"strong"),l(5,"Facilitador Sugerido "),r(6,"small",79),l(7,"(Opcional)"),o()()(),r(8,"select",80)(9,"option",81),l(10,"Selecciona un facilitador (opcional)"),o(),p(11,sr,3,4,"option",57),o(),r(12,"small",27),l(13," Si conoces a alguien que podr\xEDa liderar el desarrollo de esta experiencia, puedes sugerirlo aqu\xED. Se le enviar\xE1 una notificaci\xF3n para que considere participar. "),o()()()()),t&2){let e=c();a(11),s("ngForOf",e.facilitators)}}function dr(t,d){if(t&1&&(r(0,"span",91),l(1),o()),t&2){let e=d.$implicit;a(),f(" ",e.name," ")}}function cr(t,d){if(t&1&&(r(0,"div",88)(1,"strong"),l(2,"\xC1reas seleccionadas:"),o(),r(3,"div",89),p(4,dr,2,1,"span",90),o()()),t&2){let e=c(2);a(4),s("ngForOf",e.selectedKnowledgeAreas)}}function mr(t,d){if(t&1&&(r(0,"span",93),l(1),o()),t&2){let e=d.$implicit;a(),f(" ",e.value," ")}}function pr(t,d){if(t&1&&(r(0,"div",88)(1,"strong"),l(2,"Niveles seleccionados:"),o(),r(3,"div",89),p(4,mr,2,1,"span",92),o()()),t&2){let e=c(2);a(4),s("ngForOf",e.selectedLevels)}}function ur(t,d){if(t&1&&(r(0,"div",88)(1,"strong"),l(2,"Tipo de experiencia:"),o(),r(3,"span",94),l(4),o()()),t&2){let e,i=c(2);a(4),f(" ",(e=i.sendForm.get("type"))==null?null:e.value," ")}}function _r(t,d){if(t&1&&(r(0,"div",14)(1,"strong"),l(2,"Facilitador sugerido:"),o(),r(3,"span",95),l(4),o()()),t&2){let e,i=c(2);a(4),f(" ",i.getFacilitatorName((e=i.sendForm.get("suggested_facilitator"))==null?null:e.value)," ")}}function fr(t,d){if(t&1&&(r(0,"div",82)(1,"div",83)(2,"h6",84),u(3,"i",85),l(4," Resumen de tu experiencia "),o(),p(5,cr,5,1,"div",86)(6,pr,5,1,"div",86)(7,ur,5,1,"div",86)(8,_r,5,1,"div",87),o()()),t&2){let e,i,n=c();a(5),s("ngIf",n.selectedKnowledgeAreas.length>0),a(),s("ngIf",n.selectedLevels.length>0),a(),s("ngIf",(e=n.sendForm.get("type"))==null?null:e.value),a(),s("ngIf",(i=n.sendForm.get("suggested_facilitator"))==null?null:i.value)}}function vr(t,d){t&1&&u(0,"span",96)}function gr(t,d){t&1&&u(0,"i",97)}var _i=(()=>{class t{constructor(e,i,n,m){this._userService=e,this._lessonService=i,this._bDService=n,this._notificationService=m,this.loading=!1,this.knowledgeAreas=[],this.academicLevels=Object.entries(X).map(([_,C])=>({key:_,value:C})),this.facilitators=[],this.showSuccessActions=!1,this.knowledgeAreaInput="",this.filteredKnowledgeAreas=[],this.selectedKnowledgeAreas=[],this.showKnowledgeAreaDropdown=!1,this.levelInput="",this.filteredLevels=[],this.selectedLevels=[],this.showLevelDropdown=!1,this.showFacilitatorField=!1,this.added=new _e,this.title="Enviar experiencia",this.identity=this._userService.getIdentity(),this.token=this._userService.getToken(),this.url=V.url,this.fields=[{id:"title",label:"T\xEDtulo",type:"text",required:!0},{id:"resume",label:"Resumen",type:"textarea",required:!0},{id:"references",label:"Referencias",type:"textarea",required:!0},{id:"type",label:"Tipo",type:"select",required:!0,options:[{value:"",label:"Selecciona el tipo"},{value:"Desarrollo",label:"Desarrollo"},{value:"Consideraci\xF3n",label:"Consideraci\xF3n"}]}],this.errorMsg="Hubo un error al enviar la experiencia. Int\xE9ntalo de nuevo m\xE1s tarde.",this.successMsg="Se ha enviado la experiencia correctamente. Ser\xE1 revisada por el administrador y recibir\xE1s una notificaci\xF3n cuando sea aprobada.",this.sendForm=new Ee({title:new I("",A.required),resume:new I("",A.required),references:new I("",A.required),type:new I("",A.required),knowledge_area:new I([],A.required),level:new I([],A.required),suggested_facilitator:new I("")})}ngOnInit(){this.loadKnowledgeAreas(),this.loadFacilitators(),this.setupFormWatchers()}ngAfterViewInit(){this.setupModalEvents(),this.setupClickOutsideListener()}setupModalEvents(){let e=document.getElementById("send");e&&(e.addEventListener("shown.bs.modal",()=>{e.removeAttribute("aria-hidden")}),e.addEventListener("hidden.bs.modal",()=>{e.setAttribute("aria-hidden","true")}),e.addEventListener("show.bs.modal",()=>{e.removeAttribute("aria-hidden")}))}setupFormWatchers(){this.sendForm.get("type")?.valueChanges.subscribe(e=>{this.showFacilitatorField=e==="Desarrollo",this.showFacilitatorField||this.sendForm.get("suggested_facilitator")?.setValue("")})}loadKnowledgeAreas(){this._bDService.getKnowledgeAreas().subscribe({next:e=>{e&&Array.isArray(e.areas)?this.knowledgeAreas=e.areas:(this.knowledgeAreas=[],console.error("La respuesta de \xE1reas de conocimiento no es un array:",e))},error:e=>{console.error("Error al cargar las \xE1reas de conocimiento:",e),this.knowledgeAreas=[]}})}loadFacilitators(){this._userService.getAllUsers().subscribe({next:e=>{e&&e.users&&(this.facilitators=e.users.filter(i=>i.role==="expert"||i.role==="admin"||i.role==="delegated_admin"||i.canAdvise))},error:e=>{console.error("Error al cargar facilitadores:",e),this.facilitators=[]}})}get f(){return this.sendForm.controls}restartValues(){this.status=null,this.submitted=!1,this.showSuccessActions=!1,this.showFacilitatorField=!1,this.sendForm.reset(),this.sendForm.patchValue({knowledge_area:[],level:[]}),this.selectedKnowledgeAreas=[],this.selectedLevels=[],this.knowledgeAreaInput="",this.levelInput="",this.showKnowledgeAreaDropdown=!1,this.showLevelDropdown=!1}onSubmit(){if(this.submitted=!0,this.loading=!0,this.sendForm.invalid){this.loading=!1;return}this.lesson=new at,this.lesson.title=this.sendForm.value.title,this.lesson.resume=this.sendForm.value.resume,this.lesson.references=this.sendForm.value.references,this.lesson.type=this.sendForm.value.type,this.lesson.accepted=!1,this.lesson.author=this.identity._id,this.lesson.class="experience",this.lesson.knowledge_area=Array.isArray(this.sendForm.value.knowledge_area)?this.sendForm.value.knowledge_area:[this.sendForm.value.knowledge_area];let e=Array.isArray(this.sendForm.value.level)?this.sendForm.value.level:[this.sendForm.value.level];this.lesson.level=Object.entries(X).filter(([i,n])=>e.includes(n)).map(([i,n])=>i),this.showFacilitatorField&&this.sendForm.value.suggested_facilitator&&(this.lesson.suggested_facilitator=this.sendForm.value.suggested_facilitator),this._lessonService.addLesson(this.token,this.lesson).subscribe({next:i=>{i.lesson&&i.lesson._id?(this.status="success",this.showSuccessActions=!0,this.sendNotifications(i.lesson)):(this.status="error",console.log(i)),this.loading=!1},error:i=>{this.status="error",this.loading=!1,console.log(i)}}),document.querySelector(".modal-body")?.scrollTo(0,0),this.submitted=!1}closeModal(){try{let e=document.getElementById("send");if(e){let i=window.bootstrap?.Modal?.getInstance(e);i&&i.hide()}}catch(e){console.log("Error al cerrar modal:",e)}}createAnotherExperience(){this.status=null,this.showSuccessActions=!1,this.sendForm.reset(),this.sendForm.patchValue({knowledge_area:[],level:[]}),this.submitted=!1,this.loading=!1,this.showFacilitatorField=!1,this.selectedKnowledgeAreas=[],this.selectedLevels=[],this.knowledgeAreaInput="",this.levelInput="",this.showKnowledgeAreaDropdown=!1,this.showLevelDropdown=!1}closeAndRefresh(){this.restartValues(),this.closeModal(),this.added.emit()}onChanges(){this.sendForm.valueChanges.subscribe(e=>{e&&(this.status=null,this.submitted=!1)})}sendNotifications(e){console.log("Enviando notificaciones para la experiencia:",e),console.log("Sistema de notificaciones activado autom\xE1ticamente para:",{experienceId:e._id,title:e.title,type:e.type,hasFacilitator:!!e.suggested_facilitator,notifications:{user:"/inicio/mis-lecciones",admin:"/admin/lecciones",facilitator:e.type==="Desarrollo"&&e.suggested_facilitator?"/inicio/asesorar-lecciones":null}})}getKnowledgeAreaName(e){let i=this.knowledgeAreas.find(n=>n._id===e);return i?i.name:"Desconocida"}getFacilitatorName(e){let i=this.facilitators.find(n=>n._id===e);return i?`${i.name} ${i.surname}`:"Desconocido"}onKnowledgeAreaInputChange(){let e=this.knowledgeAreaInput.toLowerCase().trim();if(e.length===0){this.filteredKnowledgeAreas=[],this.showKnowledgeAreaDropdown=!1;return}let i=this.selectedKnowledgeAreas.map(n=>n._id);this.filteredKnowledgeAreas=this.knowledgeAreas.filter(n=>!i.includes(n._id)&&n.name.toLowerCase().includes(e)),this.showKnowledgeAreaDropdown=this.filteredKnowledgeAreas.length>0||e.length>0}selectKnowledgeArea(e){this.selectedKnowledgeAreas.find(i=>i._id===e._id)||(this.selectedKnowledgeAreas.push(e),this.updateKnowledgeAreaFormControl()),this.knowledgeAreaInput="",this.showKnowledgeAreaDropdown=!1,this.filteredKnowledgeAreas=[]}removeKnowledgeArea(e){this.selectedKnowledgeAreas=this.selectedKnowledgeAreas.filter(i=>i._id!==e._id),this.updateKnowledgeAreaFormControl()}addNewKnowledgeAreaFromInput(){let e=this.knowledgeAreaInput.trim();if(!e)return;let i=this.knowledgeAreas.find(m=>m.name.toLowerCase()===e.toLowerCase());if(i){this.selectKnowledgeArea(i);return}let n={_id:"",name:e,used:!1};this._bDService.addKnowledgeArea(n).subscribe({next:m=>{m.area&&m.area._id&&(this.knowledgeAreas.push(m.area),this.selectKnowledgeArea(m.area))},error:m=>{console.error("Error adding new knowledge area",m)}})}updateKnowledgeAreaFormControl(){let e=this.selectedKnowledgeAreas.map(i=>i._id);this.sendForm.get("knowledge_area")?.setValue(e)}onLevelInputChange(){let e=this.levelInput.toLowerCase().trim();if(e.length===0){this.filteredLevels=[],this.showLevelDropdown=!1;return}let i=this.selectedLevels.map(n=>n.value);this.filteredLevels=this.academicLevels.filter(n=>!i.includes(n.value)&&n.value.toLowerCase().includes(e)),this.showLevelDropdown=this.filteredLevels.length>0}selectLevel(e){this.selectedLevels.find(i=>i.value===e.value)||(this.selectedLevels.push(e),this.updateLevelFormControl()),this.levelInput="",this.showLevelDropdown=!1,this.filteredLevels=[]}removeLevel(e){this.selectedLevels=this.selectedLevels.filter(i=>i.value!==e.value),this.updateLevelFormControl()}updateLevelFormControl(){let e=this.selectedLevels.map(i=>i.value);this.sendForm.get("level")?.setValue(e)}setupClickOutsideListener(){document.addEventListener("click",e=>{let i=e.target;i.closest(".knowledge-area-autocomplete")||(this.showKnowledgeAreaDropdown=!1),i.closest(".level-autocomplete")||(this.showLevelDropdown=!1)})}static{this.\u0275fac=function(i){return new(i||t)(y(T),y(ne),y(ie),y(Ne))}}static{this.\u0275cmp=P({type:t,selectors:[["send-experience"]],outputs:{added:"added"},standalone:!1,decls:68,vars:37,consts:[["id","send","tabindex","-1","aria-labelledby","sendTitle","aria-hidden","true","data-bs-backdrop","static","data-bs-keyboard","false",1,"modal","fade"],[1,"modal-dialog","modal-xl","modal-dialog-scrollable"],["enctype","multipart/form-data",1,"modal-content",3,"ngSubmit","input","formGroup"],[1,"modal-header","bg-success","text-white"],["id","sendTitle",1,"modal-title"],[1,"fas","fa-share-alt","me-2"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close","btn-close-white",3,"click"],[1,"modal-body"],["class","alert alert-danger fade show","role","alert",4,"ngIf"],["class","alert alert-success fade show","role","alert",4,"ngIf"],[1,"alert","alert-info","mb-4",3,"ngStyle"],[1,"fas","fa-info-circle","me-2"],[1,"mb-1","mt-2"],[1,"mb-1"],[1,"mb-0"],[3,"ngStyle"],[1,"row"],[1,"col-md-12"],["class","mb-3",4,"ngFor","ngForOf"],[1,"col-md-6"],[1,"mb-3"],[1,"form-label"],[1,"text-danger"],["class","selected-items-container mb-2",4,"ngIf"],[1,"knowledge-area-autocomplete","position-relative"],["type","text","placeholder","Escribe para buscar o agregar \xE1rea de conocimiento...","autocomplete","off",1,"form-control",3,"ngModelChange","input","keyup.enter","ngModel","ngModelOptions","ngClass"],["class","dropdown-menu show position-absolute w-100 mt-1","style","z-index: 1050; max-height: 200px; overflow-y: auto;",4,"ngIf"],[1,"form-text","text-muted"],["class","invalid-feedback d-block",4,"ngIf"],[1,"level-autocomplete","position-relative"],["type","text","placeholder","Escribe para buscar los niveles acad\xE9micos.","autocomplete","off",1,"form-control",3,"ngModelChange","input","ngModel","ngModelOptions","ngClass"],["class","row",4,"ngIf"],["class","card bg-light",4,"ngIf"],[1,"modal-footer",3,"ngStyle"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary",3,"click"],[1,"fas","fa-times","me-1"],["type","submit",1,"btn","btn-success",3,"disabled"],["class","spinner-border spinner-border-sm me-2","role","status","aria-hidden","true",4,"ngIf"],["class","fas fa-paper-plane me-1",4,"ngIf"],["role","alert",1,"alert","alert-danger","fade","show"],[1,"fas","fa-times-circle","me-2"],["role","alert",1,"alert","alert-success","fade","show"],[1,"fas","fa-check-circle","me-2"],[1,"mt-3","d-flex","justify-content-center","gap-2"],["type","button",1,"btn","btn-success",3,"click"],[1,"fas","fa-plus","me-1"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"form-label",3,"for"],["class","text-danger",4,"ngIf"],["type","text","class","form-control","autocomplete","off",3,"id","formControlName","ngClass","placeholder",4,"ngIf"],["class","form-control","rows","3",3,"id","formControlName","ngClass","placeholder",4,"ngIf"],["class","form-select",3,"formControlName","id","ngClass",4,"ngIf"],["class","form-text text-muted",4,"ngIf"],["class","invalid-feedback",4,"ngIf"],["type","text","autocomplete","off",1,"form-control",3,"id","formControlName","ngClass","placeholder"],["rows","3",1,"form-control",3,"id","formControlName","ngClass","placeholder"],[1,"form-select",3,"formControlName","id","ngClass"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"invalid-feedback"],[4,"ngIf"],[1,"selected-items-container","mb-2"],["class","badge bg-primary me-1 mb-1 selected-chip",4,"ngFor","ngForOf"],[1,"badge","bg-primary","me-1","mb-1","selected-chip"],["type","button","aria-label","Eliminar",1,"btn-close","btn-close-white","ms-1",3,"click"],[1,"dropdown-menu","show","position-absolute","w-100","mt-1",2,"z-index","1050","max-height","200px","overflow-y","auto"],["type","button","class","dropdown-item",3,"click",4,"ngFor","ngForOf"],["class","dropdown-divider",4,"ngIf"],["type","button","class","dropdown-item text-success",3,"click",4,"ngIf"],["type","button",1,"dropdown-item",3,"click"],[1,"fas","fa-tag","me-2"],[1,"dropdown-divider"],["type","button",1,"dropdown-item","text-success",3,"click"],[1,"fas","fa-plus","me-2"],[1,"invalid-feedback","d-block"],["class","badge bg-success me-1 mb-1 selected-chip",4,"ngFor","ngForOf"],[1,"badge","bg-success","me-1","mb-1","selected-chip"],[1,"fas","fa-graduation-cap","me-2"],["for","suggested_facilitator",1,"form-label"],[1,"text-muted"],["formControlName","suggested_facilitator","id","suggested_facilitator",1,"form-select"],["value",""],[1,"card","bg-light"],[1,"card-body"],[1,"card-title"],[1,"fas","fa-eye","me-2"],["class","mb-2",4,"ngIf"],["class","mb-0",4,"ngIf"],[1,"mb-2"],[1,"mt-1"],["class","badge bg-primary me-1",4,"ngFor","ngForOf"],[1,"badge","bg-primary","me-1"],["class","badge bg-success me-1",4,"ngFor","ngForOf"],[1,"badge","bg-success","me-1"],[1,"badge","bg-info","ms-1"],[1,"badge","bg-warning","ms-1"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-2"],[1,"fas","fa-paper-plane","me-1"]],template:function(i,n){i&1&&(r(0,"div",0)(1,"div",1)(2,"form",2),v("ngSubmit",function(){return n.onSubmit()})("input",function(){return n.onChanges()}),r(3,"div",3)(4,"h5",4),u(5,"i",5),l(6," Enviar Experiencia "),o(),r(7,"button",6),v("click",function(){return n.restartValues()}),o()(),r(8,"div",7),p(9,Vo,3,1,"div",8)(10,Do,10,1,"div",9),r(11,"div",10),u(12,"i",11),r(13,"strong"),l(14,"\xBFC\xF3mo funciona?"),o(),r(15,"p",12),l(16,"En este espacio puedes compartir con la red los materiales de clase que hayas desarrollado."),o(),r(17,"p",13)(18,"strong"),l(19,"Desarrollo:"),o(),l(20," Para experiencias que deseas que pasen por el proceso de desarrollo de lecciones con la asesor\xEDa de un experto en din\xE1mica de sistemas."),o(),r(21,"p",14)(22,"strong"),l(23,"Consideraci\xF3n:"),o(),l(24," Si la lecci\xF3n se encuentra lo suficientemente madura para ser compartida con la red."),o()(),r(25,"div",15)(26,"div",16)(27,"div",17),p(28,zo,10,8,"div",18),o()(),r(29,"div",16)(30,"div",19)(31,"div",20)(32,"label",21)(33,"strong"),l(34,"\xC1reas de Conocimiento"),r(35,"span",22),l(36,"*"),o()()(),p(37,Ho,2,1,"div",23),r(38,"div",24)(39,"input",25),ge("ngModelChange",function(_){return ve(n.knowledgeAreaInput,_)||(n.knowledgeAreaInput=_),_}),v("input",function(){return n.onKnowledgeAreaInputChange()})("keyup.enter",function(){return n.addNewKnowledgeAreaFromInput()}),o(),p(40,Xo,4,3,"div",26),o(),r(41,"small",27),l(42," Escribe para buscar \xE1reas existentes o crear nuevas "),o(),p(43,Qo,2,1,"div",28),o()(),r(44,"div",19)(45,"div",20)(46,"label",21)(47,"strong"),l(48,"Niveles Acad\xE9micos"),r(49,"span",22),l(50,"*"),o()()(),p(51,tr,2,1,"div",23),r(52,"div",29)(53,"input",30),ge("ngModelChange",function(_){return ve(n.levelInput,_)||(n.levelInput=_),_}),v("input",function(){return n.onLevelInputChange()}),o(),p(54,nr,2,1,"div",26),o(),r(55,"small",27),l(56," Seleccionar uno o m\xE1s niveles acad\xE9micos. e.g Preescolar - Primaria - Secundaria - Bachillerato - Universitario - Posgrado. "),o(),p(57,rr,2,1,"div",28),o()()(),p(58,lr,14,1,"div",31)(59,fr,9,4,"div",32),o()(),r(60,"div",33)(61,"button",34),v("click",function(){return n.restartValues()}),u(62,"i",35),l(63," Cancelar "),o(),r(64,"button",36),p(65,vr,1,0,"span",37)(66,gr,1,0,"i",38),l(67),o()()()()()),i&2&&(a(2),s("formGroup",n.sendForm),a(7),s("ngIf",n.status==="error"),a(),s("ngIf",n.status==="success"&&n.showSuccessActions),a(),s("ngStyle",b(25,ht,n.showSuccessActions?"none":"block")),a(14),s("ngStyle",b(27,ht,n.showSuccessActions?"none":"block")),a(3),s("ngForOf",n.fields),a(9),s("ngIf",n.selectedKnowledgeAreas.length>0),a(2),fe("ngModel",n.knowledgeAreaInput),s("ngModelOptions",B(29,ui))("ngClass",b(30,Ye,n.submitted&&n.f.knowledge_area.errors)),a(),s("ngIf",n.showKnowledgeAreaDropdown),a(3),s("ngIf",n.submitted&&n.f.knowledge_area.errors),a(8),s("ngIf",n.selectedLevels.length>0),a(2),fe("ngModel",n.levelInput),s("ngModelOptions",B(32,ui))("ngClass",b(33,Ye,n.submitted&&n.f.level.errors)),a(),s("ngIf",n.showLevelDropdown),a(3),s("ngIf",n.submitted&&n.f.level.errors),a(),s("ngIf",n.showFacilitatorField),a(),s("ngIf",n.selectedKnowledgeAreas.length>0||n.selectedLevels.length>0||n.showFacilitatorField),a(),s("ngStyle",b(35,ht,n.showSuccessActions?"none":"flex")),a(4),s("disabled",n.loading||n.sendForm.invalid),a(),s("ngIf",n.loading),a(),s("ngIf",!n.loading),a(),f(" ",n.loading?"Enviando...":"Enviar Experiencia"," "))},dependencies:[he,$,O,Oe,ee,le,de,j,se,K,Q,Le,xe,be],styles:[".selected-chip[_ngcontent-%COMP%]{font-size:.875rem;padding:.375rem .5rem;display:inline-flex;align-items:center}.selected-chip[_ngcontent-%COMP%]   .btn-close[_ngcontent-%COMP%]{font-size:.7rem;width:.8rem;height:.8rem}.selected-items-container[_ngcontent-%COMP%]{min-height:2rem;padding:.375rem;border:1px solid #dee2e6;border-radius:.375rem;background-color:#f8f9fa}.dropdown-menu.show[_ngcontent-%COMP%]{display:block;border:1px solid #dee2e6;box-shadow:0 .125rem .25rem #00000013}.dropdown-item[_ngcontent-%COMP%]:hover{background-color:#e9ecef}.knowledge-area-autocomplete[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%], .level-autocomplete[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]{top:100%!important;left:0!important;right:0!important}"]})}}return t})();var Te=t=>["/inicio","leccion",t],Ke=t=>["/perfil",t],fi=t=>["/inicio/lecciones",t];function xr(t,d){if(t&1){let e=x();r(0,"button",8),v("click",function(){g(e);let n=c();return h(n.openSuggestModal())}),u(1,"i",9),r(2,"span",10),l(3,"Sugerir leccion"),o()()}}function br(t,d){if(t&1){let e=x();r(0,"button",11),v("click",function(){g(e);let n=c();return h(n.openSendExperienceModal())}),u(1,"i",9),r(2,"span",10),l(3,"Enviar experiencias"),o()()}}function Cr(t,d){t&1&&(r(0,"div",12)(1,"div",13)(2,"div",14)(3,"span",15),l(4,"Loading..."),o()()()())}function yr(t,d){t&1&&(r(0,"div",12)(1,"h4",16),l(2," No han sido publicadas lecciones. "),o()())}function Sr(t,d){t&1&&(D(0),l(1," Ocultar opciones "),R())}function wr(t,d){t&1&&l(0," Ver opciones ")}function Er(t,d){if(t&1){let e=x();r(0,"div",42)(1,"div",43)(2,"input",44),v("click",function(){let n=g(e).$implicit,m=c(3);return h(m.setArea(n.name))}),o(),r(3,"label",45),l(4),o()()()}if(t&2){let e=d.$implicit;a(2),S("id",e.name),a(),S("for",e.name),a(),f(" ",e.name," ")}}function Ir(t,d){if(t&1&&(r(0,"div",39)(1,"div",40),p(2,Er,5,3,"div",41),o()()),t&2){let e=c(2);a(2),s("ngForOf",e.areas)}}function Lr(t,d){t&1&&(D(0),l(1," Ocultar opciones "),R())}function Fr(t,d){t&1&&l(0," Ver opciones ")}function kr(t,d){if(t&1){let e=x();r(0,"div",47)(1,"div",43)(2,"input",44),v("click",function(){let n=g(e).$implicit,m=c(3);return h(m.setLevel(n.value))}),o(),r(3,"label",45),l(4),o()()()}if(t&2){let e=d.$implicit;a(2),S("id",e.value),a(),S("for",e.value),a(),f(" ",e.label," ")}}function Tr(t,d){if(t&1&&(r(0,"div",17),p(1,kr,5,3,"div",46),o()),t&2){let e=c(2);a(),s("ngForOf",e.levels)}}function Ar(t,d){if(t&1&&(r(0,"button",66),u(1,"i",67),l(2),o()),t&2){let e=c().$implicit;a(2),f(" ",e.score.toFixed(2)," ")}}function Mr(t,d){if(t&1&&(r(0,"button",68)(1,"span"),u(2,"i",64),r(3,"span"),l(4),o()()()),t&2){let e=c().$implicit;a(4),f(" ",e.views,"")}}function Pr(t,d){if(t&1&&(r(0,"small"),l(1),o()),t&2){let e=c().$implicit;a(),f("",e,"...")}}function Or(t,d){if(t&1&&(r(0,"p",69),p(1,Pr,2,1,"small",37),o()),t&2){let e=d.index;a(),s("ngIf",e==0)}}function Vr(t,d){if(t&1&&(r(0,"span",71),l(1),o()),t&2){let e=d.$implicit,i=c(5);a(),f(" ",i.academic_level[e]||e," ")}}function Dr(t,d){if(t&1&&(D(0),p(1,Vr,2,1,"span",70),R()),t&2){let e=c().$implicit,i=c(3);a(),s("ngForOf",i.extractLevels(e))}}function Rr(t,d){t&1&&(r(0,"small",16),l(1,"No se ha asignado"),o())}function Nr(t,d){if(t&1&&(r(0,"span",74),l(1),o()),t&2){let e=d.$implicit;S("title",e.name),a(),w(e.name)}}function $r(t,d){if(t&1&&(r(0,"div",72),p(1,Nr,2,2,"span",73),o()),t&2){let e=c().$implicit;a(),s("ngForOf",e.knowledge_area)}}function Ur(t,d){t&1&&(r(0,"small",16),l(1,"No se ha asignado"),o())}function Br(t,d){t&1&&u(0,"img",83)}function qr(t,d){if(t&1&&u(0,"img",84),t&2){let e=c().$implicit,i=c(5);S("src",i.url+"get-image-user/"+e.picture,N)}}function jr(t,d){if(t&1&&(r(0,"div",78)(1,"a",79)(2,"button",80),p(3,Br,1,0,"img",81)(4,qr,1,1,"img",82),o()()()),t&2){let e=d.$implicit;a(2),ut("title","",e.name," ",e.surname,""),s("routerLink",b(6,Ke,e._id)),a(),s("ngIf",!e.picture),a(),s("ngIf",e.picture)}}function Kr(t,d){if(t&1&&(r(0,"div",17)(1,"div",18)(2,"div",17)(3,"div",18)(4,"strong"),l(5,"Grupo de desarrollo:"),o()()(),r(6,"div",75)(7,"div",76)(8,"div",17),p(9,jr,5,8,"div",77),o()()()()()),t&2){let e=c().$implicit;a(9),s("ngForOf",e.development_group)}}function zr(t,d){t&1&&u(0,"img",83)}function Gr(t,d){if(t&1&&u(0,"img",84),t&2){let e=c(2).$implicit,i=c(3);S("src",i.url+"get-image-user/"+e.author.picture,N)}}function Hr(t,d){if(t&1&&(r(0,"div",17)(1,"div",18)(2,"div",17)(3,"div",18)(4,"strong"),l(5,"Enviada por:"),o()()(),r(6,"div",85)(7,"div",76)(8,"div",17)(9,"div",78)(10,"a",79)(11,"button",86),p(12,zr,1,0,"img",81)(13,Gr,1,1,"img",82),o()()(),r(14,"div",87)(15,"h6",88)(16,"a",89)(17,"strong"),l(18),o()(),u(19,"br"),r(20,"small",16),l(21),E(22,"amFromUnix"),E(23,"amLocale"),E(24,"amDateFormat"),o()()()()()()()()),t&2){let e=c().$implicit;a(11),s("routerLink",b(15,Ke,e.author._id)),a(),s("ngIf",!e.author.picture),a(),s("ngIf",e.author.picture),a(3),s("routerLink",b(17,Ke,e.author._id)),a(2),J(" ",e.author.name," ",e.author.surname," "),a(3),w(F(24,12,F(23,9,q(22,7,e.created_at),"es"),"LLL"))}}function Wr(t,d){if(t&1){let e=x();r(0,"div")(1,"div",49)(2,"div",12)(3,"div",50)(4,"div",17)(5,"div",51)(6,"div",17)(7,"div",18)(8,"div",52),u(9,"i",53),o()()(),r(10,"div",54)(11,"div",55)(12,"button",56)(13,"span"),l(14),o()(),p(15,Ar,3,1,"button",57)(16,Mr,5,1,"button",58),o()()(),r(17,"div",18)(18,"div",17)(19,"div",18)(20,"div",59)(21,"h5",60)(22,"strong"),l(23),o()()(),r(24,"small",16),l(25),E(26,"amFromUnix"),E(27,"amLocale"),E(28,"amDateFormat"),o(),p(29,Or,2,1,"p",61),o(),r(30,"div",62)(31,"button",63),v("click",function(){let n=g(e).$implicit,m=c(3);return h(m.increaseViews(n))}),u(32,"i",64),o()()(),r(33,"div",17)(34,"div",47)(35,"div",17)(36,"div",18)(37,"strong"),l(38,"Nivel acad\xE9mico:"),o()()(),r(39,"div",17)(40,"div",18)(41,"p"),p(42,Dr,2,1,"ng-container",22)(43,Rr,2,0,"ng-template",null,1,L),o()()()(),r(45,"div",47)(46,"div",17)(47,"div",18)(48,"strong"),l(49,"\xC1reas de conocimiento:"),o()()(),r(50,"div",17)(51,"div",18),p(52,$r,2,1,"div",65)(53,Ur,2,0,"ng-template",null,1,L),o()()()(),p(55,Kr,10,1,"div",26)(56,Hr,25,19,"div",26),o()()()()()()}if(t&2){let e=d.$implicit,i=k(44),n=c(3);a(8),W("text-center p-2 py-3 rounded-lg border border-ligth text-center bg-",n.lesson_states[e.state].class,""),s("routerLink",b(26,Te,e._id)),a(6),f("V. ",e.version.toFixed(1),""),a(),s("ngIf",e.state=="completed"),a(),s("ngIf",e.state=="completed"),a(4),s("routerLink",b(28,Te,e._id)),a(3),w(e.title),a(2),f(" ",F(28,23,F(27,20,q(26,18,e.created_at),"es"),"LL")," "),a(4),s("ngForOf",e.resume.split(`
`)),a(2),s("routerLink",b(30,Te,e._id)),a(11),s("ngIf",n.extractLevels(e).length>0)("ngIfElse",i),a(10),s("ngIf",e.knowledge_area.length>0)("ngIfElse",i),a(3),s("ngIf",e.development_group.length>0&&e.state=="completed"),a(),s("ngIf",e.development_group.length<=0||e.state=="proposed")}}function Jr(t,d){if(t&1&&(r(0,"div"),p(1,Wr,57,32,"div",48),o()),t&2){let e=c(2);a(),s("ngForOf",e.lessons)}}function Yr(t,d){if(t&1&&(r(0,"button",66),u(1,"i",67),l(2),o()),t&2){let e=c().$implicit;a(2),f(" ",e.score.toFixed(2)," ")}}function Xr(t,d){if(t&1&&(r(0,"button",68)(1,"span"),u(2,"i",64),r(3,"span"),l(4),o()()()),t&2){let e=c().$implicit;a(4),f(" ",e.views,"")}}function Zr(t,d){if(t&1&&(r(0,"small"),l(1),o()),t&2){let e=c().$implicit;a(),f("",e,"...")}}function Qr(t,d){if(t&1&&(r(0,"p",69),p(1,Zr,2,1,"small",37),o()),t&2){let e=d.index;a(),s("ngIf",e==0)}}function ea(t,d){if(t&1&&(r(0,"span",71),l(1),o()),t&2){let e=d.$implicit,i=c(5);a(),f(" ",i.academic_level[e]||e," ")}}function ta(t,d){if(t&1&&(D(0),p(1,ea,2,1,"span",70),R()),t&2){let e=c().$implicit,i=c(3);a(),s("ngForOf",i.extractLevels(e))}}function ia(t,d){t&1&&(r(0,"small",16),l(1,"No se ha asignado"),o())}function na(t,d){if(t&1&&(r(0,"span",74),l(1),o()),t&2){let e=d.$implicit;S("title",e.name),a(),w(e.name)}}function oa(t,d){if(t&1&&(r(0,"div",72),p(1,na,2,2,"span",73),o()),t&2){let e=c().$implicit;a(),s("ngForOf",e.knowledge_area)}}function ra(t,d){t&1&&(r(0,"small",16),l(1,"No se ha asignado"),o())}function aa(t,d){t&1&&u(0,"img",83)}function sa(t,d){if(t&1&&u(0,"img",84),t&2){let e=c().$implicit,i=c(5);S("src",i.url+"get-image-user/"+e.picture,N)}}function la(t,d){if(t&1&&(r(0,"div",78)(1,"a",79)(2,"button",80),p(3,aa,1,0,"img",81)(4,sa,1,1,"img",82),o()()()),t&2){let e=d.$implicit;a(2),ut("title","",e.name," ",e.surname,""),s("routerLink",b(6,Ke,e._id)),a(),s("ngIf",!e.picture),a(),s("ngIf",e.picture)}}function da(t,d){if(t&1&&(r(0,"div",17)(1,"div",18)(2,"div",17)(3,"div",18)(4,"strong"),l(5,"Grupo de desarrollo:"),o()()(),r(6,"div",75)(7,"div",76)(8,"div",17),p(9,la,5,8,"div",77),o()()()()()),t&2){let e=c().$implicit;a(9),s("ngForOf",e.development_group)}}function ca(t,d){t&1&&u(0,"img",83)}function ma(t,d){if(t&1&&u(0,"img",84),t&2){let e=c(2).$implicit,i=c(3);S("src",i.url+"get-image-user/"+e.author.picture,N)}}function pa(t,d){if(t&1&&(r(0,"div",17)(1,"div",18)(2,"div",17)(3,"div",18)(4,"strong"),l(5,"Enviada por:"),o()()(),r(6,"div",85)(7,"div",76)(8,"div",17)(9,"div",78)(10,"a",79)(11,"button",86),p(12,ca,1,0,"img",81)(13,ma,1,1,"img",82),o()()(),r(14,"div",87)(15,"h6",88)(16,"a",89)(17,"strong"),l(18),o()(),u(19,"br"),r(20,"small",16),l(21),E(22,"amFromUnix"),E(23,"amLocale"),E(24,"amDateFormat"),o()()()()()()()()),t&2){let e=c().$implicit;a(11),s("routerLink",b(15,Ke,e.author._id)),a(),s("ngIf",!e.author.picture),a(),s("ngIf",e.author.picture),a(3),s("routerLink",b(17,Ke,e.author._id)),a(2),J(" ",e.author.name," ",e.author.surname," "),a(3),w(F(24,12,F(23,9,q(22,7,e.created_at),"es"),"LLL"))}}function ua(t,d){if(t&1){let e=x();r(0,"div")(1,"div",49)(2,"div",12)(3,"div",50)(4,"div",17)(5,"div",51)(6,"div",17)(7,"div",18)(8,"div",52),u(9,"i",53),o()()(),r(10,"div",54)(11,"div",55)(12,"button",56)(13,"span"),l(14),o()(),p(15,Yr,3,1,"button",57)(16,Xr,5,1,"button",58),o()()(),r(17,"div",18)(18,"div",17)(19,"div",18)(20,"div",59)(21,"h5",60)(22,"strong"),l(23),o()()(),r(24,"small",16),l(25),E(26,"amFromUnix"),E(27,"amLocale"),E(28,"amDateFormat"),o(),p(29,Qr,2,1,"p",61),o(),r(30,"div",62)(31,"button",63),v("click",function(){let n=g(e).$implicit,m=c(3);return h(m.increaseViews(n))}),u(32,"i",64),o()()(),r(33,"div",17)(34,"div",47)(35,"div",17)(36,"div",18)(37,"strong"),l(38,"Nivel acad\xE9mico:"),o()()(),r(39,"div",17)(40,"div",18)(41,"p"),p(42,ta,2,1,"ng-container",22)(43,ia,2,0,"ng-template",null,1,L),o()()()(),r(45,"div",47)(46,"div",17)(47,"div",18)(48,"strong"),l(49,"\xC1reas de conocimiento:"),o()()(),r(50,"div",17)(51,"div",18),p(52,oa,2,1,"div",65)(53,ra,2,0,"ng-template",null,1,L),o()()()(),p(55,da,10,1,"div",26)(56,pa,25,19,"div",26),o()(),r(57,"div",90)(58,"div",18)(59,"button",91),v("click",function(){let n=g(e).$implicit,m=c(3);return h(m.increaseViews(n))}),u(60,"i",64),l(61," Ver lecci\xF3n "),o()()()()()()()}if(t&2){let e=d.$implicit,i=k(44),n=c(3);a(8),W("text-center p-2 py-3 rounded-lg border border-ligth text-center bg-",n.lesson_states[e.state].class,""),s("routerLink",b(27,Te,e._id)),a(6),f("V. ",e.version.toFixed(1),""),a(),s("ngIf",e.state=="completed"),a(),s("ngIf",e.state=="completed"),a(4),s("routerLink",b(29,Te,e._id)),a(3),w(e.title),a(2),f(" ",F(28,24,F(27,21,q(26,19,e.created_at),"es"),"LL")," "),a(4),s("ngForOf",e.resume.split(`
`)),a(2),s("routerLink",b(31,Te,e._id)),a(11),s("ngIf",n.extractLevels(e).length>0)("ngIfElse",i),a(10),s("ngIf",e.knowledge_area.length>0)("ngIfElse",i),a(3),s("ngIf",e.development_group.length>0&&e.state=="completed"),a(),s("ngIf",e.development_group.length<=0||e.state=="proposed"),a(3),s("routerLink",b(33,Te,e._id))}}function _a(t,d){if(t&1&&(r(0,"div"),p(1,ua,62,35,"div",48),E(2,"filter"),o()),t&2){let e=c(2);a(),s("ngForOf",F(2,1,e.allLessons,e.filter.value))}}function fa(t,d){if(t&1&&(r(0,"li",95)(1,"a",96),l(2,"Anterior"),o()()),t&2){let e=c(3);a(),s("routerLink",b(1,fi,e.prevPage))}}function va(t,d){if(t&1&&(r(0,"li",95)(1,"a",97),l(2,"Siguiente"),o()()),t&2){let e=c(3);a(),s("routerLink",b(1,fi,e.nextPage))}}function ga(t,d){if(t&1&&(r(0,"nav",92)(1,"ul",93),p(2,fa,3,3,"li",94)(3,va,3,3,"li",94),o()()),t&2){let e=c(2);a(2),s("ngIf",e.page>1),a(),s("ngIf",e.page<e.pages&&e.page!=e.pages)}}function ha(t,d){if(t&1){let e=x();r(0,"div",12)(1,"div",17)(2,"div",18)(3,"div")(4,"div",17)(5,"div",18)(6,"h6",19),u(7,"i",20),l(8," \xC1rea de conocimiento "),r(9,"button",21),v("click",function(){g(e);let n=c();return h(n.setShowAreas())}),p(10,Sr,2,0,"ng-container",22)(11,wr,1,0,"ng-template",null,0,L),o()()()(),p(13,Ir,3,1,"div",23),o()(),r(14,"div",18)(15,"div")(16,"div",17)(17,"div",18)(18,"h6",24),l(19,"Nivel acad\xE9mico "),r(20,"button",25),v("click",function(){g(e);let n=c();return h(n.setShowLevels())}),p(21,Lr,2,0,"ng-container",22)(22,Fr,1,0,"ng-template",null,0,L),o()()()(),p(24,Tr,2,1,"div",26),o()()(),r(25,"div",27)(26,"div",18)(27,"form")(28,"div",28)(29,"span",29),l(30,"Filtrar:"),o(),u(31,"input",30),o()()()(),r(32,"div",31)(33,"label",32)(34,"small",16),l(35,"Ordenar por:"),o()(),r(36,"div",33)(37,"select",34),v("change",function(){g(e);let n=c();return h(n.reloadLessons())}),r(38,"option",35),l(39,"M\xE1s vistos"),o(),r(40,"option",36),l(41," M\xE1s populares"),o()()()(),p(42,Jr,2,1,"div",37)(43,_a,3,4,"div",37)(44,ga,4,2,"nav",38),o()}if(t&2){let e=k(12),i=c();a(10),s("ngIf",i.showAreas)("ngIfElse",e),a(3),s("ngIf",i.showAreas),a(8),s("ngIf",i.showLevels)("ngIfElse",e),a(3),s("ngIf",i.showLevels),a(7),s("formControl",i.filter),a(6),s("formControl",i.orderControl),a(5),s("ngIf",!i.orderControl.value&&!i.filter.value&&i.selectedAreas.length==0&&i.selectedLevels.length==0),a(),s("ngIf",i.orderControl.value||i.filter.value||i.selectedAreas.length>0||i.selectedLevels.length>0),a(),s("ngIf",!i.filter.value&&i.selectedAreas.length==0&&i.selectedLevels.length==0)}}function xa(t,d){t&1&&(r(0,"div",12)(1,"div",12)(2,"h4",16),l(3," No se encontraron lecciones para los criterios de b\xFAsqueda seleccionados. "),o()()())}var xt=(()=>{class t{constructor(e,i,n,m,_){this._userService=e,this._lessonService=i,this._bDService=n,this._router=m,this._route=_,this.allLessons=[],this.lessons=[],this.level={basic:"B\xE1sico",medium:"Medio",advanced:"Avanzado"},this.type={consideration:"Consideraci\xF3n",development:"Desarrollo"},this.academic_level=X,this.lesson_states=$e,this.visible=new I,this.selectedAreas=[],this.selectedLevels=[],this.loading=!0,this.openModalRetries=0,this.states=[{label:"Propuesta",value:"proposed",class:"secondary"},{label:"Asignada",value:"assigned",class:"warning"},{label:"Desarrollo",value:"development",class:"info"},{label:"Prueba",value:"test",class:"primary"},{label:"Terminada",value:"completed",class:"success"}],this.levels=[{label:"Preescolar",value:"garden"},{label:"Primaria",value:"school"},{label:"Secundaria",value:"midddleschool"},{label:"Bachillerato",value:"highschool"},{label:"Universitario",value:"university"}],this.showAreas=!1,this.showLevels=!1,this.title="Lecciones",this.url=V.url,this.token=this._userService.getToken(),this.identity=this._userService.getIdentity(),this.areas,this.orderControl=new I(""),this.filter=new I(""),this.orderBy="created_at"}normalizeLessonForPrefill(e){console.log("[LessonsComponent] normalize input:",e);let i=JSON.parse(JSON.stringify(e||{}));try{let n=Array.isArray(i.knowledge_area)?i.knowledge_area:[];i.knowledge_area=n.map(m=>typeof m=="string"?m:m?.name||"").filter(m=>!!m)}catch{i.knowledge_area=[]}if(i.justification&&typeof i.justification!="string")try{let n=[];i.justification.methodology&&n.push(String(i.justification.methodology)),i.justification.objectives&&n.push(String(i.justification.objectives)),i.justificationText=n.join(`

`)}catch{}return console.log("[LessonsComponent] normalize output:",i),i}ngOnInit(){this.getAllLessons(),this.getAllAreas(),this.actualPage(),this._route.queryParams.subscribe(e=>{console.log("[LessonsComponent] queryParams:",e);let i=String(e.openSuggestModal||"").toLowerCase()==="true",n=e.lessonId||e.lesson_id||"";if(!n){let m=this._route.snapshot.params.page;m&&isNaN(parseInt(m,10))&&(n=m)}console.log("[LessonsComponent] openSuggestModal=",i," lessonId=",n),i&&n&&setTimeout(()=>{let _=[...this.allLessons,...this.lessons].find(C=>String(C._id)===String(n));if(_){let C=this.normalizeLessonForPrefill(_);console.log("[LessonsComponent] found normalized:",C);try{localStorage.setItem("resuggestLessonPayload",JSON.stringify(C))}catch{}this.openSuggestModal()}else this._lessonService.getLesson(this.token,n).subscribe({next:C=>{let M=C&&(C.lesson||C.data)||null,U=M?this.normalizeLessonForPrefill(M):null;console.log("[LessonsComponent] fetched normalized:",U);try{U&&localStorage.setItem("resuggestLessonPayload",JSON.stringify(U))}catch{}this.openSuggestModal()},error:()=>{this.openSuggestModal()}})},300)})}setArea(e){this.selectedAreas.indexOf(e)>=0?this.selectedAreas.splice(this.selectedAreas.indexOf(e),1):this.selectedAreas.push(e),this.getAllLessons()}setLevel(e){this.selectedLevels.indexOf(e)>=0?this.selectedLevels.splice(this.selectedLevels.indexOf(e),1):this.selectedLevels.push(e),this.getAllLessons()}getAllAreas(){this.areas=JSON.parse(localStorage.getItem("areas")),this.areas||this._bDService.getAllKnowledgeAreas().subscribe({next:e=>{e.areas&&(this.areas=e.areas.map(i=>ye(Y({},i),{used:!1})),localStorage.setItem("areas",JSON.stringify(this.areas)))},error:e=>{console.log(e)}})}getAllLessons(){let e=[],i,n=this.orderBy||"created_at";this.loading=!0,this._lessonService.getAllLessons(this.token,n,!0).subscribe({next:m=>{m&&m.lessons?(this.allLessons=m.lessons,this.allLessons=this.allLessons.filter(_=>_?.state==="completed"&&_?.visible===!0),this.selectedAreas.length>0&&(this.selectedAreas.forEach(_=>{e=e.concat(this.allLessons.filter(C=>(i=!1,C.knowledge_area&&C.knowledge_area.length>0&&C.knowledge_area.some(function(M){if(i=M.name==_,i)return!0}),i)))}),this.allLessons=Array.from(new Set(e)),e=[]),this.selectedLevels.length>0&&(this.selectedLevels.forEach(_=>{e=e.concat(this.allLessons.filter(C=>{let M=Array.isArray(C?.level)?C.level:C?.level?[C.level]:[],U=Array.isArray(C?.development_level)?C.development_level:C?.development_level?[C.development_level]:[],ke=M.concat(U);return console.log("levelArray: ",M),console.log("devLevelArray: ",U),console.log("combinedLevels: ",ke),console.log("level: ",_),ke.includes(_)}))}),this.allLessons=Array.from(new Set(e)),e=[]),console.log("Lessons loaded successfully:",this.allLessons.length)):(console.warn("No lessons data received"),this.allLessons=[]),this.loading=!1},error:m=>{console.error("Error fetching lessons:",m),this.loading=!1,this.allLessons=[]}})}getLessons(e=1){this._lessonService.getLessons(this.token,e,!0).subscribe({next:i=>{i.lessons&&(this.lessons=i.lessons.filter(n=>n?.state==="completed"&&n?.visible===!0),this.total=i.total,this.pages=i.pages,this.page=i.currentPage,e>this.pages&&this._router.navigate(["/inicio/lecciones"]),this.loading=!1)},error:i=>{this.loading=!1,console.log(i)}})}actualPage(){this._route.params.subscribe(e=>{let i=+e.page;this.page=i,i?(this.nextPage=i+1,this.prevPage=i-1,this.prevPage<=0&&(this.prevPage=1)):(this.page=1,this.nextPage=this.page+1),this.getLessons(this.page)})}reloadLessons(){this.orderControl.value=="views"?this.orderBy="views":this.orderControl.value=="score"?this.orderBy="score":this.orderBy="created_at",this.getAllLessons(),this._lessonService.getLessons&&this.getLessons(this.page||1)}setNeedReload(e){this.needReloadData=!0}setShowAreas(){this.showAreas?this.showAreas=!1:this.showAreas=!0}setShowLevels(){this.showLevels?this.showLevels=!1:this.showLevels=!0}increaseViews(e){e.views=(e.views??0)+1,this._lessonService.editLesson(this.token,e).subscribe({next:i=>{i&&i.lesson._id&&this._lessonService.getLessons&&this.getLessons(this.page||1)},error:i=>{console.log(i)}})}openSuggestModal(){let e=()=>{try{let i=document.getElementById("add");if(!i)return this.openModalRetries<20?(this.openModalRetries++,setTimeout(e,100)):void 0;let n=window.bootstrap?.Modal?.getInstance(i);n&&n.dispose();let m=window.bootstrap?.Modal;if(!m)return this.openModalRetries<20?(this.openModalRetries++,setTimeout(e,100)):void 0;new m(i,{backdrop:"static",keyboard:!1}).show(),this.openModalRetries=0}catch(i){console.log("Error al abrir modal de sugerir lecci\xF3n:",i)}};setTimeout(e,0)}openSendExperienceModal(){setTimeout(()=>{try{let e=document.getElementById("send");if(e){let i=window.bootstrap?.Modal?.getInstance(e);i&&i.dispose(),new window.bootstrap.Modal(e,{backdrop:"static",keyboard:!1}).show()}}catch(e){console.log("Error al abrir modal de enviar experiencia:",e)}},0)}extractLevels(e){let i=[],n=_=>{_==null||_===""||i.push(String(_))};Array.isArray(e?.level)?e.level.forEach(n):n(e?.level),Array.isArray(e?.development_level)?e.development_level.forEach(n):n(e?.development_level);let m=i.map(_=>this.mapLevelKey(_)).filter(_=>!!_);return Array.from(new Set(m))}mapLevelKey(e){let i=String(e).toUpperCase().trim();return{GARDEN:"GARDEN",PRESCHOOL:"GARDEN",PREESCOLAR:"GARDEN",SCHOOL:"SCHOOL",PRIMARIA:"SCHOOL",HIGHSCHOOL:"HIGHSCHOOL",SECUNDARIA:"HIGHSCHOOL",UNIVERSITY:"GRADUATE",UNIVERSITARIO:"GRADUATE",GRADUATE:"GRADUATE"}[i]||i}static{this.\u0275fac=function(i){return new(i||t)(y(T),y(ne),y(ie),y(z),y(te))}}static{this.\u0275cmp=P({type:t,selectors:[["lessons"]],standalone:!1,decls:13,vars:10,consts:[["showOptions",""],["notAssigned",""],[1,"card"],[1,"card-header"],[1,"m-0","text-primary","fw-bolder","float-start"],["type","button","class","btn btn-primary float-end ms-3",3,"click",4,"ngIf"],["type","button","class","btn btn-secondary float-end",3,"click",4,"ngIf"],["class","card-body",4,"ngIf"],["type","button",1,"btn","btn-primary","float-end","ms-3",3,"click"],[1,"fas","fa-plus"],[1,"ms-2"],["type","button",1,"btn","btn-secondary","float-end",3,"click"],[1,"card-body"],[1,"text-muted","text-center"],["role","status",1,"spinner-border",2,"width","3rem","height","3rem"],[1,"visually-hidden"],[1,"text-muted"],[1,"row"],[1,"col"],[1,"categories-section-title"],[1,"fas","fa-filter"],[1,"categories-toggle-btn",3,"click"],[4,"ngIf","ngIfElse"],["class","collapsible-categories expanded",4,"ngIf"],[1,"text-primary","fw-bold","mb-0"],[1,"btn","btn-link",3,"click"],["class","row",4,"ngIf"],[1,"row","mb-1"],[1,"input-group","mb-2"],[1,"input-group-text"],["type","text","id","filter","placeholder","Filtro","autocomplete","off",1,"form-control",3,"formControl"],[1,"row","mb-3"],["for","order",1,"col-3","offset-6","col-form-label","text-end"],[1,"col-3"],["id","orderOptions",1,"form-control",3,"change","formControl"],["value","views"],["value","score"],[4,"ngIf"],["class","mt-3","aria-label","Page navigation",4,"ngIf"],[1,"collapsible-categories","expanded"],[1,"categories-grid"],["class","category-item",4,"ngFor","ngForOf"],[1,"category-item"],[1,"form-check"],["type","checkbox",1,"form-check-input",3,"click","id"],[1,"form-check-label",3,"for"],["class","col-6",4,"ngFor","ngForOf"],[1,"col-6"],[4,"ngFor","ngForOf"],[1,"card","mb-2"],[1,"media-body"],[1,"col-auto"],[2,"width","100%","height","80px","overflow","hidden","cursor","pointer",3,"routerLink"],[1,"text-white","fas","fa-chalkboard-teacher",2,"font-size","50px"],[1,"row","mt-1"],[1,"col-12"],["disabled","","title","Versi\xF3n",1,"btn","w-100","btn-sm"],["class","btn w-100 btn-sm","disabled","","title","Calificaci\xF3n",4,"ngIf"],["class","btn w-100 btn-sm","disabled","","title","Visualizaciones",4,"ngIf"],[2,"cursor","pointer",3,"routerLink"],[1,"my-0"],["class","text-justify",4,"ngFor","ngForOf"],[1,"text-end","col-3"],["title","Ver lecci\xF3n",1,"btn","btn-info","ms-2",3,"click","routerLink"],[1,"fas","fa-eye"],["class","selected-items-container mb-2",4,"ngIf","ngIfElse"],["disabled","","title","Calificaci\xF3n",1,"btn","w-100","btn-sm"],[1,"fas","fa-star"],["disabled","","title","Visualizaciones",1,"btn","w-100","btn-sm"],[1,"text-justify"],["class","badge bg-info me-1 mb-1 d-inline-flex align-items-center",4,"ngFor","ngForOf"],[1,"badge","bg-info","me-1","mb-1","d-inline-flex","align-items-center"],[1,"selected-items-container","mb-2"],["class","badge bg-info me-1 mb-1 d-inline-flex align-items-center",3,"title",4,"ngFor","ngForOf"],[1,"badge","bg-info","me-1","mb-1","d-inline-flex","align-items-center",3,"title"],[1,"card","mt-1"],[1,"card-body","p-1"],["class","col-auto pe-0",4,"ngFor","ngForOf"],[1,"col-auto","pe-0"],[1,"text-primary"],[1,"btn","flex-shrink-0","rounded-circle","overflow-hidden","p-0",2,"width","40px","height","40px",3,"routerLink","title"],["class","img-fluid","src","assets/images/user-default.png",4,"ngIf"],["class","img-fluid",3,"src",4,"ngIf"],["src","assets/images/user-default.png",1,"img-fluid"],[1,"img-fluid",3,"src"],[1,"card","mt-2"],[1,"btn","flex-shrink-0","rounded-circle","overflow-hidden","p-0",2,"width","40px","height","40px",3,"routerLink"],[1,"col","rounded","px-2"],[1,"mb-1"],[1,"text-primary",3,"routerLink"],[1,"row","mt-3","text-end"],[1,"btn","btn-info","ms-2",3,"click","routerLink"],["aria-label","Page navigation",1,"mt-3"],[1,"pagination","justify-content-end"],["class","page-item",4,"ngIf"],[1,"page-item"],[1,"page-link","bg-primary",3,"routerLink"],[1,"page-link","bg-info",3,"routerLink"]],template:function(i,n){i&1&&(r(0,"div",2)(1,"div",3)(2,"h3",4),l(3),o(),p(4,xr,4,0,"button",5)(5,br,4,0,"button",6),o(),p(6,Cr,5,0,"div",7)(7,yr,3,0,"div",7)(8,ha,45,11,"div",7)(9,xa,4,0,"div",7),E(10,"filter"),o(),u(11,"suggest-lesson")(12,"send-experience")),i&2&&(a(3),w(n.title),a(),s("ngIf",n.identity.role!="guest"),a(),s("ngIf",n.identity.role!="guest"),a(),s("ngIf",n.loading),a(),s("ngIf",n.lessons.length==0&&!n.loading),a(),s("ngIf",n.lessons.length!=0),a(),s("ngIf",n.lessons.length>0&&F(10,7,n.allLessons,n.filter.value).length==0&&!n.loading))},dependencies:[$,O,ee,le,de,j,se,K,Q,De,Re,G,pi,_i,ce,me,pe,Be],encapsulation:2})}}return t})();var vi=[{id:"name",label:"Nombre",type:"text",attr:"name",required:!0},{id:"description",label:"Descripci\xF3n",type:"textarea",attr:"description",required:!0},{id:"type",label:"Tipo",type:"select",attr:"type",required:!0,options:[{label:"Documento",value:"document"},{label:"Enlace",value:"link"},{label:"Video",value:"video"},{label:"Software",value:"software"}]},{id:"url",label:"Enlace",type:"text",attr:"url",required:!0},{id:"file",label:"Archivo",type:"file",attr:"file",required:!0},{id:"source",label:"Fuente",type:"textarea",attr:"source",required:!0},{id:"justification",label:"Justificaci\xF3n",type:"textarea",attr:"justification",required:!0}],gi=[{id:"name",label:"Nombre",type:"text",attr:"name",required:!0},{id:"description",label:"Descripci\xF3n",type:"textarea",attr:"description",required:!0},{id:"type",label:"Tipo",type:"select",attr:"type",required:!0,options:[{label:"Documento",value:"document"},{label:"Enlace",value:"link"},{label:"Video",value:"video"},{label:"Software",value:"software"}]},{id:"url",label:"Enlace",type:"text",attr:"url",required:!0},{id:"file",label:"Archivo",type:"file",attr:"file",required:!0},{id:"source",label:"Fuente",type:"textarea",attr:"source",required:!0}],hi=[{label:"Documentos",value:"document"},{label:"Enlaces",value:"link"},{label:"Video",value:"video"},{label:"Software",value:"software"}];var xi=t=>["/perfil",t];function ba(t,d){if(t&1){let e=x();r(0,"input",25),ge("ngModelChange",function(n){g(e);let m=c(2).$implicit,_=c();return ve(_.resource[m.id],n)||(_.resource[m.id]=n),h(n)}),o()}if(t&2){let e=c(2).$implicit,i=c();S("name",e.id),fe("ngModel",i.resource[e.id])}}function Ca(t,d){if(t&1){let e=x();r(0,"select",26),ge("ngModelChange",function(n){g(e);let m=c(3);return ve(m.resource.type,n)||(m.resource.type=n),h(n)}),r(1,"option",27),l(2,"Documento"),o(),r(3,"option",28),l(4,"Video"),o(),r(5,"option",29),l(6,"Enlace"),o(),r(7,"option",30),l(8,"Software"),o()()}if(t&2){let e=c(3);fe("ngModel",e.resource.type)}}function ya(t,d){if(t&1){let e=x();r(0,"input",31),ge("ngModelChange",function(n){g(e);let m=c(3);return ve(m.resource.url,n)||(m.resource.url=n),h(n)}),o()}if(t&2){let e=c(3);fe("ngModel",e.resource.url)}}function Sa(t,d){if(t&1&&(D(0),p(1,ba,1,2,"input",22)(2,Ca,9,1,"select",23)(3,ya,1,1,"input",24),R()),t&2){let e=c().$implicit;a(),s("ngIf",e.type!=="file"&&e.id!=="type"&&e.id!=="url"),a(),s("ngIf",e.id==="type"),a(),s("ngIf",e.id==="url")}}function wa(t,d){if(t&1&&(r(0,"p"),l(1),o()),t&2){let e=c(2).$implicit,i=c();a(),w(i.types[i.resource[e.id]].label)}}function Ea(t,d){if(t&1&&(r(0,"p"),l(1),o()),t&2){let e=c(2).$implicit,i=c();a(),w(i.resource[e.id])}}function Ia(t,d){if(t&1&&(r(0,"p")(1,"a",33),l(2),o()()),t&2){let e=c(3);a(),S("href",e.getLink(e.resource.url),N),a(),w(e.resource.url)}}function La(t,d){if(t&1&&(r(0,"p")(1,"a",34),u(2,"i",15),l(3),o()()),t&2){let e=c(3);a(),ae("title","Descargar recurso: ",e.resource.file,""),S("href",e.url+"get-resource/"+e.resource.file,N),a(2),f(" ",e.resource.file," ")}}function Fa(t,d){if(t&1&&p(0,wa,2,1,"p",32)(1,Ea,2,1,"p",32)(2,Ia,3,2,"p",32)(3,La,4,4,"p",32),t&2){let e=c().$implicit,i=c();s("ngIf",e.id=="type"&&i.resource[e.id]),a(),s("ngIf",i.resource[e.id]&&e.type!="file"&&e.id!="type"&&e.id!="url"),a(),s("ngIf",i.resource[e.id]&&e.id=="url"),a(),s("ngIf",i.resource[e.id]&&e.type=="file")}}function ka(t,d){if(t&1&&(r(0,"div",9)(1,"label",20)(2,"strong"),l(3),o()(),r(4,"div",11),p(5,Sa,4,3,"ng-container",21)(6,Fa,4,4,"ng-template",null,0,L),o()()),t&2){let e=d.$implicit,i=k(7),n=c();a(),S("for",e.id),a(2),f("",e.label,":"),a(2),s("ngIf",(n.resource==null?null:n.resource._resubmit)||!n.resource.accepted&&(n.identity==null?null:n.identity._id)===(n.resource==null||n.resource.author==null?null:n.resource.author._id))("ngIfElse",i)}}function Ta(t,d){t&1&&u(0,"img",44)}function Aa(t,d){if(t&1&&u(0,"img",45),t&2){let e=c(2).$implicit,i=c();S("src",i.url+"get-image-user/"+e.user.picture,N)}}function Ma(t,d){if(t&1&&(r(0,"div",39)(1,"a",40)(2,"div",41),p(3,Ta,1,0,"img",42)(4,Aa,1,1,"img",43),o()()()),t&2){let e=c().$implicit;a(),s("routerLink",b(3,xi,e.user._id)),a(2),s("ngIf",!e.user.picture),a(),s("ngIf",e.user.picture)}}function Pa(t,d){if(t&1&&(r(0,"div",46)(1,"h6",47)(2,"a",40)(3,"strong"),l(4),o()(),u(5,"br"),r(6,"small",48),l(7),E(8,"amFromUnix"),E(9,"amLocale"),E(10,"amDateFormat"),o()(),r(11,"p",49),l(12),o()()),t&2){let e=c().$implicit;a(2),s("routerLink",b(13,xi,e.user._id)),a(2),J(" ",e.user.name," ",e.user.surname," "),a(3),f(" ",F(10,10,F(9,7,q(8,5,e.created_at),"es"),"LLL")," "),a(5),f(" ",e.text," ")}}function Oa(t,d){if(t&1&&(r(0,"div",50)(1,"button",51),u(2,"i",13),l(3),o()()),t&2){let e=c().$implicit;a(3),f(" ",e.score," ")}}function Va(t,d){if(t&1&&(r(0,"div",35),p(1,Ma,5,5,"div",36)(2,Pa,13,15,"div",37)(3,Oa,4,1,"div",38),o()),t&2){let e=d.$implicit;a(),s("ngIf",e.user!=null),a(),s("ngIf",e.user!=null),a(),s("ngIf",e.user!=null)}}function Da(t,d){t&1&&(r(0,"span"),l(1,"Guardar y volver a sugerir"),o())}function Ra(t,d){t&1&&(r(0,"span"),u(1,"i",53),l(2," Guardando..."),o())}function Na(t,d){if(t&1){let e=x();r(0,"button",52),v("click",function(){g(e);let n=c();return h(n.saveAndResuggest())}),p(1,Da,2,0,"span",32)(2,Ra,3,0,"span",32),o()}if(t&2){let e=c();s("disabled",e.saving),a(),s("ngIf",!e.saving),a(),s("ngIf",e.saving)}}var bi=(()=>{class t{constructor(e,i){this._userService=e,this._resourceService=i,this.saving=!1,this.modalEventListeners=[],this.title="Agregar recurso",this.identity=this._userService.getIdentity(),this.token=this._userService.getToken(),this.url=V.url,this.fields=gi,this.types=rt}ngOnInit(){}saveAndResuggest(){if(!this.resource)return;this.saving=!0;let e=ye(Y({},this.resource),{accepted:!1,rejected:!1,visible:!1});this._resourceService.editResource(this.token,e).subscribe({next:i=>{this.saving=!1;try{this.resource.rejected=!1,this.resource.accepted=!1,delete this.resource._resubmit}catch{}alert("Cambios guardados. El recurso fue vuelto a sugerir."),this.closeModal()},error:()=>{this.saving=!1,alert("No se pudo guardar el recurso. Int\xE9ntalo de nuevo.")}})}ngAfterViewInit(){this.setupModalEvents()}ngOnDestroy(){this.modalEventListeners.forEach(e=>e())}setupModalEvents(){let e=document.getElementById("details");if(e){let i=()=>{setTimeout(()=>{},100)};e.addEventListener("hidden.bs.modal",i),this.modalEventListeners.push(()=>e.removeEventListener("hidden.bs.modal",i))}}getLink(e){return e.includes("http://")||e.includes("https://")?e:`http://${e}`}closeModal(){try{let e=document.getElementById("details");if(e){let i=window.bootstrap?.Modal?.getInstance(e);i?i.hide():window.bootstrap?.Modal?.getOrCreateInstance(e)?.hide()}}catch(e){console.log("Error al cerrar modal de detalles:",e)}}static{this.\u0275fac=function(i){return new(i||t)(y(T),y(Fe))}}static{this.\u0275cmp=P({type:t,selectors:[["details-resource"]],inputs:{resource:"resource"},standalone:!1,decls:32,vars:5,consts:[["readOnlyField",""],["id","details","tabindex","-1","aria-labelledby","detailsTitle","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog","modal-dialog-scrollable"],[1,"modal-content"],[1,"modal-header"],["id","detailsTitle",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],["class","row",4,"ngFor","ngForOf"],[1,"row"],[1,"col-3"],[1,"col"],[1,"btn","btn-sm","btn-warning"],[1,"fas","fa-star"],[1,"btn","btn-sm","btn-info"],[1,"fas","fa-download"],["class","row mt-2",4,"ngFor","ngForOf"],[1,"modal-footer"],["data-bs-dismiss","modal",1,"btn","btn-secondary"],["class","btn btn-primary","id","resubmitBtn",3,"disabled","click",4,"ngIf"],[1,"col-3",3,"for"],[4,"ngIf","ngIfElse"],["class","form-control mb-2",3,"ngModel","name","ngModelChange",4,"ngIf"],["class","form-select mb-2","name","type",3,"ngModel","ngModelChange",4,"ngIf"],["class","form-control mb-2","name","url",3,"ngModel","ngModelChange",4,"ngIf"],[1,"form-control","mb-2",3,"ngModelChange","ngModel","name"],["name","type",1,"form-select","mb-2",3,"ngModelChange","ngModel"],["value","document"],["value","video"],["value","link"],["value","software"],["name","url",1,"form-control","mb-2",3,"ngModelChange","ngModel"],[4,"ngIf"],["target","_blank",3,"href"],["target","_blank",1,"btn","btn-info",3,"title","href"],[1,"row","mt-2"],["class","col-auto",4,"ngIf"],["class","col bg-light rounded-left p-2",4,"ngIf"],["class","col-auto bg-light rounded-right p-2 me-3 align-items-center",4,"ngIf"],[1,"col-auto"],["data-bs-dismiss","modal",1,"text-primary",3,"routerLink"],[1,"flex-shrink-0","rounded-circle","border-1","overflow-hidden",2,"width","40px","height","40px"],["class","img-fluid","src","assets/images/user-default.png",4,"ngIf"],["class","img-fluid",3,"src",4,"ngIf"],["src","assets/images/user-default.png",1,"img-fluid"],[1,"img-fluid",3,"src"],[1,"col","bg-light","rounded-left","p-2"],[1,"mb-1"],[1,"text-muted"],[1,"card-text"],[1,"col-auto","bg-light","rounded-right","p-2","me-3","align-items-center"],[1,"btn","btn-warning","py-0","ms-1"],["id","resubmitBtn",1,"btn","btn-primary",3,"click","disabled"],[1,"fas","fa-spinner","fa-spin"]],template:function(i,n){i&1&&(r(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"h5",5),l(5,"Detalles del recurso"),o(),u(6,"button",6),o(),r(7,"div",7),p(8,ka,8,4,"div",8),r(9,"div",9)(10,"label",10)(11,"strong"),l(12,"Calificaci\xF3n:"),o()(),r(13,"div",11)(14,"p")(15,"button",12),u(16,"i",13),l(17),o()()()(),r(18,"div",9)(19,"label",10)(20,"strong"),l(21,"Descargas:"),o()(),r(22,"div",11)(23,"p")(24,"button",14),u(25,"i",15),l(26),o()()()(),p(27,Va,4,3,"div",16),o(),r(28,"div",17)(29,"button",18),l(30,"Cerrar"),o(),p(31,Na,3,3,"button",19),o()()()()),i&2&&(a(8),s("ngForOf",n.fields),a(9),f(" ",n.resource.score.toFixed(2)," "),a(9),f(" ",n.resource.downloads," "),a(),s("ngForOf",n.resource.comments),a(4),s("ngIf",(n.resource==null?null:n.resource._resubmit)||!n.resource.accepted&&(n.identity==null?null:n.identity._id)===(n.resource==null||n.resource.author==null?null:n.resource.author._id)))},dependencies:[$,O,le,de,j,se,K,Le,G,ce,me,pe],encapsulation:2})}}return t})();var Ci=t=>({display:t}),lt=t=>({"is-invalid":t});function Ua(t,d){if(t&1&&(r(0,"div",29),u(1,"i",30),l(2),o()),t&2){let e=c();a(2),f(" ",e.errorMsg," ")}}function Ba(t,d){if(t&1){let e=x();r(0,"div",31),u(1,"i",32),l(2),r(3,"div",33)(4,"button",34),v("click",function(){g(e);let n=c();return h(n.createAnotherResource())}),u(5,"i",35),l(6," Sugerir Otro Recurso "),o(),r(7,"button",36),v("click",function(){g(e);let n=c();return h(n.closeAndRefresh())}),u(8,"i",37),l(9," Cerrar "),o()()()}if(t&2){let e=c();a(2),f(" ",e.successMsg," ")}}function qa(t,d){if(t&1&&(r(0,"div",38),u(1,"i",32),l(2),o()),t&2){let e=c();a(2),f(" ",e.warningMsg," ")}}function ja(t,d){if(t&1&&(r(0,"div",39),u(1,"i",32),l(2),o()),t&2){let e=c();a(2),f(" ",e.deletedMsg," ")}}function Ka(t,d){t&1&&(r(0,"span"),l(1,"*"),o())}function za(t,d){if(t&1&&u(0,"input",48),t&2){let e=c().$implicit,i=c();S("id",e.id),S("formControlName",e.id),s("ngClass",b(3,lt,i.submitted&&i.f[e.id].errors))}}function Ga(t,d){if(t&1&&(r(0,"textarea",49),l(1,"                        "),o()),t&2){let e=c().$implicit,i=c();S("id",e.id),S("formControlName",e.id),s("ngClass",b(3,lt,i.submitted&&i.f[e.id].errors))}}function Ha(t,d){if(t&1&&(r(0,"option",52),l(1),o()),t&2){let e=d.$implicit;S("value",e.value),a(),f(" ",e.label,"")}}function Wa(t,d){if(t&1){let e=x();r(0,"select",50),v("input",function(){g(e);let n=c(2);return h(n.setDisabled())}),p(1,Ha,2,2,"option",51),o()}if(t&2){let e=c().$implicit,i=c();S("formControlName",e.id),S("id",e.id),s("ngClass",b(4,lt,i.submitted&&i.f[e.id].errors)),a(),s("ngForOf",e.options)}}function Ja(t,d){if(t&1){let e=x();r(0,"input",55),v("change",function(n){g(e);let m=c(3);return h(m.fileChangeEvent(n))}),o()}if(t&2){let e=c(2).$implicit,i=c();S("formControlName",e.id),S("id",e.id),s("ngClass",b(3,lt,i.submitted&&i.f[e.id].errors||i.maxSizeError))}}function Ya(t,d){if(t&1&&(r(0,"div",56)(1,"div",57,0),l(3),o()()),t&2){let e=c(3);a(),Pe("width",e.barWidth),a(2),w(e.barWidth)}}function Xa(t,d){if(t&1&&(r(0,"div"),l(1),o()),t&2){let e=c(4);a(),f(" El archivo es demasiado grande, el tama\xF1o maximo permitido es de ",e.MAX_FILE_SIZE,"MB. ")}}function Za(t,d){if(t&1&&(r(0,"div",58),p(1,Xa,2,1,"div",42),o()),t&2){let e=c(3);a(),s("ngIf",e.maxSizeError)}}function Qa(t,d){if(t&1&&(r(0,"div"),p(1,Ja,1,5,"input",53)(2,Ya,4,3,"div",54)(3,Za,2,1,"div",47),o()),t&2){let e=c().$implicit,i=c();a(),s("ngIf",e.type=="file"),a(),s("ngIf",i.filesToUpload!=null||i.barWidth!="0%"),a(),s("ngIf",i.maxSizeError&&e.id=="file")}}function es(t,d){if(t&1&&(r(0,"div"),l(1),o()),t&2){let e=c(2).$implicit;a(),f(" El campo ",e.label," es obligatorio. ")}}function ts(t,d){if(t&1&&(r(0,"div",58),p(1,es,2,1,"div",42),o()),t&2){let e=c().$implicit,i=c();a(),s("ngIf",i.f[e.id].errors.required)}}function is(t,d){if(t&1&&(r(0,"div",40)(1,"label",41)(2,"strong"),l(3),p(4,Ka,2,0,"span",42),o()(),r(5,"div",43),p(6,za,1,5,"input",44)(7,Ga,2,5,"textarea",45)(8,Wa,2,6,"select",46)(9,Qa,4,3,"div",42)(10,ts,2,1,"div",47),o()()),t&2){let e=d.$implicit,i=c();s("ngStyle",b(9,Ci,i.showSuccessActions?"none":"flex")),a(),S("for",e.id),a(2),w(e.label),a(),s("ngIf",e.required),a(2),s("ngIf",e.type=="text"),a(),s("ngIf",e.type==="textarea"),a(),s("ngIf",e.type=="select"),a(),s("ngIf",e.type=="file"),a(),s("ngIf",i.submitted&&i.f[e.id].errors)}}function ns(t,d){t&1&&u(0,"span",59)}var yi=(()=>{class t{constructor(e,i,n){this._userService=e,this._resourceService=i,this._uploadService=n,this.academicLevels=Object.entries(X).map(([m,_])=>({key:m,value:_})),this.successMsg="Se ha enviado la sugerencia para el nuevo recurso correctamente. Gracias por tu sugerencia. Si deseas, puedes enviar otra sugerencia",this.deletedMsg="Se ha cancelado correctamente la sugerencia. Puedes volver a enviar un recurso",this.MAX_FILE_SIZE=20,this.maxSize=20*1024*1024,this.maxSizeError=!1,this.barWidth="0%",this.resourceId="",this.showSuccessActions=!1,this.resourceSubmitted=new _e,this.title="Sugerir recurso",this.identity=this._userService.getIdentity(),this.token=this._userService.getToken(),this.url=V.url,this.fields=vi,this.errorMsg="Hubo un error al enviar la sugerencia para el nuevo recurso. Intentalo de nuevo m\xE1s tarde.",this.warningMsg="Se estan subiendo los archivos, por favor evita cerrar la ventana. ",this.addForm=new Ee({name:new I("",A.required),type:new I("",A.required),description:new I("",A.required),justification:new I("",A.required),source:new I("",A.required),file:new I("",A.required),url:new I("",A.required)})}ngOnInit(){this.closeBtn=document.getElementById("closeBtn")}ngAfterViewInit(){this.setupModalEvents()}setupModalEvents(){let e=document.getElementById("add");e&&(e.addEventListener("shown.bs.modal",()=>{e.removeAttribute("aria-hidden")}),e.addEventListener("hidden.bs.modal",()=>{e.setAttribute("aria-hidden","true")}),e.addEventListener("show.bs.modal",()=>{e.removeAttribute("aria-hidden")}))}get f(){return this.addForm.controls}restartValues(){this.status=null,this.showSuccessActions=!1,this.loading==!0&&this.cancelResource(),this.addForm.reset(),this.disableForm(!1),this.submitted=!1,this.maxSizeError=!1,this.barWidth="0%",(this.loading==!1||this.loading==null)&&this.closeModal()}closeModal(){try{let e=document.getElementById("add");if(e){let i=window.bootstrap?.Modal?.getInstance(e);i?i.hide():(this.closeBtn=document.getElementById("closeBtn"),this.closeBtn&&this.closeBtn.click())}}catch(e){console.log("Error al cerrar modal de sugerir:",e)}}createAnotherResource(){this.status=null,this.showSuccessActions=!1,this.addForm.reset(),this.disableForm(!1),this.submitted=!1,this.maxSizeError=!1,this.barWidth="0%",this.loading=!1}closeAndRefresh(){this.restartValues(),this.resourceSubmitted.emit(!0)}getValue(){return this.resourceId}setResId(e){this.resourceId=e}cancelResource(){return Ze(this,null,function*(){console.log("entr\xF3"),this.warningMsg="Se esta cancelando la sugerencia",this.status="warning",yield this.subscriptionFile$.unsubscribe(),console.log("subscrip",this.subscriptionFile$),yield this.subscriptionResource$.unsubscribe(),console.log("subscripReso",this.subscriptionResource$),yield this._resourceService.deleteResource(this.token,this.getValue()).subscribe(e=>{e&&e.resource&&(console.log("deleted?",e),this.status="deleted",this.warningMsg="Se estan subiendo los archivos, por favor evita cerrar la ventana. ",this.errorMsg="Hubo un error al enviar la sugerencia para el nuevo recurso. Intentalo de nuevo m\xE1s tarde.",this.loading=!1)},e=>{console.log(e),this.errorMsg="hubo un Error, por favor comunicate con el Administrador",this.status="error",this.loading=!1})})}disableForm(e){e==!0?(this.addForm.controls.name.disable(),this.addForm.controls.type.disable(),this.addForm.controls.description.disable(),this.addForm.controls.justification.disable(),this.addForm.controls.source.disable(),this.addForm.controls.file.disable()):(this.addForm.controls.name.enable(),this.addForm.controls.type.enable(),this.addForm.controls.description.enable(),this.addForm.controls.justification.enable(),this.addForm.controls.source.enable(),this.addForm.controls.file.enable())}setDisabled(){this.subscriptionDisable=this.addForm.get("type").valueChanges.subscribe(e=>{["video","document","software"].includes(e)?(this.addForm.controls.url.disable(),this.addForm.controls.url.setValue(""),this.addForm.controls.file.enable()):(this.addForm.controls.url.enable(),this.addForm.controls.file.setValue(""),this.filesToUpload=null,this.addForm.controls.file.disable())})}fileChangeEvent(e){if(this.filesToUpload=e.target.files,this.maxSize<e.target.files[0].size){this.maxSizeError=!0;return}this.maxSizeError=!1}onSubmit(){if(this.submitted=!0,this.loading=!0,this.addForm.invalid||this.maxSizeError){this.loading=!1;return}this.resource=new Xt(this.addForm.value.name,this.addForm.value.type,this.addForm.value.source,this.addForm.value.description,this.identity._id),this.resource.justification=this.addForm.value.justification,this.resource.url=this.addForm.value.url,this.resource.accepted=!1,this.subscriptionResource$=this._resourceService.addResource(this.token,this.resource).subscribe(e=>{e.resource&&e.resource._id?(this.setResId(e.resource._id),this.filesToUpload?this.filesToUpload.length>0?(this.disableForm(!0),this.subscriptionFile$=this._uploadService.makeFileRequest(this.url+"upload-resource/"+e.resource._id,[],this.filesToUpload,this.token,"file").subscribe(i=>{switch(i.type){case Ve.UploadProgress:this.status="warning",this.barWidth=Math.round(i.loaded/i.total*100).toString()+"%";break;case Ve.Response:this.status="success",this.disableForm(!1),this.barWidth="0%",this.loading=!1,this.showSuccessActions=!0}},i=>{this.status="error",this.barWidth="0%",this.loading=!1,console.log(i)})):(this.status="error",this.barWidth="0%",this.loading=!1):(this.status="success",this.loading=!1,this.showSuccessActions=!0)):(this.status="error",this.barWidth="0%",this.loading=!1)},e=>{this.status="error",this.barWidth="0%",this.loading=!1,console.log(e)}),document.querySelector(".modal-body").scrollTop=0,this.submitted=!1}onChanges(){console.log("btn: ",this.closeBtn),this.loading==!1&&(console.log("changes"),this.status=null,this.addForm.valueChanges.subscribe(e=>{e&&(this.status=null,this.barWidth="0%",this.submitted=!1)}))}convertAcademicLevelValuesToKeys(e){return Object.entries(X).filter(([i,n])=>e.includes(n)).map(([i,n])=>i)}static{this.\u0275fac=function(i){return new(i||t)(y(T),y(Fe),y(it))}}static{this.\u0275cmp=P({type:t,selectors:[["suggest"]],outputs:{resourceSubmitted:"resourceSubmitted"},standalone:!1,decls:40,vars:11,consts:[["progress",""],["id","add","tabindex","-1","aria-labelledby","addTitle","aria-hidden","true","data-bs-backdrop","static","data-bs-keyboard","false",1,"modal","fade"],["id","modalD",1,"modal-dialog","modal-lg","modal-dialog-scrollable"],["enctype","multipart/form-data",1,"modal-content",3,"ngSubmit","input","formGroup"],[1,"modal-header"],["id","addTitle",1,"modal-title"],["type","button","id","closeBtn","data-bs-dismiss","modal",1,"buttonClose",2,"display","none"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],["class","alert alert-danger fade show text-center","role","alert",4,"ngIfSuccessMessage","ngIf"],["class","alert alert-success fade show text-center","role","alert",4,"ngIf"],["class","alert alert-warning fade show text-center","role","alert",4,"ngIfSuccessMessage","ngIf"],["class","alert alert-info fade show text-center","role","alert",4,"ngIfSuccessMessage","ngIf"],["class","mb-3 row",3,"ngStyle",4,"ngFor","ngForOf"],[1,"modal-footer",3,"ngStyle"],["data-bs-toggle","modal","data-bs-target","#cancelModal"],["type","button",1,"btn","btn-danger"],["type","submit",1,"btn","btn-success",3,"disabled"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],[1,"visually-hidden"],["id","cancelModal","tabindex","-1","role","dialog","aria-labelledby","cancelBtn","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-dialog-centered"],[1,"modal-content"],["id","cancelUpload",1,"modal-title"],["role","alert",1,"alert","alert-warning","mb-0"],[1,"fas","fa-exclamation-triangle","icon-message","me-2"],[1,"modal-footer"],["data-bs-dismiss","modal",1,"btn","btn-danger",3,"click"],["data-bs-dismiss","modal",1,"btn","btn-primary","text-white"],["role","alert",1,"alert","alert-danger","fade","show","text-center"],[1,"fas","fa-times-circle","icon-message","me-2"],["role","alert",1,"alert","alert-success","fade","show","text-center"],[1,"fas","fa-check-circle","icon-message","me-2"],[1,"mt-3","d-flex","justify-content-center","gap-2"],["type","button",1,"btn","btn-primary",3,"click"],[1,"fas","fa-plus"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"fas","fa-times"],["role","alert",1,"alert","alert-warning","fade","show","text-center"],["role","alert",1,"alert","alert-info","fade","show","text-center"],[1,"mb-3","row",3,"ngStyle"],[1,"col-3","col-form-label",3,"for"],[4,"ngIf"],[1,"col-9"],["type","text","class","form-control","autocomplete","off",3,"id","formControlName","ngClass",4,"ngIf"],["class","form-control","rows","3",3,"id","formControlName","ngClass",4,"ngIf"],["class","form-control",3,"formControlName","id","ngClass","input",4,"ngIf"],["class","invalid-feedback",4,"ngIf"],["type","text","autocomplete","off",1,"form-control",3,"id","formControlName","ngClass"],["rows","3",1,"form-control",3,"id","formControlName","ngClass"],[1,"form-control",3,"input","formControlName","id","ngClass"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["type","file","class","form-control","name","file",3,"formControlName","id","ngClass","change",4,"ngIf"],["class","progress",4,"ngIf"],["type","file","name","file",1,"form-control",3,"change","formControlName","id","ngClass"],[1,"progress"],["role","progressbar","aria-valuenow","barWidth","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","progress-bar-striped","progress-bar-animated"],[1,"invalid-feedback"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"]],template:function(i,n){i&1&&(r(0,"div",1)(1,"div",2)(2,"form",3),v("ngSubmit",function(){return n.onSubmit()})("input",function(){return n.onChanges()}),r(3,"div",4)(4,"h5",5),l(5,"Sugerir un recurso para el repositorio"),o(),r(6,"button",6),l(7," Close"),o(),u(8,"button",7),o(),r(9,"div",8),p(10,Ua,3,1,"div",9)(11,Ba,10,1,"div",10)(12,qa,3,1,"div",11)(13,ja,3,1,"div",12)(14,is,11,11,"div",13),o(),r(15,"div",14)(16,"div",15)(17,"button",16),l(18,"Cancelar"),o()(),r(19,"button",17),p(20,ns,1,0,"span",18),r(21,"span",19),l(22,"Enviar"),o(),l(23," Enviar "),o()()()()(),r(24,"div",20)(25,"div",21)(26,"div",22)(27,"div",4)(28,"h5",23),l(29,"Cancelar sugerencia de recurso para el Repositorio"),o(),u(30,"button",7),o(),r(31,"div",8)(32,"div",24),u(33,"i",25),l(34," \xBFEstas seguro que quieres cancelar la carga del recurso? Si continuas se eliminar\xE1 la sugerencia "),o()(),r(35,"div",26)(36,"button",27),v("click",function(){return n.restartValues()}),l(37,"S\xED"),o(),r(38,"button",28),l(39,"No"),o()()()()()),i&2&&(a(2),s("formGroup",n.addForm),a(8),s("ngIf",n.status==="error"),a(),s("ngIf",n.status==="success"&&n.showSuccessActions),a(),s("ngIf",n.status==="warning"),a(),s("ngIf",n.status==="deleted"),a(),s("ngForOf",n.fields),a(),s("ngStyle",b(9,Ci,n.showSuccessActions?"none":"flex")),a(4),s("disabled",n.loading),a(),s("ngIf",n.loading&&!n.addForm.invalid))},dependencies:[he,$,O,Oe,ee,le,de,j,se,K,Q,xe,be],encapsulation:2})}}return t})();var rs=t=>({"is-invalid":t});function as(t,d){if(t&1&&(r(0,"div",32),u(1,"i",33),l(2),o()),t&2){let e=c();a(2),f(" ",e.errorMsg," ")}}function ss(t,d){if(t&1&&(r(0,"div",34),u(1,"i",35),l(2),o()),t&2){let e=c();a(2),f(" ",e.successMsg," ")}}function ls(t,d){t&1&&u(0,"img",36)}function ds(t,d){if(t&1&&u(0,"img",37),t&2){let e=c();S("src",e.url+"get-image-user/"+e.identity.picture,N)}}function cs(t,d){t&1&&(r(0,"div",40),l(1," Debes elegir el n\xFAmero de estrellas para calificar el recurso. "),o())}function ms(t,d){if(t&1&&(r(0,"div",38),p(1,cs,2,0,"div",39),o()),t&2){let e=c();a(),s("ngIf",e.ratingForm.controls.rating.errors.required)}}var Si=(()=>{class t{constructor(e,i,n){this._userService=e,this._resourceService=i,this._commentService=n,this.rated=new _e,this.submitted=!1,this.modalEventListeners=[],this.isClosingFromEvent=!1,this.title="Calificar recurso",this.url=V.url,this.identity=this._userService.getIdentity(),this.token=this._userService.getToken(),this.errorMsg="Hubo un error al guardar la calificaci\xF3n del recurso. Intentalo de nuevo m\xE1s tarde.",this.successMsg="Se ha enviado la calificaci\xF3n correctamente. Muchas gracias por participar.",this.ratingForm=new Mt({rating:new He("",A.required),text:new He("")})}ngOnInit(){}ngAfterViewInit(){this.setupModalEvents()}ngOnDestroy(){this.modalEventListeners.forEach(e=>e())}setupModalEvents(){let e=document.getElementById("rating");if(e){let i=()=>{this.restartValues()};e.addEventListener("hidden.bs.modal",i),this.modalEventListeners.push(()=>e.removeEventListener("hidden.bs.modal",i))}}restartValues(){this.status=null,this.submitted=!1,this.ratingForm.reset(),this.isClosingFromEvent||this.rated.emit()}closeModal(){try{let e=document.getElementById("rating");if(e){let i=window.bootstrap?.Modal?.getInstance(e);i?(this.isClosingFromEvent=!0,i.hide(),setTimeout(()=>{this.isClosingFromEvent=!1},300)):(this.isClosingFromEvent=!0,window.bootstrap?.Modal?.getOrCreateInstance(e)?.hide(),setTimeout(()=>{this.isClosingFromEvent=!1},300))}}catch(e){console.log("Error al cerrar modal de rating:",e),this.isClosingFromEvent=!1}}onSubmit(){return Ze(this,null,function*(){if(this.submitted=!0,!this.ratingForm.invalid){this.comment=new Wt(this.ratingForm.value.text,this.identity._id),this.comment.score=this.ratingForm.value.rating;try{let e=yield this._commentService.addComment(this.token,this.comment).toPromise();e&&e.comment._id?(this.resource.score==0?this.resource.score+=e.comment.score:(this.resource.score+=e.comment.score,this.resource.score/=2),this.resource.comments.push(e.comment._id),this._resourceService.editResource(this.token,this.resource).subscribe({next:i=>{i&&i.resource._id&&(this.status="success",setTimeout(()=>{this.closeModal()},2e3))},error:i=>{this.status="error",console.error(i)}})):this.status="error"}catch(e){this.status="error",console.error(e)}this.submitted=!1}})}static{this.\u0275fac=function(i){return new(i||t)(y(T),y(Fe),y(ot))}}static{this.\u0275cmp=P({type:t,selectors:[["rating-resource"]],inputs:{resource:"resource"},outputs:{rated:"rated"},standalone:!1,decls:39,vars:10,consts:[["id","rating","tabindex","-1","aria-labelledby","ratingTitle","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog","modal-dialog-centered"],[1,"modal-content",3,"ngSubmit","formGroup"],[1,"modal-header"],["id","ratingTitle",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close",3,"click"],[1,"text-center","modal-body"],["class","alert alert-danger fade show text-center","role","alert",4,"ngIf"],["class","alert alert-success fade show text-center","role","alert",4,"ngIf"],["aria-label","Calificaci\xF3n por estrellas",1,"my-2","clasificacion"],["id","res-rate-5","type","radio","name","rating","value","5","formControlName","rating"],["for","res-rate-5","title","5.0","aria-label","5.0"],[1,"fas","fa-star","icon-message"],["id","res-rate-4","type","radio","name","rating","value","4","formControlName","rating"],["for","res-rate-4","title","4.0","aria-label","4.0"],["id","res-rate-3","type","radio","name","rating","value","3","formControlName","rating"],["for","res-rate-3","title","3.0","aria-label","3.0"],["id","res-rate-2","type","radio","name","rating","value","2","formControlName","rating"],["for","res-rate-2","title","2.0","aria-label","2.0"],["id","res-rate-1","type","radio","name","rating","value","1","formControlName","rating"],["for","res-rate-1","title","1.0","aria-label","1.0"],[1,"form-group","row","mt-3"],[1,"col-2","align-items-center"],[1,"flex-shrink-0","rounded-circle","border-1","overflow-hidden","me-2",2,"width","40px","height","40px"],["class","img-fluid","src","assets/images/user-default.png",4,"ngIf"],["class","img-fluid",3,"src",4,"ngIf"],[1,"col","ps-0","align-items-center"],["formControlName","text","rows","2","placeholder","Escribe un comentario sobre el recurso...",1,"form-control",3,"ngClass"],["class","invalid-feedback",4,"ngIf"],[1,"modal-footer"],["type","submit",1,"btn","btn-warning"],["data-bs-dismiss","modal",1,"btn","btn-secondary",3,"click"],["role","alert",1,"alert","alert-danger","fade","show","text-center"],[1,"fas","fa-times-circle","icon-message","me-2"],["role","alert",1,"alert","alert-success","fade","show","text-center"],[1,"fas","fa-check-circle","icon-message","me-2"],["src","assets/images/user-default.png",1,"img-fluid"],[1,"img-fluid",3,"src"],[1,"invalid-feedback"],["class","text-start",4,"ngIf"],[1,"text-start"]],template:function(i,n){i&1&&(r(0,"div",0)(1,"div",1)(2,"form",2),v("ngSubmit",function(){return n.onSubmit()}),r(3,"div",3)(4,"h5",4),l(5),o(),r(6,"button",5),v("click",function(){return n.restartValues()}),o()(),r(7,"div",6),p(8,as,3,1,"div",7)(9,ss,3,1,"div",8),r(10,"div",9),u(11,"input",10),r(12,"label",11),u(13,"i",12),o(),u(14,"input",13),r(15,"label",14),u(16,"i",12),o(),u(17,"input",15),r(18,"label",16),u(19,"i",12),o(),u(20,"input",17),r(21,"label",18),u(22,"i",12),o(),u(23,"input",19),r(24,"label",20),u(25,"i",12),o()(),r(26,"div",21)(27,"div",22)(28,"div",23),p(29,ls,1,0,"img",24)(30,ds,1,1,"img",25),o()(),r(31,"div",26),u(32,"textarea",27),p(33,ms,2,1,"div",28),o()(),r(34,"div",29)(35,"button",30),l(36,"Enviar calificaci\xF3n"),o(),r(37,"button",31),v("click",function(){return n.restartValues()}),l(38,"Cerrar"),o()()()()()()),i&2&&(a(2),s("formGroup",n.ratingForm),a(3),w(n.title),a(3),s("ngIf",n.status==="error"),a(),s("ngIf",n.status==="success"),a(20),s("ngIf",!n.identity.picture),a(),s("ngIf",n.identity.picture),a(2),s("ngClass",b(8,rs,n.submitted&&n.ratingForm.controls.rating.errors)),a(),s("ngIf",n.submitted&&n.ratingForm.controls.rating.errors))},dependencies:[he,O,ee,j,Pt,K,Q,xe,be],styles:["label[_ngcontent-%COMP%]{color:#95a5a6}input[type=radio][_ngcontent-%COMP%]{display:none}.clasificacion[_ngcontent-%COMP%]{direction:rtl;unicode-bidi:bidi-override}label[_ngcontent-%COMP%]:hover{color:#f39c12}label[_ngcontent-%COMP%]:hover ~ label[_ngcontent-%COMP%]{color:#f39c12}input[type=radio][_ngcontent-%COMP%]:checked ~ label[_ngcontent-%COMP%]{color:orange}",".clasificacion[_ngcontent-%COMP%]{display:inline-flex;flex-direction:row;gap:6px;direction:rtl;unicode-bidi:bidi-override}.clasificacion[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}.clasificacion[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{cursor:pointer;padding:6px;border-radius:6px;background-color:transparent;transition:background-color .15s ease-in-out,transform .05s ease-in-out}.clasificacion[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:hover, .clasificacion[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:hover ~ label[_ngcontent-%COMP%]{background-color:#000}.clasificacion[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%], .clasificacion[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%] ~ label[_ngcontent-%COMP%]{background-color:#000}.clasificacion[_ngcontent-%COMP%]   i.fas[_ngcontent-%COMP%]{color:#ffc107;font-size:1.25rem}"]})}}return t})();var dt=t=>["/perfil",t],wi=t=>["/admin/recursos",t];function us(t,d){t&1&&(r(0,"button",9),u(1,"i",10),r(2,"span",11),l(3,"Sugerir recurso"),o()())}function _s(t,d){t&1&&(r(0,"div",12)(1,"div",13)(2,"div",14)(3,"span",15),l(4,"Loading..."),o()()()())}function fs(t,d){t&1&&(r(0,"div",12)(1,"h4",16),l(2," No se han publicado recursos. "),o()())}function vs(t,d){if(t&1){let e=x();r(0,"div",30)(1,"div",31)(2,"input",32),v("click",function(){let n=g(e).$implicit,m=c(2);return h(m.setType(n.value))}),o(),r(3,"label",33),l(4),o()()()}if(t&2){let e=d.$implicit;a(2),S("id",e.value),a(),S("for",e.value),a(),f(" ",e.label," ")}}function gs(t,d){if(t&1){let e=x();r(0,"div",34)(1,"label",35)(2,"small",16),l(3,"Ordenar por:"),o()(),r(4,"div",36)(5,"select",37),v("change",function(){g(e);let n=c(2);return h(n.reloadResources())}),r(6,"option",38),l(7,"M\xE1s descargados"),o(),r(8,"option",39),l(9," M\xE1s populares"),o()()()()}if(t&2){let e=c(2);a(5),s("formControl",e.orderControl)}}function hs(t,d){t&1&&(r(0,"span",68),u(1,"i",69),l(2," Pendiente de aprobaci\xF3n "),o())}function xs(t,d){t&1&&(r(0,"span",70),u(1,"i",71),l(2," Aprobado "),o())}function bs(t,d){t&1&&u(0,"img",72)}function Cs(t,d){if(t&1&&u(0,"img",73),t&2){let e=c().$implicit,i=c(3);S("src",i.url+"get-image-user/"+e.author.picture,N)}}function ys(t,d){if(t&1){let e=x();D(0),r(1,"button",74),v("click",function(){g(e);let n=c().$implicit,m=c(3);return n.accepted&&m.goToUrl(n.url),h(n.accepted&&m.increaseDownloads(n))}),u(2,"i",75),o(),R()}if(t&2){let e=c().$implicit;a(),s("title",e.accepted?"Ir al enlace":"Recurso pendiente de aprobaci\xF3n")("disabled",!e.accepted)}}function Ss(t,d){if(t&1){let e=x();r(0,"a",76),v("click",function(){g(e);let n=c().$implicit,m=c(3);return h(n.accepted&&m.increaseDownloads(n))}),u(1,"i",51),o()}if(t&2){let e=c().$implicit,i=c(3);we("disabled",!e.accepted),s("title",e.accepted?"Descargar recurso: "+e.file:"Recurso pendiente de aprobaci\xF3n")("href",e.accepted?i.url+"get-resource/"+e.file:"#",N)("target",e.accepted?"_blank":"")}}function ws(t,d){if(t&1){let e=x();r(0,"div")(1,"div",1)(2,"div",12)(3,"div",41)(4,"div",42)(5,"div",43)(6,"div",42)(7,"div",23)(8,"div",44),u(9,"i",45),o()()(),r(10,"div",46)(11,"div",47)(12,"button",48),u(13,"i",49),l(14),o(),r(15,"button",50)(16,"span"),u(17,"i",51),r(18,"span"),l(19),o()()()()()(),r(20,"div",23)(21,"h5",52)(22,"strong"),l(23),o(),p(24,hs,3,0,"span",53)(25,xs,3,0,"span",54),o(),r(26,"p"),l(27),o(),r(28,"p")(29,"strong"),l(30,"Subido por:"),o()(),r(31,"div",42)(32,"div",55)(33,"a",56)(34,"div",57)(35,"a",58),p(36,bs,1,0,"img",59)(37,Cs,1,1,"img",60),o()()()(),r(38,"div",61)(39,"h6",62)(40,"a",63)(41,"strong"),l(42),o()(),u(43,"br"),r(44,"small",16),l(45),E(46,"amFromUnix"),E(47,"amLocale"),E(48,"amDateFormat"),o()()()()(),r(49,"div",43)(50,"div",42)(51,"div",23)(52,"button",64),v("click",function(){let n=g(e).$implicit,m=c(3);return h(m.openDetailsModal(n))}),u(53,"i",65),o(),r(54,"button",66),v("click",function(){let n=g(e).$implicit,m=c(3);return h(m.openRatingModal(n))}),u(55,"i",49),o(),p(56,ys,3,2,"ng-container",67)(57,Ss,2,5,"ng-template",null,0,L),o()()()()()()()()}if(t&2){let e=d.$implicit,i=k(58),n=c(3);a(8),W("text-center p-2 rounded-lg border border-ligth ",n.iconResource[e.type].class,""),a(),W("text-white fas ",n.iconResource[e.type].icon,""),a(5),f(" ",e.score.toFixed(2)," "),a(5),f(" ",e.downloads,""),a(4),w(e.name),a(),s("ngIf",!e.accepted&&e.author._id===n.identity._id),a(),s("ngIf",e.accepted&&e.visible&&e.author._id===n.identity._id),a(2),w(e.description),a(8),s("routerLink",b(31,dt,e.author._id)),a(),s("ngIf",!e.author.picture),a(),s("ngIf",e.author.picture),a(3),s("routerLink",b(33,dt,e.author._id)),a(2),J(" ",e.author.name," ",e.author.surname," "),a(3),w(F(48,28,F(47,25,q(46,23,e.created_at),"es"),"LLL")),a(9),s("title",e.accepted?"Calificar recurso":"Recurso pendiente de aprobaci\xF3n")("disabled",!e.accepted),a(2),s("ngIf",e.type=="link")("ngIfElse",i)}}function Es(t,d){if(t&1&&(r(0,"div"),p(1,ws,59,35,"div",40),o()),t&2){let e=c(2);a(),s("ngForOf",e.resources)}}function Is(t,d){t&1&&(r(0,"span",68),u(1,"i",69),l(2," Pendiente de aprobaci\xF3n "),o())}function Ls(t,d){t&1&&(r(0,"span",70),u(1,"i",71),l(2," Aprobado "),o())}function Fs(t,d){t&1&&u(0,"img",72)}function ks(t,d){if(t&1&&u(0,"img",73),t&2){let e=c().$implicit,i=c(3);S("src",i.url+"get-image-user/"+e.author.picture,N)}}function Ts(t,d){if(t&1){let e=x();D(0),r(1,"button",74),v("click",function(){g(e);let n=c().$implicit,m=c(3);return n.accepted&&m.goToUrl(n.url),h(n.accepted&&m.increaseDownloads(n))}),u(2,"i",75),o(),R()}if(t&2){let e=c().$implicit;a(),s("title",e.accepted?"Ir al enlace":"Recurso pendiente de aprobaci\xF3n")("disabled",!e.accepted)}}function As(t,d){if(t&1){let e=x();r(0,"a",76),v("click",function(){g(e);let n=c().$implicit,m=c(3);return h(n.accepted&&m.increaseDownloads(n))}),u(1,"i",51),o()}if(t&2){let e=c().$implicit,i=c(3);we("disabled",!e.accepted),s("title",e.accepted?"Descargar recurso: "+e.file:"Recurso pendiente de aprobaci\xF3n")("href",e.accepted?i.url+"get-resource/"+e.file:"#",N)("target",e.accepted?"_blank":"")}}function Ms(t,d){if(t&1){let e=x();r(0,"div")(1,"div",1)(2,"div",12)(3,"div",41)(4,"div",42)(5,"div",43)(6,"div",42)(7,"div",23)(8,"div",44),u(9,"i",45),o()()(),r(10,"div",46)(11,"div",47)(12,"button",48),u(13,"i",49),l(14),o(),r(15,"button",50)(16,"span"),u(17,"i",51),r(18,"span"),l(19),o()()()()()(),r(20,"div",23)(21,"h5",52)(22,"strong"),l(23),o(),p(24,Is,3,0,"span",53)(25,Ls,3,0,"span",54),o(),r(26,"p"),l(27),o(),r(28,"p")(29,"strong"),l(30,"Subido por:"),o()(),r(31,"div",42)(32,"div",55)(33,"a",56)(34,"div",57)(35,"a",58),p(36,Fs,1,0,"img",59)(37,ks,1,1,"img",60),o()()()(),r(38,"div",61)(39,"h6",62)(40,"a",63)(41,"strong"),l(42),o()(),u(43,"br"),r(44,"small",16),l(45),E(46,"amFromUnix"),E(47,"amLocale"),E(48,"amDateFormat"),o()()()()(),r(49,"div",43)(50,"div",42)(51,"div",23)(52,"button",64),v("click",function(){let n=g(e).$implicit,m=c(3);return h(m.openDetailsModal(n))}),u(53,"i",65),o(),r(54,"button",66),v("click",function(){let n=g(e).$implicit,m=c(3);return h(m.openRatingModal(n))}),u(55,"i",49),o(),p(56,Ts,3,2,"ng-container",67)(57,As,2,5,"ng-template",null,0,L),o()()()()()()()()}if(t&2){let e=d.$implicit,i=k(58),n=c(3);a(8),W("text-center p-2 rounded-lg border border-ligth ",n.iconResource[e.type].class,""),a(),W("text-white fas ",n.iconResource[e.type].icon,""),a(5),f(" ",e.score.toFixed(2)," "),a(5),f(" ",e.downloads,""),a(4),w(e.name),a(),s("ngIf",!e.accepted&&e.author._id===n.identity._id),a(),s("ngIf",e.accepted&&e.visible&&e.author._id===n.identity._id),a(2),w(e.description),a(8),s("routerLink",b(31,dt,e.author._id)),a(),s("ngIf",!e.author.picture),a(),s("ngIf",e.author.picture),a(3),s("routerLink",b(33,dt,e.author._id)),a(2),J(" ",e.author.name," ",e.author.surname," "),a(3),w(F(48,28,F(47,25,q(46,23,e.created_at),"es"),"LLL")),a(9),s("title",e.accepted?"Calificar recurso":"Recurso pendiente de aprobaci\xF3n")("disabled",!e.accepted),a(2),s("ngIf",e.type=="link")("ngIfElse",i)}}function Ps(t,d){if(t&1&&(r(0,"div"),p(1,Ms,59,35,"div",40),E(2,"filter"),o()),t&2){let e=c(2);a(),s("ngForOf",F(2,1,e.allResources,e.filter.value))}}function Os(t,d){if(t&1&&(r(0,"li",80)(1,"a",81),l(2,"Anterior"),o()()),t&2){let e=c(3);a(),s("routerLink",b(1,wi,e.prevPage))}}function Vs(t,d){if(t&1&&(r(0,"li",80)(1,"a",82),l(2,"Siguiente"),o()()),t&2){let e=c(3);a(),s("routerLink",b(1,wi,e.nextPage))}}function Ds(t,d){if(t&1&&(r(0,"nav",77)(1,"ul",78),p(2,Os,3,3,"li",79)(3,Vs,3,3,"li",79),o()()),t&2){let e=c(2);a(2),s("ngIf",e.page>1),a(),s("ngIf",e.page<e.pages&&e.page!=e.pages)}}function Rs(t,d){if(t&1&&(r(0,"div",12)(1,"form",17)(2,"h6",18),u(3,"i",19),l(4," Tipos de recursos "),o(),r(5,"div",20),p(6,vs,5,3,"div",21),o()(),r(7,"div",22)(8,"div",23)(9,"form")(10,"div",24)(11,"span",25),l(12,"Filtrar:"),o(),u(13,"input",26),o()()()(),p(14,gs,10,1,"div",27)(15,Es,2,1,"div",28)(16,Ps,3,4,"div",28)(17,Ds,4,2,"nav",29),o()),t&2){let e=c();a(6),s("ngForOf",e.types),a(7),s("formControl",e.filter),a(),s("ngIf",e.filter.value||e.selectedTypes.length>0),a(),s("ngIf",!e.filter.value&&e.selectedTypes.length==0),a(),s("ngIf",e.filter.value||e.selectedTypes.length>0),a(),s("ngIf",!e.filter.value&&e.selectedTypes.length==0)}}function Ns(t,d){if(t&1&&u(0,"details-resource",83),t&2){let e=c();s("resource",e.detailsResourceItem)}}function $s(t,d){if(t&1){let e=x();r(0,"rating-resource",84),v("rated",function(n){g(e);let m=c();return h(m.setNeedReload(n))}),o()}if(t&2){let e=c();s("resource",e.ratingResourceItem)}}var Ct=(()=>{class t{constructor(e,i,n,m){this._userService=e,this._resourceService=i,this._router=n,this._route=m,this.allResources=[],this.resources=[],this.iconResource=rt,this.visible=new I,this.selectedTypes=[],this.selectedOrder=[],this.loading=!0,this.resubmitRequested=!1,this.title="Repositorio",this.url=V.url,this.token=this._userService.getToken(),this.identity=this._userService.getIdentity(),this.areas=localStorage.getItem("areas"),this.types=hi,this.orderControl=new I(""),this.filter=new I("")}ngOnInit(){this.getAllResources(),this.actualPage(),this._route.queryParams.subscribe(e=>{let i=e.resourceId;if(this.resubmitRequested=e.resubmit==="true"||e.resubmit===!0,i){let n=()=>{let _=[...this.allResources||[],...this.resources||[]].find(C=>C&&C._id===i);return _?(this.resubmitRequested&&(_._resubmit=!0),this.openDetailsModal(_),!0):!1};setTimeout(()=>{n()||setTimeout(()=>n(),300)},0)}})}ngDoCheck(){this.needReloadData&&(this.actualPage(),this.needReloadData=!1)}setOrder(){if(this.orderControl){if(this.orderControl.value=="downloads")return"downloads";if(this.orderControl.value=="score")return"score"}return""}getAllResources(){let e=[],i=this.setOrder();this._resourceService.getAllResources(this.token,i,!0).subscribe(n=>{n.resources&&(this.allResources=n.resources,this.selectedTypes.length>0&&(this.selectedTypes.forEach(m=>{e=e.concat(this.allResources.filter(_=>_.type==m))}),this.allResources=e))},n=>{console.log(n)})}getResources(e=1){this._resourceService.getResources(this.token,e,!0).subscribe(i=>{i.resources&&(this.resources=i.resources,this.total=i.total,this.pages=i.pages,e>this.pages&&this._router.navigate(["/inicio/recursos"]),this.loading=!1)},i=>{console.log(i)})}actualPage(){this._route.params.subscribe(e=>{let i=+e.page;this.page=i,i?(this.nextPage=i+1,this.prevPage=i-1,this.prevPage<=0&&(this.prevPage=1)):(this.page=1,this.nextPage=this.page+1),this.getResources(this.page)})}setType(e){this.selectedTypes.indexOf(e)>=0?this.selectedTypes.splice(this.selectedTypes.indexOf(e),1):this.selectedTypes.push(e),this.getAllResources()}reloadResources(){this.getAllResources()}goToUrl(e){e.includes("http://")||e.includes("https://")?window.open(e,"_blank"):window.open(`http://${e}`,"_blank")}setDetailResource(e){this.detailsResourceItem=e}setRatingResource(e){this.ratingResourceItem=e}openDetailsModal(e){this.setDetailResource(e),setTimeout(()=>{try{let i=document.getElementById("details");if(i){let n=window.bootstrap?.Modal?.getInstance(i);n&&n.dispose(),new window.bootstrap.Modal(i,{backdrop:"static",keyboard:!1}).show()}}catch(i){console.log("Error al abrir modal de detalles:",i),alert(`Detalles del recurso: ${e.name}
Descripci\xF3n: ${e.description}`)}},0)}openRatingModal(e){if(!e.accepted){alert("Este recurso est\xE1 pendiente de aprobaci\xF3n y no se puede calificar a\xFAn.");return}this.setRatingResource(e),setTimeout(()=>{try{let i=document.getElementById("rating");if(i){let n=window.bootstrap?.Modal?.getInstance(i);n&&n.dispose(),new window.bootstrap.Modal(i,{backdrop:"static",keyboard:!1}).show()}}catch(i){console.log("Error al abrir modal de rating:",i),alert("Error al abrir el modal de calificaci\xF3n. Intenta recargar la p\xE1gina.")}},0)}setNeedReload(e){this.needReloadData=!0}onResourceSubmitted(e){this.getAllResources(),this.actualPage()}increaseDownloads(e){e.downloads+=1,this._resourceService.editResource(this.token,e).subscribe(i=>{i&&i.resource._id&&this.getResources(this.page)},i=>{console.log(i)})}static{this.\u0275fac=function(i){return new(i||t)(y(T),y(Fe),y(z),y(te))}}static{this.\u0275cmp=P({type:t,selectors:[["resources"]],standalone:!1,decls:11,vars:7,consts:[["getResource",""],[1,"card"],[1,"card-header"],[1,"m-0","text-primary","fw-bolder","float-start"],["type","button","class","btn btn-primary float-end","data-bs-toggle","modal","data-bs-target","#add",4,"ngIf"],["class","card-body",4,"ngIf"],[3,"resourceSubmitted"],[3,"resource",4,"ngIf"],[3,"resource","rated",4,"ngIf"],["type","button","data-bs-toggle","modal","data-bs-target","#add",1,"btn","btn-primary","float-end"],[1,"fas","fa-plus"],[1,"ms-2"],[1,"card-body"],[1,"text-muted","text-center"],["role","status",1,"spinner-border",2,"width","3rem","height","3rem"],[1,"visually-hidden"],[1,"text-muted"],[1,"categories-form"],[1,"categories-section-title"],[1,"fas","fa-folder-open"],[1,"categories-container"],["class","category-item",4,"ngFor","ngForOf"],[1,"form-group","row","mb-1"],[1,"col"],[1,"input-group","mb-2"],[1,"input-group-text"],["type","text","id","filter","placeholder","Filtro","autocomplete","off",1,"form-control",3,"formControl"],["class","form-group row mb-3",4,"ngIf"],[4,"ngIf"],["class","mt-3","aria-label","Page navigation",4,"ngIf"],[1,"category-item"],[1,"form-check"],["type","checkbox",1,"form-check-input",3,"click","id"],[1,"form-check-label",3,"for"],[1,"form-group","row","mb-3"],["for","order",1,"col-3","offset-6","col-form-label","text-end"],[1,"col-3"],["id","orderOptions",1,"form-control",3,"change","formControl"],["value","downloads"],["value","score"],[4,"ngFor","ngForOf"],[1,"media-body"],[1,"row"],[1,"col-auto"],[2,"width","80px","height","80px","overflow","hidden"],[2,"font-size","62px"],[1,"row","mt-1"],[1,"col-12"],["disabled","","title","Ver calificaciones",1,"btn","w-100","btn-sm"],[1,"fas","fa-star"],["disabled","",1,"btn","w-100","btn-sm","text-truncate"],[1,"fas","fa-download"],[1,"mt-0","text-truncate"],["class","badge bg-warning text-dark ms-2",4,"ngIf"],["class","badge bg-success ms-2",4,"ngIf"],[1,"col-auto","pe-0"],[1,"text-primary"],[1,"flex-shrink-0","rounded-circle","border-1","overflow-hidden",2,"width","40px","height","40px","background-color","aqua"],[3,"routerLink"],["class","img-fluid","src","assets/images/user-default.png",4,"ngIf"],["class","img-fluid",3,"src",4,"ngIf"],[1,"col","rounded","px-2"],[1,"mb-1"],[1,"text-primary",3,"routerLink"],["title","Ver detalles",1,"btn","btn-info","me-2",3,"click"],[1,"fas","fa-eye"],[1,"btn","btn-warning","me-2",3,"click","title","disabled"],[4,"ngIf","ngIfElse"],[1,"badge","bg-warning","text-dark","ms-2"],[1,"fas","fa-clock"],[1,"badge","bg-success","ms-2"],[1,"fas","fa-check"],["src","assets/images/user-default.png",1,"img-fluid"],[1,"img-fluid",3,"src"],[1,"btn","btn-secondary",3,"click","title","disabled"],[1,"fas","fa-hand-pointer"],[1,"btn","btn-secondary",3,"click","title","href","target"],["aria-label","Page navigation",1,"mt-3"],[1,"pagination","justify-content-end"],["class","page-item",4,"ngIf"],[1,"page-item"],[1,"page-link","bg-primary",3,"routerLink"],[1,"page-link","bg-info",3,"routerLink"],[3,"resource"],[3,"rated","resource"]],template:function(i,n){i&1&&(r(0,"div",1)(1,"div",2)(2,"h3",3),l(3),o(),p(4,us,4,0,"button",4),o(),p(5,_s,5,0,"div",5)(6,fs,3,0,"div",5)(7,Rs,18,6,"div",5),o(),r(8,"suggest",6),v("resourceSubmitted",function(_){return n.onResourceSubmitted(_)}),o(),p(9,Ns,1,1,"details-resource",7)(10,$s,1,1,"rating-resource",8)),i&2&&(a(3),w(n.title),a(),s("ngIf",n.identity.role!="guest"),a(),s("ngIf",n.loading),a(),s("ngIf",n.resources.length==0&&!n.loading),a(),s("ngIf",n.resources.length!=0),a(2),s("ngIf",n.detailsResourceItem),a(),s("ngIf",n.ratingResourceItem))},dependencies:[$,O,ee,le,de,j,se,K,Q,De,Re,G,bi,yi,Si,ce,me,pe,Be],encapsulation:2})}}return t})();var Us=()=>["/inicio/convocatorias"],Bs=()=>["/inicio/lecciones"],ze=t=>["/inicio","leccion",t],Ei=t=>["/inicio/mis-lecciones",t];function qs(t,d){t&1&&(r(0,"div",5)(1,"div",6)(2,"div",7)(3,"span",8),l(4,"Loading..."),o()()()())}function js(t,d){t&1&&(r(0,"div",5)(1,"h4",9),l(2," Aqu\xED se muestran las lecciones en las que estas participando. A\xFAn no hay lecciones que mostrar. "),o(),r(3,"p")(4,"a",10),l(5,"Revisa las convocatorias abiertas dando clic ac\xE1 y animate a participar!"),o()(),r(6,"p")(7,"a",10),l(8,"Si tienes algun tema para lecci\xF3n para proponer o quieres compartir tus experiencias. Da clic aqu\xED."),o()()()),t&2&&(a(4),s("routerLink",B(2,Us)),a(3),s("routerLink",B(3,Bs)))}function Ks(t,d){if(t&1){let e=x();r(0,"div",12)(1,"div",17)(2,"input",18),v("click",function(){let n=g(e).$implicit,m=c(2);return h(m.setState(n.value))}),o(),r(3,"label",19),l(4),o()()()}if(t&2){let e=d.$implicit;a(2),S("id",e.value),a(),S("for",e.value),a(),f(" ",e.label," ")}}function zs(t,d){if(t&1&&(r(0,"button",41),u(1,"i",42),l(2),o()),t&2){let e=c().$implicit;a(2),f(" ",e.score.toFixed(2)," ")}}function Gs(t,d){if(t&1&&(r(0,"button",43)(1,"span"),u(2,"i",37),r(3,"span"),l(4),o()()()),t&2){let e=c().$implicit;a(4),f(" ",e.views,"")}}function Hs(t,d){if(t&1&&(r(0,"small"),l(1),o()),t&2){let e=c().$implicit;a(),f("",e,"...")}}function Ws(t,d){if(t&1&&(r(0,"p",44),p(1,Hs,2,1,"small",15),o()),t&2){let e=d.index;a(),s("ngIf",e==0)}}function Js(t,d){if(t&1&&(r(0,"span"),l(1),o()),t&2){let e=c().$implicit,i=c(3);a(),f(" ",i.academic_level[e.level]," ")}}function Ys(t,d){t&1&&(r(0,"small",9),l(1,"No se ha asignado"),o())}function Xs(t,d){if(t&1&&(r(0,"small",47),l(1),o()),t&2){let e=d.$implicit;S("title",e.name),a(),w(e.name)}}function Zs(t,d){if(t&1&&(r(0,"div",45),p(1,Xs,2,2,"small",46),o()),t&2){let e=c().$implicit;a(),s("ngForOf",e.knowledge_area)}}function Qs(t,d){t&1&&(r(0,"small",9),l(1,"No se ha asignado"),o())}function el(t,d){if(t&1&&(r(0,"div")(1,"div",21)(2,"div",5)(3,"div",22)(4,"div",11)(5,"div",23)(6,"div",11)(7,"div",12)(8,"div",24),u(9,"i",25),o()()(),r(10,"div",26)(11,"div",27)(12,"button",28)(13,"span"),l(14),o()(),p(15,zs,3,1,"button",29)(16,Gs,5,1,"button",30),o()()(),r(17,"div",12)(18,"div",11)(19,"div",12)(20,"div",31)(21,"h5",32)(22,"strong"),l(23),o()()(),r(24,"small",9),l(25),E(26,"amFromUnix"),E(27,"amLocale"),E(28,"amDateFormat"),o(),r(29,"h5")(30,"span",33),l(31),o()(),p(32,Ws,2,1,"p",34),o(),r(33,"div",35)(34,"button",36),u(35,"i",37),o()()(),r(36,"div",11)(37,"div",38)(38,"div",11)(39,"div",12)(40,"strong"),l(41,"Nivel acad\xE9mico:"),o()()(),r(42,"div",11)(43,"div",12)(44,"p"),p(45,Js,2,1,"span",39)(46,Ys,2,0,"ng-template",null,0,L),o()()()(),r(48,"div",38)(49,"div",11)(50,"div",12)(51,"strong"),l(52,"\xC1reas de conocimiento:"),o()()(),r(53,"div",11)(54,"div",12),p(55,Zs,2,1,"div",40)(56,Qs,2,0,"ng-template",null,0,L),o()()()()()()()()()()),t&2){let e=d.$implicit,i=k(47),n=c(3);a(8),W("text-center p-2 py-3 rounded-lg border border-ligth text-center bg-",n.lesson_states[e.state].class,""),s("routerLink",b(25,ze,e._id)),a(6),f("V. ",e.version.toFixed(1),""),a(),s("ngIf",e.state=="completed"),a(),s("ngIf",e.state=="completed"),a(4),s("routerLink",b(27,ze,e._id)),a(3),w(e.title),a(2),f(" ",F(28,22,F(27,19,q(26,17,e.created_at),"es"),"LL")," "),a(6),f(" ",n.lesson_states[e.state].label," "),a(),s("ngForOf",e.resume.split(`
`)),a(2),s("routerLink",b(29,ze,e._id)),a(11),s("ngIf",n.academic_level.hasOwnProperty(e.level))("ngIfElse",i),a(10),s("ngIf",e.knowledge_area.length>0)("ngIfElse",i)}}function tl(t,d){if(t&1&&(r(0,"div"),p(1,el,58,31,"div",20),o()),t&2){let e=c(2);a(),s("ngForOf",e.lessons)}}function il(t,d){t&1&&(r(0,"div",5)(1,"h4",9),l(2," No se encontraron lecciones para los criterios de b\xFAsqueda seleccionados. "),o()())}function nl(t,d){if(t&1&&(r(0,"button",41),u(1,"i",42),l(2),o()),t&2){let e=c().$implicit;a(2),f(" ",e.score.toFixed(2)," ")}}function ol(t,d){if(t&1&&(r(0,"button",43)(1,"span"),u(2,"i",37),r(3,"span"),l(4),o()()()),t&2){let e=c().$implicit;a(4),f(" ",e.views,"")}}function rl(t,d){if(t&1&&(r(0,"small"),l(1),o()),t&2){let e=c().$implicit;a(),f("",e,"...")}}function al(t,d){if(t&1&&(r(0,"p",44),p(1,rl,2,1,"small",15),o()),t&2){let e=d.index;a(),s("ngIf",e==0)}}function sl(t,d){if(t&1&&(r(0,"span"),l(1),o()),t&2){let e=c().$implicit,i=c(4);a(),f(" ",i.academic_level[e.level]," ")}}function ll(t,d){t&1&&(r(0,"small",9),l(1,"No se ha asignado"),o())}function dl(t,d){if(t&1&&(r(0,"small",47),l(1),o()),t&2){let e=d.$implicit;S("title",e.name),a(),w(e.name)}}function cl(t,d){if(t&1&&(r(0,"div",45),p(1,dl,2,2,"small",46),o()),t&2){let e=c().$implicit;a(),s("ngForOf",e.knowledge_area)}}function ml(t,d){t&1&&(r(0,"small",9),l(1,"No se ha asignado"),o())}function pl(t,d){if(t&1&&(r(0,"div")(1,"div",21)(2,"div",5)(3,"div",22)(4,"div",11)(5,"div",23)(6,"div",11)(7,"div",12)(8,"div",48),u(9,"i",49),o()()(),r(10,"div",26)(11,"div",27)(12,"button",28)(13,"span"),l(14),o()(),p(15,nl,3,1,"button",29)(16,ol,5,1,"button",30),o()()(),r(17,"div",12)(18,"div",11)(19,"div",12)(20,"div",31)(21,"h5",32)(22,"strong"),l(23),o()()(),r(24,"small",9),l(25),E(26,"amFromUnix"),E(27,"amLocale"),E(28,"amDateFormat"),o(),r(29,"h5")(30,"span",33),l(31),o()(),p(32,al,2,1,"p",34),o(),r(33,"div",35)(34,"button",36),u(35,"i",37),o()()(),r(36,"div",11)(37,"div",38)(38,"div",11)(39,"div",12)(40,"strong"),l(41,"Nivel acad\xE9mico:"),o()()(),r(42,"div",11)(43,"div",12)(44,"p"),p(45,sl,2,1,"span",39)(46,ll,2,0,"ng-template",null,0,L),o()()()(),r(48,"div",38)(49,"div",11)(50,"div",12)(51,"strong"),l(52,"\xC1reas de conocimiento:"),o()()(),r(53,"div",11)(54,"div",12),p(55,cl,2,1,"div",40)(56,ml,2,0,"ng-template",null,0,L),o()()()()()()()()()()),t&2){let e=d.$implicit,i=k(47),n=c(4);a(8),W("text-center p-2 py-3 rounded-lg border border-ligth text-center bg-",n.lesson_states[e.state].class,""),s("routerLink",b(25,ze,e._id)),a(6),f("V. ",e.version.toFixed(1),""),a(),s("ngIf",e.state=="completed"),a(),s("ngIf",e.state=="completed"),a(4),s("routerLink",b(27,ze,e._id)),a(3),w(e.title),a(2),f(" ",F(28,22,F(27,19,q(26,17,e.created_at),"es"),"LL")," "),a(6),f(" ",n.lesson_states[e.state].label," "),a(),s("ngForOf",e.resume.split(`
`)),a(2),s("routerLink",b(29,ze,e._id)),a(11),s("ngIf",n.academic_level.hasOwnProperty(e.level))("ngIfElse",i),a(10),s("ngIf",e.knowledge_area.length>0)("ngIfElse",i)}}function ul(t,d){if(t&1&&(r(0,"div"),p(1,pl,58,31,"div",20),o()),t&2){let e=c(3);a(),s("ngForOf",e.allLessons)}}function _l(t,d){if(t&1&&(r(0,"div"),p(1,il,3,0,"div",4)(2,ul,2,1,"div",15),o()),t&2){let e=c(2);a(),s("ngIf",e.allLessons.length==0&&!e.loading),a(),s("ngIf",e.allLessons.length>0)}}function fl(t,d){if(t&1&&(r(0,"li",53)(1,"a",54),l(2,"Anterior"),o()()),t&2){let e=c(3);a(),s("routerLink",b(1,Ei,e.prevPage))}}function vl(t,d){if(t&1&&(r(0,"li",53)(1,"a",55),l(2,"Siguiente"),o()()),t&2){let e=c(3);a(),s("routerLink",b(1,Ei,e.nextPage))}}function gl(t,d){if(t&1&&(r(0,"nav",50)(1,"ul",51),p(2,fl,3,3,"li",52)(3,vl,3,3,"li",52),o()()),t&2){let e=c(2);a(2),s("ngIf",e.page>1),a(),s("ngIf",e.page<e.pages&&e.page!=e.pages)}}function hl(t,d){if(t&1&&(r(0,"div",5)(1,"div",11)(2,"div",12)(3,"div",13)(4,"div",11),p(5,Ks,5,3,"div",14),o()()()(),p(6,tl,2,1,"div",15)(7,_l,3,2,"div",15)(8,gl,4,2,"nav",16),o()),t&2){let e=c();a(5),s("ngForOf",e.states),a(),s("ngIf",e.selectedStates.length==0),a(),s("ngIf",e.selectedStates.length>0),a(),s("ngIf",e.selectedStates.length==0)}}var yt=(()=>{class t{constructor(e,i,n,m,_){this._userService=e,this._lessonService=i,this._bDService=n,this._router=m,this._route=_,this.allLessons=[],this.lessons=[],this.level={basic:"B\xE1sico",medium:"Medio",advanced:"Avanzado"},this.type={consideration:"Consideraci\xF3n",development:"Desarrollo"},this.academic_level=X,this.lesson_states=$e,this.selectedStates=[],this.states=[{label:"Propuesta",value:"proposed",class:"secondary"},{label:"Asignada",value:"assigned",class:"warning"},{label:"Desarrollo",value:"development",class:"info"},{label:"Prueba",value:"test",class:"primary"},{label:"Terminada",value:"completed",class:"success"}],this.levels=[{label:"Preescolar",value:"garden"},{label:"Primaria",value:"school"},{label:"Secundaria",value:"highschool"},{label:"Universitario",value:"university"}],this.loading=!0,this.title="Mis lecciones",this.url=V.url,this.token=this._userService.getToken(),this.identity=this._userService.getIdentity(),this.areas}ngOnInit(){this.getAllMyLessons(),this.getAllAreas(),this.actualPage()}setState(e){this.selectedStates.indexOf(e)>=0?this.selectedStates.splice(this.selectedStates.indexOf(e),1):this.selectedStates.push(e),this.getAllMyLessons()}getAllAreas(){this.areas=JSON.parse(localStorage.getItem("areas")),this.areas||this._bDService.getAllKnowledgeAreas().subscribe(e=>{e.areas&&(this.areas=e.areas,localStorage.setItem("areas",JSON.stringify(this.areas)))},e=>{console.log(e)})}getAllMyLessons(){let e=[];console.log("getAllMyLessons called, loading:",this.loading),this._lessonService.getAllMyLessons(this.token).subscribe(i=>{console.log("getAllMyLessons response:",i),i.lessons?(this.allLessons=i.lessons,console.log("All lessons received:",this.allLessons.length),this.selectedStates.length>0&&(this.selectedStates.forEach(n=>{e=e.concat(this.allLessons.filter(m=>m.state==n))}),this.allLessons=e,e=[],console.log("Filtered lessons:",this.allLessons.length)),this.lessons=this.allLessons,this.loading=!1):(console.warn("No lessons in response"),this.lessons=[],this.loading=!1)},i=>{console.error("Error getting my lessons:",i),this.lessons=[],this.loading=!1})}getMyLessons(e=1){this._lessonService.getMyLessons(this.token,e).subscribe({next:i=>{i.lessons&&(this.lessons=i.lessons,this.total=i.total,this.pages=i.pages,e>this.pages&&this._router.navigate(["/inicio/mis-lecciones"]),this.loading=!1)},error:i=>{this.loading=!1,console.log(i)}})}actualPage(){this._route.params.subscribe(e=>{let i=+e.page;this.page=i,i?(this.nextPage=i+1,this.prevPage=i-1,this.prevPage<=0&&(this.prevPage=1)):(this.page=1,this.nextPage=this.page+1),this.getMyLessons(this.page)})}reloadLessons(){this.getAllMyLessons()}static{this.\u0275fac=function(i){return new(i||t)(y(T),y(ne),y(ie),y(z),y(te))}}static{this.\u0275cmp=P({type:t,selectors:[["my-lessons"]],standalone:!1,decls:7,vars:4,consts:[["notAssigned",""],[1,"card"],[1,"card-header"],[1,"m-0","text-primary","font-weight-bolder","float-left"],["class","card-body",4,"ngIf"],[1,"card-body"],[1,"text-muted","text-center"],["role","status",1,"spinner-border",2,"width","3rem","height","3rem"],[1,"sr-only"],[1,"text-muted"],[1,"card-link",3,"routerLink"],[1,"row"],[1,"col"],[1,"form-group"],["class","col",4,"ngFor","ngForOf"],[4,"ngIf"],["class","mt-3","aria-label","Page navigation",4,"ngIf"],[1,"custom-control","custom-checkbox"],["type","checkbox",1,"custom-control-input",3,"click","id"],[1,"custom-control-label",3,"for"],[4,"ngFor","ngForOf"],[1,"card","mb-2"],[1,"media-body"],[1,"col-auto"],[2,"width","158px","height","80px","overflow","hidden",3,"routerLink"],[1,"text-white","fas","fa-chalkboard-teacher",2,"font-size","50px","cursor","pointer"],[1,"row","mt-1"],[1,"col-12"],["disabled","","title","Versi\xF3n",1,"btn","w-100","btn-sm"],["class","btn w-100 btn-sm","disabled","","title","Calificaci\xF3n",4,"ngIf"],["class","btn w-100 btn-sm","disabled","","title","Visualizaciones",4,"ngIf"],[2,"cursor","pointer",3,"routerLink"],[1,"my-0"],[1,"badge","badge-info","me-1"],["class","text-justify",4,"ngFor","ngForOf"],[1,"text-end","col-auto"],["title","Ver lecci\xF3n",1,"btn","btn-info","ms-2",3,"routerLink"],[1,"fas","fa-eye"],[1,"col-6"],[4,"ngIf","ngIfElse"],["style","display: flex; flex-wrap: wrap;",4,"ngIf","ngIfElse"],["disabled","","title","Calificaci\xF3n",1,"btn","w-100","btn-sm"],[1,"fas","fa-star"],["disabled","","title","Visualizaciones",1,"btn","w-100","btn-sm"],[1,"text-justify"],[2,"display","flex","flex-wrap","wrap"],["class","badge badge-info me-1 mb-1 text-truncate",3,"title",4,"ngFor","ngForOf"],[1,"badge","badge-info","me-1","mb-1","text-truncate",3,"title"],[2,"width","158px","height","80px","overflow","hidden","cursor","pointer",3,"routerLink"],[1,"text-white","fas","fa-chalkboard-teacher",2,"font-size","50px"],["aria-label","Page navigation",1,"mt-3"],[1,"pagination","justify-content-end"],["class","page-item",4,"ngIf"],[1,"page-item"],[1,"page-link","bg-primary",3,"routerLink"],[1,"page-link","bg-info",3,"routerLink"]],template:function(i,n){i&1&&(r(0,"div",1)(1,"div",2)(2,"h3",3),l(3),o()(),p(4,qs,5,0,"div",4)(5,js,9,4,"div",4)(6,hl,9,4,"div",4),o()),i&2&&(a(3),w(n.title),a(),s("ngIf",n.loading),a(),s("ngIf",n.lessons.length==0&&!n.loading&&n.selectedStates.length==0),a(),s("ngIf",n.lessons.length!=0||n.selectedStates.length>0))},dependencies:[$,O,G,ce,me,pe],encapsulation:2})}}return t})();var Ii={teacher:{label:"Docente",class:"badge-success"},guest:{label:"Invitado",class:"badge-orange"},student:{label:"Estudiante",class:"badge-info"},expert:{label:"Facilitador",class:"badge-purple"},admin:{label:"Administrador",class:"badge-green"},delegated_admin:{label:"Administrador",class:"badge-green"},lesson_manager:{label:"Gestor de lecciones",class:"badge-pink"}};var Li=t=>["/perfil",t];function xl(t,d){if(t&1&&(r(0,"p",17),l(1),o()),t&2){let e=d.$implicit;a(),f(" ",e," ")}}function bl(t,d){t&1&&u(0,"img",33)}function Cl(t,d){if(t&1&&u(0,"img",34),t&2){let e=c().$implicit,i=c(2);S("src",i.url+"get-image-user/"+e.picture,N)}}function yl(t,d){if(t&1&&(r(0,"span",35),l(1),o()),t&2){let e=c().$implicit,i=c(2);a(),w(i.profile_label[e.role].label)}}function Sl(t,d){if(t&1&&(r(0,"div",23)(1,"div",24)(2,"a",25)(3,"button",26),p(4,bl,1,0,"img",27)(5,Cl,1,1,"img",28),o()()(),r(6,"div",29)(7,"h6",30)(8,"a",31)(9,"strong"),l(10),o()(),u(11,"br"),p(12,yl,2,1,"span",32),o()()()),t&2){let e=d.$implicit;a(3),s("routerLink",b(7,Li,e._id)),a(),s("ngIf",!e.picture),a(),s("ngIf",e.picture),a(3),s("routerLink",b(9,Li,e._id)),a(2),J(" ",e.name," ",e.surname," "),a(2),s("ngIf",e.role)}}function wl(t,d){if(t&1&&(r(0,"div",18)(1,"div",19)(2,"div",18)(3,"div",19)(4,"strong"),l(5,"Interesados en participar:"),o()()(),r(6,"div",20)(7,"div",21),p(8,Sl,13,11,"div",22),o()()()()),t&2){let e=c();a(8),s("ngForOf",e.lesson.call.interested)}}function El(t,d){if(t&1){let e=x();D(0),r(1,"button",36),v("click",function(){g(e);let n=c();return h(n.editLesson(n.lesson,"add"))}),u(2,"i",37),l(3," Unirse "),o(),R()}}function Il(t,d){if(t&1){let e=x();r(0,"button",38),v("click",function(){g(e);let n=c();return h(n.onLeaveClick(n.lesson))}),u(1,"i",39),l(2," Retirarse "),o()}}var Fi=(()=>{class t{constructor(e,i){this._userService=e,this._lessonService=i,this.isJoined=new _e,this.title="Agregar recurso",this.identity=this._userService.getIdentity(),this.token=this._userService.getToken(),this.url=V.url,this.profile_label=Ii}ngOnInit(){this.startRealtimeSync()}ngOnChanges(e){e.lesson&&this.restartRealtimeSync()}ngOnDestroy(){this.stopRealtimeSync()}getLink(e){return e.includes("http://")||e.includes("https://")?e:`http://${e}`}hasJoined(e){return!e||!e.call||!e.call.interested?!1:e.call.interested.map(n=>n?._id||n).indexOf(this.identity?._id)>=0}getLesson(e){this.Templesson=e}abandonLesson(){this.Templesson&&this.editLesson(this.Templesson,"remove")}onLeaveClick(e){confirm("\xBFEstas seguro que quieres retirarte de este grupo de desarrollo?")&&(this.getLesson(e),this.abandonLesson())}editLesson(e,i){if(!e||!e.call)return;let n=Y({},e);if(n.call=Y({},e.call),n.call.interested=(e.call.interested||[]).map(m=>m?._id||m),i==="remove"){let m=n.call.interested.indexOf(this.identity?._id);if(m>=0)n.call.interested.splice(m,1);else return}else if(i==="add"){if(n.call.interested.indexOf(this.identity?._id)>=0)return;n.call.interested.push(this.identity?._id)}this._lessonService.editLesson(this.token,n).subscribe({next:m=>{m&&m.lesson&&m.lesson._id&&(this.refreshLesson(m.lesson._id),this.isJoined.emit())},error:m=>{console.log(m)}})}refreshLesson(e){e&&this._lessonService.getLesson(this.token,e).subscribe({next:i=>{i&&i.lesson&&(this.lesson=i.lesson)},error:i=>{console.warn("No se pudo actualizar la lecci\xF3n en tiempo real:",i)}})}startRealtimeSync(){this.stopRealtimeSync();let e=this.lesson?._id;e&&(this.realtimeTimer=setInterval(()=>this.refreshLesson(e),5e3))}stopRealtimeSync(){this.realtimeTimer&&(clearInterval(this.realtimeTimer),this.realtimeTimer=null)}restartRealtimeSync(){this.startRealtimeSync()}static{this.\u0275fac=function(i){return new(i||t)(y(T),y(ne))}}static{this.\u0275cmp=P({type:t,selectors:[["details-call"]],inputs:{lesson:"lesson",isJoin:"isJoin"},outputs:{isJoined:"isJoined"},standalone:!1,features:[It],decls:24,vars:5,consts:[["leaveGroup",""],["id","details","tabindex","-1","role","dialog","aria-labelledby","details","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-lg","modal-dialog-scrollable"],[1,"modal-content"],[1,"modal-header"],["id","detailsTitle",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],[1,"mb-3"],[1,"row","mb-4"],[1,"col-3"],[1,"col-9"],["class","text-break",4,"ngFor","ngForOf"],["class","row",4,"ngIf"],[1,"modal-footer"],[4,"ngIf","ngIfElse"],["data-bs-dismiss","modal",1,"btn","btn-secondary"],[1,"text-break"],[1,"row"],[1,"col"],[1,"card","mt-2"],[1,"card-body","p-1"],["class","row mb-1",4,"ngFor","ngForOf"],[1,"row","mb-1"],[1,"col-auto","pe-0"],[1,"text-primary"],["data-bs-dismiss","modal",1,"btn","flex-shrink-0","rounded-circle","overflow-hidden","p-0",2,"width","40px","height","40px",3,"routerLink"],["class","img-fluid","src","assets/images/user-default.png",4,"ngIf"],["class","img-fluid",3,"src",4,"ngIf"],[1,"col","rounded","px-2"],[1,"mb-1"],["data-bs-dismiss","modal",1,"text-primary",3,"routerLink"],["class","text-muted",4,"ngIf"],["src","assets/images/user-default.png",1,"img-fluid"],[1,"img-fluid",3,"src"],[1,"text-muted"],["title","Unirse",1,"btn","btn-success","me-2",3,"click"],[1,"fas","fa-user-plus"],["title","Retirarse",1,"btn","btn-danger","me-2",3,"click"],[1,"fas","fa-user-minus"]],template:function(i,n){if(i&1&&(r(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"h5",5),l(5,"Detalles de la convocatoria"),o(),u(6,"button",6),o(),r(7,"div",7)(8,"h4",8)(9,"strong"),l(10),o()(),r(11,"div",9)(12,"div",10)(13,"strong"),l(14,"Resumen:"),o()(),r(15,"div",11),p(16,xl,2,1,"p",12),o()(),p(17,wl,9,1,"div",13),o(),r(18,"div",14),p(19,El,4,0,"ng-container",15)(20,Il,3,0,"ng-template",null,0,L),r(22,"button",16),l(23,"Cerrar"),o()()()()()),i&2){let m=k(21);a(10),w(n.lesson.title),a(6),s("ngForOf",n.lesson.resume.split(`
`)),a(),s("ngIf",(n.lesson==null||n.lesson.call==null||n.lesson.call.interested==null?null:n.lesson.call.interested.length)>0),a(2),s("ngIf",!n.hasJoined(n.lesson))("ngIfElse",m)}},dependencies:[$,O,G],encapsulation:2})}}return t})();var ki=t=>["/inicio/convocatorias",t];function Fl(t,d){t&1&&(r(0,"div",24)(1,"div",25)(2,"div",26)(3,"span",27),l(4,"Loading..."),o()()()())}function kl(t,d){t&1&&(r(0,"div",24)(1,"h4",28),l(2," No hay convocatorias abiertas para desarrollo de lecciones. "),o()())}function Tl(t,d){t&1&&(D(0),l(1," Ocultar opciones "),R())}function Al(t,d){t&1&&l(0," Ver opciones ")}function Ml(t,d){if(t&1){let e=x();r(0,"div",38)(1,"div",39)(2,"input",40),v("click",function(){let n=g(e).$implicit,m=c(3);return h(m.setArea(n.name))}),o(),r(3,"label",41),l(4),o()()()}if(t&2){let e=d.$implicit;a(2),S("id",e.name),a(),S("for",e.name),a(),f(" ",e.name," ")}}function Pl(t,d){if(t&1&&(r(0,"div",29),p(1,Ml,5,3,"div",37),o()),t&2){let e=c(2);a(),s("ngForOf",e.areas)}}function Ol(t,d){t&1&&(D(0),l(1," Ocultar opciones "),R())}function Vl(t,d){t&1&&l(0," Ver opciones ")}function Dl(t,d){if(t&1){let e=x();r(0,"div",38)(1,"div",39)(2,"input",40),v("click",function(){let n=g(e).$implicit,m=c(3);return h(m.setLevel(n.value))}),o(),r(3,"label",41),l(4),o()()()}if(t&2){let e=d.$implicit;a(2),S("id",e.value),a(),S("for",e.value),a(),f(" ",e.label," ")}}function Rl(t,d){if(t&1&&(r(0,"div",29),p(1,Dl,5,3,"div",37),o()),t&2){let e=c(2);a(),s("ngForOf",e.levels)}}function Nl(t,d){if(t&1&&(r(0,"p",56),l(1),o()),t&2){let e=d.$implicit;a(),f(" ",e," ")}}function $l(t,d){if(t&1&&(D(0),p(1,Nl,2,1,"p",55),R()),t&2){let e=c().$implicit;a(),s("ngForOf",e.call.text.split(`
`))}}function Ul(t,d){t&1&&(r(0,"p",58),l(1," A\xFAn no has abierto la convocatoria. Completa el formulario para publicarla. "),o())}function Bl(t,d){if(t&1&&p(0,Ul,2,0,"p",57),t&2){let e=c().$implicit,i=c(3);s("ngIf",i.isLessonLeader(e)&&i.isApprovedByFacilitator(e))}}function ql(t,d){if(t&1&&(r(0,"small",60),l(1),o()),t&2){let e=d.$implicit,i=c(5);a(),f(" ",i.academic_level[e]||e," ")}}function jl(t,d){if(t&1&&(r(0,"div"),p(1,ql,2,1,"small",59),o()),t&2){let e=c().$implicit;a(),s("ngForOf",e.level)}}function Kl(t,d){t&1&&(r(0,"small",28),l(1,"No se ha asignado"),o())}function zl(t,d){if(t&1&&(r(0,"small",62),l(1),o()),t&2){let e=d.$implicit;a(),w(e.name)}}function Gl(t,d){if(t&1&&(r(0,"div"),p(1,zl,2,1,"small",61),o()),t&2){let e=c().$implicit;a(),s("ngForOf",e.knowledge_area)}}function Hl(t,d){t&1&&(r(0,"small",28),l(1,"No se ha asignado"),o())}function Wl(t,d){if(t&1){let e=x();D(0),r(1,"button",63),v("click",function(n){g(e);let m=c(2).$implicit;return c(3).editLesson(m,"add"),h(n.stopPropagation())}),u(2,"i",64),o(),R()}}function Jl(t,d){if(t&1){let e=x();r(0,"button",65),v("click",function(){g(e);let n=c(2).$implicit,m=c(3);return h(m.openLeaveModal(n))}),u(1,"i",66),o()}}function Yl(t,d){if(t&1&&(D(0),p(1,Wl,3,0,"ng-container",33)(2,Jl,2,0,"ng-template",null,3,L),R()),t&2){let e=k(3),i=c().$implicit,n=c(3);a(),s("ngIf",!n.hasJoined(i))("ngIfElse",e)}}function Xl(t,d){t&1&&(D(0),r(1,"span",67),u(2,"i",68),l(3,"Eres el l\xEDder "),o(),R())}function Zl(t,d){if(t&1){let e=x();r(0,"button",80),v("click",function(){g(e);let n=c(2).$implicit,m=c(3);return h(m.openCall(n))}),u(1,"i",81),l(2,"Abrir Convocatoria "),o()}if(t&2){let e=c(2).$implicit,i=c(3);s("disabled",i.isSavingCall[e._id])}}function Ql(t,d){if(t&1){let e=x();r(0,"button",80),v("click",function(){g(e);let n=c(2).$implicit,m=c(3);return h(m.submitCall(n))}),u(1,"i",82),l(2,"Guardar "),o()}if(t&2){let e=c(2).$implicit,i=c(3);s("disabled",i.isSavingCall[e._id]||i.isDraftSameAsSaved(e))}}function ed(t,d){if(t&1){let e=x();r(0,"div",69)(1,"div",70)(2,"div",71)(3,"label",72),l(4,"Descripci\xF3n de la convocatoria"),o(),r(5,"textarea",73),v("ngModelChange",function(n){g(e);let m=c().$implicit,_=c(3);return h(_.setCallDraftText(m,n))}),o(),r(6,"div",74)(7,"input",75),v("ngModelChange",function(n){g(e);let m=c().$implicit,_=c(3);return h(_.setCallDraftVisible(m,n))}),o(),r(8,"label",41),l(9,"Visible p\xFAblicamente"),o()(),r(10,"div",76),p(11,Zl,3,1,"button",77)(12,Ql,3,1,"button",77),r(13,"button",78),v("click",function(){g(e);let n=c().$implicit,m=c(3);return h(m.activateLesson(n))}),u(14,"i",79),l(15,"Asignar Lecci\xF3n "),o()()()()()}if(t&2){let e=c().$implicit,i=c(3);a(5),s("ngModel",i.getCallDraftText(e)),a(2),ae("id","visible_",e._id,""),s("ngModel",i.getCallDraftVisible(e)),a(),ae("for","visible_",e._id,""),a(3),s("ngIf",!(e.call!=null&&e.call.text)||i.getCallDraftVisible(e)===!1),a(),s("ngIf",(e.call==null?null:e.call.text)&&i.getCallDraftVisible(e)!==!1),a(),s("disabled",i.isSavingCall[e._id])("title","Asignar Lecci\xF3n ("+i.getParticipantCount(e)+" participantes)")}}function td(t,d){t&1&&(r(0,"span",88),l(1,"\u2713 Suficientes participantes para activar"),o())}function id(t,d){t&1&&(r(0,"span",89),l(1,"\u26A0 Se recomienda al menos 2 participantes"),o())}function nd(t,d){if(t&1&&(r(0,"div",83)(1,"div",84)(2,"strong"),u(3,"i",85),l(4,"Gesti\xF3n de Convocatoria:"),o(),u(5,"br"),l(6,"\u2022 Participantes actuales: "),r(7,"strong"),l(8),o(),u(9,"br"),l(10,"\u2022 "),p(11,td,2,0,"span",86)(12,id,2,0,"span",87),u(13,"br"),l(14,"\u2022 Puedes activar la lecci\xF3n cuando consideres que hay suficientes participantes "),o()()),t&2){let e=c().$implicit,i=c(3);a(8),w(i.getParticipantCount(e)),a(3),s("ngIf",i.hasSufficientParticipants(e)),a(),s("ngIf",!i.hasSufficientParticipants(e))}}function od(t,d){if(t&1){let e=x();r(0,"div")(1,"div",7)(2,"div",24)(3,"div",43)(4,"div",29)(5,"div",44)(6,"div",29)(7,"div",30)(8,"div",45),u(9,"i",46),o()()(),r(10,"div",47)(11,"div",48)(12,"button",49)(13,"span"),l(14),o()()()()(),r(15,"div",30)(16,"div",29)(17,"div",50)(18,"strong"),l(19),o(),r(20,"p")(21,"small",28),l(22),E(23,"amFromUnix"),E(24,"amLocale"),E(25,"amDateFormat"),o()(),p(26,$l,2,1,"ng-container",33)(27,Bl,1,1,"ng-template",null,1,L),o()(),r(29,"div",29)(30,"div",38)(31,"div",29)(32,"div",30)(33,"strong"),l(34,"Nivel acad\xE9mico:"),o()()(),r(35,"div",29)(36,"div",30),p(37,jl,2,1,"div",33)(38,Kl,2,0,"ng-template",null,2,L),o()()(),r(40,"div",38)(41,"div",29)(42,"div",30)(43,"strong"),l(44,"\xC1reas de conocimiento:"),o()()(),r(45,"div",29)(46,"div",30),p(47,Gl,2,1,"div",33)(48,Hl,2,0,"ng-template",null,2,L),o()()()()(),r(50,"div",44)(51,"div",29)(52,"div",30)(53,"button",51),v("click",function(){let n=g(e).$implicit,m=c(3);return h(m.openDetailsModal(n))}),u(54,"i",52),o(),p(55,Yl,4,2,"ng-container",35)(56,Xl,4,0,"ng-container",35)(57,ed,16,10,"div",53),o(),p(58,nd,15,3,"div",54),o()()()()()()()}if(t&2){let e=d.$implicit,i=k(28),n=k(39),m=c(3);a(14),f("V. ",e.version.toFixed(1),""),a(5),w(e.title),a(3),f(" ",F(25,18,F(24,15,q(23,13,e.created_at),"es"),"LL")," "),a(4),s("ngIf",e.call==null?null:e.call.text)("ngIfElse",i),a(11),s("ngIf",e.level&&e.level.length>0)("ngIfElse",n),a(10),s("ngIf",e.knowledge_area&&e.knowledge_area.length>0)("ngIfElse",n),a(8),s("ngIf",!m.isLessonLeader(e)),a(),s("ngIf",m.isLessonLeader(e)&&!m.isApprovedByFacilitator(e)),a(),s("ngIf",m.isLessonLeader(e)&&m.isApprovedByFacilitator(e)),a(),s("ngIf",m.isLeaderManagement&&m.isLessonLeader(e))}}function rd(t,d){if(t&1&&(r(0,"div"),p(1,od,59,21,"div",42),o()),t&2){let e=c(2);a(),s("ngForOf",e.lessons)}}function ad(t,d){t&1&&(D(0),r(1,"div",24)(2,"h4",28),l(3," No se encontraron convocatorias para los criterios de b\xFAsqueda seleccionados. "),o()(),R())}function sd(t,d){if(t&1&&(r(0,"p",56),l(1),o()),t&2){let e=d.$implicit;a(),f(" ",e," ")}}function ld(t,d){if(t&1&&(D(0),p(1,sd,2,1,"p",55),R()),t&2){let e=c().$implicit;a(),s("ngForOf",e.call.text.split(`
`))}}function dd(t,d){t&1&&(r(0,"p",58),l(1," A\xFAn no has abierto la convocatoria. Completa el formulario a la derecha para publicarla. "),o())}function cd(t,d){if(t&1&&p(0,dd,2,0,"p",57),t&2){let e=c().$implicit,i=c(4);s("ngIf",i.isLessonLeader(e)&&i.isApprovedByFacilitator(e))}}function md(t,d){if(t&1&&(r(0,"small",91),l(1),o()),t&2){let e=d.$implicit,i=c(6);a(),f(" ",i.academic_level[e]||e," ")}}function pd(t,d){if(t&1&&(r(0,"div"),p(1,md,2,1,"small",90),o()),t&2){let e=c().$implicit;a(),s("ngForOf",e.level)}}function ud(t,d){t&1&&(r(0,"small",28),l(1,"No se ha asignado"),o())}function _d(t,d){if(t&1&&(r(0,"small",62),l(1),o()),t&2){let e=d.$implicit;a(),w(e.name)}}function fd(t,d){if(t&1&&(r(0,"div"),p(1,_d,2,1,"small",61),o()),t&2){let e=c().$implicit;a(),s("ngForOf",e.knowledge_area)}}function vd(t,d){t&1&&(r(0,"small",28),l(1,"No se ha asignado"),o())}function gd(t,d){if(t&1){let e=x();D(0),r(1,"button",63),v("click",function(n){g(e);let m=c(2).$implicit;return c(4).editLesson(m,"add"),h(n.stopPropagation())}),u(2,"i",64),o(),R()}}function hd(t,d){if(t&1){let e=x();r(0,"button",65),v("click",function(){g(e);let n=c(2).$implicit,m=c(4);return h(m.openLeaveModal(n))}),u(1,"i",66),o()}}function xd(t,d){if(t&1&&(D(0),p(1,gd,3,0,"ng-container",33)(2,hd,2,0,"ng-template",null,6,L),R()),t&2){let e=k(3),i=c().$implicit,n=c(4);a(),s("ngIf",!n.hasJoined(i))("ngIfElse",e)}}function bd(t,d){t&1&&(D(0),r(1,"span",67),u(2,"i",68),l(3,"Eres el l\xEDder "),o(),R())}function Cd(t,d){if(t&1){let e=x();r(0,"button",80),v("click",function(){g(e);let n=c(2).$implicit,m=c(4);return h(m.submitCall(n))}),u(1,"i",81),l(2,"Abrir Convocatoria "),o()}if(t&2){let e=c(2).$implicit,i=c(4);s("disabled",i.isSavingCall[e._id])}}function yd(t,d){if(t&1){let e=x();r(0,"button",80),v("click",function(){g(e);let n=c(2).$implicit,m=c(4);return h(m.submitCall(n))}),u(1,"i",82),l(2,"Guardar "),o()}if(t&2){let e=c(2).$implicit,i=c(4);s("disabled",i.isSavingCall[e._id]||i.isDraftSameAsSaved(e))}}function Sd(t,d){if(t&1){let e=x();r(0,"div",69)(1,"div",70)(2,"div",71)(3,"label",72),l(4,"Descripci\xF3n de la convocatoria"),o(),r(5,"textarea",73),v("ngModelChange",function(n){g(e);let m=c().$implicit,_=c(4);return h(_.setCallDraftText(m,n))}),o(),r(6,"div",74)(7,"input",75),v("ngModelChange",function(n){g(e);let m=c().$implicit,_=c(4);return h(_.setCallDraftVisible(m,n))}),o(),r(8,"label",41),l(9,"Visible p\xFAblicamente"),o()(),r(10,"div",76),p(11,Cd,3,1,"button",77)(12,yd,3,1,"button",77),r(13,"button",78),v("click",function(){g(e);let n=c().$implicit,m=c(4);return h(m.activateLesson(n))}),u(14,"i",79),l(15,"Asignar Lecci\xF3n "),o()()()()()}if(t&2){let e=c().$implicit,i=c(4);a(5),s("ngModel",i.getCallDraftText(e)),a(2),ae("id","visible2_",e._id,""),s("ngModel",i.getCallDraftVisible(e)),a(),ae("for","visible2_",e._id,""),a(3),s("ngIf",!(e.call!=null&&e.call.text)||i.getCallDraftVisible(e)===!1),a(),s("ngIf",(e.call==null?null:e.call.text)&&i.getCallDraftVisible(e)!==!1),a(),s("disabled",i.isSavingCall[e._id])("title","Asignar Lecci\xF3n ("+i.getParticipantCount(e)+" participantes)")}}function wd(t,d){t&1&&(r(0,"span",88),l(1,"\u2713 Suficientes participantes para activar"),o())}function Ed(t,d){t&1&&(r(0,"span",89),l(1,"\u26A0 Se recomienda al menos 2 participantes"),o())}function Id(t,d){if(t&1&&(r(0,"div",83)(1,"div",84)(2,"strong"),u(3,"i",85),l(4,"Gesti\xF3n de Convocatoria:"),o(),u(5,"br"),l(6,"\u2022 Participantes actuales: "),r(7,"strong"),l(8),o(),u(9,"br"),l(10,"\u2022 "),p(11,wd,2,0,"span",86)(12,Ed,2,0,"span",87),u(13,"br"),l(14,"\u2022 Puedes activar la lecci\xF3n cuando consideres que hay suficientes participantes "),o()()),t&2){let e=c().$implicit,i=c(4);a(8),w(i.getParticipantCount(e)),a(3),s("ngIf",i.hasSufficientParticipants(e)),a(),s("ngIf",!i.hasSufficientParticipants(e))}}function Ld(t,d){if(t&1){let e=x();r(0,"div")(1,"div",7)(2,"div",24)(3,"div",43)(4,"div",29)(5,"div",44)(6,"div",29)(7,"div",30)(8,"div",45),u(9,"i",46),o()()(),r(10,"div",47)(11,"div",48)(12,"button",49)(13,"span"),l(14),o()()()()(),r(15,"div",30)(16,"div",29)(17,"div",50)(18,"strong"),l(19),o(),r(20,"p")(21,"small",28),l(22),E(23,"amFromUnix"),E(24,"amLocale"),E(25,"amDateFormat"),o()(),p(26,ld,2,1,"ng-container",33)(27,cd,1,1,"ng-template",null,5,L),o()(),r(29,"div",29)(30,"div",38)(31,"div",29)(32,"div",30)(33,"strong"),l(34,"Nivel acad\xE9mico:"),o()()(),r(35,"div",29)(36,"div",30),p(37,pd,2,1,"div",33)(38,ud,2,0,"ng-template",null,2,L),o()()(),r(40,"div",38)(41,"div",29)(42,"div",30)(43,"strong"),l(44,"\xC1reas de conocimiento:"),o()()(),r(45,"div",29)(46,"div",30),p(47,fd,2,1,"div",33)(48,vd,2,0,"ng-template",null,2,L),o()()()()(),r(50,"div",44)(51,"div",29)(52,"div",30)(53,"button",51),v("click",function(){let n=g(e).$implicit,m=c(4);return h(m.openDetailsModal(n))}),u(54,"i",52),o(),p(55,xd,4,2,"ng-container",35)(56,bd,4,0,"ng-container",35)(57,Sd,16,10,"div",53),o(),p(58,Id,15,3,"div",54),o()()()()()()()}if(t&2){let e=d.$implicit,i=k(28),n=k(39),m=c(4);a(14),f("V. ",e.version.toFixed(1),""),a(5),w(e.title),a(3),f(" ",F(25,18,F(24,15,q(23,13,e.created_at),"es"),"LL")," "),a(4),s("ngIf",e.call==null?null:e.call.text)("ngIfElse",i),a(11),s("ngIf",e.level&&e.level.length>0)("ngIfElse",n),a(10),s("ngIf",e.knowledge_area&&e.knowledge_area.length>0)("ngIfElse",n),a(8),s("ngIf",!m.isLessonLeader(e)),a(),s("ngIf",m.isLessonLeader(e)&&!m.isApprovedByFacilitator(e)),a(),s("ngIf",m.isLessonLeader(e)&&m.isApprovedByFacilitator(e)),a(),s("ngIf",m.isLeaderManagement&&m.isLessonLeader(e))}}function Fd(t,d){if(t&1&&p(0,Ld,59,21,"div",42),t&2){let e=c(3);s("ngForOf",e.filteredLessons)}}function kd(t,d){if(t&1&&(r(0,"div"),p(1,ad,4,0,"ng-container",33)(2,Fd,1,1,"ng-template",null,4,L),o()),t&2){let e=k(3),i=c(2);a(),s("ngIf",i.filteredLessons.length===0)("ngIfElse",e)}}function Td(t,d){if(t&1&&(r(0,"li",95)(1,"a",96),l(2,"Anterior"),o()()),t&2){let e=c(3);a(),s("routerLink",b(1,ki,e.prevPage))}}function Ad(t,d){if(t&1&&(r(0,"li",95)(1,"a",97),l(2,"Siguiente"),o()()),t&2){let e=c(3);a(),s("routerLink",b(1,ki,e.nextPage))}}function Md(t,d){if(t&1&&(r(0,"nav",92)(1,"ul",93),p(2,Td,3,3,"li",94)(3,Ad,3,3,"li",94),o()()),t&2){let e=c(2);a(2),s("ngIf",e.page>1),a(),s("ngIf",e.page<e.pages&&e.page!=e.pages)}}function Pd(t,d){if(t&1){let e=x();r(0,"div",24)(1,"div",29)(2,"div",30)(3,"div")(4,"div",29)(5,"div",30)(6,"h6",31),l(7," \xC1rea de conocimiento "),r(8,"button",32),v("click",function(){g(e);let n=c();return h(n.setShowAreas())}),p(9,Tl,2,0,"ng-container",33)(10,Al,1,0,"ng-template",null,0,L),o()()()(),p(12,Pl,2,1,"div",34),o()(),r(13,"div",30)(14,"div")(15,"div",29)(16,"div",30)(17,"h6",31),l(18,"Nivel acad\xE9mico "),r(19,"button",32),v("click",function(){g(e);let n=c();return h(n.setShowLevels())}),p(20,Ol,2,0,"ng-container",33)(21,Vl,1,0,"ng-template",null,0,L),o()()()(),p(23,Rl,2,1,"div",34),o()()(),p(24,rd,2,1,"div",35)(25,kd,4,2,"div",35)(26,Md,4,2,"nav",36),o()}if(t&2){let e=k(11),i=c();a(9),s("ngIf",i.showAreas)("ngIfElse",e),a(3),s("ngIf",i.showAreas),a(8),s("ngIf",i.showLevels)("ngIfElse",e),a(3),s("ngIf",i.showLevels),a(),s("ngIf",!i.hasActiveFilters()),a(),s("ngIf",i.hasActiveFilters()),a(),s("ngIf",!i.hasActiveFilters())}}function Od(t,d){if(t&1){let e=x();r(0,"details-call",98),v("isJoined",function(n){g(e);let m=c();return h(m.setNeedReload(n))}),o()}if(t&2){let e=c();s("lesson",e.callLesson)("isJoin",e.isJoin)}}var St=(()=>{class t{constructor(e,i,n,m,_,C){this._userService=e,this._lessonService=i,this._bDService=n,this._router=m,this._route=_,this.notificationService=C,this.filteredLessons=[],this.allLessons=[],this.lessons=[],this.academic_level={GARDEN:"Preescolar",SCHOOL:"Primaria",MIDDLESCHOOL:"Secundaria",HIGHSCHOOL:"Bachillerato",UNIVERSITY:"Universitario",GRADUATE:"Posgrado"},this.filter=new He(""),this.selectedAreas=[],this.selectedLevels=[],this.levels=[{label:"Preescolar",value:"GARDEN"},{label:"Primaria",value:"SCHOOL"},{label:"Secundaria",value:"MIDDLESCHOOL"},{label:"Bachillerato",value:"HIGHSCHOOL"},{label:"Universitario",value:"UNIVERSITY"},{label:"Posgrado",value:"GRADUATE"}],this.loading=!0,this.focusedLessonId=null,this.actionType=null,this.showFocusedLesson=!1,this.isLeaderManagement=!1,this.callDraftByLessonId={},this.isSavingCall={},this.showAreas=!1,this.showLevels=!1,this.title="Convocatorias",this.url=V.url,this.token=this._userService.getToken(),this.identity=this._userService.getIdentity()}ngDoCheck(){this.needReloadData&&(this.showFocusedLesson?this.loadFocusedLesson():this.actualPage(),this.needReloadData=!1)}ngOnInit(){let e=this._route.snapshot.queryParams.lesson||null,i=this._route.snapshot.queryParams.action||null;e&&i==="manage"?(this.focusedLessonId=e,this.actionType=i,this.showFocusedLesson=!0,this.isLeaderManagement=!0,this.title="Gestionar Convocatoria - Lecci\xF3n Aprobada",this.loadFocusedLesson()):(this.showFocusedLesson=!1,this.isLeaderManagement=!1,this.title="Convocatorias",this.loadInitialData()),this._route.queryParams.subscribe(n=>{let m=n.lesson||null,_=n.action||null;(m!==this.focusedLessonId||_!==this.actionType)&&(this.focusedLessonId=m,this.actionType=_,this.focusedLessonId&&this.actionType==="manage"?(this.showFocusedLesson=!0,this.isLeaderManagement=!0,this.title="Gestionar Convocatoria - Lecci\xF3n Aprobada",this.loadFocusedLesson()):(this.showFocusedLesson=!1,this.isLeaderManagement=!1,this.title="Convocatorias",this.loadInitialData()))}),this.getAllAreas(),this.startRealtimeSync()}getAllAreas(){this.areas=JSON.parse(localStorage.getItem("areas")),this.areas||this._bDService.getAllKnowledgeAreas().subscribe(e=>{e.areas&&(this.areas=e.areas,localStorage.setItem("areas",JSON.stringify(this.areas)))},e=>{console.log(e)})}loadInitialData(){this.actualPage(),this.fetchAllCalls(),this.filter.valueChanges.subscribe(()=>{this.applyFilters()})}getCalls(e=1){this.showFocusedLesson||this._lessonService.getCalls(this.token,e).subscribe({next:i=>{i.lessons&&(this.lessons=i.lessons,this.total=i.total,this.pages=i.pages,e>this.pages&&this._router.navigate(["/inicio/convocatorias"]),this.loading=!1)},error:i=>{this.loading=!1,console.log(i)}})}actualPage(){this.showFocusedLesson||this._route.params.subscribe(e=>{let i=+e.page;this.page=i,i?(this.nextPage=i+1,this.prevPage=i-1,this.prevPage<=0&&(this.prevPage=1)):(this.page=1,this.nextPage=this.page+1),this.getCalls(this.page)})}fetchAllCalls(){let e;this._lessonService.getAllCalls(this.token).subscribe({next:i=>{i.lessons&&(this.allLessons=i.lessons,this.applyFilters())},error:i=>{console.log(i)}})}applyFilters(){let e=[...this.allLessons],i=this.filter.value?.toLowerCase();i&&(e=e.filter(n=>n.title.toLowerCase().includes(i))),this.selectedAreas.length>0&&(e=e.filter(n=>n.knowledge_area.some(m=>this.selectedAreas.includes(m.name)))),this.selectedLevels.length>0&&(e=e.filter(n=>n.level&&n.level.some(m=>this.selectedLevels.includes(m)))),this.filteredLessons=e}hasActiveFilters(){return!!this.filter.value||this.selectedAreas.length>0||this.selectedLevels.length>0}setArea(e){this.selectedAreas.indexOf(e)>=0?this.selectedAreas.splice(this.selectedAreas.indexOf(e),1):this.selectedAreas.push(e),this.applyFilters()}setLevel(e){this.selectedLevels.indexOf(e)>=0?this.selectedLevels.splice(this.selectedLevels.indexOf(e),1):this.selectedLevels.push(e),this.applyFilters()}setShowAreas(){this.showAreas?this.showAreas=!1:this.showAreas=!0}setShowLevels(){this.showLevels?this.showLevels=!1:this.showLevels=!0}hasJoined(e){let i=[];return this.isLessonLeader(e)?!0:e&&e.call&&e.call.interested&&e.call.interested.length>0?(e.call.interested.forEach(n=>{let m=n._id||n;i.push(m)}),i.indexOf(this.identity._id)>=0):!1}getLesson(e){this.Templesson=e}abandonLesson(){this.editLesson(this.Templesson,"remove")}editLesson(e,i){if(i==="remove"&&this.isLessonLeader(e)){alert("Como l\xEDder de la lecci\xF3n, no puedes retirarte de tu propia convocatoria.");return}let n=Y({},e);if(i==="remove"){let _=n.call.interested.map(C=>C._id||C).indexOf(this.identity._id);if(_>=0)n.call.interested.splice(_,1);else{console.warn("Usuario no encontrado en la lista de interesados");return}}else if(i==="add"){if(n.call.interested.map(_=>_._id||_).indexOf(this.identity._id)>=0){console.warn("El usuario ya est\xE1 en la lista de interesados");return}n.call.interested.push(this.identity._id)}this._lessonService.editLesson(this.token,n).subscribe(m=>{if(m&&m.lesson._id){let _=m.lesson,C=this.lessons.findIndex(U=>U._id===_._id);C>=0&&(this.lessons[C]=Y(Y({},this.lessons[C]),_)),this.showFocusedLesson?this.loadFocusedLesson():this.getCalls(this.page),this.fetchAllCalls(),console.log(`Te has ${i==="add"?"unido a":"retirado de"} la convocatoria "${e.title}"`),i==="add"?this.notifyLeaderUserJoined(e):i==="remove"&&this.notifyLeaderUserLeft(e)}},m=>{console.error("Error al actualizar la lecci\xF3n:",m),alert(`Hubo un error al ${i==="add"?"unirse a":"retirarse de"} la convocatoria. Por favor, int\xE9ntalo de nuevo.`)})}notifyLeaderUserJoined(e){try{let i=e.leader&&(e.leader._id||e.leader)||e.author&&(e.author._id||e.author);if(!i){console.warn("No se pudo determinar el l\xEDder para notificar.");return}if(i===this.identity?._id)return;let n={user:i,type:"lesson",title:"Nuevo participante en tu convocatoria",content:`${this.identity?.name||"Alguien"} ${this.identity?.surname||""} se ha unido a la convocatoria "${e.title}"`,link:`/inicio/convocatorias?lesson=${e._id}&action=manage`,relatedId:e._id,relatedModel:"Lesson",from:this.identity?._id,priority:"medium"};this.notificationService.createNotification(n).subscribe({next:()=>console.log("Notificaci\xF3n enviada al l\xEDder por nuevo participante"),error:m=>console.warn("No se pudo enviar la notificaci\xF3n al l\xEDder:",m)})}catch(i){console.warn("Error preparando notificaci\xF3n al l\xEDder:",i)}}notifyLeaderUserLeft(e){try{let i=e.leader&&(e.leader._id||e.leader)||e.author&&(e.author._id||e.author);if(!i){console.warn("No se pudo determinar el l\xEDder para notificar salida.");return}if(i===this.identity?._id)return;let n={user:i,type:"lesson",title:"Un participante se retir\xF3 de tu convocatoria",content:`${this.identity?.name||"Alguien"} ${this.identity?.surname||""} se retir\xF3 de la convocatoria "${e.title}"`,link:`/inicio/convocatorias?lesson=${e._id}&action=manage`,relatedId:e._id,relatedModel:"Lesson",from:this.identity?._id,priority:"low"};this.notificationService.createNotification(n).subscribe({next:()=>console.log("Notificaci\xF3n enviada al l\xEDder por retiro de participante"),error:m=>console.warn("No se pudo enviar la notificaci\xF3n de retiro al l\xEDder:",m)})}catch(i){console.warn("Error preparando notificaci\xF3n de retiro al l\xEDder:",i)}}openDetailsModal(e){this.callLesson=e,setTimeout(()=>{try{let i=document.getElementById("details");if(i){let n=window.bootstrap?.Modal?.getInstance(i);n&&n.dispose();let m=new window.bootstrap.Modal(i);i.addEventListener("hidden.bs.modal",()=>{this.callLesson=null,this.showFocusedLesson?this.loadFocusedLesson():this.actualPage()},{once:!0}),m.show()}}catch(i){console.log("Error al abrir modal de detalles:",i)}},0)}openLeaveModal(e){this.getLesson(e),setTimeout(()=>{try{let i=document.getElementById("leftconvo");if(i){let n=window.bootstrap?.Modal?.getInstance(i);n&&n.dispose();let m=new window.bootstrap.Modal(i);i.addEventListener("hidePrevented.bs.modal",_=>_.preventDefault()),m.show()}}catch(i){console.log("Error al abrir modal de retirarse:",i)}},0)}setNeedReload(e){this.needReloadData=!0;try{e==="forceReload"&&window.location?.reload()}catch(i){console.warn("No se pudo forzar la recarga:",i)}}loadFocusedLesson(){this.focusedLessonId&&this._lessonService.getLesson(this.token,this.focusedLessonId).subscribe(e=>{if(e.lesson){this.lessons=[e.lesson];let i=e.lesson;this.isLessonLeader(i)&&this.isApprovedByFacilitator(i)&&this.ensureCallDraft(i),this.loading=!1,console.log("Convocatoria enfocada cargada:",e.lesson.title)}else console.error("No se pudo cargar la convocatoria enfocada"),this.loading=!1},e=>{console.error("Error cargando convocatoria enfocada:",e),this.loading=!1})}isLessonLeader(e){if(!e||!this.identity)return!1;let i=e.author&&e.author._id?e.author._id:e.author,n=e.leader&&e.leader._id?e.leader._id:e.leader;return i===this.identity._id||n===this.identity._id}isApprovedByFacilitator(e){return e?.accepted===!0||e?.state==="approved_by_expert"}ensureCallDraft(e){let i=e._id;if(!this.callDraftByLessonId[i]){let n=e.call?.text||this.generateDefaultCallText(e),m=e.call&&typeof e.call.visible=="boolean"?e.call.visible:!0;this.callDraftByLessonId[i]={text:n,visible:m}}}getCallDraftText(e){return this.ensureCallDraft(e),this.callDraftByLessonId[e._id].text}setCallDraftText(e,i){this.ensureCallDraft(e),this.callDraftByLessonId[e._id].text=i}getCallDraftVisible(e){return this.ensureCallDraft(e),this.callDraftByLessonId[e._id].visible}setCallDraftVisible(e,i){if(this.ensureCallDraft(e),this.callDraftByLessonId[e._id].visible=i,i===!1)this.submitCall(e,{forceReload:!0});else if(i===!0&&!e.call?.text){let n=this.callDraftByLessonId[e._id];(!n.text||n.text.trim().length<10)&&(n.text=this.generateDefaultCallText(e)),this.submitCall(e)}}isDraftSameAsSaved(e){this.ensureCallDraft(e);let i=_=>(_||"").replace(/\r\n/g,`
`).trim(),n=i(e?.call?.text||""),m=i(this.callDraftByLessonId[e._id]?.text||"");return n===m}generateDefaultCallText(e){let i=(e.knowledge_area||[]).map(_=>_.name).join(", "),n=(e.level||[]).map(_=>this.academic_level[_]).join(", ");return["El facilitador ha aprobado esta lecci\xF3n. \xA1Abrimos convocatoria para el desarrollo!",`T\xEDtulo: ${e.title}`,i?`\xC1reas: ${i}`:"",n?`Niveles: ${n}`:"","Si te interesa participar, \xFAnete al grupo desde esta convocatoria."].filter(Boolean).join(`
`)}submitCall(e,i){if(!this.isLessonLeader(e)||!this.isApprovedByFacilitator(e)){alert("Solo el l\xEDder puede abrir/editar la convocatoria en este estado.");return}let n=this.callDraftByLessonId[e._id];if(!n?.text||n.text.trim().length<10){alert("La descripci\xF3n de la convocatoria es muy corta. A\xF1ade m\xE1s detalles.");return}this.isSavingCall[e._id]=!0,this._lessonService.createCall(this.token,e._id,{text:n.text,visible:n.visible}).subscribe({next:m=>{if(m?.lesson){let _=this.lessons.findIndex(C=>C._id===e._id);if(_>=0){let C=this.lessons[_],M=m.lesson,U=Array.isArray(M?.knowledge_area)?M.knowledge_area:[],Mi=U.length>0&&typeof U[0]=="object"&&U?.length?U:C?.knowledge_area,Pi=M?.level&&M.level.length?M.level:C?.level;this.lessons[_]=ye(Y(Y({},C),M),{knowledge_area:Mi,level:Pi,call:M.call??C.call})}alert("Convocatoria guardada correctamente.")}if(this.isSavingCall[e._id]=!1,n.visible===!1||i?.forceReload)try{window.location?.reload()}catch{}},error:m=>{console.error("Error al guardar convocatoria",m),this.isSavingCall[e._id]=!1,alert("No se pudo guardar la convocatoria.")}})}openCall(e){if(!this.isLessonLeader(e)||!this.isApprovedByFacilitator(e)){alert("Solo el l\xEDder puede abrir la convocatoria en este estado.");return}this.ensureCallDraft(e);let i=this.callDraftByLessonId[e._id];(!i.text||i.text.trim().length<10)&&(i.text=this.generateDefaultCallText(e)),i.visible=!0,this.isSavingCall[e._id]=!0,this._lessonService.createCall(this.token,e._id,{text:i.text,visible:!0}).subscribe({next:n=>{if(this.isSavingCall[e._id]=!1,n?.lesson){let m=this.lessons.findIndex(_=>_._id===e._id);if(m>=0){let _=this.lessons[m],C=n.lesson;this.lessons[m]=ye(Y(Y({},_),C),{call:ye(Y({},C.call||_.call||{}),{text:i.text,visible:!0})})}alert("Convocatoria abierta correctamente.")}},error:n=>{console.error("Error al abrir convocatoria",n),this.isSavingCall[e._id]=!1,alert("No se pudo abrir la convocatoria.")}})}activateLesson(e){if(!this.isLessonLeader(e)||!this.isApprovedByFacilitator(e)){console.error("No tienes permisos para activar esta lecci\xF3n");return}let i=e.call?.interested?.length||0,n=`\xBFEst\xE1s seguro de que quieres activar la lecci\xF3n "${e.title}"?

Participantes actuales: ${i}

Esta acci\xF3n iniciar\xE1 oficialmente el desarrollo de la lecci\xF3n y notificar\xE1 a todos los participantes.`;if(confirm(n)){console.log("Activando lecci\xF3n:",e._id);let m=Y({},e);m.state="assigned",this._lessonService.editLesson(this.token,m).subscribe({next:_=>{console.log("Lecci\xF3n activada exitosamente:",_),this._lessonService.addLessonMessage(this.token,e._id,{text:"comienza a hablar",conversationTitle:"General"}).subscribe({next:()=>{alert("\xA1Lecci\xF3n activada! Se cre\xF3 el chat General autom\xE1ticamente.")},error:U=>{console.error("No se pudo crear la conversaci\xF3n General por defecto:",U),alert("Lecci\xF3n activada, pero hubo un problema creando el chat General.")}});let M=this.lessons.findIndex(U=>U._id===e._id);M!==-1&&(this.lessons[M]=ye(Y({},this.lessons[M]),{state:"assigned"})),this.showFocusedLesson&&this._router.navigate(["/inicio/mis-lecciones"]);try{window.location?.reload()}catch{}},error:_=>{console.error("Error activando lecci\xF3n:",_);let C="Hubo un error al activar la lecci\xF3n. Por favor, int\xE9ntalo de nuevo.";_.status===403?C="No tienes permisos para activar esta lecci\xF3n.":_.status===404?C="La lecci\xF3n no fue encontrada.":_.status===400&&(C="La lecci\xF3n no puede ser activada en su estado actual."),alert(C)}})}}getParticipantCount(e){return e.call?.interested?.length||0}hasSufficientParticipants(e){return this.getParticipantCount(e)>=2}ngOnDestroy(){this.stopRealtimeSync()}startRealtimeSync(){this.stopRealtimeSync(),this.realtimeTimer=setInterval(()=>{this.showFocusedLesson?this.loadFocusedLesson():this.getCalls(this.page||1)},7e3)}stopRealtimeSync(){this.realtimeTimer&&(clearInterval(this.realtimeTimer),this.realtimeTimer=null)}static{this.\u0275fac=function(i){return new(i||t)(y(T),y(ne),y(ie),y(z),y(te),y(Ne))}}static{this.\u0275cmp=P({type:t,selectors:[["calls"]],inputs:{isJoin:"isJoin"},standalone:!1,decls:24,vars:5,consts:[["showOptions",""],["noCallYet",""],["notAssigned",""],["leaveGroup",""],["elseTemplate",""],["noCallYet2",""],["leaveGroup2",""],[1,"card"],[1,"card-header"],[1,"m-0","text-primary","fw-bolder","float-start"],["class","card-body",4,"ngIf"],[3,"lesson","isJoin","isJoined",4,"ngIf"],["id","leftconvo","tabindex","-1","role","dialog","aria-labelledby","leaveGroup","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-dialog-centered"],[1,"modal-content"],[1,"modal-header"],["id","leftconvocatoria",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],["role","alert",1,"alert","alert-warning","mb-0"],[1,"fas","fa-exclamation-triangle","icon-message","me-2"],[1,"modal-footer"],["data-bs-dismiss","modal",1,"btn","btn-danger",3,"click"],["data-bs-dismiss","modal",1,"btn","btn-primary","text-white"],[1,"card-body"],[1,"text-muted","text-center"],["role","status",1,"spinner-border",2,"width","3rem","height","3rem"],[1,"visually-hidden"],[1,"text-muted"],[1,"row"],[1,"col"],[1,"text-primary","fw-bold","mb-0"],[1,"btn","btn-link",3,"click"],[4,"ngIf","ngIfElse"],["class","row",4,"ngIf"],[4,"ngIf"],["class","mt-3","aria-label","Page navigation",4,"ngIf"],["class","col-6",4,"ngFor","ngForOf"],[1,"col-6"],[1,"form-check"],["type","checkbox",1,"form-check-input",3,"click","id"],[1,"form-check-label",3,"for"],[4,"ngFor","ngForOf"],[1,"media-body"],[1,"col-auto"],[1,"text-center","p-2","py-3","rounded-lg","border","border-ligth","text-center","bg-warning",2,"width","120px","height","80px","overflow","hidden"],[1,"text-white","fas","fa-bullhorn",2,"font-size","50px"],[1,"row","mt-1"],[1,"col-12"],["disabled","","title","Versi\xF3n",1,"btn","w-100","btn-sm"],[1,"col-11"],["title","Ver detalles",1,"btn","btn-info","me-2",3,"click"],[1,"fas","fa-eye"],["class","mb-2",4,"ngIf"],["class","col-12 mt-2",4,"ngIf"],["class","text-break",4,"ngFor","ngForOf"],[1,"text-break"],["class","text-danger fw-bold",4,"ngIf"],[1,"text-danger","fw-bold"],["class","badge bg-primary text-white me-1 mb-1",4,"ngFor","ngForOf"],[1,"badge","bg-primary","text-white","me-1","mb-1"],["class","badge badge-info me-1 text-truncate",4,"ngFor","ngForOf"],[1,"badge","badge-info","me-1","text-truncate"],["title","Unirse",1,"btn","btn-success","me-2",3,"click"],[1,"fas","fa-user-plus"],["title","Retirarse",1,"btn","btn-danger","me-2",3,"click"],[1,"fas","fa-user-minus"],[1,"badge","bg-info","text-dark","me-2"],[1,"fas","fa-crown","me-1"],[1,"mb-2"],[1,"card","border-info"],[1,"card-body","p-2"],[1,"form-label","fw-bold","mb-1"],["rows","3","placeholder","Escribe una breve descripci\xF3n...",1,"form-control","mb-2",3,"ngModelChange","ngModel"],[1,"form-check","form-switch","mb-2"],["type","checkbox",1,"form-check-input",3,"ngModelChange","id","ngModel"],[1,"d-flex","gap-2"],["class","btn btn-success",3,"disabled","click",4,"ngIf"],[1,"btn","btn-warning",3,"click","disabled","title"],[1,"fas","fa-play-circle","me-1"],[1,"btn","btn-success",3,"click","disabled"],[1,"fas","fa-bullhorn","me-1"],[1,"fas","fa-save","me-1"],[1,"col-12","mt-2"],[1,"alert","alert-info"],[1,"fas","fa-info-circle","me-1"],["class","text-success",4,"ngIf"],["class","text-warning",4,"ngIf"],[1,"text-success"],[1,"text-warning"],["class","badge badge-info me-1 mb-1 text-truncate",4,"ngFor","ngForOf"],[1,"badge","badge-info","me-1","mb-1","text-truncate"],["aria-label","Page navigation",1,"mt-3"],[1,"pagination","justify-content-end"],["class","page-item",4,"ngIf"],[1,"page-item"],[1,"page-link","bg-primary",3,"routerLink"],[1,"page-link","bg-info",3,"routerLink"],[3,"isJoined","lesson","isJoin"]],template:function(i,n){i&1&&(r(0,"div",7)(1,"div",8)(2,"h3",9),l(3),o()(),p(4,Fl,5,0,"div",10)(5,kl,3,0,"div",10)(6,Pd,27,9,"div",10),o(),p(7,Od,1,2,"details-call",11),r(8,"div",12)(9,"div",13)(10,"div",14)(11,"div",15)(12,"h5",16),l(13,"Retirarse del grupo"),o(),u(14,"button",17),o(),r(15,"div",18)(16,"div",19),u(17,"i",20),l(18," \xBFEstas seguro que quieres retirarte de este grupo de desarrollo? "),o()(),r(19,"div",21)(20,"button",22),v("click",function(){return n.abandonLesson()}),l(21,"S\xED"),o(),r(22,"button",23),l(23,"No"),o()()()()()),i&2&&(a(3),w(n.title),a(),s("ngIf",n.loading),a(),s("ngIf",n.lessons.length==0&&!n.loading),a(),s("ngIf",n.lessons.length!=0),a(),s("ngIf",n.callLesson))},dependencies:[$,O,j,At,K,Le,G,Fi,ce,me,pe],encapsulation:2})}}return t})();var ct=t=>["/inicio","leccion",t],Ti=t=>["/inicio/mis-lecciones",t];function Vd(t,d){t&1&&(r(0,"div",11)(1,"div",12)(2,"div",13)(3,"span",14),l(4,"Loading..."),o()()()())}function Dd(t,d){t&1&&(r(0,"div",11)(1,"h4",15),l(2," No tienes ninguna lecci\xF3n asignada para asesorar. "),o()())}function Rd(t,d){if(t&1){let e=x();r(0,"div",17)(1,"div",22)(2,"input",23),v("click",function(){let n=g(e).$implicit,m=c(2);return h(m.setState(n.value))}),o(),r(3,"label",24),l(4),o()()()}if(t&2){let e=d.$implicit;a(2),S("id",e.value),a(),S("for",e.value),a(),f(" ",e.label," ")}}function Nd(t,d){if(t&1&&(r(0,"button",46),u(1,"i",47),l(2),o()),t&2){let e=c().$implicit;a(2),f(" ",e.score.toFixed(2)," ")}}function $d(t,d){if(t&1&&(r(0,"button",48)(1,"span"),u(2,"i",41),r(3,"span"),l(4),o()()()),t&2){let e=c().$implicit;a(4),f(" ",e.views,"")}}function Ud(t,d){if(t&1&&(r(0,"small"),l(1),o()),t&2){let e=c().$implicit;a(),f("",e,"...")}}function Bd(t,d){if(t&1&&(r(0,"p",49),p(1,Ud,2,1,"small",20),o()),t&2){let e=d.index;a(),s("ngIf",e==0)}}function qd(t,d){if(t&1){let e=x();r(0,"button",50),v("click",function(){g(e);let n=c().$implicit,m=c(3);return h(m.approveLesson(n))}),u(1,"i",51),l(2," Avalar Convocatoria "),o()}}function jd(t,d){if(t&1&&(r(0,"span"),l(1),o()),t&2){let e=c().$implicit,i=c(3);a(),f(" ",i.academic_level[e.level]," ")}}function Kd(t,d){t&1&&(r(0,"small",15),l(1,"No se ha asignado"),o())}function zd(t,d){if(t&1&&(r(0,"small",54),l(1),o()),t&2){let e=d.$implicit;S("title",e.name),a(),w(e.name)}}function Gd(t,d){if(t&1&&(r(0,"div",52),p(1,zd,2,2,"small",53),o()),t&2){let e=c().$implicit;a(),s("ngForOf",e.knowledge_area)}}function Hd(t,d){t&1&&(r(0,"small",15),l(1,"No se ha asignado"),o())}function Wd(t,d){if(t&1){let e=x();r(0,"div")(1,"div",26)(2,"div",11)(3,"div",27)(4,"div",16)(5,"div",28)(6,"div",16)(7,"div",17)(8,"div",29),u(9,"i",30),o()()(),r(10,"div",31)(11,"div",32)(12,"button",33)(13,"span"),l(14),o()(),p(15,Nd,3,1,"button",34)(16,$d,5,1,"button",35),o()()(),r(17,"div",17)(18,"div",16)(19,"div",17)(20,"div",36)(21,"h5",37)(22,"strong"),l(23),o()()(),r(24,"small",15),l(25),E(26,"amFromUnix"),E(27,"amLocale"),E(28,"amDateFormat"),o(),r(29,"h5")(30,"span"),l(31),o()(),p(32,Bd,2,1,"p",38),o(),r(33,"div",39)(34,"button",40),v("click",function(){let n=g(e).$implicit,m=c(3);return h(m.handleViewLesson(n))}),u(35,"i",41),o(),p(36,qd,3,0,"button",42),o()(),r(37,"div",16)(38,"div",43)(39,"div",16)(40,"div",17)(41,"strong"),l(42,"Nivel acad\xE9mico:"),o()()(),r(43,"div",16)(44,"div",17)(45,"p"),p(46,jd,2,1,"span",44)(47,Kd,2,0,"ng-template",null,0,L),o()()()(),r(49,"div",43)(50,"div",16)(51,"div",17)(52,"strong"),l(53,"\xC1reas de conocimiento:"),o()()(),r(54,"div",16)(55,"div",17),p(56,Gd,2,1,"div",45)(57,Hd,2,0,"ng-template",null,0,L),o()()()()()()()()()()}if(t&2){let e=d.$implicit,i=k(48),n=c(3);a(8),W("text-center p-2 py-3 rounded-lg border border-ligth text-center bg-",n.lesson_states[e.state].class,""),s("routerLink",b(28,ct,e._id)),a(6),f("V. ",e.version.toFixed(1),""),a(),s("ngIf",e.state=="completed"),a(),s("ngIf",e.state=="completed"),a(4),s("routerLink",b(30,ct,e._id)),a(3),w(e.title),a(2),f(" ",F(28,25,F(27,22,q(26,20,e.created_at),"es"),"LL")," "),a(5),W("badge badge-",n.lesson_states[e.state].class," me-1"),a(),f(" ",n.lesson_states[e.state].label," "),a(),s("ngForOf",e.resume.split(`
`)),a(4),s("ngIf",n.isSuggestedFacilitator(e)&&n.isProposedLesson(e)),a(10),s("ngIf",n.academic_level.hasOwnProperty(e.level))("ngIfElse",i),a(10),s("ngIf",e.knowledge_area.length>0)("ngIfElse",i)}}function Jd(t,d){if(t&1&&(r(0,"div"),p(1,Wd,59,32,"div",25),o()),t&2){let e=c(2);a(),s("ngForOf",e.lessons)}}function Yd(t,d){if(t&1&&(r(0,"button",46),u(1,"i",47),l(2),o()),t&2){let e=c().$implicit;a(2),f(" ",e.score.toFixed(2)," ")}}function Xd(t,d){if(t&1&&(r(0,"button",48)(1,"span"),u(2,"i",41),r(3,"span"),l(4),o()()()),t&2){let e=c().$implicit;a(4),f(" ",e.views,"")}}function Zd(t,d){if(t&1&&(r(0,"small"),l(1),o()),t&2){let e=c().$implicit;a(),f("",e,"...")}}function Qd(t,d){if(t&1&&(r(0,"p",49),p(1,Zd,2,1,"small",20),o()),t&2){let e=d.index;a(),s("ngIf",e==0)}}function ec(t,d){if(t&1){let e=x();r(0,"button",56),v("click",function(){g(e);let n=c().$implicit,m=c(3);return h(m.approveLesson(n))}),u(1,"i",51),l(2," Avalar Convocatoria "),o()}}function tc(t,d){if(t&1&&(r(0,"span"),l(1),o()),t&2){let e=c().$implicit,i=c(3);a(),f(" ",i.academic_level[e.level]," ")}}function ic(t,d){t&1&&(r(0,"small",15),l(1,"No se ha asignado"),o())}function nc(t,d){if(t&1&&(r(0,"small",54),l(1),o()),t&2){let e=d.$implicit;S("title",e.name),a(),w(e.name)}}function oc(t,d){if(t&1&&(r(0,"div",52),p(1,nc,2,2,"small",53),o()),t&2){let e=c().$implicit;a(),s("ngForOf",e.knowledge_area)}}function rc(t,d){t&1&&(r(0,"small",15),l(1,"No se ha asignado"),o())}function ac(t,d){if(t&1){let e=x();r(0,"div")(1,"div",26)(2,"div",11)(3,"div",27)(4,"div",16)(5,"div",28)(6,"div",16)(7,"div",17)(8,"div",29),u(9,"i",30),o()()(),r(10,"div",31)(11,"div",32)(12,"button",33)(13,"span"),l(14),o()(),p(15,Yd,3,1,"button",34)(16,Xd,5,1,"button",35),o()()(),r(17,"div",17)(18,"div",16)(19,"div",17)(20,"div",36)(21,"h5",37)(22,"strong"),l(23),o()()(),r(24,"small",15),l(25),E(26,"amFromUnix"),E(27,"amLocale"),E(28,"amDateFormat"),o(),r(29,"h5")(30,"span"),l(31),o()(),p(32,Qd,2,1,"p",38),o(),r(33,"div",39)(34,"button",40),v("click",function(){let n=g(e).$implicit,m=c(3);return h(m.handleViewLesson(n))}),u(35,"i",41),o(),p(36,ec,3,0,"button",55),o()(),r(37,"div",16)(38,"div",43)(39,"div",16)(40,"div",17)(41,"strong"),l(42,"Nivel acad\xE9mico:"),o()()(),r(43,"div",16)(44,"div",17)(45,"p"),p(46,tc,2,1,"span",44)(47,ic,2,0,"ng-template",null,0,L),o()()()(),r(49,"div",43)(50,"div",16)(51,"div",17)(52,"strong"),l(53,"\xC1reas de conocimiento:"),o()()(),r(54,"div",16)(55,"div",17),p(56,oc,2,1,"div",45)(57,rc,2,0,"ng-template",null,0,L),o()()()()()()()()()()}if(t&2){let e=d.$implicit,i=k(48),n=c(3);a(8),W("text-center p-2 py-3 rounded-lg border border-ligth text-center bg-",n.lesson_states[e.state].class,""),s("routerLink",b(28,ct,e._id)),a(6),f("V. ",e.version.toFixed(1),""),a(),s("ngIf",e.state=="completed"),a(),s("ngIf",e.state=="completed"),a(4),s("routerLink",b(30,ct,e._id)),a(3),w(e.title),a(2),f(" ",F(28,25,F(27,22,q(26,20,e.created_at),"es"),"LL")," "),a(5),W("badge badge-",n.lesson_states[e.state].class," me-1"),a(),f(" ",n.lesson_states[e.state].label," "),a(),s("ngForOf",e.resume.split(`
`)),a(4),s("ngIf",n.isSuggestedFacilitator(e)&&n.isProposedLesson(e)),a(10),s("ngIf",n.academic_level.hasOwnProperty(e.level))("ngIfElse",i),a(10),s("ngIf",e.knowledge_area.length>0)("ngIfElse",i)}}function sc(t,d){if(t&1&&(r(0,"div"),p(1,ac,59,32,"div",25),o()),t&2){let e=c(2);a(),s("ngForOf",e.allLessons)}}function lc(t,d){if(t&1&&(r(0,"li",60)(1,"a",61),l(2,"Anterior"),o()()),t&2){let e=c(3);a(),s("routerLink",b(1,Ti,e.prevPage))}}function dc(t,d){if(t&1&&(r(0,"li",60)(1,"a",62),l(2,"Siguiente"),o()()),t&2){let e=c(3);a(),s("routerLink",b(1,Ti,e.nextPage))}}function cc(t,d){if(t&1&&(r(0,"nav",57)(1,"ul",58),p(2,lc,3,3,"li",59)(3,dc,3,3,"li",59),o()()),t&2){let e=c(2);a(2),s("ngIf",e.page>1),a(),s("ngIf",e.page<e.pages&&e.page!=e.pages)}}function mc(t,d){if(t&1&&(r(0,"div",11)(1,"div",16)(2,"div",17)(3,"div",18)(4,"div",16),p(5,Rd,5,3,"div",19),o()()()(),p(6,Jd,2,1,"div",20)(7,sc,2,1,"div",20)(8,cc,4,2,"nav",21),o()),t&2){let e=c();a(5),s("ngForOf",e.states),a(),s("ngIf",e.selectedStates.length==0),a(),s("ngIf",e.selectedStates.length>0),a(),s("ngIf",e.selectedStates.length==0)}}function pc(t,d){t&1&&(r(0,"div",11)(1,"div",11)(2,"h4",15),l(3," No se encontraron lecciones para los criterios de b\xFAsqueda seleccionados. "),o()()())}function uc(t,d){if(t&1&&u(0,"img",87),t&2){let e=c(2);s("src",e.url+"get-file-user/"+e.selectedLessonForPreview.author.picture,N)}}function _c(t,d){if(t&1&&(r(0,"span",89),l(1),o()),t&2){let e=d.$implicit,i=c(3);a(),f(" ",i.academic_level[e]||e," ")}}function fc(t,d){if(t&1&&(r(0,"div",79),p(1,_c,2,1,"span",88),o()),t&2){let e=c(2);a(),s("ngForOf",e.selectedLessonForPreview.level)}}function vc(t,d){t&1&&(r(0,"p",90),l(1,"No especificado"),o())}function gc(t,d){if(t&1&&(r(0,"span",92),l(1),o()),t&2){let e=d.$implicit;a(),f(" ",e.name||e," ")}}function hc(t,d){if(t&1&&(r(0,"div",79),p(1,gc,2,1,"span",91),o()),t&2){let e=c(2);a(),s("ngForOf",e.selectedLessonForPreview.knowledge_area)}}function xc(t,d){t&1&&(r(0,"p",90),l(1,"No especificado"),o())}function bc(t,d){if(t&1&&(r(0,"div",77)(1,"div",32)(2,"strong"),l(3,"Justificaci\xF3n:"),o(),r(4,"p",82),l(5),o()()()),t&2){let e=c(2);a(5),w(e.selectedLessonForPreview.justification)}}function Cc(t,d){if(t&1){let e=x();r(0,"div",93)(1,"div")(2,"button",94),v("click",function(){g(e);let n=c(2);return h(n.rejectLessonSuggestion(n.selectedLessonForPreview))}),u(3,"i",95),l(4," Rechazar Lecci\xF3n "),o(),r(5,"button",96),v("click",function(){g(e);let n=c(2);return h(n.approveLesson(n.selectedLessonForPreview))}),u(6,"i",51),l(7," Avalar Convocatoria "),o()(),r(8,"button",97),v("click",function(){g(e);let n=c(2);return h(n.closePreviewModal())}),l(9," Cerrar "),o()()}}function yc(t,d){if(t&1){let e=x();r(0,"div",98)(1,"button",97),v("click",function(){g(e);let n=c(2);return h(n.closePreviewModal())}),l(2," Cerrar "),o()()}}function Sc(t,d){if(t&1){let e=x();r(0,"div",63)(1,"div",64)(2,"h5",65),u(3,"i",66),l(4," Previsualizaci\xF3n de Lecci\xF3n Propuesta "),o(),r(5,"button",67),v("click",function(){g(e);let n=c();return h(n.closePreviewModal())}),o()(),r(6,"div",68)(7,"div",69)(8,"div",32)(9,"div",70)(10,"div",71),p(11,uc,1,1,"img",72),r(12,"div")(13,"h6",73)(14,"strong"),l(15,"Propuesta enviada por:"),o(),l(16),o(),r(17,"small",15),u(18,"i",74),l(19),E(20,"amFromUnix"),E(21,"amLocale"),E(22,"amDateFormat"),o()()()()()(),r(23,"div",16)(24,"div",32)(25,"div",3)(26,"div",4)(27,"h5",75),u(28,"i",76),l(29," Detalles de la Lecci\xF3n "),o()(),r(30,"div",11)(31,"div",77)(32,"div",78)(33,"strong"),l(34,"T\xEDtulo:"),o(),r(35,"p",79),l(36),o()(),r(37,"div",78)(38,"strong"),l(39,"Estado:"),o(),r(40,"p",79)(41,"span",80),l(42),o()()()(),r(43,"div",77)(44,"div",78)(45,"strong"),l(46,"Niveles Acad\xE9micos:"),o(),p(47,fc,2,1,"div",81)(48,vc,2,0,"ng-template",null,1,L),o(),r(50,"div",78)(51,"strong"),l(52,"\xC1reas de Conocimiento:"),o(),p(53,hc,2,1,"div",81)(54,xc,2,0,"ng-template",null,2,L),o()(),r(56,"div",77)(57,"div",32)(58,"strong"),l(59,"Resumen:"),o(),r(60,"p",82),l(61),o()()(),r(62,"div",77)(63,"div",32)(64,"strong"),l(65,"Referencias:"),o(),r(66,"p",82),l(67),o()()(),p(68,bc,6,1,"div",83),o()()()()(),r(69,"div",84),p(70,Cc,10,0,"div",85)(71,yc,3,0,"div",86),o()()}if(t&2){let e=k(49),i=k(55),n=c();a(11),s("ngIf",n.selectedLessonForPreview.author==null?null:n.selectedLessonForPreview.author.picture),a(5),J(" ",n.selectedLessonForPreview.author==null?null:n.selectedLessonForPreview.author.name," ",n.selectedLessonForPreview.author==null?null:n.selectedLessonForPreview.author.surname," "),a(3),f(" ",F(22,20,F(21,17,q(20,15,n.selectedLessonForPreview.created_at),"es"),"LL")," "),a(17),w(n.selectedLessonForPreview.title),a(6),f(" ",(n.lesson_states[n.selectedLessonForPreview.state]==null?null:n.lesson_states[n.selectedLessonForPreview.state].label)||"Propuesta"," "),a(5),s("ngIf",n.selectedLessonForPreview.level&&n.selectedLessonForPreview.level.length>0)("ngIfElse",e),a(6),s("ngIf",n.selectedLessonForPreview.knowledge_area&&n.selectedLessonForPreview.knowledge_area.length>0)("ngIfElse",i),a(8),w(n.selectedLessonForPreview.resume),a(6),w(n.selectedLessonForPreview.references),a(),s("ngIf",n.selectedLessonForPreview.justification),a(2),s("ngIf",n.isSuggestedFacilitator(n.selectedLessonForPreview)&&n.isProposedLesson(n.selectedLessonForPreview)),a(),s("ngIf",!n.isSuggestedFacilitator(n.selectedLessonForPreview)||!n.isProposedLesson(n.selectedLessonForPreview))}}function wc(t,d){if(t&1){let e=x();r(0,"div",99),v("click",function(){g(e);let n=c();return h(n.closePreviewModal())}),o()}if(t&2){let e=c();we("show",e.showPreviewModal)}}var wt=(()=>{class t{constructor(e,i,n,m,_){this._userService=e,this._lessonService=i,this._bDService=n,this._router=m,this._route=_,this.allLessons=[],this.lessons=[],this.level={basic:"B\xE1sico",medium:"Medio",advanced:"Avanzado"},this.type={consideration:"Consideraci\xF3n",development:"Desarrollo"},this.academic_level=X,this.lesson_states=$e,this.selectedStates=[],this.states=[{label:"Invitaciones",value:"proposed",class:"secondary"},{label:"Asignada",value:"assigned",class:"warning"},{label:"Desarrollo",value:"development",class:"info"},{label:"Prueba",value:"test",class:"primary"},{label:"Terminada",value:"completed",class:"success"}],this.levels=[{label:"Preescolar",value:"garden"},{label:"Primaria",value:"school"},{label:"Secundaria",value:"highschool"},{label:"Universitario",value:"university"}],this.loading=!0,this.focusedLessonId=null,this.actionType=null,this.showFocusedLesson=!1,this.showPreviewModal=!1,this.selectedLessonForPreview=null,this.title="Asesorar lecciones",this.url=V.url,this.token=this._userService.getToken(),this.identity=this._userService.getIdentity(),this.areas}ngOnInit(){this._route.queryParams.subscribe(e=>{this.focusedLessonId=e.lesson||null,this.actionType=e.action||null,this.focusedLessonId&&this.actionType==="approve"&&(console.log("Enfocando lecci\xF3n desde notificaci\xF3n:",this.focusedLessonId),this.showFocusedLesson=!0,this.title="Aprobar Lecci\xF3n como Facilitador");let i=String(e.openPreview||"").toLowerCase()==="true",n=e.lessonId||e.lesson_id||null;i&&n&&this._lessonService.getLesson(this.token,n).subscribe({next:m=>{let _=m?.lesson||m?.data||null;_&&this.openPreviewModal(_)},error:m=>{console.error("Error cargando lecci\xF3n para openPreview:",m)}})}),this.showFocusedLesson&&this.focusedLessonId?this.getFocusedLesson():(this.getAllLessonsToAdvise(),this.actualPage()),this.getAllAreas()}setState(e){this.selectedStates.indexOf(e)>=0?this.selectedStates.splice(this.selectedStates.indexOf(e),1):this.selectedStates.push(e),this.getAllLessonsToAdvise()}getAllAreas(){this.areas=JSON.parse(localStorage.getItem("areas")),this.areas||this._bDService.getAllKnowledgeAreas().subscribe({next:e=>{e.areas&&(this.areas=e.areas,localStorage.setItem("areas",JSON.stringify(this.areas)))},error:e=>{console.log(e)}})}getAllLessonsToAdvise(){console.log("=== getAllLessonsToAdvise called ===");let e=[];this._lessonService.getAllLessonsToAdvise(this.token).subscribe({next:i=>{if(console.log("getAllLessonsToAdvise response:",i),i.lessons){if(this.lessons=i.lessons,console.log("All lessons to advise (base list):",this.lessons.length),this.allLessons.forEach(n=>{console.log(`- ${n.title} (state: ${n.state}) - suggested_facilitator: ${n.suggested_facilitator?._id} - expert: ${n.expert?._id}`)}),this.allLessons=this.lessons,this.selectedStates.length>0){console.log("Filtering by selected states:",this.selectedStates);let n=new Set(this.selectedStates);this.allLessons=this.lessons.filter(m=>n.has(m.state)),console.log("Filtered lessons:",this.allLessons.length),console.log("Selected states:",this.selectedStates)}else console.log("No states selected, showing all lessons");this.loading=!1}},error:i=>{console.log("Error in getAllLessonsToAdvise:",i),this.loading=!1}})}getLessonsToAdvise(e=1){this._lessonService.getLessonsToAdvise(this.token,e).subscribe({next:i=>{i.lessons&&(this.lessons=i.lessons,this.total=i.total,this.pages=i.pages,e>this.pages&&this._router.navigate(["/inicio/asesorar-lecciones"]),this.loading=!1)},error:i=>{this.loading=!1,console.log(i)}})}actualPage(){this._route.params.subscribe(e=>{let i=+e.page;this.page=i,i?(this.nextPage=i+1,this.prevPage=i-1,this.prevPage<=0&&(this.prevPage=1)):(this.page=1,this.nextPage=this.page+1),this.getLessonsToAdvise(this.page)})}reloadLessons(){this.getAllLessonsToAdvise()}getFocusedLesson(){this.focusedLessonId&&this._lessonService.getLesson(this.token,this.focusedLessonId).subscribe({next:e=>{e.lesson?(this.lessons=[e.lesson],this.loading=!1,console.log("Lecci\xF3n enfocada cargada:",e.lesson.title),console.log("Datos completos de la lecci\xF3n:",e.lesson),this.actionType==="approve"&&e.lesson.state==="proposed"&&this.openPreviewModal(e.lesson)):(console.error("No se pudo cargar la lecci\xF3n enfocada"),this.loading=!1)},error:e=>{console.error("Error cargando lecci\xF3n enfocada:",e),this.loading=!1}})}isSuggestedFacilitator(e){return e.suggested_facilitator&&e.suggested_facilitator._id===this.identity._id}isProposedLesson(e){return e.state==="proposed"}approveLesson(e){if(!this.isSuggestedFacilitator(e)||!this.isProposedLesson(e)){console.error("No tienes permisos para aprobar esta lecci\xF3n");return}confirm(`\xBFEst\xE1s seguro de que quieres avalar la lecci\xF3n "${e.title}" ? Esta acci\xF3n notificar\xE1 al l\xEDder para que abra la convocatoria.`)&&this._lessonService.approveFacilitatorSuggestion(this.token,e._id).subscribe({next:i=>{alert("\xA1Lecci\xF3n aprobada exitosamente! El l\xEDder ha sido notificado para abrir la convocatoria."),this.closePreviewModal(),this._router.navigate(["/inicio/asesorar-lecciones"]).then(()=>{try{window.location?.reload()}catch{}})},error:i=>{console.error("Error aprobando lecci\xF3n:",i),alert("Hubo un error al aprobar la lecci\xF3n. Por favor, int\xE9ntalo de nuevo.")}})}openPreviewModal(e){this.selectedLessonForPreview=e,this.showPreviewModal=!0,console.log("Abriendo modal de previsualizaci\xF3n para:",e.title)}closePreviewModal(){this.showPreviewModal=!1,this.selectedLessonForPreview=null}handleViewLesson(e){e.state==="proposed"&&this.isSuggestedFacilitator(e)?this.openPreviewModal(e):this._router.navigate(["/inicio/leccion",e._id])}rejectLessonSuggestion(e){if(!this.isSuggestedFacilitator(e)||!this.isProposedLesson(e)){console.error("No tienes permisos para rechazar esta lecci\xF3n");return}let n=e.accepted===!0?`\xBFEst\xE1s seguro de que quieres retirarte de la lecci\xF3n "${e.title}"? La lecci\xF3n ya fue aceptada, por lo que un administrador deber\xE1 asignar un nuevo facilitador.`:`\xBFEst\xE1s seguro de que quieres rechazar la lecci\xF3n "${e.title}"? Esta acci\xF3n notificar\xE1 al autor que debe buscar otro facilitador.`;if(confirm(n)){console.log("Rechazando/Retir\xE1ndose de lecci\xF3n:",e._id);let m=prompt("Por favor, indica el motivo (opcional):")||"El facilitador ha decidido no participar en esta lecci\xF3n.";this._lessonService.rejectFacilitatorSuggestion(this.token,e._id,m).subscribe({next:_=>{console.log("Respuesta del servidor:",_),_.withdrawn?alert("Te has retirado de la lecci\xF3n exitosamente. Un administrador asignar\xE1 un nuevo facilitador."):alert("Lecci\xF3n rechazada. El autor ha sido notificado para que busque otro facilitador."),this.closePreviewModal(),this._router.navigate(["/inicio/asesorar-lecciones"]).then(()=>{window.location.reload()})},error:_=>{console.error("Error rechazando lecci\xF3n:",_),alert("Hubo un error al procesar tu solicitud. Por favor, int\xE9ntalo de nuevo.")}})}}static{this.\u0275fac=function(i){return new(i||t)(y(T),y(ne),y(ie),y(z),y(te))}}static{this.\u0275cmp=P({type:t,selectors:[["advise-lesson"]],standalone:!1,decls:12,vars:11,consts:[["notAssigned",""],["noLevels",""],["noAreas",""],[1,"card"],[1,"card-header"],[1,"m-0","text-primary","font-weight-bolder","float-left"],["class","card-body",4,"ngIf"],["id","previewLessonModal","tabindex","-1","role","dialog","aria-labelledby","previewLessonModalLabel","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-xl"],["class","modal-content",4,"ngIf"],["class","modal-backdrop fade",3,"show","click",4,"ngIf"],[1,"card-body"],[1,"text-muted","text-center"],["role","status",1,"spinner-border",2,"width","3rem","height","3rem"],[1,"sr-only"],[1,"text-muted"],[1,"row"],[1,"col"],[1,"form-group"],["class","col",4,"ngFor","ngForOf"],[4,"ngIf"],["class","mt-3","aria-label","Page navigation",4,"ngIf"],[1,"custom-control","custom-checkbox"],["type","checkbox",1,"custom-control-input",3,"click","id"],[1,"custom-control-label",3,"for"],[4,"ngFor","ngForOf"],[1,"card","mb-2"],[1,"media-body"],[1,"col-auto"],[2,"width","100%","height","80px","overflow","hidden","cursor","pointer",3,"routerLink"],[1,"text-white","fas","fa-chalkboard-teacher",2,"font-size","50px"],[1,"row","mt-1"],[1,"col-12"],["disabled","","title","Versi\xF3n",1,"btn","w-100","btn-sm"],["class","btn w-100 btn-sm","disabled","","title","Calificaci\xF3n",4,"ngIf"],["class","btn w-100 btn-sm","disabled","","title","Visualizaciones",4,"ngIf"],[2,"cursor","pointer",3,"routerLink"],[1,"my-0"],["class","text-justify",4,"ngFor","ngForOf"],[1,"text-end","col-auto"],["title","Ver lecci\xF3n",1,"btn","btn-info","ms-2",3,"click"],[1,"fas","fa-eye"],["class","btn btn-success ms-2","title","Avalar Lecci\xF3n ",3,"click",4,"ngIf"],[1,"col-6"],[4,"ngIf","ngIfElse"],["style","display: flex; flex-wrap: wrap;",4,"ngIf","ngIfElse"],["disabled","","title","Calificaci\xF3n",1,"btn","w-100","btn-sm"],[1,"fas","fa-star"],["disabled","","title","Visualizaciones",1,"btn","w-100","btn-sm"],[1,"text-justify"],["title","Avalar Lecci\xF3n ",1,"btn","btn-success","ms-2",3,"click"],[1,"fas","fa-check-circle","me-1"],[2,"display","flex","flex-wrap","wrap"],["class","badge badge-info me-1 mb-1 text-truncate",3,"title",4,"ngFor","ngForOf"],[1,"badge","badge-info","me-1","mb-1","text-truncate",3,"title"],["class","btn btn-success ms-2","title","Avalar lecci\xF3n",3,"click",4,"ngIf"],["title","Avalar lecci\xF3n",1,"btn","btn-success","ms-2",3,"click"],["aria-label","Page navigation",1,"mt-3"],[1,"pagination","justify-content-end"],["class","page-item",4,"ngIf"],[1,"page-item"],[1,"page-link","bg-primary",3,"routerLink"],[1,"page-link","bg-info",3,"routerLink"],[1,"modal-content"],[1,"modal-header","bg-primary","text-white"],["id","previewLessonModalLabel",1,"modal-title"],[1,"fas","fa-eye","me-2"],["type","button","aria-label","Close",1,"btn-close","btn-close-white",3,"click"],[1,"modal-body"],[1,"row","mb-4"],[1,"alert","alert-info"],[1,"d-flex","align-items-center"],["class","rounded-circle me-3","width","50","height","50","alt","Autor",3,"src",4,"ngIf"],[1,"mb-1"],[1,"fas","fa-calendar","me-1"],[1,"mb-0"],[1,"fas","fa-info-circle","me-2"],[1,"row","mb-3"],[1,"col-md-6"],[1,"mt-1"],[1,"badge","bg-secondary"],["class","mt-1",4,"ngIf","ngIfElse"],[1,"mt-1",2,"white-space","pre-line"],["class","row mb-3",4,"ngIf"],[1,"modal-footer"],["class","w-100 d-flex justify-content-between",4,"ngIf"],["class","w-100 d-flex justify-content-end",4,"ngIf"],["width","50","height","50","alt","Autor",1,"rounded-circle","me-3",3,"src"],["class","badge bg-info me-1 mb-1",4,"ngFor","ngForOf"],[1,"badge","bg-info","me-1","mb-1"],[1,"text-muted","mt-1"],["class","badge bg-success me-1 mb-1",4,"ngFor","ngForOf"],[1,"badge","bg-success","me-1","mb-1"],[1,"w-100","d-flex","justify-content-between"],["type","button",1,"btn","btn-danger","me-2",3,"click"],[1,"fas","fa-times","me-1"],["type","button",1,"btn","btn-success",3,"click"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"w-100","d-flex","justify-content-end"],[1,"modal-backdrop","fade",3,"click"]],template:function(i,n){i&1&&(r(0,"div",3)(1,"div",4)(2,"h3",5),l(3),o()(),p(4,Vd,5,0,"div",6)(5,Dd,3,0,"div",6)(6,mc,9,4,"div",6)(7,pc,4,0,"div",6),o(),r(8,"div",7)(9,"div",8),p(10,Sc,72,23,"div",9),o()(),p(11,wc,1,2,"div",10)),i&2&&(a(3),w(n.title),a(),s("ngIf",n.loading),a(),s("ngIf",n.lessons.length==0&&!n.loading&&n.selectedStates.length==0),a(),s("ngIf",n.lessons.length!=0),a(),s("ngIf",n.lessons.length>0&&n.allLessons.length==0&&!n.loading),a(),Pe("display",n.showPreviewModal?"block":"none"),we("show",n.showPreviewModal),a(2),s("ngIf",n.selectedLessonForPreview),a(),s("ngIf",n.showPreviewModal))},dependencies:[$,O,G,ce,me,pe],encapsulation:2})}}return t})();var ue=()=>{let t=pt(z),d=pt(T),e=d.getIdentity(),i=d.getToken();return!e||!i?t.parseUrl("/"):e.actived?!0:(alert("Tu cuenta a\xFAn no ha sido activada por un administrador. Acceso limitado a recursos y lecciones por protecci\xF3n de datos (GDPR)."),t.parseUrl("/inicio"))};var Ec=[{path:"",component:ii,canActivate:[Bt],children:[{path:"",component:Je},{path:"post",component:Je},{path:"post/:page",component:Je},{path:"publicacion/:id",component:ni},{path:"usuarios",component:vt},{path:"usuarios/:page",component:vt},{path:"lecciones",component:xt,canActivate:[ue]},{path:"lecciones/:page",component:xt,canActivate:[ue]},{path:"leccion/:id",component:Zt,canActivate:[ue]},{path:"mis-lecciones",component:yt,canActivate:[ue]},{path:"mis-lecciones/:page",component:yt,canActivate:[ue]},{path:"asesorar-lecciones",component:wt,canActivate:[ue]},{path:"asesorar-lecciones/:page",component:wt,canActivate:[ue]},{path:"convocatorias",component:St,canActivate:[ue]},{path:"convocatorias/:page",component:St,canActivate:[ue]},{path:"recursos",component:Ct,canActivate:[ue]},{path:"recursos/:page",component:Ct,canActivate:[ue]},{path:"**",component:Je}]}],Ai=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=tt({type:t})}static{this.\u0275inj=et({imports:[_t.forChild(Ec),_t]})}}return t})();var gp=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=tt({type:t})}static{this.\u0275inj=et({imports:[Tt,Vt,Dt,Rt,Qt,Ai,zt,Gt,Ue]})}}return t})();export{gp as HomeModule};
