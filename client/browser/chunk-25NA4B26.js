import{a as q,b as H,c as z,d as ye,e as V,f as Se}from"./chunk-D2BCPON4.js";import"./chunk-4MSQXD5K.js";import{a as _e,c as he,d as xe}from"./chunk-DEF5ACRI.js";import{a as P}from"./chunk-JI6LXSDG.js";import{a as f}from"./chunk-43WXPJ7N.js";import{a as M}from"./chunk-L5TQBNKQ.js";import{B as fe,C as ve,c as le,d as X,e as me,f as de,h as ce,k as Y,m as pe,q as ge,r as ue}from"./chunk-GWDAXWU7.js";import{$b as y,Ba as re,Ca as oe,Da as s,Ha as W,Hb as N,Ib as O,Jb as I,Na as r,Oa as a,Pa as c,Rb as se,Ua as w,Va as d,W as ae,X as B,Ya as b,Z as Q,ac as be,bc as v,cc as E,dc as Ce,eb as l,ec as Z,fb as h,gb as S,hb as T,ma as G,na as F,nb as A,ob as u,pa as n,sa as g,sb as C,ta as x,tb as j,ua as $,ub as R,ya as p}from"./chunk-3BHHYQXT.js";var Ie=[{id:"send",buttonClass:"btn-info",iconClass:"fa-paper-plane",spanContent:"Enviar mensaje",routerLink:"/mensajes/nuevo",subOptions:[]},{id:"received",buttonClass:"btn-success",iconClass:"fa-envelope-square",spanContent:"Mensajes recibidos",routerLink:"/mensajes/recibidos",subOptions:[]},{id:"sended",buttonClass:"btn-warning",iconClass:"fa-share-square",spanContent:"Mensajes enviados",routerLink:"/mensajes/enviados",subOptions:[]}],L={teacher:{label:"Docente",class:"badge-success"},guest:{label:"Invitado",class:"badge-orange"},student:{label:"Estudiante",class:"badge-info"},expert:{label:"Facilitador",class:"badge-purple"},admin:{label:"Administrador",class:"badge-green"},delegated_admin:{label:"Administrador",class:"badge-green"},lesson_manager:{label:"Gestor de Lecciones",class:"badge-primary"}};var Ue=()=>["/mensajes","recibidos"],Me=t=>[t],De=()=>["active"];function Be(t,m){t&1&&(r(0,"span"),c(1,"i",16),a())}function Ge(t,m){if(t&1&&(r(0,"li",21)(1,"a",22),l(2),a()()),t&2){let e=m.$implicit;n(),s("routerLink",u(2,Me,e.routerLink)),n(),h(e.text)}}function $e(t,m){if(t&1&&(r(0,"div",17)(1,"div",18)(2,"ul",19),p(3,Ge,3,4,"li",20),a()()()),t&2){let e=d().$implicit;b("id",e.id),n(3),s("ngForOf",e.subOptions)}}function qe(t,m){if(t&1&&(r(0,"div",11)(1,"button",12)(2,"div"),c(3,"i"),r(4,"span",13),l(5),a()(),p(6,Be,2,0,"span",14),a(),p(7,$e,4,2,"div",15),a()),t&2){let e=m.$implicit;n(),W("btn w-100 text-start d-flex justify-content-between py-2 ",e.buttonClass,""),oe("data-bs-target","#",e.id,""),s("routerLink",u(14,Me,e.routerLink))("routerLinkActive",A(16,De)),re("aria-controls",e.id),n(2),W("text-ligth fas ",e.iconClass,""),n(2),S(" ",e.spanContent," "),n(),s("ngIf",e.subOptions.length>0),n(),s("ngIf",e.subOptions.length>0)}}var Ee=(()=>{class t{constructor(e,i,o){this._userService=e,this._router=i,this._route=o,this.title="Mensajes",this.url=M.url,this.token=e.getToken(),this.identity=e.getIdentity(),this.menuOptions=Ie}ngOnInit(){}static{this.\u0275fac=function(i){return new(i||t)(g(f),g(v),g(y))}}static{this.\u0275cmp=x({type:t,selectors:[["message"]],standalone:!1,decls:14,vars:4,consts:[[1,"container"],[1,"row","py-3"],[1,"col-3",2,"position","relative"],["id","menu",1,"accordion",2,"width","253px","position","fixed"],[1,"card","rounded"],[1,"card-header","bg-primary","text-white"],[1,"stretched-link","text-white",3,"routerLink"],[1,"card-title","text-center","mb-0"],[1,"text-ligth","fas","fa-inbox"],["class","card mt-2 rounded",4,"ngFor","ngForOf"],[1,"col-9","ps-0"],[1,"card","mt-2","rounded"],["type","button","data-bs-toggle","collapse","aria-expanded","true",3,"routerLink","routerLinkActive"],[1,"ms-2"],[4,"ngIf"],["class","collapse","aria-labelledby","headingOne","data-parent","#menu",3,"id",4,"ngIf"],[1,"text-ligth","fas","fa-sort-down"],["aria-labelledby","headingOne","data-parent","#menu",1,"collapse",3,"id"],[1,"card-body","py-2","px-0"],[1,"nav","flex-column"],["subclass","nav-item",4,"ngFor","ngForOf"],["subclass","nav-item"],["routerLinkActive","active",1,"nav-link","dropdown-item","text-start",3,"routerLink"]],template:function(i,o){i&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"a",6)(7,"h4",7)(8,"strong"),c(9,"i",8),l(10),a()()()()(),p(11,qe,8,17,"div",9),a()(),r(12,"div",10),c(13,"router-outlet"),a()()()),i&2&&(n(6),s("routerLink",A(3,Ue)),n(4),S(" ",o.title,""),n(),s("ngForOf",o.menuOptions))},dependencies:[O,I,be,E,Ce],styles:["@media (min-width: 992px){.container[_ngcontent-%COMP%] > .row[_ngcontent-%COMP%] > .col-3[_ngcontent-%COMP%] > .accordion#menu[_ngcontent-%COMP%]{position:fixed!important;top:76px!important;left:115px!important;width:253px!important;z-index:98!important}.container[_ngcontent-%COMP%] > .row[_ngcontent-%COMP%] > .col-9.ps-0[_ngcontent-%COMP%]{padding-left:15px!important;padding-top:88px!important}}.col-9.ps-0[_ngcontent-%COMP%]{padding-top:72px}"]})}}return t})();var K=class{constructor(m,e,i){this.emitter=m,this.receiver=e,this.text=i}};var Le=t=>({"is-invalid":t}),He=()=>["/mensajes","enviados"];function ze(t,m){t&1&&(r(0,"div",19),c(1,"i",20),l(2," Hubo un error enviando el mensaje. Intentalo m\xE1s tarde. "),a())}function Ve(t,m){t&1&&(r(0,"div",21),c(1,"i",22),l(2," El mensaje se ha enviado correctamente. Ir a"),r(3,"a",23),l(4," mensajes enviados."),a()()),t&2&&(n(3),s("routerLink",A(1,He)))}function Ke(t,m){t&1&&c(0,"img",27)}function Je(t,m){if(t&1&&c(0,"img",28),t&2){let e=d().item,i=d();b("src",i.url+"get-image-user/"+e.picture,F)}}function Qe(t,m){if(t&1&&(r(0,"div",24),p(1,Ke,1,0,"img",25)(2,Je,1,1,"img",26),a(),l(3),c(4,"br"),r(5,"small"),l(6),a()),t&2){let e=m.item,i=d();n(),s("ngIf",!e.picture),n(),s("ngIf",e.picture),n(),T(" ",e.name," ",e.surname," "),n(3),h((i.categories[e.role]==null?null:i.categories[e.role].label)||e.role||"Rol no definido")}}function We(t,m){t&1&&(r(0,"div",30),l(1," Debes elegir el destinatario del mensaje. "),a())}function Xe(t,m){if(t&1&&(r(0,"div"),p(1,We,2,0,"div",29),a()),t&2){let e=d();n(),s("ngIf",e.f.to.errors.required)}}function Ye(t,m){t&1&&(r(0,"div"),l(1," El campo mensaje es requerido. "),a())}function Ze(t,m){if(t&1&&(r(0,"div",31),p(1,Ye,2,0,"div",13),a()),t&2){let e=d();n(),s("ngIf",e.f.message.errors.required)}}var te=(()=>{class t{constructor(e,i,o,_){this._userService=e,this._messageService=i,this._route=o,this._router=_,this.items=[{name:null,surname:null}],this.formError=!1,this.title="Mensaje nuevo",this.identity=this._userService.getIdentity(),this.token=this._userService.getToken(),this.url=M.url,this.categories=L,this.messageForm=new ce({to:new Y("",X.required),message:new Y("",X.required)}),this.getAllUsers()}onChanges(){this.messageForm.valueChanges.subscribe(e=>{e&&(this.status=null,this.submitted=!1)})}get f(){return this.messageForm.controls}onSubmit(){this.submitted=!0,!this.messageForm.invalid&&(this.message=new K(this.identity._id,this.messageForm.value.to,this.messageForm.value.message),this._messageService.addMessage(this.token,this.message).subscribe(e=>{e&&e.message._id?(this.messageForm.reset(),this.status="success"):this.status="error"},e=>{this.status="error",console.log(e)}))}getAllUsers(){let e;this._userService.getAllUsers().subscribe(i=>{i.users&&(this.allUsers=i.users,this.allUsers=this.allUsers.filter(o=>o._id!=this.identity._id),this.items=this.allUsers)},i=>{console.log(i)})}customSearchFn(e,i){if(!i)return!1;let o=i?.role,_=o&&L[o]?.label?L[o].label:o||"";e=(e||"").toLocaleLowerCase();let Oe=(i.name||"").toLocaleLowerCase(),Pe=(i.surname||"").toLocaleLowerCase(),Ae=_.toLocaleLowerCase();return Oe.indexOf(e)>-1||Pe.includes(e)||Ae.includes(e)}static{this.\u0275fac=function(i){return new(i||t)(g(f),g(P),g(y),g(v))}}static{this.\u0275cmp=x({type:t,selectors:[["newMessage"]],standalone:!1,decls:26,vars:14,consts:[[1,"card"],[1,"card-header"],[1,"m-0","text-primary","font-weight-bolder","float-left"],[1,"card-body"],[3,"ngSubmit","formGroup"],[1,"form-group","row"],[1,"col"],["class","alert alert-danger fade show text-center m-0","role","alert",4,"ngIfSuccessMessage","ngIf"],["class","alert alert-success fade show text-center m-0","role","alert",4,"ngIfSuccessMessage","ngIf"],["for","toinput",1,"col-sm-2","col-form-label"],[1,"col-sm-10"],["bindLabel","name","formControlName","to","clearAllText","Limpiar","notFoundText","No se encuentra el usuario",3,"items","searchFn","ngClass"],["ng-option-tmp",""],[4,"ngIf"],["for","colFormLabel",1,"col-sm-2","col-form-label"],["formControlName","message","rows","3",1,"form-control",3,"change","ngClass"],["class","invalid-feedback",4,"ngIf"],[1,"form-group","text-end"],["type","submit",1,"btn","btn-info"],["role","alert",1,"alert","alert-danger","fade","show","text-center","m-0"],[1,"fas","fa-times-circle","icon-message","me-2"],["role","alert",1,"alert","alert-success","fade","show","text-center","m-0"],[1,"fas","fa-check-circle","icon-message","me-2"],[1,"alert-link",3,"routerLink"],[1,"flex-shrink-0","rounded-circle","border-1","overflow-hidden","me-2","float-left",2,"width","30px","height","30px"],["class","img-fluid","src","assets/images/user-default.png",4,"ngIf"],["class","img-fluid",3,"src",4,"ngIf"],["src","assets/images/user-default.png",1,"img-fluid"],[1,"img-fluid",3,"src"],["class","invalid-feedback-select",4,"ngIf"],[1,"invalid-feedback-select"],[1,"invalid-feedback"]],template:function(i,o){i&1&&(r(0,"div",0)(1,"div",1)(2,"h3",2),l(3),a()(),r(4,"div",3)(5,"form",4),w("ngSubmit",function(){return o.onSubmit()}),r(6,"div",5)(7,"div",6),p(8,ze,3,0,"div",7)(9,Ve,5,2,"div",8),a()(),r(10,"div",5)(11,"label",9),l(12,"Para*"),a(),r(13,"div",10)(14,"ng-select",11),p(15,Qe,7,5,"ng-template",12),a(),p(16,Xe,2,1,"div",13),a()(),r(17,"div",5)(18,"label",14),l(19,"Mensaje*"),a(),r(20,"div",10)(21,"textarea",15),w("change",function(){return o.onChanges()}),a(),p(22,Ze,2,1,"div",16),a()(),r(23,"div",17)(24,"button",18),l(25,"Enviar"),a()()()()()),i&2&&(n(3),h(o.title),n(2),s("formGroup",o.messageForm),n(3),s("ngIf",o.status==="error"),n(),s("ngIf",o.status==="success"),n(5),s("items",o.items)("searchFn",o.customSearchFn)("ngClass",u(10,Le,o.submitted&&o.f.to.errors)),n(2),s("ngIf",o.submitted&&o.f.to.errors),n(5),s("ngClass",u(12,Le,o.submitted&&o.f.message.errors)),n(),s("ngIf",o.submitted&&o.f.message.errors))},dependencies:[N,I,pe,le,me,de,ge,ue,E,he,_e],encapsulation:2})}}return t})();var it=t=>({"bg-light":t}),ke=t=>["/perfil",t],Fe=t=>["/mensajes/recibidos",t];function nt(t,m){t&1&&(r(0,"div",3)(1,"div",19)(2,"div",20)(3,"span",21),l(4,"Loading..."),a()()()())}function at(t,m){t&1&&(r(0,"div",3)(1,"h4",22),l(2," No has recibido ning\xFAn mensaje. "),a()())}function rt(t,m){t&1&&c(0,"img",34)}function ot(t,m){if(t&1&&c(0,"img",35),t&2){let e=d().$implicit,i=d(2);b("src",i.url+"get-image-user/"+e.emitter.picture,F)}}function st(t,m){if(t&1&&(r(0,"small"),l(1),a()),t&2){let e=d().$implicit,i=d(2);n(),S(" (",(i.categories[e.emitter.role]==null?null:i.categories[e.emitter.role].label)||e.emitter.role||"Usuario",") ")}}function lt(t,m){if(t&1&&(r(0,"div")(1,"div",24)(2,"div",3)(3,"div",25)(4,"div",26)(5,"div",27),p(6,rt,1,0,"img",28)(7,ot,1,1,"img",29),a()(),r(8,"div",30)(9,"h6"),l(10," De: "),r(11,"a",31)(12,"strong"),l(13),a(),p(14,st,2,1,"small",5),a(),c(15,"br"),r(16,"small",22),l(17),C(18,"amFromUnix"),C(19,"amLocale"),C(20,"amDateFormat"),a()()()(),r(21,"div",32),c(22,"div",33),C(23,"linky"),a()()()()),t&2){let e=m.$implicit,i=d(2);n(),s("ngClass",u(20,it,!e.viewed)),n(4),s("routerLink",u(22,ke,e.emitter._id)),n(),s("ngIf",!e.emitter.picture),n(),s("ngIf",e.emitter.picture),n(4),s("routerLink",u(24,ke,e.emitter._id)),n(2),T(" ",e.emitter.name," ",e.emitter.surname," "),n(),s("ngIf",e.emitter&&e.emitter.role),n(3),S("Recibido el: ",R(20,15,R(19,12,j(18,10,e.created_at),"es"),"LLL"),""),n(5),b("innerHTML",i.newLines(j(23,18,e.text)),G)}}function mt(t,m){if(t&1&&(r(0,"div"),p(1,lt,24,26,"div",23),a()),t&2){let e=d();n(),s("ngForOf",e.messages)}}function dt(t,m){if(t&1&&(r(0,"li",39)(1,"a",40),l(2,"Anterior"),a()()),t&2){let e=d(2);n(),s("routerLink",u(1,Fe,e.prevPage))}}function ct(t,m){if(t&1&&(r(0,"li",39)(1,"a",41),l(2,"Siguiente"),a()()),t&2){let e=d(2);n(),s("routerLink",u(1,Fe,e.nextPage))}}function pt(t,m){if(t&1&&(r(0,"nav",36)(1,"ul",37),p(2,dt,3,3,"li",38)(3,ct,3,3,"li",38),a()()),t&2){let e=d();n(2),s("ngIf",e.page>1),n(),s("ngIf",e.page<e.pages&&e.page!=e.pages)}}var ie=(()=>{class t{constructor(e,i,o,_){this._userService=e,this._messageService=i,this._route=o,this._router=_,this.messages=[],this.loading=!0,this.title="Recibidos",this.identity=this._userService.getIdentity(),this.token=this._userService.getToken(),this.url=M.url,this.categories=L,this.page=1}ngOnInit(){this.actualPage();let e=parseInt(localStorage.getItem("unviewedMessages"));e&&e>0&&setTimeout(()=>{this.setviewed(),localStorage.setItem("unviewedMessages","0")},1e3)}getReceivedMessages(e=1){this._messageService.getReceivedMessages(this.token,e).subscribe(i=>{i.messages&&(this.messages=i.messages,this.total=i.total,this.pages=i.pages),e>this.pages&&this._router.navigate(["/mensajes/recibidos"]),this.loading=!1},i=>{this.loading=!1,console.log(i)})}actualPage(){this._route.params.subscribe(e=>{let i=+e.page;this.page=i,i?(this.nextPage=i+1,this.prevPage=i-1,this.prevPage<=0&&(this.prevPage=1)):(this.page=1,this.nextPage=this.page+1),this.getReceivedMessages(this.page)})}setDelete(e){this.tempMessageId=e}delete(){this._messageService.removeMessage(this.token,this.tempMessageId).subscribe(e=>{e.message&&(this.tempMessageId=null,this.getReceivedMessages(this.page))},e=>{console.log(e)})}setviewed(){this._messageService.setViewedMessage(this.token).subscribe(e=>{},e=>{console.log(e)})}newLines(e){let i="";return e&&e.split(`
`).forEach(o=>{i+=`<p>${o}</p>`}),i}static{this.\u0275fac=function(i){return new(i||t)(g(f),g(P),g(y),g(v))}}static{this.\u0275cmp=x({type:t,selectors:[["received"]],standalone:!1,decls:25,vars:5,consts:[[1,"card"],[1,"card-header"],[1,"m-0","text-primary","fw-bolder","float-start"],[1,"card-body"],["class","card-body",4,"ngIf"],[4,"ngIf"],["class","mt-3","aria-label","Page navigation",4,"ngIf"],["id","delete","tabindex","-1","role","dialog","aria-labelledby","delete","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-dialog-centered"],[1,"modal-content"],[1,"modal-header"],["id","deleteTitle",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],["role","alert",1,"alert","alert-warning","mb-0"],[1,"fas","fa-exclamation-triangle","icon-message","me-2"],[1,"modal-footer"],["data-bs-dismiss","modal",1,"btn","btn-danger",3,"click"],["data-bs-dismiss","modal",1,"btn","btn-primary","text-white"],[1,"text-muted","text-center"],["role","status",1,"spinner-border",2,"width","3rem","height","3rem"],[1,"visually-hidden"],[1,"text-muted"],[4,"ngFor","ngForOf"],[1,"card",3,"ngClass"],[1,"row","align-items-center"],[1,"col-1"],[1,"picture","rounded-circle","border-4","overflow-hidden",2,"width","40px","height","40px",3,"routerLink"],["class","img-fluid","src","assets/images/user-default.png",4,"ngIf"],["class","img-fluid",3,"src",4,"ngIf"],[1,"col"],[1,"text-primary",3,"routerLink"],[1,"row"],[1,"col","offset-1",3,"innerHTML"],["src","assets/images/user-default.png",1,"img-fluid"],[1,"img-fluid",3,"src"],["aria-label","Page navigation",1,"mt-3"],[1,"pagination","justify-content-end"],["class","page-item",4,"ngIf"],[1,"page-item"],[1,"page-link","bg-primary",3,"routerLink"],[1,"page-link","bg-info",3,"routerLink"]],template:function(i,o){i&1&&(r(0,"div",0)(1,"div",1)(2,"h3",2),l(3),a()(),r(4,"div",3),p(5,nt,5,0,"div",4)(6,at,3,0,"div",4)(7,mt,2,1,"div",5)(8,pt,4,2,"nav",6),a()(),r(9,"div",7)(10,"div",8)(11,"div",9)(12,"div",10)(13,"h5",11),l(14,"Eliminar mensaje"),a(),c(15,"button",12),a(),r(16,"div",13)(17,"div",14),c(18,"i",15),l(19," \xBFEsta seguro que desea eliminar el mensaje? "),a()(),r(20,"div",16)(21,"button",17),w("click",function(){return o.delete()}),l(22,"S\xED"),a(),r(23,"button",18),l(24,"No"),a()()()()()),i&2&&(n(3),h(o.title),n(2),s("ngIf",o.loading),n(),s("ngIf",o.messages.length==0&&!o.loading),n(),s("ngIf",o.messages.length!=0),n(),s("ngIf",o.messages.length>0))},dependencies:[N,O,I,E,q,H,z,V],encapsulation:2})}}return t})();var gt=t=>({"bg-light":t}),Te=t=>["/perfil",t],je=t=>["/mensajes/enviados",t];function ut(t,m){t&1&&(r(0,"div",3)(1,"div",19)(2,"div",20)(3,"span",21),l(4,"Loading..."),a()()()())}function ft(t,m){t&1&&(r(0,"div",3)(1,"h4",22),l(2," No hay mensajes enviados. "),a()())}function vt(t,m){t&1&&c(0,"img",34)}function _t(t,m){if(t&1&&c(0,"img",35),t&2){let e=d().$implicit,i=d(2);b("src",i.url+"get-image-user/"+e.receiver.picture,F)}}function ht(t,m){if(t&1&&(r(0,"small"),l(1),a()),t&2){let e=d().$implicit,i=d(2);n(),S(" (",(i.categories[e.receiver.role]==null?null:i.categories[e.receiver.role].label)||e.receiver.role||"Usuario",") ")}}function xt(t,m){if(t&1&&(r(0,"div")(1,"div",24)(2,"div",3)(3,"div",25)(4,"div",26)(5,"div",27),p(6,vt,1,0,"img",28)(7,_t,1,1,"img",29),a()(),r(8,"div",30)(9,"h6"),l(10," Enviado a: "),r(11,"a",31)(12,"strong"),l(13),a(),p(14,ht,2,1,"small",5),a(),c(15,"br"),r(16,"small",22),l(17),C(18,"amFromUnix"),C(19,"amLocale"),C(20,"amDateFormat"),a()()()(),r(21,"div",32),c(22,"div",33),C(23,"linky"),a()()()()),t&2){let e=m.$implicit,i=d(2);n(),s("ngClass",u(20,gt,!e.viewed)),n(4),s("routerLink",u(22,Te,e.receiver._id)),n(),s("ngIf",!e.receiver.picture),n(),s("ngIf",e.receiver.picture),n(4),s("routerLink",u(24,Te,e.receiver._id)),n(2),T(" ",e.receiver.name," ",e.receiver.surname," "),n(),s("ngIf",e.receiver&&e.receiver.role),n(3),S("Enviado el: ",R(20,15,R(19,12,j(18,10,e.created_at),"es"),"LLL"),""),n(5),b("innerHTML",i.newLines(j(23,18,e.text)),G)}}function bt(t,m){if(t&1&&(r(0,"div"),p(1,xt,24,26,"div",23),a()),t&2){let e=d();n(),s("ngForOf",e.messages)}}function Ct(t,m){if(t&1&&(r(0,"li",39)(1,"a",40),l(2,"Anterior"),a()()),t&2){let e=d(2);n(),s("routerLink",u(1,je,e.prevPage))}}function yt(t,m){if(t&1&&(r(0,"li",39)(1,"a",41),l(2,"Siguiente"),a()()),t&2){let e=d(2);n(),s("routerLink",u(1,je,e.nextPage))}}function St(t,m){if(t&1&&(r(0,"nav",36)(1,"ul",37),p(2,Ct,3,3,"li",38)(3,yt,3,3,"li",38),a()()),t&2){let e=d();n(2),s("ngIf",e.page>1),n(),s("ngIf",e.page<e.pages&&e.page!=e.pages)}}var ne=(()=>{class t{constructor(e,i,o,_){this._userService=e,this._messageService=i,this._route=o,this._router=_,this.messages=[],this.loading=!0,this.title="Enviados",this.identity=this._userService.getIdentity(),this.token=this._userService.getToken(),this.url=M.url,this.categories=L,this.page=1}ngOnInit(){this.actualPage()}getEmittedMessages(e=1){this._messageService.getEmittedMessages(this.token,e).subscribe(i=>{i.messages&&(this.messages=i.messages,this.total=i.total,this.pages=i.pages),e>this.pages&&this._router.navigate(["/mensajes/enviados"]),this.loading=!1},i=>{this.loading=!1,console.log(i)})}actualPage(){this._route.params.subscribe(e=>{let i=+e.page;this.page=i,i?(this.nextPage=i+1,this.prevPage=i-1,this.prevPage<=0&&(this.prevPage=1)):(this.page=1,this.nextPage=this.page+1),this.getEmittedMessages(this.page)})}setDelete(e){this.tempMessageId=e}delete(){this._messageService.removeMessage(this.token,this.tempMessageId).subscribe(e=>{e.message&&(this.tempMessageId=null,this.getEmittedMessages(this.page))},e=>{console.log(e)})}newLines(e){let i="";return e&&e.split(`
`).forEach(o=>{i+=`<p>${o}</p>`}),i}static{this.\u0275fac=function(i){return new(i||t)(g(f),g(P),g(y),g(v))}}static{this.\u0275cmp=x({type:t,selectors:[["sended"]],standalone:!1,decls:25,vars:5,consts:[[1,"card"],[1,"card-header"],[1,"m-0","text-primary","fw-bolder","float-start"],[1,"card-body"],["class","card-body",4,"ngIf"],[4,"ngIf"],["class","mt-3","aria-label","Page navigation",4,"ngIf"],["id","delete","tabindex","-1","role","dialog","aria-labelledby","delete","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-dialog-centered"],[1,"modal-content"],[1,"modal-header"],["id","deleteTitle",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],["role","alert",1,"alert","alert-warning","mb-0"],[1,"fas","fa-exclamation-triangle","icon-message","me-2"],[1,"modal-footer"],["data-bs-dismiss","modal",1,"btn","btn-danger",3,"click"],["data-bs-dismiss","modal",1,"btn","btn-primary","text-white"],[1,"text-muted","text-center"],["role","status",1,"spinner-border",2,"width","3rem","height","3rem"],[1,"visually-hidden"],[1,"text-muted"],[4,"ngFor","ngForOf"],[1,"card",3,"ngClass"],[1,"row","align-items-center"],[1,"col-1"],[1,"picture","rounded-circle","border-4","overflow-hidden",2,"width","40px","height","40px",3,"routerLink"],["class","img-fluid","src","assets/images/user-default.png",4,"ngIf"],["class","img-fluid",3,"src",4,"ngIf"],[1,"col"],[1,"text-primary",3,"routerLink"],[1,"row"],[1,"col","offset-1",3,"innerHTML"],["src","assets/images/user-default.png",1,"img-fluid"],[1,"img-fluid",3,"src"],["aria-label","Page navigation",1,"mt-3"],[1,"pagination","justify-content-end"],["class","page-item",4,"ngIf"],[1,"page-item"],[1,"page-link","bg-primary",3,"routerLink"],[1,"page-link","bg-info",3,"routerLink"]],template:function(i,o){i&1&&(r(0,"div",0)(1,"div",1)(2,"h3",2),l(3),a()(),r(4,"div",3),p(5,ut,5,0,"div",4)(6,ft,3,0,"div",4)(7,bt,2,1,"div",5)(8,St,4,2,"nav",6),a()(),r(9,"div",7)(10,"div",8)(11,"div",9)(12,"div",10)(13,"h5",11),l(14,"Eliminar mensaje"),a(),c(15,"button",12),a(),r(16,"div",13)(17,"div",14),c(18,"i",15),l(19," \xBFEsta seguro que desea eliminar el mensaje? "),a()(),r(20,"div",16)(21,"button",17),w("click",function(){return o.delete()}),l(22,"S\xED"),a(),r(23,"button",18),l(24,"No"),a()()()()()),i&2&&(n(3),h(o.title),n(2),s("ngIf",o.loading),n(),s("ngIf",o.messages.length==0&&!o.loading),n(),s("ngIf",o.messages.length!=0),n(),s("ngIf",o.messages.length>0))},dependencies:[N,O,I,E,q,H,z,V],encapsulation:2})}}return t})();var Re=(()=>{class t{constructor(e,i,o){this._userService=e,this._router=i,this._route=o,this.identity=e.getIdentity(),this.title="Informaci\xF3n"}static{this.\u0275fac=function(i){return new(i||t)(g(f),g(v),g(y))}}static{this.\u0275cmp=x({type:t,selectors:[["info"]],standalone:!1,decls:5,vars:1,consts:[[1,"card"],[1,"card-header"],[1,"m-0","text-primary","font-weight-bolder","float-left"],[1,"card-body"]],template:function(i,o){i&1&&(r(0,"div",0)(1,"div",1)(2,"h3",2),l(3),a()(),c(4,"div",3),a()),i&2&&(n(3),h(o.title))},encapsulation:2})}}return t})();var J=(()=>{class t{constructor(e,i){this._router=e,this._userService=i}canActivate(){let e=this._userService.getIdentity(),i=this._userService.getToken();return!e||!i?(this._router.navigate(["/"]),!1):e.actived?!0:(alert("Tu cuenta a\xFAn no ha sido activada. No puedes enviar mensajes privados hasta que un administrador apruebe tu cuenta (protecci\xF3n de datos GDPR)."),this._router.navigate(["/inicio"]),!1)}static{this.\u0275fac=function(i){return new(i||t)(Q(v),Q(f))}}static{this.\u0275prov=ae({token:t,factory:t.\u0275fac})}}return t})();var It=[{path:"",component:Ee,canActivate:[J],children:[{path:"",redirectTo:"recibidos",pathMatch:"full"},{path:"nuevo",component:te},{path:"recibidos",component:ie},{path:"recibidos/:page",component:ie},{path:"enviados",component:ne},{path:"enviados/:page",component:ne},{path:"informacion",component:Re},{path:"**",component:te}]}],Ne=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=$({type:t})}static{this.\u0275inj=B({imports:[Z.forChild(It),Z]})}}return t})();var vi=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=$({type:t})}static{this.\u0275inj=B({providers:[J],imports:[se,fe,ve,Ne,xe,ye,Se]})}}return t})();export{vi as MessageModule};
