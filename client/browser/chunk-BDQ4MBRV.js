import{a as z,b as D}from"./chunk-LDL6SX5C.js";import"./chunk-ZTCIQEDA.js";import{a as j}from"./chunk-O5WKCLKG.js";import{a as L}from"./chunk-H2O7B6BZ.js";import"./chunk-M6MDGVAZ.js";import{$b as R,Ba as I,Da as o,Hb as w,Ib as O,Jb as A,Kb as M,Lb as F,Na as n,Oa as i,Pa as p,Rb as V,Ta as h,Ua as u,Va as l,ba as x,ca as b,cc as q,eb as a,ec as $,fb as v,gb as C,hb as y,nb as k,ob as g,pa as r,sa as S,ta as E,ya as m}from"./chunk-3BHHYQXT.js";var P=t=>({active:t}),N=()=>["/admin/lecciones"],U=t=>({lesson:t,action:"openAddCall"}),G=t=>({lesson:t,action:"openCall"}),B=()=>["/admin/lecciones-propuestas"],H=t=>({lesson:t}),J=()=>["/admin/recursos-propuestos"],K=t=>({resourceId:t}),Q=()=>["/inicio/recursos"],W=t=>({resourceId:t,resubmit:!0});function X(t,c){if(t&1&&(n(0,"span",10),a(1),i()),t&2){let e=l();r(),C(" ",e.convocatorias.length+e.convocatoriasAbiertas.length," ")}}function Y(t,c){if(t&1&&(n(0,"span",10),a(1),i()),t&2){let e=l();r(),v(e.sugerencias.length)}}function Z(t,c){if(t&1&&(n(0,"span",10),a(1),i()),t&2){let e=l();r(),v(e.recursos.length)}}function ee(t,c){if(t&1&&(n(0,"span",10),a(1),i()),t&2){let e=l();r(),v(e.featuredLessonsCount)}}function te(t,c){t&1&&(n(0,"div",23),p(1,"i",24),a(2,"No hay convocatorias pendientes por abrir. "),i())}function ne(t,c){if(t&1&&(n(0,"span",36),a(1),i()),t&2){let e=l().$implicit;r(),C(" v",e.version.toFixed(1)," ")}}function ie(t,c){t&1&&(n(0,"span",37),a(1,"-"),i())}function ae(t,c){if(t&1&&(n(0,"span",38),a(1),i()),t&2){let e=l().$implicit;r(),C(" \u2192 Nueva: v",(e.version+1).toFixed(1)," ")}}function re(t,c){t&1&&(n(0,"span",38),a(1," V1 "),i())}function oe(t,c){if(t&1&&(n(0,"span"),a(1),i()),t&2){let e=l().$implicit;r(),y("",e.leader.name," ",e.leader.surname,"")}}function se(t,c){t&1&&(n(0,"span",37),a(1,"Sin l\xEDder asignado"),i())}function ce(t,c){t&1&&(n(0,"span"),a(1,"Abrir convocatoria"),i())}function le(t,c){t&1&&(n(0,"span"),a(1,"Abrir nueva versi\xF3n"),i())}function de(t,c){if(t&1&&(n(0,"tr")(1,"td"),a(2),i(),n(3,"td"),m(4,ne,2,1,"span",29)(5,ie,2,0,"span",30)(6,ae,2,1,"span",31)(7,re,2,0,"span",31),i(),n(8,"td")(9,"span",32),a(10),i()(),n(11,"td"),m(12,oe,2,2,"span",33)(13,se,2,0,"span",30),i(),n(14,"td",27)(15,"a",34),p(16,"i",35),m(17,ce,2,0,"span",33)(18,le,2,0,"span",33),i()()()),t&2){let e=c.$implicit,d=l(3);r(2),v(e.title),r(2),o("ngIf",e.version!==void 0),r(),o("ngIf",e.version===void 0),r(),o("ngIf",e.version!==void 0&&e.state==="completed"),r(),o("ngIf",e.state==="proposed"),r(3),v(d.getInterestedCount(e)),r(2),o("ngIf",e.leader),r(),o("ngIf",!e.leader),r(2),o("routerLink",k(13,N))("queryParams",g(14,U,e._id))("title",e.state==="completed"?"Abrir convocatoria para nueva versi\xF3n":"Abrir convocatoria"),r(2),o("ngIf",e.state==="proposed"),r(),o("ngIf",e.state==="completed")}}function me(t,c){if(t&1&&(n(0,"div",25)(1,"table",26)(2,"thead")(3,"tr")(4,"th"),a(5,"T\xEDtulo de lecci\xF3n"),i(),n(6,"th"),a(7,"Versi\xF3n"),i(),n(8,"th"),a(9,"Interesados"),i(),n(10,"th"),a(11,"L\xEDder"),i(),n(12,"th",27),a(13,"Acciones"),i()()(),n(14,"tbody"),m(15,de,19,16,"tr",28),i()()()),t&2){let e=l(2);r(15),o("ngForOf",e.convocatorias)}}function pe(t,c){t&1&&(n(0,"div",23),p(1,"i",24),a(2,"No hay convocatorias abiertas pendientes por asignar. "),i())}function _e(t,c){if(t&1&&(n(0,"span",36),a(1),i()),t&2){let e=l().$implicit;r(),C("v",e.version,"")}}function ue(t,c){t&1&&(n(0,"span",37),a(1,"-"),i())}function ve(t,c){if(t&1&&(n(0,"span"),a(1),i()),t&2){let e=l().$implicit;r(),y("",e.leader.name," ",e.leader.surname,"")}}function ge(t,c){t&1&&(n(0,"span",37),a(1,"Sin l\xEDder asignado"),i())}function fe(t,c){if(t&1&&(n(0,"tr")(1,"td"),a(2),i(),n(3,"td"),m(4,_e,2,1,"span",29)(5,ue,2,0,"span",30),i(),n(6,"td")(7,"span",32),a(8),i()(),n(9,"td"),m(10,ve,2,2,"span",33)(11,ge,2,0,"span",30),i(),n(12,"td",27)(13,"a",39),p(14,"i",40),a(15,"Ver convocatoria "),i()()()),t&2){let e=c.$implicit,d=l(3);r(2),v(e.title),r(2),o("ngIf",e.version!==void 0),r(),o("ngIf",e.version===void 0),r(3),v(d.getInterestedCount(e)),r(2),o("ngIf",e.leader),r(),o("ngIf",!e.leader),r(2),o("routerLink",k(8,N))("queryParams",g(9,G,e._id))}}function xe(t,c){if(t&1&&(n(0,"div",25)(1,"table",26)(2,"thead")(3,"tr")(4,"th"),a(5,"T\xEDtulo de lecci\xF3n"),i(),n(6,"th"),a(7,"Versi\xF3n"),i(),n(8,"th"),a(9,"Interesados"),i(),n(10,"th"),a(11,"L\xEDder"),i(),n(12,"th",27),a(13,"Acciones"),i()()(),n(14,"tbody"),m(15,fe,16,11,"tr",28),i()()()),t&2){let e=l(2);r(15),o("ngForOf",e.convocatoriasAbiertas)}}function be(t,c){if(t&1){let e=h();n(0,"div",2)(1,"div",11)(2,"div",12)(3,"h5",13),p(4,"i",14),a(5,"Convocatorias por abrir "),i(),n(6,"button",15),u("click",function(){x(e);let s=l();return b(s.reloadConvocatorias())}),p(7,"i",16),a(8," Recargar "),i()(),n(9,"div",17),m(10,te,3,0,"div",18)(11,me,16,1,"div",19),i()(),n(12,"div",20)(13,"div",21)(14,"h5",13),p(15,"i",22),a(16,"Convocatorias por asignar "),i(),n(17,"button",15),u("click",function(){x(e);let s=l();return b(s.reloadConvocatoriasAbiertas())}),p(18,"i",16),a(19," Recargar "),i()(),n(20,"div",17),m(21,pe,3,0,"div",18)(22,xe,16,1,"div",19),i()()()}if(t&2){let e=l();r(10),o("ngIf",e.convocatorias.length===0),r(),o("ngIf",e.convocatorias.length>0),r(10),o("ngIf",e.convocatoriasAbiertas.length===0),r(),o("ngIf",e.convocatoriasAbiertas.length>0)}}function he(t,c){t&1&&(n(0,"div",23),p(1,"i",24),a(2,"No hay sugerencias de lecciones pendientes. "),i())}function Ce(t,c){if(t&1&&(n(0,"span"),a(1),i()),t&2){let e=l().$implicit;r(),y("",e.author.name," ",e.author.surname,"")}}function ke(t,c){t&1&&(n(0,"span",37),a(1,"Sin autor"),i())}function Te(t,c){if(t&1&&(n(0,"tr")(1,"td"),a(2),i(),n(3,"td"),m(4,Ce,2,2,"span",33)(5,ke,2,0,"span",30),i(),n(6,"td",27)(7,"a",43),p(8,"i",40),a(9,"Ver propuesta "),i()()()),t&2){let e=c.$implicit;r(2),v(e.title),r(2),o("ngIf",e.author),r(),o("ngIf",!e.author),r(2),o("routerLink",k(5,B))("queryParams",g(6,H,e._id))}}function Se(t,c){if(t&1&&(n(0,"div",25)(1,"table",26)(2,"thead")(3,"tr")(4,"th"),a(5,"T\xEDtulo"),i(),n(6,"th"),a(7,"Autor"),i(),n(8,"th",27),a(9,"Acciones"),i()()(),n(10,"tbody"),m(11,Te,10,8,"tr",28),i()()()),t&2){let e=l(2);r(11),o("ngForOf",e.sugerencias)}}function ye(t,c){if(t&1){let e=h();n(0,"div",2)(1,"div",11)(2,"div",41)(3,"h5",13),p(4,"i",42),a(5,"Sugerencias de lecciones "),i(),n(6,"button",15),u("click",function(){x(e);let s=l();return b(s.reloadSugerencias())}),p(7,"i",16),a(8," Recargar "),i()(),n(9,"div",17),m(10,he,3,0,"div",18)(11,Se,12,1,"div",19),i()()()}if(t&2){let e=l();r(10),o("ngIf",e.sugerencias.length===0),r(),o("ngIf",e.sugerencias.length>0)}}function Pe(t,c){t&1&&(n(0,"div",23),p(1,"i",24),a(2,"No hay recursos pendientes por aprobar. "),i())}function Ee(t,c){if(t&1&&(n(0,"span"),a(1),i()),t&2){let e=l().$implicit;r(),y("",e.author.name," ",e.author.surname,"")}}function Ie(t,c){t&1&&(n(0,"span",37),a(1,"Sin autor"),i())}function we(t,c){if(t&1&&(n(0,"a",53),p(1,"i",54),a(2,"Volver a sugerir "),i()),t&2){let e=l().$implicit;o("routerLink",k(2,Q))("queryParams",g(3,W,e._id))}}function Oe(t,c){if(t&1){let e=h();n(0,"tr")(1,"td"),a(2),n(3,"a",47),a(4," Ver en lista "),i()(),n(5,"td"),m(6,Ee,2,2,"span",33)(7,Ie,2,0,"span",30),i(),n(8,"td")(9,"span",36),a(10),i()(),n(11,"td",27)(12,"button",48),u("click",function(){let s=x(e).$implicit,_=l(3);return b(_.aprobar(s._id))}),p(13,"i",49),a(14,"Aprobar "),i(),n(15,"button",50),u("click",function(){let s=x(e).$implicit,_=l(3);return b(_.rechazar(s._id))}),p(16,"i",51),a(17,"Rechazar "),i(),m(18,we,3,5,"a",52),i()()}if(t&2){let e=c.$implicit;I("id","res-"+e._id),r(2),C(" ",e.name," "),r(),o("routerLink",k(8,J))("queryParams",g(9,K,e._id)),r(3),o("ngIf",e.author),r(),o("ngIf",!e.author),r(3),v(e.type),r(8),o("ngIf",e.rejected)}}function Ae(t,c){if(t&1&&(n(0,"div",25)(1,"table",26)(2,"thead")(3,"tr")(4,"th"),a(5,"Nombre"),i(),n(6,"th"),a(7,"Autor"),i(),n(8,"th"),a(9,"Tipo"),i(),n(10,"th",27),a(11,"Acciones"),i()()(),n(12,"tbody"),m(13,Oe,19,11,"tr",28),i()()()),t&2){let e=l(2);r(13),o("ngForOf",e.recursos)}}function Me(t,c){if(t&1){let e=h();n(0,"div",2)(1,"div",11)(2,"div",44)(3,"h5",13),p(4,"i",45),a(5,"Recursos por aprobar "),i(),n(6,"button",46),u("click",function(){x(e);let s=l();return b(s.reloadRecursos())}),p(7,"i",16),a(8," Recargar "),i()(),n(9,"div",17),m(10,Pe,3,0,"div",18)(11,Ae,14,1,"div",19),i()()()}if(t&2){let e=l();r(10),o("ngIf",e.recursos.length===0),r(),o("ngIf",e.recursos.length>0)}}function Fe(t,c){if(t&1){let e=h();n(0,"div",2)(1,"app-featured-lessons",55),u("lessonsCountChange",function(s){x(e);let _=l();return b(_.onFeaturedLessonsCountChange(s))}),i()()}}var Ue=(()=>{class t{constructor(e,d,s,_){this.tasks=e,this.userService=d,this.lessonService=s,this.route=_,this.activeTab="convocatorias",this.convocatorias=[],this.convocatoriasAbiertas=[],this.recursos=[],this.sugerencias=[],this.featuredLessonsCount=0}ngOnInit(){this.route.queryParams.subscribe(e=>{e.tab&&(this.activeTab=e.tab)}),this.reloadConvocatorias(),this.reloadConvocatoriasAbiertas(),this.reloadSugerencias(),this.reloadRecursos()}setActiveTab(e){this.activeTab=e,this.loadActiveTabData()}loadActiveTabData(){switch(this.activeTab){case"convocatorias":this.reloadConvocatorias(),this.reloadConvocatoriasAbiertas();break;case"sugerencias":this.reloadSugerencias();break;case"recursos":this.reloadRecursos();break}}reloadConvocatorias(){this.tasks.listConvocatorias().subscribe({next:e=>{this.convocatorias=e.lessons||[],this.normalizeLessons(this.convocatorias)},error:()=>this.convocatorias=[]})}reloadConvocatoriasAbiertas(){this.tasks.listConvocatoriasAbiertas().subscribe({next:e=>{this.convocatoriasAbiertas=e.items||e.lessons||[],this.normalizeLessons(this.convocatoriasAbiertas)},error:()=>this.convocatoriasAbiertas=[]})}reloadRecursos(){this.tasks.listRecursosPendientes().subscribe({next:e=>this.recursos=e.resources||[],error:()=>this.recursos=[]}),console.log(this.recursos)}reloadSugerencias(){this.tasks.listSugerencias().subscribe({next:e=>this.sugerencias=e.lessons||[],error:()=>this.sugerencias=[]})}aprobar(e){confirm("\xBFEst\xE1s seguro de que quieres aprobar este recurso?")&&this.tasks.aprobarRecurso(e).subscribe({next:()=>{alert("Recurso aprobado exitosamente"),this.reloadRecursos()},error:d=>{alert("Error al aprobar el recurso: "+(d.error?.message||"Error desconocido"))}})}rechazar(e){let d=prompt("Por favor, introduce el motivo del rechazo:");d!==null&&d.trim()!==""&&this.tasks.rechazarRecurso(e,d.trim()).subscribe({next:()=>{alert("Recurso rechazado exitosamente"),this.reloadRecursos()},error:s=>{alert("Error al rechazar el recurso: "+(s.error?.message||"Error desconocido"))}})}normalizeLessons(e){if(!Array.isArray(e))return;let d=this.userService.getToken()||"";e.forEach(s=>{let _=typeof s?.leader=="string"?s.leader:s?.leader?._id;_&&(!s.leader||!s.leader.name)&&this.userService.getUser(_).subscribe({next:f=>{f&&f.user&&(s.leader={_id:f.user._id,name:f.user.name,surname:f.user.surname,email:f.user.email})},error:()=>{}}),(s.version===void 0||s.version===null)&&this.lessonService.getLesson(d,s._id).subscribe({next:f=>{let T=f?.lesson;T&&(T.version!==void 0&&(s.version=T.version),!s.leader&&T.leader&&(s.leader=T.leader))},error:()=>{}})})}getInterestedCount(e){return e&&e.call&&Array.isArray(e.call.interested)?e.call.interested.length:0}onFeaturedLessonsCountChange(e){this.featuredLessonsCount=e}static{this.\u0275fac=function(d){return new(d||t)(S(z),S(L),S(j),S(R))}}static{this.\u0275cmp=E({type:t,selectors:[["admin-pending-tasks"]],decls:27,vars:21,consts:[[1,"container-fluid","mt-4"],[1,"row","mb-4"],[1,"col-12"],[1,"mb-3"],[1,"nav","nav-tabs","mb-4"],[1,"nav-item"],[1,"nav-link",2,"cursor","pointer",3,"click","ngClass"],["class","badge-notify",4,"ngIf"],[1,"row",3,"ngSwitch"],["class","col-12",4,"ngSwitchCase"],[1,"badge-notify"],[1,"card","shadow-sm"],[1,"card-header","bg-primary","text-white","d-flex","justify-content-between","align-items-center"],[1,"mb-0"],[1,"fas","fa-bullhorn","me-2"],[1,"btn","btn-sm","btn-light",3,"click"],[1,"fas","fa-sync-alt"],[1,"card-body"],["class","alert alert-info",4,"ngIf"],["class","table-responsive",4,"ngIf"],[1,"card","shadow-sm","mt-4"],[1,"card-header","bg-success","text-white","d-flex","justify-content-between","align-items-center"],[1,"fas","fa-user-check","me-2"],[1,"alert","alert-info"],[1,"fas","fa-info-circle","me-2"],[1,"table-responsive"],[1,"table","table-hover"],[1,"text-end"],[4,"ngFor","ngForOf"],["class","badge bg-secondary",4,"ngIf"],["class","text-muted",4,"ngIf"],["class","ms-1 text-muted",4,"ngIf"],[1,"badge","bg-info"],[4,"ngIf"],[1,"btn","btn-sm","btn-outline-primary",3,"routerLink","queryParams","title"],[1,"fas","fa-bullhorn","me-1"],[1,"badge","bg-secondary"],[1,"text-muted"],[1,"ms-1","text-muted"],["title","Ver convocatoria",1,"btn","btn-sm","btn-outline-success",3,"routerLink","queryParams"],[1,"fas","fa-eye","me-1"],[1,"card-header","bg-info","text-white","d-flex","justify-content-between","align-items-center"],[1,"fas","fa-lightbulb","me-2"],["title","Ver propuesta",1,"btn","btn-sm","btn-outline-info",3,"routerLink","queryParams"],[1,"card-header","bg-warning","text-dark","d-flex","justify-content-between","align-items-center"],[1,"fas","fa-file-alt","me-2"],[1,"btn","btn-sm","btn-dark",3,"click"],["title","Ver en recursos propuestos",1,"ms-2","small",3,"routerLink","queryParams"],["title","Aprobar recurso",1,"btn","btn-sm","btn-success","me-2",3,"click"],[1,"fas","fa-check","me-1"],["title","Rechazar recurso",1,"btn","btn-sm","btn-danger","me-2",3,"click"],[1,"fas","fa-times","me-1"],["class","btn btn-sm btn-outline-primary","title","Volver a sugerir",3,"routerLink","queryParams",4,"ngIf"],["title","Volver a sugerir",1,"btn","btn-sm","btn-outline-primary",3,"routerLink","queryParams"],[1,"fas","fa-edit","me-1"],[3,"lessonsCountChange"]],template:function(d,s){d&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),a(4,"Gesti\xF3n acad\xE9mica y tareas"),i(),n(5,"ul",4)(6,"li",5)(7,"a",6),u("click",function(){return s.setActiveTab("convocatorias")}),a(8," Convocatorias por gestionar "),m(9,X,2,1,"span",7),i()(),n(10,"li",5)(11,"a",6),u("click",function(){return s.setActiveTab("sugerencias")}),a(12," Sugerencias de lecciones "),m(13,Y,2,1,"span",7),i()(),n(14,"li",5)(15,"a",6),u("click",function(){return s.setActiveTab("recursos")}),a(16," Recursos por aprobar "),m(17,Z,2,1,"span",7),i()(),n(18,"li",5)(19,"a",6),u("click",function(){return s.setActiveTab("mejores-lecciones")}),a(20,"Mejores lecciones "),m(21,ee,2,1,"span",7),i()()()()(),n(22,"div",8),m(23,be,23,4,"div",9)(24,ye,12,2,"div",9)(25,Me,12,2,"div",9)(26,Fe,2,0,"div",9),i()()),d&2&&(r(7),o("ngClass",g(13,P,s.activeTab==="convocatorias")),r(2),o("ngIf",s.convocatorias.length>0||s.convocatoriasAbiertas.length>0),r(2),o("ngClass",g(15,P,s.activeTab==="sugerencias")),r(2),o("ngIf",s.sugerencias.length>0),r(2),o("ngClass",g(17,P,s.activeTab==="recursos")),r(2),o("ngIf",s.recursos.length>0),r(2),o("ngClass",g(19,P,s.activeTab==="mejores-lecciones")),r(2),o("ngIf",s.featuredLessonsCount>0),r(),o("ngSwitch",s.activeTab),r(),o("ngSwitchCase","convocatorias"),r(),o("ngSwitchCase","sugerencias"),r(),o("ngSwitchCase","recursos"),r(),o("ngSwitchCase","mejores-lecciones"))},dependencies:[V,w,O,A,M,F,$,q,D],styles:[".nav-tabs[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{color:#6c757d;border:none;border-bottom:3px solid transparent;padding:.75rem 1.5rem;transition:all .3s ease}.nav-tabs[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]:hover{border-bottom-color:#dee2e6;background-color:transparent}.nav-tabs[_ngcontent-%COMP%]   .nav-link.active[_ngcontent-%COMP%]{color:#0d6efd;border-bottom-color:#0d6efd;background-color:transparent;font-weight:600}.card[_ngcontent-%COMP%]{border:none;border-radius:8px}.card-header[_ngcontent-%COMP%]{border-radius:8px 8px 0 0!important;padding:1rem 1.5rem}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:600;color:#495057;border-bottom:2px solid #dee2e6}.theme-dark[_ngcontent-%COMP%]   .nav-tabs[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{color:var(--rd-muted)!important;border-bottom-color:transparent!important}.theme-dark[_ngcontent-%COMP%]   .nav-tabs[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]:hover{border-bottom-color:#2a2f36!important;color:var(--rd-text)!important}.theme-dark[_ngcontent-%COMP%]   .nav-tabs[_ngcontent-%COMP%]   .nav-link.active[_ngcontent-%COMP%]{color:var(--rd-primary)!important;border-bottom-color:var(--rd-primary)!important}.theme-dark[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{color:var(--rd-text)!important;border-bottom-color:#2a2f36!important}.theme-dark[_ngcontent-%COMP%]   .btn-outline-primary[_ngcontent-%COMP%], .theme-dark[_ngcontent-%COMP%]   .btn-outline-success[_ngcontent-%COMP%], .theme-dark[_ngcontent-%COMP%]   .btn-light[_ngcontent-%COMP%]{color:var(--rd-text)!important;border-color:#2a2f36!important;background-color:transparent!important}.theme-dark[_ngcontent-%COMP%]   .btn-light[_ngcontent-%COMP%]:hover{background-color:#1f2937!important}.badge-notify[_ngcontent-%COMP%]{display:inline-block;min-width:20px;padding:3px 6px;font-size:11px;font-weight:600;line-height:1;color:#fff;background-color:#dc3545;border-radius:10px;margin-left:8px;vertical-align:middle;animation:_ngcontent-%COMP%_pulse-badge 2s ease-in-out infinite}@keyframes _ngcontent-%COMP%_pulse-badge{0%,to{transform:scale(1);opacity:1}50%{transform:scale(1.1);opacity:.9}}.theme-dark[_ngcontent-%COMP%]   .badge-notify[_ngcontent-%COMP%]{background-color:#e74c3c}"]})}}return t})();export{Ue as PendingTasksComponent};
