import{a as H}from"./chunk-TSWB7RUP.js";import{a as z}from"./chunk-5P7CLSZR.js";import{a as k}from"./chunk-H2O7B6BZ.js";import{a as B}from"./chunk-M6MDGVAZ.js";import{A as U,C as G,c as T,d as f,e as N,f as L,k as D,m as q,p as j,q as R,r as A}from"./chunk-GWDAXWU7.js";import{$b as V,Da as d,Fb as E,Hb as F,Ib as O,Jb as P,Na as r,Oa as o,Pa as c,Rb as M,Ua as y,Va as u,X as h,Ya as v,bc as $,eb as n,ec as x,fb as I,gb as _,ob as w,pa as a,sa as p,ta as C,ua as g,ya as m}from"./chunk-3BHHYQXT.js";var K=e=>({"is-invalid":e});function X(e,l){e&1&&(r(0,"div",32),c(1,"i",33),n(2," No se ha podido cambiar la contrase\xF1a. "),o())}function Y(e,l){e&1&&(r(0,"div",34),c(1,"i",35),n(2," La contrase\xF1a se ha cambiado correctamente. "),o())}function Z(e,l){e&1&&(r(0,"span"),n(1,"*"),o())}function ee(e,l){if(e&1&&(r(0,"div"),n(1),o()),e&2){let t=u(2).$implicit;a(),_(" El campo ",t.label.toLowerCase()," es obligatorio. ")}}function te(e,l){if(e&1&&(r(0,"div"),n(1),o()),e&2){let t=u(3);a(),_(" La contrase\xF1a debe tener m\xEDnimo ",t.passwordMinLength," caracteres. ")}}function ie(e,l){e&1&&(r(0,"div"),n(1," Las contrase\xF1as no coinciden. "),o())}function re(e,l){if(e&1&&(r(0,"div",40),m(1,ee,2,1,"div",37)(2,te,2,1,"div",37)(3,ie,2,0,"div",37),o()),e&2){let t=u().$implicit,i=u();a(),d("ngIf",i.f[t.id].errors.required),a(),d("ngIf",t.id=="newPassword"&&i.f[t.id].errors.minlength),a(),d("ngIf",t.id=="confirmPassword"&&i.f[t.id].errors.mustMatch)}}function oe(e,l){if(e&1&&(r(0,"div",25)(1,"label",36),n(2),m(3,Z,2,0,"span",37),o(),r(4,"div",38),c(5,"input",39),m(6,re,4,3,"div",29),o()()),e&2){let t=l.$implicit,i=u();a(),v("for",t.id),a(),_(" ",t.label,""),a(),d("ngIf",t.required),a(2),v("id",t.id),v("formControlName",t.id),v("placeholder",t.placeholder),d("ngClass",w(8,K,i.submitted&&i.f[t.id].errors)),a(),d("ngIf",i.submitted&&i.f[t.id].errors)}}function ne(e,l){e&1&&(r(0,"div",32),c(1,"i",33),n(2," La contrase\xF1a ingresada no es correcta. "),o())}function ae(e,l){e&1&&(r(0,"div",32),c(1,"i",33),n(2," No ha sido posible eliminar la cuenta de usuario. Por favor comunicate con el administrador de RedDin\xE1mica. "),o())}function se(e,l){e&1&&(r(0,"div",34),c(1,"i",35),n(2," Tu cuenta se ha eliminado correctamente. "),o())}function de(e,l){e&1&&(r(0,"div"),n(1," La contrase\xF1a es obligatoria. "),o())}function le(e,l){if(e&1&&(r(0,"div",40),m(1,de,2,0,"div",37),o()),e&2){let t=u();a(),d("ngIf",t.password.errors.required)}}var Q=(()=>{class e{constructor(t,i,s,S,b){this._userService=t,this._formBuilder=i,this._route=s,this._router=S,this._location=b,this.user=new z,this.submitted=!1,this.deleteSubmitted=!1,this.title="Opciones de seguridad",this.url=B.url,this.identity=this._userService.getIdentity(),this.fieldsForm=[{id:"actualPassword",label:"Contrase\xF1a actual",type:"password",placeholder:"Contrase\xF1a actual",required:!0},{id:"newPassword",label:"Nueva contrase\xF1a",type:"password",placeholder:"Nueva contrase\xF1a",required:!0},{id:"confirmPassword",label:"Confirmar contrase\xF1a",type:"password",placeholder:"Confirmar nueva contrase\xF1a",required:!0}]}ngOnInit(){this.passwordMinLength=6,this.editPassword=this._formBuilder.group({actualPassword:["",f.required],newPassword:["",[f.required,f.minLength(this.passwordMinLength)]],confirmPassword:["",f.required]},{validator:H("newPassword","confirmPassword")}),this.password=new D("",f.required)}get f(){return this.editPassword.controls}onSubmit(){this.submitted=!0,!this.editPassword.invalid&&(this.user.password=this.editPassword.value.actualPassword,this.user.email=this.identity.email,this._userService.validatePass(this.user).subscribe({next:t=>{t?(this.status="success",this.user.password=this.editPassword.value.newPassword,this._userService.changePass(this.user).subscribe(i=>{i.user&&i.user._id?this.status="success":this.status="error"},i=>{this.status="error",console.log(i)})):this.status="error",this.editPassword.reset(),this.submitted=!1},error:t=>{this.status="error",this.editPassword.reset(),this.submitted=!1,console.log(t)}}))}onDeleteAccount(){this.deleteSubmitted=!0,this.user=this.identity,!this.password.invalid&&(this.user.password=this.password.value,this._userService.validatePass(this.user).subscribe({next:t=>{t?(this.deleteStatus="success",console.log("validatePass response",t),this._userService.deleteUser().subscribe({next:i=>{console.log("deleteUser response",i),i.user&&i.user._id?(this.deleteStatus="success",localStorage.clear(),this._router.navigate(["/"]).finally(()=>location.reload())):this.deleteStatus="error2"},error:i=>{this.deleteStatus="error2",console.log(i)}})):this.deleteStatus="error",this.editPassword.reset(),this.submitted=!1},error:t=>{this.deleteStatus="error",console.log(t)}}))}static{this.\u0275fac=function(i){return new(i||e)(p(k),p(U),p(V),p($),p(E))}}static{this.\u0275cmp=C({type:e,selectors:[["securityOptions"]],standalone:!1,decls:51,vars:13,consts:[[1,"container","my-3","security-options-container"],[1,"card"],[1,"card-header"],[1,"m-0","text-primary","font-weight-bolder"],[1,"card-body"],[3,"ngSubmit","formGroup"],[1,"card-title"],["class","alert alert-danger fade show text-center","role","alert",4,"ngIfSuccessMessage","ngIf"],["class","alert alert-success fade show text-center","role","alert",4,"ngIfSuccessMessage","ngIf"],["class","form-group row",4,"ngFor","ngForOf"],[1,"modal-footer"],["type","submit",1,"btn","btn-warning"],[1,"card","my-3"],[1,"card-text"],["type","button","data-bs-toggle","modal","data-bs-target","#delete",1,"btn","btn-danger"],["id","delete","tabindex","-1","role","dialog","aria-labelledby","deleteTitle","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-dialog-centered"],[1,"modal-content"],[1,"modal-header"],["id","deleteTitle",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[3,"submit"],[1,"modal-body"],["class","alert alert-danger fade show text-center","role","alert",4,"ngIf"],["class","alert alert-success fade show text-center","role","alert",4,"ngIf"],[1,"form-group","row"],["for","password",1,"col-3","col-form-label"],[1,"col-9"],["type","password","id","password","placeholder","Contrase\xF1a",1,"form-control",3,"formControl","ngClass"],["class","invalid-feedback",4,"ngIf"],["type","button","data-bs-dismiss","modal",1,"btn","btn-primary","text-white"],["type","submit",1,"btn","btn-danger"],["role","alert",1,"alert","alert-danger","fade","show","text-center"],[1,"fas","fa-times-circle","icon-message","me-2"],["role","alert",1,"alert","alert-success","fade","show","text-center"],[1,"fas","fa-check-circle","icon-message","me-2"],[1,"col-3","col-form-label",3,"for"],[4,"ngIf"],[1,"col-4"],["type","password",1,"form-control",3,"id","formControlName","ngClass","placeholder"],[1,"invalid-feedback"]],template:function(i,s){i&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3",3),n(4),o()(),r(5,"div",4)(6,"div",1)(7,"form",5),y("ngSubmit",function(){return s.onSubmit()}),r(8,"div",4)(9,"h4",6),n(10," Cambiar contrase\xF1a "),o(),m(11,X,3,0,"div",7)(12,Y,3,0,"div",8)(13,oe,7,10,"div",9),o(),r(14,"div",10)(15,"button",11),n(16,"Cambiar contrase\xF1a"),o()()()(),r(17,"div",12)(18,"div",4)(19,"h4",6),n(20," Eliminar cuenta "),o(),r(21,"div",13),n(22," Aqu\xED puedes eliminar tu cuenta de usuario en RedDin\xE1mica. "),o()(),r(23,"div",10)(24,"button",14),n(25,"Eliminar cuenta"),o()()()()()(),r(26,"div",15)(27,"div",16)(28,"div",17)(29,"div",18)(30,"h5",19),n(31,"Eliminar cuenta de usuario"),o(),c(32,"button",20),o(),r(33,"form",21),y("submit",function(b){return b.preventDefault(),s.onDeleteAccount()}),r(34,"div",22),m(35,ne,3,0,"div",23)(36,ae,3,0,"div",23)(37,se,3,0,"div",24),r(38,"p"),n(39," Por tu seguridad, por favor ingresa tu contrase\xF1a de inicio de sesi\xF2n. "),o(),r(40,"div",25)(41,"label",26),n(42," Contrase\xF1a* "),o(),r(43,"div",27),c(44,"input",28),m(45,le,2,1,"div",29),o()()(),r(46,"div",10)(47,"button",30),n(48,"Cancelar"),o(),r(49,"button",31),n(50," Eliminar cuenta"),o()()()()()()),i&2&&(a(4),I(s.title),a(3),d("formGroup",s.editPassword),a(4),d("ngIf",s.status==="error"),a(),d("ngIf",s.status==="success"),a(),d("ngForOf",s.fieldsForm),a(22),d("ngIf",s.deleteStatus==="error"),a(),d("ngIf",s.deleteStatus==="error2"),a(),d("ngIf",s.deleteStatus==="success"),a(7),d("formControl",s.password)("ngClass",w(11,K,s.deleteSubmitted&&s.password.errors)),a(),d("ngIf",s.deleteSubmitted&&s.password.errors))},dependencies:[F,O,P,q,T,N,L,j,R,A],encapsulation:2})}}return e})();var ce=[{path:"",component:Q}],W=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=g({type:e})}static{this.\u0275inj=h({imports:[x.forChild(ce),x]})}}return e})();var Oe=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=g({type:e})}static{this.\u0275inj=h({imports:[M,G,W]})}}return e})();export{Oe as SecurityOptionsModule};
