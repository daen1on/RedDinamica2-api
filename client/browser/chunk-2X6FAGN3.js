import{a as X}from"./chunk-5JTGT5DU.js";import{a as W}from"./chunk-GAG5MJMH.js";import{a as Z}from"./chunk-5P7CLSZR.js";import{a as Y}from"./chunk-H2O7B6BZ.js";import"./chunk-M6MDGVAZ.js";import{A as H,C as K,c as R,d as E,e as U,f as J,m as B,q,r as G}from"./chunk-GWDAXWU7.js";import{Da as a,H as g,Hb as j,Jb as O,Na as r,Oa as n,Pa as F,Q as N,R as u,Rb as $,S as f,Ta as A,Ua as S,Va as w,X as I,ba as _,bc as z,ca as b,cc as Q,db as T,eb as l,ec as M,fb as P,gb as D,j as L,n as p,nb as x,ob as y,pa as s,sa as h,ta as k,ua as C,vb as V,ya as c}from"./chunk-3BHHYQXT.js";var ee=t=>({"is-invalid":t}),ie=()=>["/recuperar-pass"],re=()=>["/registro"];function se(t,m){t&1&&(r(0,"div",24),F(1,"i",25),l(2," No se ha podido iniciar sesi\xF3n correctamente. "),r(3,"a",26),l(4," Recuperar contrase\xF1a. "),n()()),t&2&&(s(3),a("routerLink",x(1,ie)))}function ae(t,m){if(t&1&&(r(0,"div",24),F(1,"i",25),l(2),n()),t&2){let e=w();s(2),D(" ",e.errorMessage," ")}}function le(t,m){t&1&&(r(0,"div",28),F(1,"i",25),l(2," El correo electr\xF3nico ingresado no coincide con ninguna cuenta. "),r(3,"a",26),l(4," Registrate aqu\xED. "),n()()),t&2&&(s(3),a("routerLink",x(1,re)))}function me(t,m){if(t&1&&c(0,le,5,2,"div",27),t&2){let e=w();a("ngIf",e.invalid)}}function de(t,m){t&1&&(r(0,"div"),l(1,"El campo correo electr\xF3nico es obligatorio. "),n())}function ue(t,m){t&1&&(r(0,"div"),l(1,"El correo electr\xF3nico debe ser una direcci\xF3n email v\xE1lida."),n())}function ce(t,m){if(t&1&&(r(0,"div",29),c(1,de,2,0,"div",30)(2,ue,2,0,"div",30),n()),t&2){let e=w();s(),a("ngIf",e.f.email.errors.required),s(),a("ngIf",e.f.email.errors.email)}}function pe(t,m){t&1&&(r(0,"div"),l(1," Por favor ingresa la contrase\xF1a de inicio de sesi\xF3n. "),n())}function ge(t,m){if(t&1&&(r(0,"div",29),c(1,pe,2,0,"div",30),n()),t&2){let e=w();s(),a("ngIf",e.f.password.errors.required)}}function fe(t,m){t&1&&(r(0,"div",31)(1,"div",32)(2,"div",33)(3,"span",34),l(4,"Loading..."),n()()()())}var ne=(()=>{class t{constructor(e,i,o,d,v){this._formBuilder=e,this._userService=i,this._bDService=o,this._messageService=d,this._router=v,this.submitted=!1,this.allProfessions=[],this.allInstitutions=[],this.allAreas=[],this.unsubscribe$=new L,this.errorMessage="",this.user=new Z,this.title="Iniciar sesi\xF3n",this.emailFound=!0}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}ngOnInit(){this.loginForm=this._formBuilder.group({email:["",[E.required,E.email]],password:["",E.required]}),this.onChanges()}onChanges(){this.loginForm.valueChanges.pipe(u(this.unsubscribe$)).subscribe(()=>{this.errorMessage="",this.invalid=!1,this.emailFound=!0})}get f(){return this.loginForm.controls}onSubmit(){if(this.submitted=!0,this.loading=!0,this.loginForm.invalid){this.loading=!1;return}this._userService.signup(this.loginForm.value).pipe(u(this.unsubscribe$),N(e=>{if(!e.user||!e.user._id)throw new Error("Invalid login");return this._userService.setIdentity(e.user),this._userService.signup(this.loginForm.value,!0)}),f({next:e=>{if(!e.token)throw new Error("Token not found");this._userService.setToken(e.token),this.token=e.token,this.emailFound=!0},error:e=>{this.errorMessage="Ha ocurrido un error. Por favor intenta de nuevo.",console.error(e),this.invalid=!0,this.loading=!1}}),g(e=>(this.errorMessage="Ha ocurrido un error. Por favor intenta de nuevo.",console.error(e),this.invalid=!0,this.loading=!1,this.emailFound=!1,p))).subscribe(()=>{this.getAllInstitutions(),this.getAllProfessions(),this.getCounters(),this.getAllAreas(),this.getUnviewMessages(),this._router.navigate(["/inicio"])})}getAllAreas(){let e=localStorage.getItem("areas");if(e){this.allAreas=JSON.parse(e);return}this._bDService.getAllKnowledgeAreas().pipe(u(this.unsubscribe$),f({next:i=>{if(i.areas)this.allAreas=i.areas,localStorage.setItem("areas",JSON.stringify(this.allAreas));else throw new Error("No areas found")},error:i=>{console.error(i)}}),g(i=>(console.error(i),p))).subscribe()}getAllProfessions(){let e=localStorage.getItem("professions");if(e){this.allProfessions=JSON.parse(e);return}this._bDService.getAllProfessions().pipe(u(this.unsubscribe$),f({next:i=>{if(i.professions)this.allProfessions=i.professions,localStorage.setItem("professions",JSON.stringify(this.allProfessions));else throw new Error("No professions found")},error:i=>{console.error(i),this.errorMessage="No se pueden traer las profesiones. Por favor intenta de nuevo mas tarde."}}),g(i=>(console.error(i),this.errorMessage="No se pueden traer las profesiones. Por favor intenta de nuevo mas tarde.",p))).subscribe()}getAllInstitutions(){let e=localStorage.getItem("institutions");if(e){this.allInstitutions=JSON.parse(e);return}this._bDService.getAllInstitutions().pipe(u(this.unsubscribe$),f({next:i=>{if(i.institutions)this.allInstitutions=i.institutions,localStorage.setItem("institutions",JSON.stringify(this.allInstitutions));else throw new Error("No institutions found")},error:i=>{console.error(i),this.errorMessage="Error intentando traer las instituciones. Intenta de nuevo m\xE1s tarde"}}),g(i=>(console.error(i),this.errorMessage="Error intentando traer las instituciones. Intenta de nuevo m\xE1s tarde",p))).subscribe()}getCounters(){this._userService.getCounters().pipe(u(this.unsubscribe$),f({next:e=>{if(e)localStorage.setItem("stats",JSON.stringify(e));else throw new Error("Failed to fetch counters")},error:e=>{console.error(e),this.errorMessage="Failed to load user counters."}}),g(e=>(console.error(e),this.errorMessage="Failed to load user counters.",p))).subscribe()}getUnviewMessages(){this._messageService.getUnviewMessages(this.token).pipe(u(this.unsubscribe$),f({next:e=>{if(e)localStorage.setItem("unviewedMessages",JSON.stringify(e.unviewed));else throw new Error("Failed to fetch unviewed messages")},error:e=>{console.error(e),this.errorMessage="Unable to load new messages."}}),g(e=>(console.error(e),this.errorMessage="Unable to load new messages.",p))).subscribe()}static{this.\u0275fac=function(i){return new(i||t)(h(H),h(Y),h(X),h(W),h(z))}}static{this.\u0275cmp=k({type:t,selectors:[["login"]],standalone:!1,decls:34,vars:18,consts:[["noEmail",""],["id","login",1,"bg-light","py-5"],[1,"container","px-0"],[1,"row"],[1,"col-12","col-lg-6","offset-lg-3"],[1,"card","shadow"],[1,"card-header","bg-success","text-white","text-center","py-3"],[1,"mb-0"],[1,"card-body","px-2","px-sm-4","py-4","text-center"],["class","mx-4 alert alert-danger alert-dismissible fade show","role","alert",4,"ngIf","ngIfElse"],["class","mx-4 alert alert-danger alert-dismissible fade show","role","alert",4,"ngIf"],[1,"px-2","px-sm-4","py-sm-3",3,"ngSubmit","formGroup"],[1,"mb-3","text-start"],["for","FormEmail"],["type","email","id","FormEmail","placeholder","correo@ejemplo.com","formControlName","email",1,"form-control",3,"change","ngClass"],["class","invalid-feedback",4,"ngIf"],["for","FormPassword"],["type","password","id","FormPassword","placeholder","Contrase\xF1a","formControlName","password",1,"form-control",3,"change","ngClass"],["class","card-body",4,"ngIf"],["type","submit",1,"btn","btn-success","w-100","btn-lg","mb-2",3,"click"],[1,"card-link",3,"routerLink"],[1,"card-footer","text-center"],[1,"card-text"],[1,"dropdown-item","py-2",3,"routerLink"],["role","alert",1,"mx-4","alert","alert-danger","alert-dismissible","fade","show"],[1,"fas","fa-times-circle","icon-message","me-2"],[1,"alert-link",3,"routerLink"],["class","mx-4 alert alert-danger alert-dismissible fade show",4,"ngIf"],[1,"mx-4","alert","alert-danger","alert-dismissible","fade","show"],[1,"invalid-feedback"],[4,"ngIf"],[1,"card-body"],[1,"text-muted","text-center"],["role","status",1,"spinner-border",2,"width","3rem","height","3rem"],[1,"visually-hidden"]],template:function(i,o){if(i&1){let d=A();r(0,"section",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6)(6,"h2",7),l(7),n()(),r(8,"div",8),c(9,se,5,2,"div",9)(10,ae,3,1,"div",10)(11,me,1,1,"ng-template",null,0,V),r(13,"form",11),S("ngSubmit",function(){return _(d),b(o.onSubmit())}),r(14,"div",12)(15,"label",13),l(16,"Correo electr\xF3nico"),n(),r(17,"input",14),S("change",function(){return _(d),b(o.onChanges())}),n(),c(18,ce,3,2,"div",15),n(),r(19,"div",12)(20,"label",16),l(21,"Contrase\xF1a"),n(),r(22,"input",17),S("change",function(){return _(d),b(o.onChanges())}),n(),c(23,ge,2,1,"div",15),n(),c(24,fe,5,0,"div",18),r(25,"button",19),S("click",function(){return _(d),b(o.loading=!0)}),l(26,"Entrar"),n(),r(27,"a",20),l(28,"\xBFHa olvidado su contrase\xF1a?"),n()()(),r(29,"div",21)(30,"p",22),l(31,"\xBFA\xFAn no tienes cuenta en RedDin\xE1mica?"),n(),r(32,"a",23),l(33,"Registrate"),n()()()()()()()}if(i&2){let d=T(12);s(7),P(o.title),s(2),a("ngIf",o.invalid&&o.emailFound)("ngIfElse",d),s(),a("ngIf",o.errorMessage),s(3),a("formGroup",o.loginForm),s(4),a("ngClass",y(12,ee,o.submitted&&o.f.email.errors)),s(),a("ngIf",o.submitted&&o.f.email.errors),s(4),a("ngClass",y(14,ee,o.submitted&&o.f.password.errors)),s(),a("ngIf",o.submitted&&o.f.password.errors),s(),a("ngIf",o.loading),s(3),a("routerLink",x(16,ie)),s(5),a("routerLink",x(17,re))}},dependencies:[j,O,B,R,U,J,q,G,Q],encapsulation:2})}}return t})();var he=[{path:"",component:ne}],oe=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=C({type:t})}static{this.\u0275inj=I({imports:[M.forChild(he),M]})}}return t})();var Ve=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=C({type:t})}static{this.\u0275inj=I({imports:[$,K,oe]})}}return t})();export{Ve as LoginModule};
