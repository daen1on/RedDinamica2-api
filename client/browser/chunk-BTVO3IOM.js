import{a as Q}from"./chunk-YM3PCZES.js";import{a as H}from"./chunk-H2O7B6BZ.js";import{B as Y,c as W,e as z,l as B,s as U,t as q,u as R}from"./chunk-GWDAXWU7.js";import{Da as g,Fa as I,Ib as A,Jb as F,Na as t,Oa as n,Ob as V,Pa as d,Rb as D,Ta as G,Ua as f,Va as p,a as w,b as k,ba as _,bc as J,ca as h,eb as i,ec as K,fb as v,gb as b,hb as L,jb as y,kb as O,lb as P,pa as l,sa as M,sb as N,ta as T,ub as j,ya as S}from"./chunk-3BHHYQXT.js";function ee(a,u){if(a&1&&(t(0,"div",33),i(1),n()),a&2){let e=p();l(),b(" ",e.error," ")}}function te(a,u){a&1&&(t(0,"div",34)(1,"div",35)(2,"span",36),i(3,"Cargando..."),n()()())}function ne(a,u){if(a&1){let e=G();t(0,"div",39)(1,"div",40)(2,"h3"),i(3),n(),t(4,"div",41)(5,"button",42),f("click",function(){let r=_(e).$implicit,s=p(2);return h(s.viewGroupDetails(r._id))}),d(6,"i",43),n(),t(7,"button",44),f("click",function(){let r=_(e).$implicit,s=p(2);return h(s.editGroup(r))}),d(8,"i",45),n(),t(9,"button",46),f("click",function(){let r=_(e).$implicit,s=p(2);return h(s.deleteGroup(r._id))}),d(10,"i",47),n()()(),t(11,"div",48)(12,"p",49),i(13),n(),t(14,"div",50)(15,"div",51),d(16,"i",52),t(17,"span"),i(18),n()(),t(19,"div",51),d(20,"i",53),t(21,"span"),i(22),n()(),t(23,"div",51),d(24,"i",54),t(25,"span"),i(26),n()()(),t(27,"div",55)(28,"div",56)(29,"span",57),i(30,"Lecciones:"),n(),t(31,"span",58),i(32),n()(),t(33,"div",56)(34,"span",57),i(35,"Activo:"),n(),t(36,"span",58),i(37),n()()()(),t(38,"div",59)(39,"small",60),i(40),N(41,"date"),n()()()}if(a&2){let e=u.$implicit,o=p(2);l(3),v(e.name),l(10),v(e.description),l(5),b("",o.getStudentCount(e)," estudiantes"),l(4),L("",o.getAcademicLevelLabel(e.academicLevel)," - ",e.grade,""),l(4),v(o.getTeacherDisplayName(e.teacher)),l(6),v(e.lessonsCount||(e.lessons==null?null:e.lessons.length)||0),l(4),I("active",e.isActive),l(),b(" ",e.isActive?"S\xED":"No"," "),l(3),b(" Creado: ",j(41,11,e.createdAt,"short")," ")}}function ie(a,u){if(a&1&&(t(0,"div",37),S(1,ne,42,14,"div",38),n()),a&2){let e=p();l(),g("ngForOf",e.getFilteredGroups())}}function oe(a,u){a&1&&(t(0,"p"),i(1," No se encontraron grupos con los filtros aplicados. "),n())}function re(a,u){a&1&&(t(0,"p"),i(1," Comienza creando tu primer grupo acad\xE9mico. "),n())}function ae(a,u){if(a&1){let e=G();t(0,"div",61)(1,"div",62),d(2,"i",52),n(),t(3,"h3"),i(4,"No hay grupos disponibles"),n(),S(5,oe,2,0,"p",63)(6,re,2,0,"p",63),t(7,"button",2),f("click",function(){_(e);let r=p();return h(r.createNewGroup())}),i(8," Crear Primer Grupo "),n()()}if(a&2){let e=p();l(5),g("ngIf",e.searchTerm||e.filterLevel||e.filterGrade),l(),g("ngIf",!e.searchTerm&&!e.filterLevel&&!e.filterGrade)}}var xe=(()=>{class a{constructor(e,o,r){this.academicGroupService=e,this.router=o,this.userService=r,this.groups=[],this.loading=!1,this.error="",this.searchTerm="",this.filterLevel="",this.filterGrade="",this.teacherNameMap={}}ngOnInit(){this.loadGroups()}loadGroups(){this.loading=!0;let e=(this.userService.getIdentity()?.role||"").toString().toLowerCase();(e==="admin"||e==="delegated_admin"||e==="lesson_manager"?this.academicGroupService.getAllGroups(!0):this.academicGroupService.getTeacherGroups()).subscribe({next:c=>{let X=c?.data||[];this.groups=X.map(x=>{let m=x?.teacher,C=m&&typeof m=="object"?m._id||"":m||"",E=m&&typeof m=="object"?[m.name,m.surname].filter(Boolean).join(" ").trim():void 0,Z=typeof x?.lessonsCount=="number"?x.lessonsCount:Array.isArray(x?.lessons)?x.lessons.length:0,$=k(w({},x),{teacher:C,lessonsCount:Z,teacherName:E});return C&&E&&!this.teacherNameMap[C]&&(this.teacherNameMap[C]=E),$}),this.prefetchTeacherNames(),this.loading=!1},error:c=>{this.error="Error al cargar los grupos",this.loading=!1,console.error("Error loading groups:",c)}})}createNewGroup(){this.router.navigate(["/academia/groups/create"])}viewGroupDetails(e){this.router.navigate(["/academia/groups",e])}editGroup(e){this.router.navigate(["/academia/groups",e._id],{queryParams:{editMode:"true"}})}deleteGroup(e){confirm("\xBFEst\xE1s seguro de que quieres eliminar este grupo? Esta acci\xF3n no se puede deshacer.")&&this.academicGroupService.deleteGroup(e).subscribe({next:()=>{this.loadGroups()},error:o=>{this.error="Error al eliminar el grupo",console.error("Error deleting group:",o)}})}getFilteredGroups(){return this.groups.filter(e=>{let o=!this.searchTerm||e.name.toLowerCase().includes(this.searchTerm.toLowerCase())||e.description.toLowerCase().includes(this.searchTerm.toLowerCase()),r=!this.filterLevel||e.academicLevel===this.filterLevel,s=!this.filterGrade||e.grade===this.filterGrade;return o&&r&&s})}getStudentCount(e){return e.students?e.students.length:0}getAcademicLevelLabel(e){return e==="Colegio"?"Colegio":"Universidad"}clearFilters(){this.searchTerm="",this.filterLevel="",this.filterGrade=""}getTeacherDisplayName(e){if(!e)return"\u2014";let o=typeof e=="object"?e._id||"":e;return o&&this.teacherNameMap[o]?this.teacherNameMap[o]:typeof e=="object"&&[e.name,e.surname].filter(Boolean).join(" ").trim()||"\u2014"}prefetchTeacherNames(){Array.from(new Set((this.groups||[]).map(o=>o?.teacher&&typeof o.teacher!="object"?o.teacher:o?.teacher?._id||"").filter(o=>!!o&&!this.teacherNameMap[o]))).forEach(o=>{this.userService.getUser(o).subscribe({next:r=>{let s=r?.user?[r.user.name,r.user.surname].filter(Boolean).join(" ").trim():"";this.teacherNameMap[o]=s||"Usuario"},error:()=>{this.teacherNameMap[o]="Usuario"}})})}static{this.\u0275fac=function(o){return new(o||a)(M(Q),M(J),M(H))}}static{this.\u0275cmp=T({type:a,selectors:[["app-group-management"]],decls:59,vars:7,consts:[[1,"group-management-container"],[1,"header"],[1,"btn","btn-primary",3,"click"],[1,"fas","fa-plus"],[1,"filters-section"],[1,"search-box"],["type","text","placeholder","Buscar grupos...",1,"form-control",3,"ngModelChange","ngModel"],[1,"filter-controls"],[1,"form-control",3,"ngModelChange","ngModel"],["value",""],["value","Colegio"],["value","Universidad"],["value","Sexto"],["value","S\xE9ptimo"],["value","Octavo"],["value","Noveno"],["value","D\xE9cimo"],["value","Once"],["value","1 Semestre"],["value","2 Semestre"],["value","3 Semestre"],["value","4 Semestre"],["value","5 Semestre"],["value","6 Semestre"],["value","7 Semestre"],["value","8 Semestre"],["value","9 Semestre"],["value","10 Semestre"],[1,"btn","btn-secondary",3,"click"],["class","alert alert-danger",4,"ngIf"],["class","loading-container",4,"ngIf"],["class","groups-grid",4,"ngIf"],["class","empty-state",4,"ngIf"],[1,"alert","alert-danger"],[1,"loading-container"],["role","status",1,"spinner-border"],[1,"visually-hidden"],[1,"groups-grid"],["class","group-card",4,"ngFor","ngForOf"],[1,"group-card"],[1,"group-header"],[1,"group-actions"],[1,"btn","btn-sm","btn-outline-primary",3,"click"],[1,"fas","fa-eye"],[1,"btn","btn-sm","btn-outline-secondary",3,"click"],[1,"fas","fa-edit"],[1,"btn","btn-sm","btn-outline-danger",3,"click"],[1,"fas","fa-trash"],[1,"group-content"],[1,"group-description"],[1,"group-info"],[1,"info-item"],[1,"fas","fa-users"],[1,"fas","fa-graduation-cap"],[1,"fas","fa-user"],[1,"group-stats"],[1,"stat-item"],[1,"stat-label"],[1,"stat-value"],[1,"group-footer"],[1,"text-muted"],[1,"empty-state"],[1,"empty-icon"],[4,"ngIf"]],template:function(o,r){o&1&&(t(0,"div",0)(1,"div",1)(2,"h2"),i(3,"Gesti\xF3n de Grupos Acad\xE9micos"),n(),t(4,"button",2),f("click",function(){return r.createNewGroup()}),d(5,"i",3),i(6," Crear Nuevo Grupo "),n()(),t(7,"div",4)(8,"div",5)(9,"input",6),P("ngModelChange",function(c){return O(r.searchTerm,c)||(r.searchTerm=c),c}),n()(),t(10,"div",7)(11,"select",8),P("ngModelChange",function(c){return O(r.filterLevel,c)||(r.filterLevel=c),c}),t(12,"option",9),i(13,"Todos los niveles"),n(),t(14,"option",10),i(15,"Colegio"),n(),t(16,"option",11),i(17,"Universidad"),n()(),t(18,"select",8),P("ngModelChange",function(c){return O(r.filterGrade,c)||(r.filterGrade=c),c}),t(19,"option",9),i(20,"Todos los grados"),n(),t(21,"option",12),i(22,"Sexto"),n(),t(23,"option",13),i(24,"S\xE9ptimo"),n(),t(25,"option",14),i(26,"Octavo"),n(),t(27,"option",15),i(28,"Noveno"),n(),t(29,"option",16),i(30,"D\xE9cimo"),n(),t(31,"option",17),i(32,"Once"),n(),t(33,"option",18),i(34,"1 Semestre"),n(),t(35,"option",19),i(36,"2 Semestre"),n(),t(37,"option",20),i(38,"3 Semestre"),n(),t(39,"option",21),i(40,"4 Semestre"),n(),t(41,"option",22),i(42,"5 Semestre"),n(),t(43,"option",23),i(44,"6 Semestre"),n(),t(45,"option",24),i(46,"7 Semestre"),n(),t(47,"option",25),i(48,"8 Semestre"),n(),t(49,"option",26),i(50,"9 Semestre"),n(),t(51,"option",27),i(52,"10 Semestre"),n()(),t(53,"button",28),f("click",function(){return r.clearFilters()}),i(54," Limpiar Filtros "),n()()(),S(55,ee,2,1,"div",29)(56,te,4,0,"div",30)(57,ie,2,1,"div",31)(58,ae,9,2,"div",32),n()),o&2&&(l(9),y("ngModel",r.searchTerm),l(2),y("ngModel",r.filterLevel),l(7),y("ngModel",r.filterGrade),l(37),g("ngIf",r.error),l(),g("ngIf",r.loading),l(),g("ngIf",!r.loading&&r.getFilteredGroups().length>0),l(),g("ngIf",!r.loading&&r.getFilteredGroups().length===0))},dependencies:[D,A,F,V,Y,q,R,W,U,z,B,K],styles:[".group-management-container[_ngcontent-%COMP%]{padding:36px 20px 20px;max-width:1200px;margin:0 auto}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-top:8px;margin-bottom:30px;padding-bottom:20px;border-bottom:2px solid #e9ecef}.header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;color:#2c3e50;font-weight:600}.btn-primary[_ngcontent-%COMP%]{background-color:#3498db;border-color:#3498db;color:#fff;padding:10px 20px;border-radius:5px;text-decoration:none;display:inline-flex;align-items:center;gap:8px;transition:all .3s ease}.btn-primary[_ngcontent-%COMP%]:hover{background-color:#2980b9;border-color:#2980b9;transform:translateY(-2px)}.filters-section[_ngcontent-%COMP%]{background:#f8f9fa;padding:20px;border-radius:8px;margin-bottom:30px;box-shadow:0 2px 4px #0000001a}.search-box[_ngcontent-%COMP%]{margin-bottom:15px}.search-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:12px;border:1px solid #ddd;border-radius:5px;font-size:16px}.filter-controls[_ngcontent-%COMP%]{display:flex;gap:15px;align-items:center;flex-wrap:wrap}.filter-controls[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{min-width:150px;padding:10px;border:1px solid #ddd;border-radius:5px;background:#fff}.btn-secondary[_ngcontent-%COMP%]{background-color:#6c757d;border-color:#6c757d;color:#fff;padding:10px 15px;border-radius:5px;transition:all .3s ease}.btn-secondary[_ngcontent-%COMP%]:hover{background-color:#5a6268;border-color:#545b62}.alert[_ngcontent-%COMP%]{padding:15px;margin-bottom:20px;border-radius:5px}.alert-danger[_ngcontent-%COMP%]{background-color:#f8d7da;border:1px solid #f5c6cb;color:#721c24}.loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:50px}.groups-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(350px,1fr));gap:20px;margin-top:20px}.group-card[_ngcontent-%COMP%]{background:#fff;border-radius:10px;box-shadow:0 4px 6px #0000001a;overflow:hidden;transition:all .3s ease;border:1px solid #e9ecef}.group-card[_ngcontent-%COMP%]:hover{transform:translateY(-5px);box-shadow:0 8px 15px #00000026}.group-header[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;padding:20px;display:flex;justify-content:space-between;align-items:center}.group-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.2rem;font-weight:600}.group-actions[_ngcontent-%COMP%]{display:flex;gap:8px}.btn-sm[_ngcontent-%COMP%]{padding:6px 10px;font-size:12px;border-radius:4px}.btn-outline-primary[_ngcontent-%COMP%]{color:#fff;border-color:#fff;background:transparent}.btn-outline-primary[_ngcontent-%COMP%]:hover{background:#fff3;border-color:#fff}.btn-outline-secondary[_ngcontent-%COMP%]{color:#fff;border-color:#fff;background:transparent}.btn-outline-secondary[_ngcontent-%COMP%]:hover{background:#fff3;border-color:#fff}.btn-outline-danger[_ngcontent-%COMP%]{color:#fff;border-color:#fff;background:transparent}.btn-outline-danger[_ngcontent-%COMP%]:hover{background:#fff3;border-color:#fff}.group-content[_ngcontent-%COMP%]{padding:20px}.group-description[_ngcontent-%COMP%]{color:#6c757d;margin-bottom:15px;line-height:1.5}.group-info[_ngcontent-%COMP%]{margin-bottom:15px}.info-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-bottom:8px;color:#495057}.info-item[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{width:16px;color:#6c757d}.group-stats[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding-top:15px;border-top:1px solid #e9ecef}.stat-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.stat-label[_ngcontent-%COMP%]{font-size:12px;color:#6c757d;margin-bottom:4px}.stat-value[_ngcontent-%COMP%]{font-weight:600;color:#2c3e50}.stat-value.active[_ngcontent-%COMP%]{color:#28a745}.group-footer[_ngcontent-%COMP%]{padding:15px 20px;background:#f8f9fa;border-top:1px solid #e9ecef}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:60px 20px;color:#6c757d}.empty-icon[_ngcontent-%COMP%]{font-size:4rem;color:#dee2e6;margin-bottom:20px}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#495057;margin-bottom:10px}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:20px;font-size:16px}@media (max-width: 768px){.header[_ngcontent-%COMP%]{flex-direction:column;gap:15px;align-items:stretch}.filter-controls[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.groups-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.group-stats[_ngcontent-%COMP%]{flex-direction:column;gap:10px}}@media (max-width: 480px){.group-management-container[_ngcontent-%COMP%]{padding:10px}.group-header[_ngcontent-%COMP%]{flex-direction:column;gap:10px;align-items:stretch}.group-actions[_ngcontent-%COMP%]{justify-content:center}}"]})}}return a})();export{xe as a};
