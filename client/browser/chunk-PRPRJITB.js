import{a as ze}from"./chunk-SSVOYPUW.js";import{a as mt,b as hi,c as xi}from"./chunk-RWIJZG3H.js";import{a as pt}from"./chunk-OTR2C3OD.js";import{a as ct}from"./chunk-TCGBOSDO.js";import{c as vi,e as kt}from"./chunk-HD7OORPX.js";import{a as ue,b as _e,c as fe,d as gi}from"./chunk-D2BCPON4.js";import{a as bi,b as Ci}from"./chunk-LDL6SX5C.js";import"./chunk-ZTCIQEDA.js";import{a as we}from"./chunk-TLWJFQ3M.js";import{a as li,b as di,c as ci}from"./chunk-B2YIIQ5G.js";import{a as ui}from"./chunk-6V7B36ZC.js";import{a as _i}from"./chunk-I6YX74IH.js";import{a as Ae}from"./chunk-Y7VT7NVC.js";import"./chunk-4MSQXD5K.js";import{a as pe}from"./chunk-O5WKCLKG.js";import{a as lt,b as dt}from"./chunk-27IZBTZL.js";import{b as fi,c as Te,d as Oe}from"./chunk-WESTYKRX.js";import{a as ri,b as ai,c as Ie,d as si}from"./chunk-DEF5ACRI.js";import{a as ne}from"./chunk-5JTGT5DU.js";import{a as st}from"./chunk-5P7CLSZR.js";import{a as P}from"./chunk-H2O7B6BZ.js";import{a as A}from"./chunk-M6MDGVAZ.js";import{B as ni,C as oi,c as N,d as S,e as D,f as $,g as It,h as oe,i as Ce,j as re,k,l as at,m as q,p as le,q as H,r as Y,s as de,t as ce,u as me,z as Me}from"./chunk-GWDAXWU7.js";import{$b as z,Ba as be,Ca as ke,Da as l,Ea as Qe,H as ve,Ha as ee,Hb as G,I as Jt,Ib as T,Jb as F,M as Ht,N as Yt,Na as o,Oa as n,Pa as u,Pb as ti,Q as Pe,Qa as K,R as he,Ra as W,Rb as ii,S as Qt,Ta as C,Ua as _,Ub as Ve,Va as c,W as Xt,X as He,Ya as v,Z as Et,Za as O,_a as St,a as Gt,ab as Xe,ac as mi,b as zt,ba as f,bb as Ze,bc as j,ca as g,cb as et,cc as R,db as J,dc as pi,eb as s,ec as wt,fb as h,g as ie,ga as se,gb as b,h as Kt,hb as V,ib as tt,j as Le,jb as it,kb as nt,lb as ot,na as M,nb as Ee,ob as x,pa as a,pb as ei,sa as y,sb as I,t as ge,ta as w,tb as X,u as Wt,ua as Ye,ub as L,v as Ge,vb as B,w as Se,wa as Zt,xb as rt,ya as p}from"./chunk-3BHHYQXT.js";var Tt=[{id:"users",buttonClass:"btn-info",iconClass:"fa-user",spanContent:"Usuarios",subOptions:[{text:"Nuevos usuarios",routerLink:"/admin/usuarios-nuevos"},{text:"Todos los usuarios",routerLink:"/admin/usuarios"}]},{id:"academic",buttonClass:"btn-success",iconClass:"fa-graduation-cap",spanContent:"RedDin\xE1mica acad\xE9mica",subOptions:[{text:"Grupos acad\xE9micos",routerLink:"/admin/academico/grupos"},{text:"Lecciones acad\xE9micas",routerLink:"/admin/academico/lecciones"},{text:"Mejores lecciones",routerLink:"/admin/academico/destacadas"}]},{id:"tasks",buttonClass:"btn-secondary",iconClass:"fa-tasks",spanContent:"Gesti\xF3n acad\xE9mica y tareas",subOptions:[{text:"Tareas",routerLink:"/admin/tareas"}]},{id:"lessons",buttonClass:"btn-warning",iconClass:"fa-file-alt",spanContent:"Lecciones",subOptions:[{text:"Todas las lecciones",routerLink:"/admin/lecciones"},{text:"Propuestas",routerLink:"/admin/lecciones-propuestas"},{text:"Experiencias",routerLink:"/admin/experiencias"}]},{id:"resources",buttonClass:"btn-danger",iconClass:"fa-paperclip",spanContent:"Repositorio",subOptions:[{text:"Todos los recursos",routerLink:"/admin/recursos"},{text:"Propuestas",routerLink:"/admin/recursos-propuestos"}]},{id:"basicData",buttonClass:"btn-success",iconClass:"fa-database",spanContent:"Datos b\xE1sicos",subOptions:[{text:"Ciudades",routerLink:"/admin/ciudades"},{text:"Instituciones",routerLink:"/admin/instituciones"},{text:"\xC1reas de conocimiento",routerLink:"/admin/areas"},{text:"Profesiones",routerLink:"/admin/profesiones"}]},{id:"errors",buttonClass:"btn-primary",iconClass:"fa-exclamation-triangle",spanContent:"Errores y Sugerencias",subOptions:[{text:"Ver Errores y Sugerencias",routerLink:"/admin/view-errors"}]}];var gn=(t,d)=>({"fa-chevron-up":t,"fa-chevron-down":d}),vn=t=>({show:t}),hn=t=>[t];function xn(t,d){if(t&1&&(o(0,"li",21)(1,"a",22),u(2,"i",23),s(3),n()()),t&2){let e=d.$implicit;a(),l("routerLink",x(2,hn,e.routerLink)),a(2),b(" ",e.text," ")}}function bn(t,d){if(t&1&&(o(0,"div",14)(1,"button",15)(2,"div",16),u(3,"i"),o(4,"span"),s(5),n()(),u(6,"i",17),n(),o(7,"div",18)(8,"ul",19),p(9,xn,4,4,"li",20),n()()()),t&2){let e=d.$implicit;a(),ke("data-bs-target","#",e.id,""),be("aria-expanded",!1)("aria-controls",e.id),a(2),ee("fas ",e.iconClass,""),a(2),h(e.spanContent),a(2),v("id",e.id),a(2),l("ngForOf",e.subOptions)}}var yi=(()=>{class t{constructor(e,i,r,m){this._userService=e,this._tasks=i,this._router=r,this._route=m,this.title="Administraci\xF3n",this.isMenuCollapsed=!0,this.tasksBadge=0,this.menuOptions=Tt}ngOnInit(){if(this._userService.getIdentity()?.role==="lesson_manager"){this.menuOptions=Tt.filter(te=>["lessons","resources","academic","tasks"].includes(te.id));let r=this._router.url||"",m=/\/admin\/?$/.test(r),E=r.includes("/admin/usuarios-nuevos");(m||E)&&this._router.navigate(["/admin/lecciones"])}this._tasks.getSummary().subscribe({next:r=>{this.tasksBadge=(r.convocatoriasPorAbrir||0)+(r.sugerenciasPorHacer||0)+(r.recursosPorAprobar||0)+(r.leccionesPorMover||0),this.menuOptions=this.menuOptions.map(m=>m.id==="tasks"?zt(Gt({},m),{spanContent:`Gesti\xF3n acad\xE9mica y tareas${this.tasksBadge>0?" ("+this.tasksBadge+")":""}`}):m)}})}toggleMenu(){this.isMenuCollapsed=!this.isMenuCollapsed}static{this.\u0275fac=function(i){return new(i||t)(y(P),y(bi),y(j),y(z))}}static{this.\u0275cmp=w({type:t,selectors:[["admin"]],standalone:!1,decls:18,vars:9,consts:[[1,"container"],[1,"row","py-3"],[1,"col-12","col-lg-3","col-md-4"],["type","button","aria-controls","adminMenu","aria-expanded","false","aria-label","Toggle navigation",1,"navbar-toggler",3,"click"],[1,"navbar-toggler-icon"],[1,"admin-sidebar"],[1,"admin-header",3,"click"],[1,"d-flex","justify-content-between","align-items-center"],[1,"fas","fa-user-cog","me-2"],[1,"fas","dropdown-icon",3,"ngClass"],["id","adminMenu",1,"collapse","admin-menu",3,"ngClass"],["class","admin-menu-item",4,"ngFor","ngForOf"],[1,"col-12","col-lg-9","col-md-8"],[1,"admin-content"],[1,"admin-menu-item"],["type","button","data-bs-toggle","collapse",1,"admin-menu-btn","d-flex","justify-content-between","align-items-center"],[1,"d-flex","align-items-center"],[1,"fas","fa-chevron-down","dropdown-icon"],["data-bs-parent","#adminMenu",1,"collapse","admin-submenu",3,"id"],[1,"nav","flex-column"],["class","nav-item",4,"ngFor","ngForOf"],[1,"nav-item"],["routerLinkActive","active",1,"nav-link",3,"routerLink"],[1,"fas","fa-angle-right","me-2"]],template:function(i,r){i&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),_("click",function(){return r.toggleMenu()}),u(4,"span",4),n(),o(5,"div",5)(6,"div",6),_("click",function(){return r.toggleMenu()}),o(7,"h4",7)(8,"span"),u(9,"i",8),o(10,"strong"),s(11),n()(),u(12,"i",9),n()(),o(13,"div",10),p(14,bn,10,10,"div",11),n()()(),o(15,"div",12)(16,"div",13),u(17,"router-outlet"),n()()()()),i&2&&(a(11),h(r.title),a(),l("ngClass",ei(4,gn,r.isMenuCollapsed,!r.isMenuCollapsed)),a(),l("ngClass",x(7,vn,r.isMenuCollapsed)),a(),l("ngForOf",r.menuOptions))},dependencies:[G,T,mi,R,pi],styles:[`.container[_ngcontent-%COMP%]{padding:20px;max-width:1400px}.admin-sidebar[_ngcontent-%COMP%]{background:linear-gradient(135deg,#fff,#f8f9fa);border-radius:15px;box-shadow:0 8px 25px #0000001a;border:1px solid rgba(0,0,0,.05);overflow:hidden;position:sticky;top:80px;max-height:calc(100vh - 100px);overflow-y:auto}.admin-header[_ngcontent-%COMP%]{background:linear-gradient(135deg,#007bff,#0056b3);color:#fff;padding:20px;border:none;cursor:pointer;transition:all .3s ease;position:relative;overflow:hidden}.admin-header[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.1),transparent);transition:left .6s ease}.admin-header[_ngcontent-%COMP%]:hover:before{left:100%}.admin-header[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#0056b3,#004085);transform:translateY(-1px);box-shadow:0 6px 20px #007bff4d}.admin-header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0;font-weight:700;font-size:1.3rem;text-shadow:0 2px 4px rgba(0,0,0,.2)}.admin-header[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.2rem;transition:all .3s ease;margin-left:10px}.admin-menu[_ngcontent-%COMP%]{background:transparent;padding:0}.admin-menu-item[_ngcontent-%COMP%]{margin:8px 12px;border-radius:12px;overflow:hidden;box-shadow:0 2px 8px #0000000d;transition:all .3s ease}.admin-menu-item[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 15px #0000001a}.admin-menu-btn[_ngcontent-%COMP%]{background:linear-gradient(135deg,#6c757d,#495057);border:none;color:#fff;padding:15px 20px;width:100%;text-align:left;border-radius:12px;font-weight:600;font-size:.95rem;transition:all .3s cubic-bezier(.175,.885,.32,1.275);position:relative;overflow:hidden}.admin-menu-btn[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.1),transparent);transition:left .5s ease}.admin-menu-btn[_ngcontent-%COMP%]:hover:before{left:100%}.admin-menu-btn[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#495057,#343a40);transform:translateY(-1px);box-shadow:0 4px 12px #0003;color:#fff}.admin-menu-btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:12px;font-size:1.1rem;transition:all .3s ease}.admin-menu-btn[_ngcontent-%COMP%]:hover   i[_ngcontent-%COMP%]{transform:scale(1.1)}.admin-menu-btn[_ngcontent-%COMP%]   .dropdown-icon[_ngcontent-%COMP%]{float:right;margin-right:0;margin-left:auto;transition:transform .3s ease}.admin-menu-btn[aria-expanded=true][_ngcontent-%COMP%]   .dropdown-icon[_ngcontent-%COMP%]{transform:rotate(180deg)}.admin-submenu[_ngcontent-%COMP%]{background:linear-gradient(135deg,#f8f9fa,#e9ecef);border-radius:0 0 12px 12px;padding:12px 0 0;margin-top:-12px}.admin-submenu[_ngcontent-%COMP%]   .nav[_ngcontent-%COMP%]{padding:8px 0}.admin-submenu[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]{margin:2px 12px}.admin-submenu[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{color:#495057;padding:12px 20px;border-radius:8px;font-weight:500;font-size:.9rem;transition:all .3s ease;border:2px solid transparent;position:relative;overflow:hidden}.admin-submenu[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]:before{content:"";position:absolute;left:0;top:0;width:0;height:100%;background:linear-gradient(135deg,#007bff,#0056b3);transition:width .3s ease;border-radius:8px 0 0 8px}.admin-submenu[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]:hover:before{width:4px}.admin-submenu[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#007bff1a,#0056b30d);color:#007bff;transform:translate(4px);border-color:#007bff33}.admin-submenu[_ngcontent-%COMP%]   .nav-link.active[_ngcontent-%COMP%]{background:linear-gradient(135deg,#007bff,#0056b3);color:#fff;transform:translate(4px);box-shadow:0 2px 8px #007bff4d}.admin-submenu[_ngcontent-%COMP%]   .nav-link.active[_ngcontent-%COMP%]:before{width:4px;background:#ffffff4d}.admin-content[_ngcontent-%COMP%]{background:linear-gradient(135deg,#fff,#f8f9fa);border-radius:15px;box-shadow:0 8px 25px #0000001a;border:1px solid rgba(0,0,0,.05);min-height:calc(100vh - 140px);padding:0;overflow:hidden}.navbar-toggler[_ngcontent-%COMP%]{display:none;background:linear-gradient(135deg,#007bff,#0056b3);border:none;border-radius:10px;padding:10px 15px;margin-bottom:20px;box-shadow:0 4px 12px #007bff4d;transition:all .3s ease}.navbar-toggler[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#0056b3,#004085);transform:translateY(-2px);box-shadow:0 6px 16px #007bff66}.navbar-toggler-icon[_ngcontent-%COMP%]{background-image:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba%28255, 255, 255, 1%29' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e")}@media (max-width: 768px){.admin-sidebar[_ngcontent-%COMP%]{position:relative;top:auto;max-height:none;margin-bottom:20px}.navbar-toggler[_ngcontent-%COMP%]{display:block}.admin-content[_ngcontent-%COMP%]{min-height:auto}.admin-menu-btn[_ngcontent-%COMP%]{padding:12px 16px;font-size:.9rem}.admin-submenu[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{padding:10px 16px;font-size:.85rem}}@media (max-width: 576px){.container[_ngcontent-%COMP%], .admin-header[_ngcontent-%COMP%]{padding:15px}.admin-header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:1.1rem}.admin-menu-item[_ngcontent-%COMP%]{margin:6px 8px}.admin-menu-btn[_ngcontent-%COMP%]{padding:10px 14px;font-size:.85rem}.admin-submenu[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{padding:8px 14px;font-size:.8rem}}@keyframes _ngcontent-%COMP%_slideIn{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.admin-menu-item[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slideIn .3s ease forwards}.admin-menu-item[_ngcontent-%COMP%]:nth-child(1){animation-delay:.1s}.admin-menu-item[_ngcontent-%COMP%]:nth-child(2){animation-delay:.2s}.admin-menu-item[_ngcontent-%COMP%]:nth-child(3){animation-delay:.3s}.admin-menu-item[_ngcontent-%COMP%]:nth-child(4){animation-delay:.4s}.admin-menu-item[_ngcontent-%COMP%]:nth-child(5){animation-delay:.5s}.admin-sidebar[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.admin-sidebar[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#0000000d;border-radius:3px}.admin-sidebar[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:linear-gradient(135deg,#007bff,#0056b3);border-radius:3px}.admin-sidebar[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:linear-gradient(135deg,#0056b3,#004085)}`]})}}return t})();var Ei=t=>["/admin/usuarios-nuevos",t];function Cn(t,d){t&1&&(o(0,"div",4)(1,"div",5)(2,"div",6)(3,"span",7),s(4,"Loading..."),n()()()())}function yn(t,d){t&1&&(o(0,"div",4)(1,"h4",8),s(2," Parece que todo el trabajo aqu\xED, ya fue realizado. "),u(3,"i",9),n()())}function En(t,d){t&1&&u(0,"img",33)}function Sn(t,d){if(t&1&&u(0,"img",34),t&2){let e=c().$implicit,i=c(2);v("src",i.url+"get-image-user/"+e.picture,M)}}function In(t,d){if(t&1){let e=C();o(0,"button",35),_("click",function(){f(e);let r=c(3);return g(r.removeToOpenItem())}),u(1,"i",36),s(2," Ocultar "),n()}if(t&2){let e=c().index;ke("data-bs-target","#item",e,""),ke("aria-controls","item",e,"")}}function wn(t,d){if(t&1){let e=C();o(0,"button",37),_("click",function(){f(e);let r=c().$implicit,m=c(2);return g(m.addToOpenItem(r._id))}),u(1,"i",38),s(2," Detalles "),n()}if(t&2){let e=c().index;ke("data-bs-target","#item",e,""),ke("aria-controls","item",e,"")}}function kn(t,d){if(t&1&&(o(0,"label",43)(1,"strong"),s(2),n()()),t&2){let e=c().$implicit;v("for",e.id),a(2),b(" ",e.label,":")}}function Tn(t,d){if(t&1&&(o(0,"p",44),s(1),n()),t&2){let e=c().$implicit,i=c().$implicit;v("id",e.id),a(),b(" ",i[e.attr]," ")}}function Fn(t,d){if(t&1&&(o(0,"p",44),s(1),n()),t&2){let e=c().$implicit,i=c().$implicit;v("id",e.id),a(),b(" ",i[e.attr].name," ")}}function Ln(t,d){if(t&1&&(o(0,"p",44),s(1),n()),t&2){let e=c().$implicit,i=c().$implicit;v("id",e.id),a(),b(" ",i[e.attr]," ")}}function Pn(t,d){if(t&1&&(o(0,"p",44),s(1),n()),t&2){let e=c().$implicit,i=c().$implicit;v("id",e.id),a(),tt(" ",i[e.attr].name,", ",i[e.attr].state,", ",i[e.attr].country," ")}}function Vn(t,d){if(t&1&&(o(0,"div",39),p(1,kn,3,2,"label",40),o(2,"div",41),p(3,Tn,2,2,"p",42)(4,Fn,2,2,"p",42)(5,Ln,2,2,"p",42)(6,Pn,2,4,"p",42),n()()),t&2){let e=d.$implicit,i=c().$implicit;a(),l("ngIf",i[e.attr]),a(2),l("ngIf",i[e.attr]&&e.type=="text"),a(),l("ngIf",i[e.attr]&&e.type=="select"&&e.autocomplete&&e.id!="city"),a(),l("ngIf",i[e.attr]&&e.type=="textarea"),a(),l("ngIf",i[e.attr]&&e.type=="select"&&e.autocomplete&&e.id=="city")}}function Mn(t,d){if(t&1){let e=C();o(0,"div",0)(1,"div",15)(2,"div",16)(3,"div",17)(4,"div",18),p(5,En,1,0,"img",19)(6,Sn,1,1,"img",20),n()(),o(7,"div",21)(8,"h5"),s(9),n(),o(10,"span"),s(11),n()(),o(12,"div",22),p(13,In,3,4,"button",23)(14,wn,3,4,"button",24),o(15,"button",25),_("click",function(){let r=f(e).$implicit,m=c(2);return g(m.activeUser(r))}),u(16,"i",26),o(17,"span",27),s(18,"Activar"),n()(),o(19,"button",28),_("click",function(){let r=f(e).$implicit,m=c(2);return g(m.removeUser(r._id))}),u(20,"i",29),o(21,"span",27),s(22,"Eliminar"),n()()()()(),o(23,"div",30)(24,"div",31),p(25,Vn,7,5,"div",32),n()()()}if(t&2){let e=d.$implicit,i=d.index,r=c(2);a(5),l("ngIf",!e.picture),a(),l("ngIf",e.picture),a(3),V("",e.name," ",e.surname,""),a(),ee("badge ",r.categories[e.role].class,""),a(),h(r.categories[e.role].label),a(2),l("ngIf",r.openItem==e._id),a(),l("ngIf",r.openItem!=e._id),a(9),O("id","item",i,""),a(2),l("ngForOf",r.fields)}}function An(t,d){if(t&1&&(o(0,"li",45)(1,"a",46),s(2,"Anterior"),n()()),t&2){let e=c(2);a(),l("routerLink",x(1,Ei,e.prevPage))}}function On(t,d){if(t&1&&(o(0,"li",45)(1,"a",47),s(2,"Siguiente"),n()()),t&2){let e=c(2);a(),l("routerLink",x(1,Ei,e.nextPage))}}function Rn(t,d){if(t&1&&(o(0,"div",4)(1,"div",10),p(2,Mn,26,13,"div",11),n(),o(3,"nav",12)(4,"ul",13),p(5,An,3,3,"li",14)(6,On,3,3,"li",14),n()()()),t&2){let e=c();a(2),l("ngForOf",e.users),a(3),l("ngIf",e.page>1),a(),l("ngIf",e.page<e.pages&&e.page!=e.pages)}}var Ke=(()=>{class t{constructor(e,i,r){this._UserService=e,this._route=i,this._router=r,this.user=new st,this.users=[],this.fields=vi,this.categories=kt,this.loading=!0,this.unsubscribe$=new Le,this.title="Nuevos usuarios",this.url=A.url,this.categories=kt}ngOnInit(){if(this._UserService.getIdentity?.()?.role==="lesson_manager"){this._router.navigate(["/admin/lecciones"]);return}this.actualPage()}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}getNewUsers(e){this._UserService.getNewUsers(e).pipe(he(this.unsubscribe$)).subscribe({next:i=>{this.users=i.users||[],this.total=i.total,this.pages=i.pages,this.loading=!1,e>this.pages&&this._router.navigate(["/admin/usuarios-nuevos"])},error:i=>{console.error("error nuevos usuarios: "+i),this.loading=!1}})}activeUser(e){this._UserService.activateUserByAdmin(e).pipe(he(this.unsubscribe$)).subscribe({next:i=>{i.user&&(this.users=this.users.filter(r=>r._id!=i.user._id),this.users.length==0&&this._router.navigate(["/admin/usuarios-nuevos"]))},error:i=>{console.error("Error al activar usuario:",i)}})}removeUser(e){this._UserService.forceUserLogout(e).pipe(he(this.unsubscribe$),ve(i=>(console.log("Error al forzar logout (continuando con eliminaci\xF3n):",i),ge(null))),Pe(()=>this._UserService.deleteUser(e))).subscribe({next:i=>{i.user&&(this.users=this.users.filter(r=>r._id!=i.user._id),this.users.length==0&&this._router.navigate(["/admin/usuarios-nuevos"]))},error:i=>{console.error("Error al eliminar usuario:",i),alert("Error al eliminar el usuario. Por favor, intenta nuevamente.")}})}removeToOpenItem(){this.openItem=null}addToOpenItem(e){this.openItem=e}actualPage(){this._route.params.pipe(Yt(),he(this.unsubscribe$)).subscribe(e=>{let i=+e.page||1;this.page=i,this.nextPage=this.page+1,this.prevPage=this.page-1,this.prevPage<=0&&(this.prevPage=1),this.getNewUsers(this.page)})}static{this.\u0275fac=function(i){return new(i||t)(y(P),y(z),y(j))}}static{this.\u0275cmp=w({type:t,selectors:[["newUsers"]],standalone:!1,decls:7,vars:4,consts:[[1,"card"],[1,"card-header"],[1,"m-0","text-primary","font-weight-bolder"],["class","card-body",4,"ngIf"],[1,"card-body"],[1,"text-muted","text-center"],["role","status",1,"spinner-border",2,"width","3rem","height","3rem"],[1,"sr-only"],[1,"text-muted"],[1,"fas","fa-laugh","icon-message"],["id","usersAccordion",1,"accordion"],["class","card",4,"ngFor","ngForOf"],["aria-label","Page navigation",1,"mt-3"],[1,"pagination","justify-content-end"],["class","page-item",4,"ngIf"],["id","headingOne",1,"card-body"],[1,"row","align-items-center"],[1,"col-1"],[1,"picture","rounded-circle","border-4","overflow-hidden"],["class","img-fluid","src","assets/images/user-default.png",4,"ngIf"],["class","img-fluid",3,"src",4,"ngIf"],[1,"col-6"],[1,"col-5","text-center"],["class","btn btn-warning btn-sm m-1","type","button","data-bs-toggle","collapse",3,"click",4,"ngIf"],["class","btn btn-info btn-sm m-1","type","button","data-bs-toggle","collapse",3,"click",4,"ngIf"],["type","button",1,"btn","btn-success","btn-sm","m-1",3,"click"],[1,"fas","fa-user-check"],[1,"ms-2"],["type","button",1,"btn","btn-danger","btn-sm","m-1",3,"click"],[1,"fas","fa-user-times"],["aria-labelledby","headingOne","data-parent","#usersAccordion",1,"collapse",3,"id"],[1,"card-footer"],["class","row",4,"ngFor","ngForOf"],["src","assets/images/user-default.png",1,"img-fluid"],[1,"img-fluid",3,"src"],["type","button","data-bs-toggle","collapse",1,"btn","btn-warning","btn-sm","m-1",3,"click"],[1,"fas","fa-eye-slash"],["type","button","data-bs-toggle","collapse",1,"btn","btn-info","btn-sm","m-1",3,"click"],[1,"fas","fa-eye"],[1,"row"],["class","col-2",3,"for",4,"ngIf"],[1,"col-10"],[3,"id",4,"ngIf"],[1,"col-2",3,"for"],[3,"id"],[1,"page-item"],[1,"page-link","bg-primary",3,"routerLink"],[1,"page-link","bg-info",3,"routerLink"]],template:function(i,r){i&1&&(o(0,"div",0)(1,"div",1)(2,"h3",2),s(3),n()(),p(4,Cn,5,0,"div",3)(5,yn,4,0,"div",3)(6,Rn,7,3,"div",3),n()),i&2&&(a(3),b(" ",r.title," "),a(),l("ngIf",r.loading),a(),l("ngIf",r.users.length==0&&!r.loading),a(),l("ngIf",r.users.length>0))},dependencies:[T,F,R],styles:[".rounded-circle[_ngcontent-%COMP%]{width:60px;height:60px;background-color:#f5f5f5;border:4px solid white}.rounded-circle[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{object-fit:cover;height:100%}"]})}}return t})();var Si=[{id:"name",label:"Nombres",type:"text",attr:"name",required:!0},{id:"surname",label:"Apellidos",type:"text",attr:"surname",required:!0},{id:"email",label:"Correo electr\xF3nico",type:"text",attr:"email",required:!0},{id:"city",label:"Ciudad",type:"select",attr:"city",required:!1,autocomplete:!0},{id:"profession",label:"Profesi\xF3n",type:"select",attr:"profession",required:!1,autocomplete:!0},{id:"institution",label:"Instituci\xF3n",type:"select",attr:"institution",required:!1,autocomplete:!0},{id:"category",label:"Categor\xEDa",type:"select",attr:"role",required:!0}],Ii=[{id:"name",label:"Nombres",type:"text",attr:"name"},{id:"surname",label:"Apellidos",type:"text",attr:"surname"},{id:"email",label:"Correo electr\xF3nico",type:"text",attr:"email"},{id:"about",label:"Descripci\xF3n",type:"textarea",attr:"about"},{id:"city",label:"Ciudad",type:"text",attr:"city",autocomplete:!0},{id:"profession",label:"Profesi\xF3n",type:"text",attr:"profession",autocomplete:!0},{id:"institution",label:"Instituci\xF3n",type:"text",attr:"institution",autocomplete:!0},{id:"postgraduate",label:"Postgrados",type:"textarea",attr:"postgraduate"},{id:"category",label:"Categor\xEDa",type:"select",attr:"role",required:!0}],Ft=[{label:"Facilitador",value:"expert"},{label:"Docente",value:"teacher"},{label:"Estudiante",value:"student"},{label:"Invitado",value:"guest"}],wi=[...Ft,{label:"Administrador delegado",value:"delegated_admin"},{label:"Gestor de lecciones",value:"lesson_manager"}],ut={teacher:{label:"Docente",class:"badge-success"},guest:{label:"Invitado",class:"badge-orange"},student:{label:"Estudiante",class:"badge-info"},expert:{label:"Facilitador",class:"badge-purple"},admin:{label:"Administrador*",class:"badge-green"},delegated_admin:{label:"Administrador",class:"badge-green"},lesson_manager:{label:"Gestor de lecciones",class:"badge-pink"}};var ye=(()=>{class t{transform(e,i){return i?(i=i.toLowerCase(),e.filter(r=>r.name?r.name.toLowerCase().includes(i):r.title?r.title.toLowerCase().includes(i):!1)):e}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275pipe=Zt({name:"filter",type:t,pure:!0,standalone:!1})}}return t})();var ki=t=>["/perfil",t],Ti=t=>["/admin/usuarios",t],We=t=>({"is-invalid":t});function Dn(t,d){if(t&1){let e=C();o(0,"div",40)(1,"div",41)(2,"input",42),_("click",function(){let r=f(e).$implicit,m=c();return g(m.setCategory(r.value))}),n(),o(3,"label",43),s(4),n()()()}if(t&2){let e=d.$implicit;a(2),v("id",e.value),a(),v("for",e.value),a(),h(e.label)}}function Nn(t,d){t&1&&(o(0,"div",44)(1,"div",45)(2,"span",46),s(3,"Loading..."),n()()())}function Un(t,d){t&1&&u(0,"img",63)}function $n(t,d){if(t&1&&u(0,"img",64),t&2){let e=c().$implicit,i=c(2);l("src",i.url+"get-image-user/"+e.picture,M)}}function qn(t,d){if(t&1&&(K(0),o(1,"span",65),s(2),n(),W()),t&2){let e=c().$implicit,i=c(2);a(),l("ngClass",i.labelProfile[e.role].class),a(),h(i.labelProfile[e.role].label)}}function jn(t,d){if(t&1){let e=C();o(0,"button",66),_("click",function(){f(e);let r=c().$implicit,m=c(2);return g(m.setEdit(r))}),u(1,"i",67),o(2,"span",5),s(3,"Editar"),n()()}}function Bn(t,d){if(t&1&&(o(0,"button",68),u(1,"i",62),o(2,"span",5),s(3,"Eliminar"),n()()),t&2){let e=c().$implicit;be("data-bs-target","#confirmDelete"+e._id)}}function Gn(t,d){if(t&1){let e=C();o(0,"div",48)(1,"div",49)(2,"div",50),p(3,Un,1,0,"img",51)(4,$n,1,1,"img",52),n(),o(5,"div",53)(6,"a",54)(7,"h5"),s(8),n()(),p(9,qn,3,2,"ng-container",15),n(),o(10,"div",55),p(11,jn,4,0,"button",56)(12,Bn,4,1,"button",57),n()(),o(13,"div",58)(14,"div",18)(15,"div",19)(16,"div",21)(17,"h5",59),s(18,"Confirmar eliminaci\xF3n"),n(),u(19,"button",37),n(),o(20,"div",25),s(21),n(),o(22,"div",30)(23,"button",60),s(24,"Cancelar"),n(),o(25,"button",61),_("click",function(){let r=f(e).$implicit,m=c(2);return g(m.removeUser(r._id))}),u(26,"i",62),o(27,"span",5),s(28,"Eliminar"),n()()()()()()()}if(t&2){let e=d.$implicit,i=c(2);a(3),l("ngIf",!e.picture),a(),l("ngIf",e.picture),a(2),l("routerLink",x(15,ki,e._id)),a(2),V("",e.name," ",e.surname,""),a(),l("ngIf",i.labelProfile[e.role]),a(2),l("ngIf",i.identity._id!==e._id&&e.role!=="admin"),a(),l("ngIf",i.identity._id!==e._id&&e.role!=="admin"),a(),O("id","confirmDelete",e._id,""),be("aria-labelledby","confirmDeleteTitle"+e._id),a(4),O("id","confirmDeleteTitle",e._id,""),a(4),V(" \xBFSeguro que deseas eliminar al usuario ",e.name," ",e.surname,"? Esta acci\xF3n no se puede deshacer. ")}}function zn(t,d){if(t&1&&(o(0,"div"),p(1,Gn,29,17,"div",47),n()),t&2){let e=c();a(),l("ngForOf",e.users)}}function Kn(t,d){t&1&&u(0,"img",63)}function Wn(t,d){if(t&1&&u(0,"img",64),t&2){let e=c().$implicit,i=c(2);l("src",i.url+"get-image-user/"+e.picture,M)}}function Jn(t,d){if(t&1&&(K(0),o(1,"span",65),s(2),n(),W()),t&2){let e=c().$implicit,i=c(2);a(),l("ngClass",i.labelProfile[e.role].class),a(),h(i.labelProfile[e.role].label)}}function Hn(t,d){if(t&1){let e=C();o(0,"button",66),_("click",function(){f(e);let r=c().$implicit,m=c(2);return g(m.setEdit(r))}),u(1,"i",67),o(2,"span",5),s(3,"Editar"),n()()}}function Yn(t,d){if(t&1&&(o(0,"button",68),u(1,"i",62),o(2,"span",5),s(3,"Eliminar"),n()()),t&2){let e=c().$implicit;be("data-bs-target","#confirmDelete"+e._id)}}function Qn(t,d){if(t&1){let e=C();o(0,"div",48)(1,"div",49)(2,"div",50),p(3,Kn,1,0,"img",51)(4,Wn,1,1,"img",52),n(),o(5,"div",53)(6,"a",54)(7,"h5"),s(8),n()(),p(9,Jn,3,2,"ng-container",15),n(),o(10,"div",55),p(11,Hn,4,0,"button",56)(12,Yn,4,1,"button",57),n()(),o(13,"div",58)(14,"div",18)(15,"div",19)(16,"div",21)(17,"h5",59),s(18,"Confirmar eliminaci\xF3n"),n(),u(19,"button",37),n(),o(20,"div",25),s(21),n(),o(22,"div",30)(23,"button",60),s(24,"Cancelar"),n(),o(25,"button",61),_("click",function(){let r=f(e).$implicit,m=c(2);return g(m.removeUser(r._id))}),u(26,"i",62),o(27,"span",5),s(28,"Eliminar"),n()()()()()()()}if(t&2){let e=d.$implicit,i=c(2);a(3),l("ngIf",!e.picture),a(),l("ngIf",e.picture),a(2),l("routerLink",x(15,ki,e._id)),a(2),V("",e.name," ",e.surname,""),a(),l("ngIf",i.labelProfile[e.role]),a(2),l("ngIf",i.identity._id!==e._id&&e.role!=="admin"),a(),l("ngIf",i.identity._id!==e._id&&e.role!=="admin"),a(),O("id","confirmDelete",e._id,""),be("aria-labelledby","confirmDeleteTitle"+e._id),a(4),O("id","confirmDeleteTitle",e._id,""),a(4),V(" \xBFSeguro que deseas eliminar al usuario ",e.name," ",e.surname,"? Esta acci\xF3n no se puede deshacer. ")}}function Xn(t,d){if(t&1&&(o(0,"div"),p(1,Qn,29,17,"div",47),I(2,"filter"),n()),t&2){let e=c();a(),l("ngForOf",L(2,1,e.allUsers,e.filter.value))}}function Zn(t,d){if(t&1&&(o(0,"li",72)(1,"a",73),s(2,"Anterior"),n()()),t&2){let e=c(2);a(),l("routerLink",x(1,Ti,e.prevPage))}}function eo(t,d){if(t&1&&(o(0,"li",72)(1,"a",74),s(2,"Siguiente"),n()()),t&2){let e=c(2);a(),l("routerLink",x(1,Ti,e.nextPage))}}function to(t,d){if(t&1&&(o(0,"nav",69)(1,"ul",70),p(2,Zn,3,3,"li",71)(3,eo,3,3,"li",71),n()()),t&2){let e=c();a(2),l("ngIf",e.page>1),a(),l("ngIf",e.page<e.pages&&e.page!==e.pages)}}function io(t,d){t&1&&(o(0,"div",75),u(1,"i",76),s(2," El usuario no fue agregado correctamente. Es posible que el correo electr\xF3nico suministrado ya se encuentra registrado. "),n())}function no(t,d){t&1&&(o(0,"div",77),u(1,"i",78),s(2," El usuario fue agregado correctamente. "),n())}function oo(t,d){t&1&&(o(0,"span"),s(1,"*"),n())}function ro(t,d){if(t&1){let e=C();o(0,"input",88),_("keydown",function(r){f(e);let m=c(2);return g(m.onKeydown(r))}),n()}if(t&2){let e=c().$implicit,i=c();v("id",e.id),v("formControlName",e.id),v("placeholder",e.label),l("ngClass",x(4,We,i.submitted&&i.f[e.id].errors))}}function ao(t,d){if(t&1&&(o(0,"option",91),s(1),n()),t&2){let e=d.$implicit;l("value",e.value),a(),h(e.label)}}function so(t,d){if(t&1&&(o(0,"select",89),p(1,ao,2,2,"option",90),n()),t&2){let e=c().$implicit,i=c();v("size",i.categories.length),v("formControlName",e.id),v("id",e.id),l("ngClass",x(5,We,i.submitted&&i.f[e.id].errors)),a(),l("ngForOf",i.categories)}}function lo(t,d){if(t&1&&s(0),t&2){let e=d.item;tt("",e.name,", ",e.state,", ",e.country,"")}}function co(t,d){t&1&&p(0,lo,1,3,"ng-template",93)}function mo(t,d){if(t&1){let e=C();o(0,"ng-select",92),_("change",function(r){f(e);let m=c().$implicit,E=c();return g(E.addCityData(r,m.id))}),p(1,co,1,0,null,15),n()}if(t&2){let e=c().$implicit,i=c();O("addTagText","Agregar ",e.label,""),v("formControlName",e.id),v("placeholder",e.label),l("items",i.items[e.id])("addTag",!0)("ngClass",x(8,We,i.submitted&&i.f[e.id].errors)),a(),l("ngIf",e.id==="city")}}function po(t,d){if(t&1&&(o(0,"div",95),s(1),n()),t&2){let e=c(2).$implicit;a(),b(" El campo ",e.label," es obligatorio. ")}}function uo(t,d){if(t&1&&(o(0,"div"),p(1,po,2,1,"div",94),n()),t&2){let e=c().$implicit,i=c();a(),l("ngIf",i.f[e.id].errors.required)}}function _o(t,d){if(t&1&&(o(0,"div"),s(1),n()),t&2){let e=c(2).$implicit;a(),b(" El campo ",e.label," es obligatorio. ")}}function fo(t,d){t&1&&(o(0,"div"),s(1,"El correo electr\xF3nico debe ser una direcci\xF3n email v\xE1lida. "),n())}function go(t,d){if(t&1&&(o(0,"div",96),p(1,_o,2,1,"div",15)(2,fo,2,0,"div",15),n()),t&2){let e=c().$implicit,i=c();a(),l("ngIf",i.f[e.id].errors.required),a(),l("ngIf",i.f[e.id].errors.email||e.id=="email")}}function vo(t,d){if(t&1){let e=C();o(0,"input",97),_("keydown",function(r){f(e);let m=c(2);return g(m.onKeydown(r))}),n()}if(t&2){let e=c(2);l("formControl",e.state)}}function ho(t,d){if(t&1){let e=C();o(0,"input",98),_("keydown",function(r){f(e);let m=c(2);return g(m.onKeydown(r))}),n()}if(t&2){let e=c(2);l("formControl",e.country)}}function xo(t,d){if(t&1&&(o(0,"div",79)(1,"label",80)(2,"strong"),s(3),p(4,oo,2,0,"span",15),n()(),o(5,"div",81),p(6,ro,1,6,"input",82)(7,so,2,7,"select",83)(8,mo,2,10,"ng-select",84)(9,uo,2,1,"div",15)(10,go,3,2,"div",85)(11,vo,1,1,"input",86)(12,ho,1,1,"input",87),n()()),t&2){let e=d.$implicit,i=c();a(),v("for",e.id),a(2),h(e.label),a(),l("ngIf",e.required),a(2),l("ngIf",e.type==="text"),a(),l("ngIf",e.type==="select"&&!e.autocomplete),a(),l("ngIf",e.type==="select"&&e.autocomplete),a(),l("ngIf",e.type==="select"&&e.autocomplete&&i.submitted&&i.f[e.id].errors),a(),l("ngIf",i.submitted&&i.f[e.id].errors),a(),l("ngIf",e.id=="city"&&i.addCity),a(),l("ngIf",e.id=="city"&&i.addCity)}}function bo(t,d){t&1&&(o(0,"div",79)(1,"label",99)(2,"strong"),s(3,"Asesora lecciones"),n()(),o(4,"div",81)(5,"select",100)(6,"option",101),s(7,"S\xED"),n(),o(8,"option",102),s(9,"No"),n()()()())}function Co(t,d){t&1&&(o(0,"div",75),u(1,"i",76),s(2," El usuario no ha podido ser editado correctamente. "),n())}function yo(t,d){t&1&&(o(0,"div",77),u(1,"i",78),s(2," El usuario fue editado correctamente. "),n())}function Eo(t,d){t&1&&(o(0,"span"),s(1,"*"),n())}function So(t,d){if(t&1){let e=C();o(0,"input",105),_("keydown",function(r){f(e);let m=c(2);return g(m.onKeydown(r))}),n()}if(t&2){let e=c().$implicit,i=c();v("id",e.id),v("formControlName",e.id),l("ngClass",x(3,We,i.editSubmitted&&i.f2[e.id].errors))}}function Io(t,d){if(t&1&&u(0,"textarea",106),t&2){let e=c().$implicit;v("id",e.id),v("formControlName",e.id)}}function wo(t,d){if(t&1&&(o(0,"option",91),s(1),n()),t&2){let e=d.$implicit;l("value",e.value),a(),h(e.label)}}function ko(t,d){if(t&1&&(o(0,"select",89),p(1,wo,2,2,"option",90),n()),t&2){let e=c().$implicit,i=c();v("size",i.categories.length),v("formControlName",e.id),v("id",e.id),l("ngClass",x(5,We,i.editSubmitted&&i.f2[e.id].errors)),a(),l("ngForOf",i.categories)}}function To(t,d){if(t&1&&(o(0,"div",79)(1,"label",80)(2,"strong"),s(3),p(4,Eo,2,0,"span",15),n()(),o(5,"div",81),p(6,So,1,5,"input",103)(7,Io,1,2,"textarea",104)(8,ko,2,7,"select",83),n()()),t&2){let e=d.$implicit;a(),v("for",e.id),a(2),h(e.label),a(),l("ngIf",e.required),a(2),l("ngIf",e.type=="text"),a(),l("ngIf",e.type==="textarea"),a(),l("ngIf",e.type=="select"&&!e.autocomplete)}}function Fo(t,d){t&1&&(o(0,"div",79)(1,"label",99)(2,"strong"),s(3,"Asesora lecciones"),n()(),o(4,"div",81)(5,"select",100)(6,"option",101),s(7,"S\xED"),n(),o(8,"option",102),s(9,"No"),n()()()())}var Pt=(()=>{class t{constructor(e,i,r,m,E){this._bDService=e,this._userService=i,this._route=r,this._router=m,this.fb=E,this.labelProfile=ut,this.addFieldsForm=Si,this.editFieldsForm=Ii,this.addCity=!1,this.submitted=!1,this.editSubmitted=!1,this.city=new ct,this.profession=new lt(""),this.institution=new dt,this.user=new st,this.users=[],this.selectedCategory=[],this.loading=!0,this.title="Usuarios",this.identity=i.getIdentity(),this.categories=Ft,this.url=A.url,this.identity.role=="admin"&&(this.categories=wi),this.addForm=this.fb.group({name:["",S.required],surname:["",S.required],email:["",[S.required,S.email]],profession:["",S.required],institution:["",S.required],city:["",S.required],category:["",S.required],canAdvise:["false"]}),this.editForm=this.fb.group({name:[""],surname:[""],email:[""],profession:[""],institution:[""],about:[""],city:[""],category:[""],canAdvise:[""],postgraduate:[""]}),this.state=this.fb.control(""),this.country=this.fb.control(""),this.items={city:[],institution:[],profession:[]},this.filter=this.fb.control("")}ngOnInit(){this.getAllUsers(),this.getAllCities(),this.getAllInstitutions(),this.getAllProfessions(),this.actualPage()}get f(){return this.addForm.controls}get f2(){return this.editForm.controls}getAllCities(){this.allCities=JSON.parse(localStorage.getItem("cities")),this.allCities||this._bDService.getAllCities().subscribe({next:e=>{e.cities&&(this.allCities=e.cities,localStorage.setItem("cities",JSON.stringify(this.allCities)))},error:e=>{console.log(e)}})}getAllProfessions(){this.allProfessions=JSON.parse(localStorage.getItem("professions")),this.allProfessions||this._bDService.getAllProfessions().subscribe({next:e=>{e.professions&&(this.allProfessions=e.professions,localStorage.setItem("professions",JSON.stringify(this.allProfessions)))},error:e=>{console.log(e)}})}getAllInstitutions(){this.allInstitutions=JSON.parse(localStorage.getItem("institutions")),this.allInstitutions||this._bDService.getAllInstitutions().subscribe({next:e=>{e.institutions&&(this.allInstitutions=e.institutions,localStorage.setItem("institutions",JSON.stringify(this.allInstitutions)))},error:e=>{console.log(e)}})}setAdd(){this.status||(this.status=null),this.submitted=!1,this.items.city=this.allCities,this.items.institution=this.allInstitutions,this.items.profession=this.allProfessions}onSubmit(){return ie(this,null,function*(){if(this.submitted=!0,!this.addForm.invalid){this.user.name=this.addForm.value.name,this.user.surname=this.addForm.value.surname,this.user.email=this.addForm.value.email,this.addForm.value.city&&(this.user.city=this.addForm.value.city._id),this.addForm.value.profession&&(this.user.profession=this.addForm.value.profession._id),this.addForm.value.institution&&(this.user.institution=this.addForm.value.institution._id),this.user.role=this.addForm.value.category,this.user.canAdvise=this.addForm.value.canAdvise=="true";try{if(!this.user.city&&this.addForm.value.city){this.city.name=this.addForm.value.city.name,this.city.state=this.state.value,this.city.country=this.country.value;let i=yield Ge(this._bDService.addCity(this.city));i.city&&i.city._id?(this.user.city=i.city._id,this.state.reset(),this.country.reset(),localStorage.removeItem("cities"),this.getAllCities()):console.log(i)}if(!this.user.profession&&this.addForm.value.profession){this.profession.name=this.addForm.value.profession.name;let i=yield Ge(this._bDService.addProfession(this.profession));i.profession&&i.profession._id?(this.user.profession=i.profession._id,localStorage.removeItem("professions"),this.getAllProfessions()):console.log(i)}if(!this.user.institution&&this.addForm.value.institution){this.institution.name=this.addForm.value.institution.name;let i=yield Ge(this._bDService.addInstitution(this.institution));i.institution&&i.institution._id?(this.user.institution=i.institution._id,localStorage.removeItem("institutions"),this.getAllInstitutions()):console.log(i)}let e=yield Ge(this._userService.registerByAdmin(this.user));e.user&&e.user._id?(this.addForm.reset(),this.status="success",this.submitted=!1):this.status="error",this.getUsers(this.page),this.getAllUsers(),this.setAdd(),document.querySelector(".modal-body").scrollTop=0}catch(e){this.status="error",console.log(e)}}})}setEdit(e){let i,r,m;this.editStatus=null,this.editSubmitted=!1,this.tempUser=e,this.user=null,this.tempUser.city&&(i=`${this.tempUser.city.name}, ${this.tempUser.city.state}, ${this.tempUser.city.country}`),this.tempUser.profession&&(r=this.tempUser.profession.name),this.tempUser.institution&&(m=this.tempUser.institution.name),this.editForm.patchValue({name:this.tempUser.name,surname:this.tempUser.surname,about:this.tempUser.about,email:this.tempUser.email,city:i,profession:r,institution:m,category:this.tempUser.role,canAdvise:this.tempUser.canAdvise.toString()})}onEditSubmit(){this.submitted=!0,!this.editForm.invalid&&(this.user=this.tempUser,this.tempUser.city&&(this.user.city=this.tempUser.city._id),this.user.institution=this.tempUser.institution._id,this.user.profession=this.tempUser.profession._id,this.user.role=this.editForm.value.category,this.user.canAdvise=this.editForm.value.canAdvise=="true",this._userService.updateUser(this.user).subscribe(e=>{e.user&&e.user._id?(this.editStatus="success",this.getUsers(this.page),this.getAllUsers()):this.editStatus="error"},e=>{this.editStatus="error",console.log(e)}),document.querySelector("div#modal-body").scrollTop=0)}actualPage(){this._route.params.subscribe(e=>{let i=+e.page;this.page=i,i?(this.nextPage=i+1,this.prevPage=i-1,this.prevPage<=0&&(this.prevPage=1)):(this.page=1,this.nextPage=this.page+1),this.getUsers(this.page)})}getUsers(e){this._userService.getUsers(e).subscribe({next:i=>{i.users&&(this.users=i.users,this.total=i.total,this.pages=i.pages,e>this.pages&&this._router.navigate(["/admin/usuarios"]),this.loading=!1)},error:i=>{console.log(i)}})}getAllUsers(){let e=[];this._userService.getAllUsers().subscribe({next:i=>{i.users&&(this.allUsers=i.users,this.selectedCategory.length>0&&(this.selectedCategory.forEach(r=>{e=e.concat(this.allUsers.filter(m=>m.role==r))}),this.allUsers=e))},error:i=>{console.log(i)}})}onKeydown(e){e.keyCode===13&&(e.preventDefault(),document.getElementById("save").click())}removeUser(e){this._userService.forceUserLogout(e).pipe(ve(i=>(console.log("Error al forzar logout (continuando con eliminaci\xF3n):",i),ge(null))),Pe(()=>this._userService.deleteUser(e))).subscribe({next:i=>{i.user&&(this.users=this.users.filter(r=>r._id!=i.user._id),this.getUsers(this.page),this.getAllUsers())},error:i=>{console.log(i),alert("Error al eliminar el usuario. Por favor, intenta nuevamente.")}})}addToOpenItem(e){this.openItem=e}addCityData(e,i){e&&!e._id&&i=="city"?this.addCity=!0:this.addCity=!1}setCategory(e){this.selectedCategory.indexOf(e)>=0?this.selectedCategory.splice(this.selectedCategory.indexOf(e),1):this.selectedCategory.push(e),this.getAllUsers()}restartValues(){this.status=null,this.submitted=!1}onChanges(){this.addForm.valueChanges.subscribe(e=>{e&&(this.status=null,this.submitted=!1)}),this.editForm.valueChanges.subscribe(e=>{e&&(this.editStatus=null,this.editSubmitted=!1)})}static{this.\u0275fac=function(i){return new(i||t)(y(ne),y(P),y(z),y(j),y(Me))}}static{this.\u0275cmp=w({type:t,selectors:[["users"]],standalone:!1,decls:58,vars:17,consts:[[1,"card"],[1,"card-header","d-flex","justify-content-between","align-items-center"],[1,"m-0","text-primary","fw-bolder"],["type","button","data-bs-toggle","modal","data-bs-target","#add",1,"btn","btn-primary",3,"click"],[1,"fas","fa-plus"],[1,"ms-2"],[1,"card-body"],[1,"categories-form","mb-3"],[1,"categories-container"],["class","category-item",4,"ngFor","ngForOf"],[1,"input-group","mb-2"],[1,"input-group-prepend"],[1,"input-group-text"],["type","text","id","inlineFormInputGroup","placeholder","Filtro","autocomplete","off",1,"form-control",3,"formControl"],["class","text-center my-3",4,"ngIf"],[4,"ngIf"],["class","mt-3",4,"ngIf"],["id","add","tabindex","-1","role","dialog","aria-labelledby","addTitle","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-dialog-centered"],[1,"modal-content"],[3,"ngSubmit","input","formGroup"],[1,"modal-header"],["id","addTitle",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close",3,"click"],["aria-hidden","true"],[1,"modal-body"],["class","alert alert-danger fade show text-center","role","alert",4,"ngIf"],["class","alert alert-success fade show text-center","role","alert",4,"ngIf"],["class","form-group row",4,"ngFor","ngForOf"],["class","form-group row",4,"ngIf"],[1,"modal-footer"],["data-bs-dismiss","modal",1,"btn","btn-danger"],["id","save","type","submit",1,"btn","btn-success"],["id","edit","tabindex","-1","role","dialog","aria-labelledby","editTitle","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-dialog-scrollable"],[1,"modal-content",3,"ngSubmit","input","formGroup"],["id","editTitle",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],["id","modal-body",1,"modal-body"],["data-bs-dismiss","modal",1,"btn","btn-danger",3,"click"],[1,"category-item"],[1,"form-check"],["type","checkbox",1,"form-check-input",3,"click","id"],[1,"form-check-label",3,"for"],[1,"text-center","my-3"],["role","status",1,"spinner-border",2,"width","3rem","height","3rem"],[1,"sr-only"],["class","card mb-3",4,"ngFor","ngForOf"],[1,"card","mb-3"],[1,"card-body","d-flex","align-items-center"],[1,"picture","rounded-circle","border-4","overflow-hidden",2,"width","60px","height","60px"],["class","img-fluid","src","assets/images/user-default.png",4,"ngIf"],["class","img-fluid",3,"src",4,"ngIf"],[1,"flex-grow-1","ms-3"],[1,"text-primary","user-name",3,"routerLink"],[1,"text-center"],["type","button","class","btn btn-warning btn-sm m-1","data-bs-toggle","modal","data-bs-target","#edit",3,"click",4,"ngIf"],["type","button","class","btn btn-danger btn-sm m-1","data-bs-toggle","modal",4,"ngIf"],["tabindex","-1","role","dialog","aria-hidden","true",1,"modal","fade",3,"id"],[1,"modal-title",3,"id"],["data-bs-dismiss","modal",1,"btn","btn-secondary"],["type","button","data-bs-dismiss","modal",1,"btn","btn-danger",3,"click"],[1,"fas","fa-user-times"],["src","assets/images/user-default.png",1,"img-fluid"],[1,"img-fluid",3,"src"],[1,"badge",3,"ngClass"],["type","button","data-bs-toggle","modal","data-bs-target","#edit",1,"btn","btn-warning","btn-sm","m-1",3,"click"],[1,"fas","fa-pen-square"],["type","button","data-bs-toggle","modal",1,"btn","btn-danger","btn-sm","m-1"],[1,"mt-3"],[1,"pagination","justify-content-end"],["class","page-item",4,"ngIf"],[1,"page-item"],[1,"page-link","bg-primary",3,"routerLink"],[1,"page-link","bg-info",3,"routerLink"],["role","alert",1,"alert","alert-danger","fade","show","text-center"],[1,"fas","fa-times-circle","icon-message","me-2"],["role","alert",1,"alert","alert-success","fade","show","text-center"],[1,"fas","fa-check-circle","icon-message","me-2"],[1,"form-group","row"],[1,"col-4","col-form-label",3,"for"],[1,"col-8"],["type","text","class","form-control","autocomplete","off",3,"id","formControlName","placeholder","ngClass","keydown",4,"ngIf"],["class","form-control",3,"size","formControlName","id","ngClass",4,"ngIf"],["bindLabel","name",3,"items","addTag","addTagText","formControlName","placeholder","ngClass","change",4,"ngIf"],["class","invalid-feedback",4,"ngIf"],["type","text","class","form-control","id","state","placeholder","Departamento/Estado/Provincia","autocomplete","off",3,"formControl","keydown",4,"ngIf"],["type","text","class","form-control","id","country","placeholder","Pais","autocomplete","off",3,"formControl","keydown",4,"ngIf"],["type","text","autocomplete","off",1,"form-control",3,"keydown","id","formControlName","placeholder","ngClass"],[1,"form-control",3,"size","formControlName","id","ngClass"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["bindLabel","name",3,"change","items","addTag","addTagText","formControlName","placeholder","ngClass"],["ng-option-tmp",""],["class","invalid-feedback-select",4,"ngIf"],[1,"invalid-feedback-select"],[1,"invalid-feedback"],["type","text","id","state","placeholder","Departamento/Estado/Provincia","autocomplete","off",1,"form-control",3,"keydown","formControl"],["type","text","id","country","placeholder","Pais","autocomplete","off",1,"form-control",3,"keydown","formControl"],["for","canAdvise",1,"col-4","col-form-label"],["formControlName","canAdvise","id","canAdvise",1,"form-control"],["value","true"],["value","false"],["type","text","class","form-control","readonly","",3,"id","formControlName","ngClass","keydown",4,"ngIf"],["class","form-control","rows","3","readonly","",3,"id","formControlName",4,"ngIf"],["type","text","readonly","",1,"form-control",3,"keydown","id","formControlName","ngClass"],["rows","3","readonly","",1,"form-control",3,"id","formControlName"]],template:function(i,r){i&1&&(o(0,"div",0)(1,"div",1)(2,"h3",2),s(3),n(),o(4,"button",3),_("click",function(){return r.setAdd()}),u(5,"i",4),o(6,"span",5),s(7,"Agregar"),n()()(),o(8,"div",6)(9,"form",7)(10,"div",8),p(11,Dn,5,3,"div",9),n()(),o(12,"div",10)(13,"div",11)(14,"div",12),s(15,"Filtrar:"),n()(),u(16,"input",13),n(),p(17,Nn,4,0,"div",14)(18,zn,2,1,"div",15)(19,Xn,3,4,"div",15)(20,to,4,2,"nav",16),n()(),o(21,"div",17)(22,"div",18)(23,"div",19)(24,"form",20),_("ngSubmit",function(){return r.onSubmit()})("input",function(){return r.onChanges()}),o(25,"div",21)(26,"h5",22),s(27,"Agregar un usuario"),n(),o(28,"button",23),_("click",function(){return r.restartValues()}),o(29,"span",24),s(30,"\xD7"),n()()(),o(31,"div",25),p(32,io,3,0,"div",26)(33,no,3,0,"div",27)(34,xo,13,10,"div",28)(35,bo,10,0,"div",29),n(),o(36,"div",30)(37,"button",31),s(38,"Cancelar"),n(),o(39,"button",32),s(40,"Guardar"),n()()()()()(),o(41,"div",33)(42,"div",34)(43,"form",35),_("ngSubmit",function(){return r.onEditSubmit()})("input",function(){return r.onChanges()}),o(44,"div",21)(45,"h5",36),s(46,"Editar usuario"),n(),u(47,"button",37),n(),o(48,"div",38),p(49,Co,3,0,"div",26)(50,yo,3,0,"div",27)(51,To,9,6,"div",28)(52,Fo,10,0,"div",29),n(),o(53,"div",30)(54,"button",39),_("click",function(){return r.restartValues()}),s(55,"Cancelar"),n(),o(56,"button",32),s(57,"Guardar"),n()()()()()),i&2&&(a(3),h(r.title),a(8),l("ngForOf",r.categories),a(5),l("formControl",r.filter),a(),l("ngIf",r.loading),a(),l("ngIf",!r.filter.value&&r.selectedCategory.length===0&&!r.loading),a(),l("ngIf",r.filter.value||r.selectedCategory.length>0),a(),l("ngIf",!r.filter.value&&r.selectedCategory.length===0),a(4),l("formGroup",r.addForm),a(8),l("ngIf",r.status==="error"),a(),l("ngIf",r.status==="success"),a(),l("ngForOf",r.addFieldsForm),a(),l("ngIf",r.f.category.value=="teacher"),a(8),l("formGroup",r.editForm),a(6),l("ngIf",r.editStatus==="error"),a(),l("ngIf",r.editStatus==="success"),a(),l("ngForOf",r.editFieldsForm),a(),l("ngIf",r.f2.category.value=="teacher"))},dependencies:[G,T,F,q,ce,me,N,de,D,$,Ce,le,H,Y,Ie,ri,R,ye],styles:[".rounded-circle[_ngcontent-%COMP%]{width:60px;height:60px;background-color:#f5f5f5;border:4px solid white}.rounded-circle[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{object-fit:cover;height:100%}.theme-dark[_nghost-%COMP%]   .user-name[_ngcontent-%COMP%], .theme-dark   [_nghost-%COMP%]   .user-name[_ngcontent-%COMP%]{color:#fff!important}"]})}}return t})();var Fi=t=>({"is-invalid":t});function Lo(t,d){if(t&1&&(o(0,"div",22),u(1,"i",23),s(2),n()),t&2){let e=c();a(2),b(" ",e.errorMsg," ")}}function Po(t,d){if(t&1&&(o(0,"div",24),u(1,"i",25),s(2),n()),t&2){let e=c();a(2),b(" ",e.successMsg," ")}}function Vo(t,d){t&1&&(o(0,"span"),s(1,"*"),n())}function Mo(t,d){if(t&1&&u(0,"input",30),t&2){let e=c().$implicit,i=c();v("id",e.id),v("formControlName",e.id),l("ngClass",x(3,Fi,i.submitted&&i.f[e.id].errors))}}function Ao(t,d){if(t&1&&u(0,"textarea",31),t&2){let e=c().$implicit,i=c();v("id",e.id),v("formControlName",e.id),l("ngClass",x(3,Fi,i.submitted&&i.f[e.id].errors))}}function Oo(t,d){if(t&1&&(o(0,"div"),s(1),n()),t&2){let e=c(2).$implicit;a(),b("El campo ",e.label," es obligatorio.")}}function Ro(t,d){if(t&1&&(o(0,"div",32),p(1,Oo,2,1,"div",27),n()),t&2){let e=c().$implicit,i=c();a(),l("ngIf",i.f[e.id].errors.required)}}function Do(t,d){if(t&1&&(o(0,"div",12)(1,"label",26)(2,"strong"),s(3),p(4,Vo,2,0,"span",27),n()(),o(5,"div",14),p(6,Mo,1,5,"input",28)(7,Ao,1,5,"textarea",29)(8,Ro,2,1,"div",16),n()()),t&2){let e=d.$implicit,i=c();a(),v("for",e.id),a(2),h(e.label),a(),l("ngIf",e.required),a(2),l("ngIf",e.type=="text"),a(),l("ngIf",e.type==="textarea"),a(),l("ngIf",i.submitted&&i.f[e.id].errors)}}function No(t,d){t&1&&(o(0,"div"),s(1," Seleccionar al menos una \xE1rea de conocimiento es obligatorio. "),n())}function Uo(t,d){if(t&1&&(o(0,"div",32),p(1,No,2,0,"div",27),n()),t&2){let e=c();a(),l("ngIf",e.f.knowledge_area.errors.required)}}function $o(t,d){t&1&&(o(0,"div"),s(1,"Seleccionar al menos un nivel de desarrollo es obligatorio."),n())}function qo(t,d){if(t&1&&(o(0,"div",32),p(1,$o,2,0,"div",27),n()),t&2){let e=c();a(),l("ngIf",e.f.level.errors.required)}}var Li=(()=>{class t{constructor(e,i,r,m,E){this._userService=e,this._lessonService=i,this._bDService=r,this.cdr=m,this.fb=E,this.loading=!1,this.knowledgeAreas=[],this.academicLevels=Object.values(Te),this.added=new se,this.title="Agregar lecci\xF3n",this.identity=this._userService.getIdentity(),this.token=this._userService.getToken(),this.url=A.url,this.fields=[{id:"title",label:"T\xEDtulo",type:"text",required:!0},{id:"resume",label:"Resumen",type:"textarea",required:!0},{id:"justification",label:"Justificaci\xF3n",type:"textarea",required:!0},{id:"references",label:"Referencias",type:"textarea",required:!1}],this.errorMsg="Hubo un error al agregar el tema para una lecci\xF3n. Int\xE9ntalo de nuevo m\xE1s tarde.",this.successMsg="Se ha agregado el tema para la nueva lecci\xF3n correctamente.",this.addForm=this.fb.group({title:["",S.required],resume:["",S.required],justification:["",S.required],references:[""],knowledge_area:[[],S.required],level:[[],S.required]})}ngOnInit(){this.loadKnowledgeAreas()}loadKnowledgeAreas(){this._bDService.getKnowledgeAreas().subscribe({next:e=>{e&&Array.isArray(e.areas)?(this.knowledgeAreas=e.areas,console.log("\xC1reas de conocimiento cargadas:",this.knowledgeAreas[0])):(this.knowledgeAreas=[],console.error("La respuesta de \xE1reas de conocimiento no es un array:",e))},error:e=>{console.error("Error al cargar las \xE1reas de conocimiento:",e),this.knowledgeAreas=[]}})}get f(){return this.addForm.controls}restartValues(){this.status=null,this.submitted=!1}onSubmit(){return ie(this,null,function*(){if(this.submitted=!0,this.loading=!0,this.addForm.invalid){this.loading=!1;return}this.lesson=new mt,this.lesson.title=this.addForm.value.title,this.lesson.resume=this.addForm.value.resume,this.lesson.justification=this.addForm.value.justification,this.lesson.references=this.addForm.value.references,this.lesson.accepted=!0,this.lesson.author=this.identity._id,this.lesson.knowledge_area=this.addForm.value.knowledge_area;let e=this.addForm.value.level;this.lesson.level=Object.entries(Te).filter(([i,r])=>e.includes(r)).map(([i,r])=>i),console.log("Niveles seleccionados:",this.lesson.level),this.lesson.state="proposed",this._lessonService.addLesson(this.token,this.lesson).subscribe({next:i=>{i.lesson&&i.lesson._id?(this.addForm.reset(),this.addForm.get("knowledge_area").setValue([]),this.addForm.get("level").setValue([]),this.ngSelectComponent&&this.ngSelectComponent.clearModel(),this.status="success",this.added.emit()):(this.status="error",console.log(i)),this.loading=!1},error:i=>{this.status="error",this.loading=!1,console.log(i)}}),document.querySelector(".modal-body").scrollTop=0,this.submitted=!1})}onChanges(){this.addForm.valueChanges.subscribe(e=>{e&&(this.status=null,this.submitted=!1)})}normalizeString(e){return e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")}addNewKnowledgeArea(e){if(!e){console.warn("Evento recibido es undefined, se ignora.");return}let i=this.addForm.get("knowledge_area").value||[];if(e.name){let r=e.name.trim();if(!r){console.error("No se proporcion\xF3 un nombre de \xE1rea");return}let m=this.normalizeString(r),E=this.knowledgeAreas.find(te=>this.normalizeString(te.name)===m);E?this.handleExistingArea(E._id,i):this.handleNewArea(r,i)}else e._id?this.handleExistingArea(e._id,i):console.error("Evento no reconocido:",e)}handleExistingArea(e,i){if(i.includes(e))console.log("\xC1rea ya presente en el formulario:",e);else{let r=[...i,e];this.addForm.get("knowledge_area").patchValue(r),this.updateNgSelectFromFormControl(r)}}handleNewArea(e,i){let r={_id:"",name:e,used:!1};this._bDService.addKnowledgeArea(r).subscribe({next:m=>{let E=i.slice(0,-1);if(m.area){this.knowledgeAreas.push(m.area);let te=[...E,m.area._id];this.addForm.get("knowledge_area").patchValue(te),this.updateNgSelectFromFormControl(te)}else if(m.replace){let te=E.indexOf(m.replace._id);E.splice(te,1);let Bt=[...E,m.replace._id];this.addForm.get("knowledge_area").patchValue(Bt),this.updateNgSelectFromFormControl(Bt)}},error:m=>{console.error("Error al agregar la nueva \xE1rea de conocimiento:",m)}})}updateNgSelectFromFormControl(e){this.cdr.detectChanges(),this.ngSelectComponent.clearModel();let r=(Array.isArray(e)?e.filter(m=>m):[]).map(m=>this.knowledgeAreas.find(E=>E._id===m)).filter(m=>m);this.addForm.get("knowledge_area").patchValue(r),this.cdr.detectChanges()}compareKnowledgeAreas(e,i){return e&&i?e._id===i._id:e===i}static{this.\u0275fac=function(i){return new(i||t)(y(P),y(pe),y(ne),y(rt),y(Me))}}static{this.\u0275cmp=w({type:t,selectors:[["suggest-lesson"]],viewQuery:function(i,r){if(i&1&&Xe(Ie,5),i&2){let m;Ze(m=et())&&(r.ngSelectComponent=m.first)}},outputs:{added:"added"},standalone:!1,decls:37,vars:14,consts:[["ngSelect",""],["id","add","tabindex","-1","role","dialog","aria-labelledby","add","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-lg","modal-dialog-scrollable"],["enctype","multipart/form-data",1,"modal-content",3,"ngSubmit","input","formGroup"],[1,"modal-header"],["id","addTitle",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close",3,"click"],["aria-hidden","true"],[1,"modal-body"],["class","alert alert-danger fade show text-center","role","alert",4,"ngIfSuccessMessage","ngIf"],["class","alert alert-success fade show text-center","role","alert",4,"ngIfSuccessMessage","ngIf"],["class","form-group row",4,"ngFor","ngForOf"],[1,"form-group","row"],["for","knowledgeAreas",1,"col-3","col-form-label"],[1,"col-9"],["bindLabel","name","bindValue","_id","formControlName","knowledge_area","placeholder","Selecciona o escribe al menos una \xE1rea de conocimiento (e.g. Matem\xE1ticas)",1,"custom-ng-select",3,"add","items","compareWith","multiple","clearable","addTag"],["class","invalid-feedback",4,"ngIf"],["for","level",1,"col-3","col-form-label"],["bindLabel","valueOf","bindValue","valueOf","formControlName","level","placeholder","Selecciona o escribe al menos un nivel de desarrollo",1,"custom-ng-select",3,"items","multiple"],[1,"modal-footer"],["data-bs-dismiss","modal",1,"btn","btn-danger",3,"click"],["type","submit",1,"btn","btn-success"],["role","alert",1,"alert","alert-danger","fade","show","text-center"],[1,"fas","fa-times-circle","icon-message","me-2"],["role","alert",1,"alert","alert-success","fade","show","text-center"],[1,"fas","fa-check-circle","icon-message","me-2"],[1,"col-3","col-form-label",3,"for"],[4,"ngIf"],["type","text","class","form-control","autocomplete","off",3,"id","formControlName","ngClass",4,"ngIf"],["class","form-control","rows","3",3,"id","formControlName","ngClass",4,"ngIf"],["type","text","autocomplete","off",1,"form-control",3,"id","formControlName","ngClass"],["rows","3",1,"form-control",3,"id","formControlName","ngClass"],[1,"invalid-feedback"]],template:function(i,r){if(i&1){let m=C();o(0,"div",1)(1,"div",2)(2,"form",3),_("ngSubmit",function(){return f(m),g(r.onSubmit())})("input",function(){return f(m),g(r.onChanges())}),o(3,"div",4)(4,"h5",5),s(5),n(),o(6,"button",6),_("click",function(){return f(m),g(r.restartValues())}),o(7,"span",7),s(8,"\xD7"),n()()(),o(9,"div",8),p(10,Lo,3,1,"div",9)(11,Po,3,1,"div",10)(12,Do,9,6,"div",11),o(13,"div",12)(14,"label",13)(15,"strong"),s(16,"\xC1reas de conocimiento"),o(17,"span"),s(18,"*"),n()()(),o(19,"div",14)(20,"ng-select",15,0),_("add",function(te){return f(m),g(r.addNewKnowledgeArea(te))}),n(),p(22,Uo,2,1,"div",16),n()(),o(23,"div",12)(24,"label",17)(25,"strong"),s(26,"Nivel de desarrollo"),o(27,"span"),s(28,"*"),n()()(),o(29,"div",14),u(30,"ng-select",18),p(31,qo,2,1,"div",16),n()()(),o(32,"div",19)(33,"button",20),_("click",function(){return f(m),g(r.restartValues())}),s(34,"Cancelar"),n(),o(35,"button",21),s(36,"Guardar"),n()()()()()}i&2&&(a(2),l("formGroup",r.addForm),a(3),h(r.title),a(5),l("ngIf",r.status==="error"),a(),l("ngIf",r.status==="success"),a(),l("ngForOf",r.fields),a(8),l("items",r.knowledgeAreas)("compareWith",r.compareKnowledgeAreas)("multiple",!0)("clearable",!0)("addTag",!0),a(2),l("ngIf",r.submitted&&r.f.knowledge_area.errors),a(8),l("items",r.academicLevels)("multiple",!0),a(),l("ngIf",r.submitted&&r.f.level.errors))},dependencies:[G,T,F,q,N,D,$,H,Y,Ie],styles:[".ng-select[_ngcontent-%COMP%]{width:100%}.ng-select[_ngcontent-%COMP%]   .ng-select-container[_ngcontent-%COMP%]{min-height:40px}.ng-select[_ngcontent-%COMP%]   .ng-select-container[_ngcontent-%COMP%]   .ng-value-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center}.ng-select[_ngcontent-%COMP%]   .ng-select-container[_ngcontent-%COMP%]   .ng-placeholder[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}"]})}}return t})();var _t=class{constructor(d){this.text=d}};var Vt=t=>({"is-invalid":t}),Bo=()=>({standalone:!0});function Go(t,d){if(t&1&&(o(0,"div",27),u(1,"i",28),s(2),n()),t&2){let e=c();a(2),b(" ",e.errorMsg," ")}}function zo(t,d){if(t&1&&(o(0,"div",29),u(1,"i",30),s(2),n()),t&2){let e=c();a(2),b(" ",e.successMsg," ")}}function Ko(t,d){t&1&&(o(0,"div"),s(1," El campo \xE1reas de conocimiento es obligatorio. "),n())}function Wo(t,d){if(t&1&&(o(0,"div",31),p(1,Ko,2,0,"div",32),n()),t&2){let e=c();a(),l("ngIf",e.f.areas.errors.required)}}function Jo(t,d){if(t&1){let e=C();o(0,"span",35),s(1),o(2,"button",36),_("click",function(){let r=f(e).$implicit,m=c(2);return g(m.removeLevel(r))}),n()()}if(t&2){let e=d.$implicit;a(),b(" ",e.value," ")}}function Ho(t,d){if(t&1&&(o(0,"div",33),p(1,Jo,3,1,"span",34),n()),t&2){let e=c();a(),l("ngForOf",e.selectedLevels)}}function Yo(t,d){if(t&1){let e=C();o(0,"button",39),_("click",function(){let r=f(e).$implicit,m=c(2);return g(m.selectLevel(r))}),s(1),n()}if(t&2){let e=d.$implicit;a(),b(" ",e.value," ")}}function Qo(t,d){if(t&1&&(o(0,"div",37),p(1,Yo,2,1,"button",38),n()),t&2){let e=c();a(),l("ngForOf",e.filteredLevels)}}function Xo(t,d){t&1&&(o(0,"div"),s(1," Debe seleccionar al menos un nivel acad\xE9mico. "),n())}function Zo(t,d){if(t&1&&(o(0,"div",31),p(1,Xo,2,0,"div",32),n()),t&2){let e=c();a(),l("ngIf",e.f.level.errors.required)}}function er(t,d){t&1&&(o(0,"div"),s(1," El campo descripci\xF3n es obligatorio. "),n())}function tr(t,d){if(t&1&&(o(0,"div",31),p(1,er,2,0,"div",32),n()),t&2){let e=c();a(),l("ngIf",e.f.text.errors.required)}}var Vi=(()=>{class t{constructor(e,i,r,m){this._userService=e,this._lessonService=i,this._bDService=r,this._uploadService=m,this.newLesson=new mt,this.added=new se,this.academicLevels=Te,this.levelInput="",this.filteredLevels=[],this.selectedLevels=[],this.showLevelDropdown=!1,this.title="Crear convocatoria",this.identity=this._userService.getIdentity(),this.token=this._userService.getToken(),this.url=A.url,this.errorMsg="Hubo un error creando la convocatoria. Intentalo de nuevo m\xE1s tarde.",this.successMsg="Se ha creado la convocatoria correctamente.",this.callForm=new oe({text:new k("",S.required),areas:new k("",S.required),level:new k([],S.required)})}ngOnInit(){this.initializeLevels(),this.callForm.patchValue({areas:this.lesson.knowledge_area,text:this.lesson.resume}),this.filteredLevels=Object.entries(this.academicLevels).map(([e,i])=>({key:e,value:i}))}ngAfterViewInit(){this.setupClickOutsideListener()}ngOnDestroy(){this.stopRealtimeSync()}ngDoCheck(){this.check&&this.lesson._id&&(this.callForm.patchValue({areas:this.lesson.knowledge_area,level:"",text:""}),this.check=!1)}get f(){return this.callForm.controls}initializeLevels(){if(this.lesson&&this.lesson.level)if(Array.isArray(this.lesson.level))this.selectedLevels=this.lesson.level.map(e=>{let i=Object.entries(this.academicLevels).find(([r,m])=>r===e);return i?{key:i[0],value:i[1]}:null}).filter(Boolean);else{let e=Object.entries(this.academicLevels).find(([i,r])=>i===this.lesson.level);this.selectedLevels=e?[{key:e[0],value:e[1]}]:[]}else this.selectedLevels=[];this.updateLevelFormControl()}onLevelInputChange(){let e=this.levelInput.toLowerCase();this.filteredLevels=Object.entries(this.academicLevels).map(([i,r])=>({key:i,value:r})).filter(i=>i.value.toLowerCase().includes(e)&&!this.selectedLevels.some(r=>r.key===i.key)),this.showLevelDropdown=this.filteredLevels.length>0}selectLevel(e){this.selectedLevels.some(i=>i.key===e.key)||(this.selectedLevels.push(e),this.updateLevelFormControl()),this.levelInput="",this.showLevelDropdown=!1,this.filteredLevels=Object.entries(this.academicLevels).map(([i,r])=>({key:i,value:r})).filter(i=>!this.selectedLevels.some(r=>r.key===i.key))}removeLevel(e){this.selectedLevels=this.selectedLevels.filter(i=>i.key!==e.key),this.updateLevelFormControl(),this.filteredLevels=Object.entries(this.academicLevels).map(([i,r])=>({key:i,value:r})).filter(i=>!this.selectedLevels.some(r=>r.key===i.key))}updateLevelFormControl(){let e=this.selectedLevels.map(i=>i.key);this.callForm.patchValue({level:e})}setupClickOutsideListener(){document.addEventListener("click",e=>{let i=e.target,r=document.querySelector(".level-autocomplete-container");r&&!r.contains(i)&&(this.showLevelDropdown=!1)})}restartValues(){this.status=null,this.submitted=!1,this.check=!0,this.selectedLevels=[],this.levelInput="",this.showLevelDropdown=!1,this.added.emit()}onSubmit(){let e=[],i=[];if(this.submitted=!0,this.status=null,this.errorMsg="Hubo un error creando la convocatoria. Intentalo de nuevo m\xE1s tarde.",!this.callForm.invalid){if(!this.callForm.value.areas||!Array.isArray(this.callForm.value.areas)||this.callForm.value.areas.length===0){this.status="error",this.errorMsg="Debe seleccionar al menos un \xE1rea de conocimiento.";return}if(!this.callForm.value.text||this.callForm.value.text.trim()===""){this.status="error",this.errorMsg="La descripci\xF3n de la convocatoria es obligatoria.";return}if(!this.callForm.value.level||!Array.isArray(this.callForm.value.level)||this.callForm.value.level.length===0){this.status="error",this.errorMsg="Debe seleccionar al menos un nivel acad\xE9mico.";return}try{if(this.callForm.value.areas.forEach(r=>{r&&r._id&&e.push(r._id)}),e.length===0){this.status="error",this.errorMsg="Error procesando las \xE1reas de conocimiento seleccionadas.";return}if(this.lesson.knowledge_area=e,this.lesson.level=this.callForm.value.level,this.call=new _t(this.callForm.value.text.trim()),this.call.visible=!0,this.call.author=this.identity._id,this.nextVersion)this.newLesson.state="proposed",this.newLesson.title=this.lesson.title,this.newLesson.resume=this.lesson.resume,this.newLesson.references=this.lesson.references,this.newLesson.accepted=!0,this.newLesson.author=this.lesson.author,this.newLesson.version=this.lesson.version+1,this.newLesson.justification=this.lesson.justification,this.newLesson.knowledge_area=e,this.newLesson.level=this.callForm.value.level,this.saveLesson(this.newLesson,this.call);else{let r=[];i.push(this.lesson.author),r.push(this.lesson.author),this.identity._id!==this.lesson.author._id&&(i.some(te=>te._id===this.identity._id)||(i.push(this.identity),console.log("Admin agregado autom\xE1ticamente como interesado (NO al grupo de desarrollo):",this.identity.name))),this.call.interested=i,this.lesson.development_group=r,this.lesson.leader=this.lesson.author._id,console.log("Autor establecido como l\xEDder:",this.lesson.author.name,this.lesson.author._id),console.log("Grupo de desarrollo:",r.map(E=>E.name)),console.log("Interesados:",i.map(E=>E.name)),this.lesson.call=this.call,this.editLesson(this.lesson)}}catch(r){this.status="error",this.errorMsg="Error procesando los datos del formulario. Por favor, int\xE9ntalo de nuevo.",console.error("Error en onSubmit:",r)}}}editLesson(e){this._lessonService.editLesson(this.token,e).subscribe({next:i=>{i.lesson&&i.lesson._id?(this.status="success",this.added.emit(),this.startRealtimeSync(i.lesson._id)):(this.status="error",this.errorMsg="Error al actualizar la lecci\xF3n. Respuesta inv\xE1lida del servidor.")},error:i=>{this.status="error",console.error("Error editando lecci\xF3n:",i),i.status===500?this.errorMsg="Error interno del servidor. Por favor, verifica que todos los campos est\xE9n correctamente completados.":i.status===400?this.errorMsg=i.error?.message||"Datos inv\xE1lidos. Por favor, revisa los campos del formulario.":i.status===404?this.errorMsg="La lecci\xF3n no fue encontrada.":this.errorMsg=i.error?.message||"Hubo un error creando la convocatoria. Int\xE9ntalo de nuevo m\xE1s tarde."}}),this.submitted=!1}saveLesson(e,i){this._lessonService.addLesson(this.token,e).subscribe({next:r=>{r.lesson&&r.lesson._id?(this.status="success",this.lesson.son_lesson=r.lesson._id,this.editLesson(this.lesson),this.newLesson=r.lesson,delete i._id,delete i.interested,this.newLesson.call=i,this.newLesson.father_lesson=this.lesson._id,this.editLesson(this.newLesson),this.added.emit(),this.startRealtimeSync(r.lesson._id)):(this.status="error",this.errorMsg="Error al crear la nueva lecci\xF3n. Respuesta inv\xE1lida del servidor.")},error:r=>{this.status="error",console.error("Error guardando lecci\xF3n:",r),r.status===500?this.errorMsg="Error interno del servidor. Por favor, verifica que todos los campos est\xE9n correctamente completados.":r.status===400?this.errorMsg=r.error?.message||"Datos inv\xE1lidos. Por favor, revisa los campos del formulario.":this.errorMsg=r.error?.message||"Hubo un error creando la convocatoria. Int\xE9ntalo de nuevo m\xE1s tarde."}}),this.submitted=!1}refreshLesson(e){e&&this._lessonService.getLesson(this.token,e).subscribe({next:i=>{i&&i.lesson&&(this.lesson&&this.lesson._id===e&&(this.lesson=i.lesson),this.newLesson&&this.newLesson._id===e&&(this.newLesson=i.lesson))},error:i=>{console.warn("No se pudo actualizar la lecci\xF3n en tiempo real:",i)}})}startRealtimeSync(e){this.stopRealtimeSync(),e&&(this.realtimeTimer=setInterval(()=>this.refreshLesson(e),7e3))}stopRealtimeSync(){this.realtimeTimer&&(clearInterval(this.realtimeTimer),this.realtimeTimer=null)}static{this.\u0275fac=function(i){return new(i||t)(y(P),y(pe),y(ne),y(Ae))}}static{this.\u0275cmp=w({type:t,selectors:[["add-call"]],inputs:{areas:"areas",lesson:"lesson",nextVersion:"nextVersion"},outputs:{added:"added"},standalone:!1,decls:46,vars:26,consts:[["id","addCall","tabindex","-1","role","dialog","aria-labelledby","addCall","aria-hidden","true","data-backdrop","static","data-keyboard","false",1,"modal","fade"],["role","document",1,"modal-dialog","modal-lg","modal-dialog-centered"],["enctype","multipart/form-data",1,"modal-content",3,"ngSubmit","formGroup"],[1,"modal-header"],["id","addCallTitle",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close",3,"click"],["aria-hidden","true"],[1,"modal-body"],["class","alert alert-danger fade show text-center","role","alert",4,"ngIf"],["class","alert alert-success fade show text-center","role","alert",4,"ngIf"],[1,"form-group","row"],["for","title",1,"col-3","col-form-label"],[1,"col-9"],["type","text","id","title","disabled","",1,"form-control",3,"value"],["for","areas",1,"col-3","col-form-label"],["bindLabel","name","formControlName","areas","notFoundText","No se encontr\xF3","placeholder","Selecciona las \xE1reas de conocimiento",3,"items","multiple","hideSelected","ngClass"],["class","invalid-feedback d-block",4,"ngIf"],["for","level",1,"col-3","col-form-label"],[1,"col-9","level-autocomplete-container"],["class","selected-items-container mb-2",4,"ngIf"],["type","text","placeholder","Buscar y seleccionar niveles acad\xE9micos...",1,"form-control",3,"ngModelChange","input","focus","ngModel","ngClass","ngModelOptions"],["class","dropdown-menu show","style","position: absolute; top: 100%; left: 0; right: 0; z-index: 1000; max-height: 200px; overflow-y: auto;",4,"ngIf"],["for","text",1,"col-3","col-form-label"],["id","text","rows","3","formControlName","text","placeholder","Describe los detalles de la convocatoria",1,"form-control",3,"ngClass"],[1,"modal-footer"],["data-bs-dismiss","modal",1,"btn","btn-secondary",3,"click"],["type","submit",1,"btn","btn-success",3,"disabled"],["role","alert",1,"alert","alert-danger","fade","show","text-center"],[1,"fas","fa-times-circle","icon-message","me-2"],["role","alert",1,"alert","alert-success","fade","show","text-center"],[1,"fas","fa-check-circle","icon-message","me-2"],[1,"invalid-feedback","d-block"],[4,"ngIf"],[1,"selected-items-container","mb-2"],["class","badge bg-info me-1 mb-1 d-inline-flex align-items-center",4,"ngFor","ngForOf"],[1,"badge","bg-info","me-1","mb-1","d-inline-flex","align-items-center"],["type","button",1,"btn-close","btn-close-white","ms-1",2,"font-size","0.7em",3,"click"],[1,"dropdown-menu","show",2,"position","absolute","top","100%","left","0","right","0","z-index","1000","max-height","200px","overflow-y","auto"],["type","button","class","dropdown-item",3,"click",4,"ngFor","ngForOf"],["type","button",1,"dropdown-item",3,"click"]],template:function(i,r){i&1&&(o(0,"div",0)(1,"div",1)(2,"form",2),_("ngSubmit",function(){return r.onSubmit()}),o(3,"div",3)(4,"h5",4),s(5),n(),o(6,"button",5),_("click",function(){return r.restartValues()}),o(7,"span",6),s(8,"\xD7"),n()()(),o(9,"div",7),p(10,Go,3,1,"div",8)(11,zo,3,1,"div",9),o(12,"div",10)(13,"label",11)(14,"strong"),s(15,"Lecci\xF3n"),n()(),o(16,"div",12),u(17,"input",13),n()(),o(18,"div",10)(19,"label",14)(20,"strong"),s(21,"\xC1reas de conocimiento*"),n()(),o(22,"div",12),u(23,"ng-select",15),p(24,Wo,2,1,"div",16),n()(),o(25,"div",10)(26,"label",17)(27,"strong"),s(28,"Niveles acad\xE9micos*"),n()(),o(29,"div",18),p(30,Ho,2,1,"div",19),o(31,"input",20),ot("ngModelChange",function(E){return nt(r.levelInput,E)||(r.levelInput=E),E}),_("input",function(){return r.onLevelInputChange()})("focus",function(){return r.showLevelDropdown=r.filteredLevels.length>0}),n(),p(32,Qo,2,1,"div",21)(33,Zo,2,1,"div",16),n()(),o(34,"div",10)(35,"label",22)(36,"strong"),s(37,"Descripci\xF3n convocatoria*"),n()(),o(38,"div",12),u(39,"textarea",23),p(40,tr,2,1,"div",16),n()()(),o(41,"div",24)(42,"button",25),_("click",function(){return r.restartValues()}),s(43,"Cerrar"),n(),o(44,"button",26),s(45,"Crear y publicar"),n()()()()()),i&2&&(a(2),l("formGroup",r.callForm),a(3),h(r.title),a(5),l("ngIf",r.status==="error"),a(),l("ngIf",r.status==="success"),a(6),v("value",r.lesson.title),a(6),l("items",r.areas)("multiple",!0)("hideSelected",!0)("ngClass",x(19,Vt,r.submitted&&r.f.areas.errors)),a(),l("ngIf",r.submitted&&r.f.areas.errors),a(6),l("ngIf",r.selectedLevels.length>0),a(),it("ngModel",r.levelInput),l("ngClass",x(21,Vt,r.submitted&&r.f.level.errors))("ngModelOptions",Ee(23,Bo)),a(),l("ngIf",r.showLevelDropdown&&r.filteredLevels.length>0),a(),l("ngIf",r.submitted&&r.f.level.errors),a(6),l("ngClass",x(24,Vt,r.submitted&&r.f.text.errors)),a(),l("ngIf",r.submitted&&r.f.text.errors),a(4),l("disabled",r.status=="success"))},dependencies:[G,T,F,q,N,D,$,at,H,Y,Ie],encapsulation:2})}}return t})();var Ne=(()=>{class t{constructor(e,i){this._userService=e,this._lessonService=i,this.lessonId="",this.deleted=new se,this.identity=this._userService.getIdentity(),this.token=this._userService.getToken(),this.url=A.url}ngOnInit(){this.parent=="experiences"?(this.message="\xBFEsta seguro que desea eliminar la experiencia?",this.title="Eliminar experiencia"):this.parent=="proposed-lesson"?(this.message="\xBFEsta seguro que desea eliminar la propuesta para lecci\xF3n?",this.title="Eliminar propuesta"):(this.message="\xBFEsta seguro que desea eliminar la lecci\xF3n?",this.title="Eliminar lecci\xF3n")}delete(){this._lessonService.deleteLesson(this.token,this.lessonId).subscribe(e=>{e&&e.lesson&&this.deleted.emit()},e=>{console.log(e)})}static{this.\u0275fac=function(i){return new(i||t)(y(P),y(pe))}}static{this.\u0275cmp=w({type:t,selectors:[["delete-lesson"]],inputs:{lessonId:"lessonId",parent:"parent"},outputs:{deleted:"deleted"},standalone:!1,decls:16,vars:2,consts:[["id","delete","tabindex","-1","role","dialog","aria-labelledby","delete","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-dialog-centered"],[1,"modal-content"],[1,"modal-header"],["id","deleteTitle",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],["role","alert",1,"alert","alert-warning","mb-0"],[1,"fas","fa-exclamation-triangle","icon-message","me-2"],[1,"modal-footer"],["data-bs-dismiss","modal",1,"btn","btn-danger",3,"click"],["data-bs-dismiss","modal",1,"btn","btn-primary","text-white"]],template:function(i,r){i&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h5",4),s(5),n(),u(6,"button",5),n(),o(7,"div",6)(8,"div",7),u(9,"i",8),s(10),n()(),o(11,"div",9)(12,"button",10),_("click",function(){return r.delete()}),s(13,"S\xED"),n(),o(14,"button",11),s(15,"No"),n()()()()()),i&2&&(a(5),h(r.title),a(5),b(" ",r.message," "))},encapsulation:2})}}return t})();var Mi=t=>({"is-invalid":t}),Ue=t=>["/perfil",t];function nr(t,d){t&1&&(o(0,"div",35),u(1,"i",36),s(2," No se ha podido asignar el grupo de desarrollo. Intentalo de nuevo. "),n())}function or(t,d){t&1&&(o(0,"div",37),u(1,"i",38),s(2," Se ha asignado el grupo de desarrollo correctamente. "),n())}function rr(t,d){if(t&1&&(o(0,"p",39),s(1),n()),t&2){let e=d.$implicit;a(),b(" ",e," ")}}function ar(t,d){if(t&1&&(o(0,"p",40),s(1),n()),t&2){let e=d.$implicit;a(),b(" ",e," ")}}function sr(t,d){t&1&&u(0,"img",52)}function lr(t,d){if(t&1&&u(0,"img",53),t&2){let e=c().$implicit,i=c();v("src",i.url+"get-image-user/"+e.picture,M)}}function dr(t,d){if(t&1&&(o(0,"span",54),s(1),n()),t&2){let e=c().$implicit,i=c();a(),h(i.profile_label[e.role].label)}}function cr(t,d){if(t&1){let e=C();o(0,"div",55)(1,"button",56),_("click",function(){f(e);let r=c().$implicit,m=c();return g(m.addGroup(r))}),u(2,"i",57),n()()}}function mr(t,d){if(t&1&&(o(0,"div",41)(1,"div",42)(2,"a",43)(3,"button",44),p(4,sr,1,0,"img",45)(5,lr,1,1,"img",46),n()()(),o(6,"div",47)(7,"h6",48)(8,"a",49)(9,"strong"),s(10),n()(),u(11,"br"),p(12,dr,2,1,"span",50),n()(),p(13,cr,3,0,"div",51),n()),t&2){let e=d.$implicit,i=c();a(3),l("routerLink",x(8,Ue,e._id)),a(),l("ngIf",!e.picture),a(),l("ngIf",e.picture),a(3),l("routerLink",x(10,Ue,e._id)),a(2),V(" ",e.name," ",e.surname," "),a(2),l("ngIf",e.role),a(),l("ngIf",!i.isInDevelopmentGroup(e))}}function pr(t,d){t&1&&u(0,"img",52)}function ur(t,d){if(t&1&&u(0,"img",53),t&2){let e=c().$implicit,i=c();v("src",i.url+"get-image-user/"+e.picture,M)}}function _r(t,d){if(t&1&&(o(0,"span",54),s(1),n()),t&2){let e=c().$implicit,i=c();a(),h(i.profile_label[e.role].label)}}function fr(t,d){if(t&1){let e=C();o(0,"div",41)(1,"div",42)(2,"a",43)(3,"button",44),p(4,pr,1,0,"img",45)(5,ur,1,1,"img",46),n()()(),o(6,"div",58)(7,"h6",48)(8,"a",49)(9,"strong"),s(10),n()(),u(11,"br"),p(12,_r,2,1,"span",50),n()(),o(13,"div",55)(14,"button",59),_("click",function(){let r=f(e).$implicit,m=c();return g(m.removeGroup(r))}),u(15,"i",60),n()()()}if(t&2){let e=d.$implicit;a(3),l("routerLink",x(7,Ue,e._id)),a(),l("ngIf",!e.picture),a(),l("ngIf",e.picture),a(3),l("routerLink",x(9,Ue,e._id)),a(2),V(" ",e.name," ",e.surname," "),a(2),l("ngIf",e.role)}}function gr(t,d){t&1&&u(0,"img",52)}function vr(t,d){if(t&1&&u(0,"img",53),t&2){let e=c(2);v("src",e.url+"get-image-user/"+e.lesson.leader.picture,M)}}function hr(t,d){if(t&1&&(o(0,"span",54),s(1),n()),t&2){let e=c(2);a(),h(e.profile_label[e.lesson.leader.role].label)}}function xr(t,d){if(t&1&&(o(0,"div",61)(1,"div",62)(2,"div",63)(3,"div",19)(4,"strong"),s(5,"L\xEDder Actual"),n()(),o(6,"div",64)(7,"div",65)(8,"div",42)(9,"button",44),p(10,gr,1,0,"img",45)(11,vr,1,1,"img",46),n()(),o(12,"div",66)(13,"h6",48)(14,"a",49)(15,"strong"),s(16),n()(),u(17,"br"),p(18,hr,2,1,"span",50),n()()()()()()()),t&2){let e=c();a(9),l("routerLink",x(7,Ue,e.lesson.leader._id)),a(),l("ngIf",!e.lesson.leader.picture),a(),l("ngIf",e.lesson.leader.picture),a(3),l("routerLink",x(9,Ue,e.lesson.leader._id)),a(2),V("",e.lesson.leader.name," ",e.lesson.leader.surname,""),a(2),l("ngIf",e.lesson.leader.role)}}function br(t,d){if(t&1&&(o(0,"option",67),s(1),n()),t&2){let e=d.$implicit;v("value",e._id),a(),V(" ",e.name," ",e.surname,"")}}function Cr(t,d){t&1&&(o(0,"small",68),s(1," Selecciona un nuevo l\xEDder del grupo de desarrollo (opcional). "),n())}function yr(t,d){t&1&&(o(0,"div",70),s(1," El campo l\xEDder de desarrollo es obligatorio. "),n())}function Er(t,d){if(t&1&&(o(0,"div"),p(1,yr,2,0,"div",69),n()),t&2){let e=c();a(),l("ngIf",e.leader.errors.required)}}function Sr(t,d){if(t&1&&(o(0,"option",67),s(1),n()),t&2){let e=d.$implicit;v("value",e._id),a(),V("",e.name," ",e.surname,"")}}function Ir(t,d){t&1&&(o(0,"div",70),s(1," Es necesario asignar un facilitador. "),n())}function wr(t,d){if(t&1&&(o(0,"div"),p(1,Ir,2,0,"div",69),n()),t&2){let e=c(2);a(),l("ngIf",e.expert.errors.required)}}function kr(t,d){if(t&1&&(o(0,"div",71)(1,"label",24)(2,"strong"),s(3,"Facilitador experto*"),n()(),o(4,"div",25)(5,"select",26),p(6,Sr,2,3,"option",28),n(),p(7,wr,2,1,"div",30),n()()),t&2){let e=c();a(5),l("formControl",e.expert)("ngClass",x(4,Mi,e.submitted&&e.expert.errors)),a(),l("ngForOf",e.expertUsers),a(),l("ngIf",e.submitted&&e.expert.errors)}}var Ai=(()=>{class t{constructor(e,i){this._userService=e,this._lessonService=i,this.categories={teacher:{label:"Docente",class:"badge-success"},guest:{label:"Invitado",class:"badge-orange"},student:{label:"Estudiante",class:"badge-info"},expert:{label:"Facilitador",class:"badge-purple"},admin:{label:"Administrador",class:"badge-green"},delegated_admin:{label:"Administrador",class:"badge-green"}},this.expertUsers=[],this.assigned=new se,this.title="Detalles convocatoria",this.identity=this._userService.getIdentity(),this.token=this._userService.getToken(),this.url=A.url,this.leader=new k(""),this.expert=new k("",S.required),this.profile_label=ut}ngOnInit(){this.getExpertUsers(),this.initializeLesson(),this.setLeader()}initializeLesson(){this.lesson.development_group||(this.lesson.development_group=[]),this.lesson.call||(this.lesson.call={text:"",visible:!1,interested:[]}),this.lesson.call.interested||(this.lesson.call.interested=[]),console.log("Call interested after initialization:",this.lesson.call.interested),console.log("Development group after initialization:",this.lesson.development_group),this.lesson.development_group&&this.lesson.development_group.length>0&&(console.log("Development group types:",this.lesson.development_group.map(i=>typeof i)),console.log("First development group member:",this.lesson.development_group[0]));let e=this.getLeader();e&&this.leader.setValue(e)}setLeader(){this.lesson.development_group.length>0?this.leader.enable():this.leader.disable()}getLeader(){return this.lesson.leader}restartValues(){this.status=null,this.submitted=!1,this.assigned.emit(),this.leader=new k(""),this.expert=new k("",S.required),this.lesson&&(this.initializeLesson(),this.setLeader())}getExpertUsers(){this._userService.getAllUsers().subscribe(e=>{this.expertUsers=e.users.filter(i=>i.role=="expert"||i.role=="admin"||i.role=="delegated_admin"||i.canAdvise)},e=>{console.log(e)})}addGroup(e){this.lesson.development_group.some(r=>r._id===e._id)||this.lesson.development_group.push(e),this.lesson.development_group.length>0&&this.leader.enable()}removeGroup(e){let i=this.lesson.development_group.find((r,m)=>(r._id==e._id&&this.lesson.development_group.splice(m,1),r._id==e._id));this.lesson.development_group.length==0&&this.leader.disable()}isInDevelopmentGroup(e){return!this.lesson||!this.lesson.development_group||!e?!1:!!this.lesson.development_group.find(r=>r._id==e._id)}belongsTo(e){if(!this.lesson.development_group.find(r=>r._id==e)){let r=this.expertUsers.find(m=>m._id==e);r&&(this.lesson.development_group.some(E=>E._id===r._id)||(this.lesson.development_group.push(r),console.log("Experto agregado al grupo de desarrollo")))}}editLesson(){this.submitted=!0,!(this.expert.invalid||this.leader.invalid)&&(this.lesson.leader=this.leader.value,this.lesson.expert=this.expert.value,this.lesson.leader==this.lesson.expert&&console.log("son iguales"),this.lesson.state="assigned",this.lesson.call.visible=!1,this.belongsTo(this.expert.value),console.log("Enviando actualizaci\xF3n de lecci\xF3n (call):",{id:this.lesson._id,leader:this.lesson.leader,expert:this.lesson.expert,state:this.lesson.state}),this._lessonService.editLesson(this.token,this.lesson).subscribe({next:e=>{e&&e.lesson._id?(this.status="success",this.assigned.emit(),console.log("Lecci\xF3n asignada exitosamente"),this._lessonService.addLessonMessage(this.token,this.lesson._id,{text:"comienza a hablar",conversationTitle:"General"}).subscribe({next:()=>{console.log("Conversaci\xF3n General creada autom\xE1ticamente")},error:r=>{console.error("No se pudo crear la conversaci\xF3n General por defecto:",r)}})):(this.status="error",console.error("Respuesta inv\xE1lida del servidor"))},error:e=>{this.status="error",console.error("Error updating lesson call:",e),e.status===500?console.error("Error interno del servidor. Por favor, verifica que todos los campos est\xE9n correctamente completados."):e.status===400?console.error(e.error?.message||"Datos inv\xE1lidos. Por favor, revisa los campos del formulario."):e.status===404?console.error("La lecci\xF3n no fue encontrada."):console.error(e.error?.message||"Error al asignar el grupo a la lecci\xF3n.")}}),document.querySelector(".modal-body").scrollTop=0)}static{this.\u0275fac=function(i){return new(i||t)(y(P),y(pe))}}static{this.\u0275cmp=w({type:t,selectors:[["call"]],inputs:{lesson:"lesson"},outputs:{assigned:"assigned"},standalone:!1,decls:61,vars:18,consts:[["id","call","tabindex","-1","role","dialog","aria-labelledby","call","aria-hidden","true","data-backdrop","static","data-keyboard","false",1,"modal","fade"],["role","document",1,"modal-dialog","modal-lg","modal-dialog-scrollable"],[1,"modal-content"],[1,"modal-header"],["id","callTitle",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close",3,"click"],["aria-hidden","true"],[1,"modal-body"],["class","alert alert-danger fade show text-center","role","alert",4,"ngIf"],["class","alert alert-success fade show text-center","role","alert",4,"ngIf"],["class","text-break mt-2",4,"ngFor","ngForOf"],[1,"row","mb-2"],[1,"col-2"],[1,"col-10"],[1,"row","mb-4"],["class","text-break",4,"ngFor","ngForOf"],[1,"row"],[1,"col-6"],[1,"card","mt-2"],[1,"card-header","text-center"],[1,"card-body","p-1"],["class","row mb-1",4,"ngFor","ngForOf"],["class","row mb-3",4,"ngIf"],[1,"form-group","row","my-4"],["for","toinput",1,"col-sm-3","col-form-label"],[1,"col-sm-9"],[1,"form-control",3,"formControl","ngClass"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","form-text text-muted",4,"ngIf"],[4,"ngIf"],["class","form-group row",4,"ngIf"],[1,"modal-footer"],["data-bs-dismiss","modal",1,"btn","btn-secondary",3,"click"],["type","submit",1,"btn","btn-success",3,"click","disabled"],["role","alert",1,"alert","alert-danger","fade","show","text-center"],[1,"fas","fa-times-circle","icon-message","me-2"],["role","alert",1,"alert","alert-success","fade","show","text-center"],[1,"fas","fa-check-circle","icon-message","me-2"],[1,"text-break","mt-2"],[1,"text-break"],[1,"row","mb-1"],[1,"col-auto","pe-0"],[1,"text-primary"],["data-bs-dismiss","modal",1,"btn","flex-shrink-0","rounded-circle","overflow-hidden","p-0",2,"width","40px","height","40px",3,"routerLink"],["class","img-fluid","src","assets/images/user-default.png",4,"ngIf"],["class","img-fluid",3,"src",4,"ngIf"],[1,"col","rounded","px-2"],[1,"mb-1"],["data-bs-dismiss","modal",1,"text-primary",3,"routerLink"],["class","text-muted",4,"ngIf"],["class","col-auto",4,"ngIf"],["src","assets/images/user-default.png",1,"img-fluid"],[1,"img-fluid",3,"src"],[1,"text-muted"],[1,"col-auto"],["title","Agregar al grupo de desarrollo",1,"btn","btn-success","me-2",3,"click"],[1,"fas","fa-plus"],[1,"col","rounded","px-2","text-truncate"],["title","Eliminar del grupo de desarrollo",1,"btn","btn-danger","me-2",3,"click"],[1,"fas","fa-minus"],[1,"row","mb-3"],[1,"col-12"],[1,"card"],[1,"card-body","p-2"],[1,"row","align-items-center"],[1,"col"],[3,"value"],[1,"form-text","text-muted"],["class","invalid-feedback-select",4,"ngIf"],[1,"invalid-feedback-select"],[1,"form-group","row"]],template:function(i,r){i&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h5",4),s(5),n(),o(6,"button",5),_("click",function(){return r.restartValues()}),o(7,"span",6),s(8,"\xD7"),n()()(),o(9,"div",7),p(10,nr,3,0,"div",8)(11,or,3,0,"div",9)(12,rr,2,1,"p",10),o(13,"p")(14,"strong"),s(15,"Lecci\xF3n"),n()(),o(16,"div",11)(17,"div",12)(18,"strong"),s(19,"T\xEDtulo:"),n()(),o(20,"div",13),s(21),n()(),o(22,"div",14)(23,"div",12)(24,"strong"),s(25,"Resumen:"),n()(),o(26,"div",13),p(27,ar,2,1,"p",15),n()(),o(28,"div",16)(29,"div",17)(30,"div",18)(31,"div",19)(32,"strong"),s(33,"Interesados en participar"),n()(),o(34,"div",20),p(35,mr,14,12,"div",21),n()()(),o(36,"div",17)(37,"div",18)(38,"div",19)(39,"strong"),s(40,"Grupo de desarrollo"),n()(),o(41,"div",20),p(42,fr,16,11,"div",21),n()()()(),p(43,xr,19,11,"div",22),o(44,"div",23)(45,"label",24)(46,"strong"),s(47,"Cambiar L\xEDder de desarrollo"),n()(),o(48,"div",25)(49,"select",26)(50,"option",27),s(51,"Seleccionar nuevo l\xEDder..."),n(),p(52,br,2,3,"option",28),n(),p(53,Cr,2,0,"small",29)(54,Er,2,1,"div",30),n()(),p(55,kr,8,6,"div",31),n(),o(56,"div",32)(57,"button",33),_("click",function(){return r.restartValues()}),s(58,"Cerrar"),n(),o(59,"button",34),_("click",function(){return r.editLesson()}),s(60," Asignar grupo a la lecci\xF3n "),n()()()()()),i&2&&(a(5),h(r.title),a(5),l("ngIf",r.status==="error"),a(),l("ngIf",r.status==="success"),a(),l("ngForOf",r.lesson==null||r.lesson.call==null||r.lesson.call.text==null?null:r.lesson.call.text.split(`
`)),a(9),b(" ",r.lesson.title," "),a(6),l("ngForOf",r.lesson.resume.split(`
`)),a(8),l("ngForOf",r.lesson==null||r.lesson.call==null?null:r.lesson.call.interested),a(7),l("ngForOf",r.lesson==null?null:r.lesson.development_group),a(),l("ngIf",r.lesson==null?null:r.lesson.leader),a(6),l("formControl",r.leader)("ngClass",x(16,Mi,r.submitted&&r.leader.errors)),a(3),l("ngForOf",r.lesson==null?null:r.lesson.development_group),a(),l("ngIf",!r.submitted),a(),l("ngIf",r.submitted&&r.leader.errors),a(),l("ngIf",r.expertUsers),a(4),l("disabled",r.status=="success"))},dependencies:[G,T,F,ce,me,de,D,le,R],encapsulation:2})}}return t})();var Oi=()=>[],Ri=t=>["/admin","leccion",t],Di=()=>["proposed","approved_by_expert"],Ni=()=>["completed"],Ui=()=>["proposed"],$e=t=>["/perfil",t],$i=t=>["/admin/lecciones",t];function Fr(t,d){t&1&&(o(0,"div",15)(1,"div",16)(2,"div",17)(3,"span",18),s(4,"Loading..."),n()()()())}function Lr(t,d){t&1&&(o(0,"div",15)(1,"h4",19),s(2,' No han sido creadas lecciones. Puedes agregar una nueva lecci\xF3n haciendo clic en el bot\xF3n "Agregar tema". '),n()())}function Pr(t,d){if(t&1){let e=C();o(0,"div",40)(1,"div",41)(2,"input",42),_("click",function(){let r=f(e).$implicit,m=c(2);return g(m.setState(r.value))}),n(),o(3,"label",43),s(4),n()()()}if(t&2){let e=d.$implicit;a(2),v("id",e.value),a(),v("for",e.value),a(),b(" ",e.label," ")}}function Vr(t,d){t&1&&(K(0),s(1," Ocultar opciones "),W())}function Mr(t,d){t&1&&s(0," Ver opciones ")}function Ar(t,d){if(t&1){let e=C();o(0,"div",47)(1,"div",41)(2,"input",42),_("click",function(){let r=f(e).$implicit,m=c(3);return g(m.setArea(r.name))}),n(),o(3,"label",48),s(4),n()()()}if(t&2){let e=d.$implicit;a(2),v("id",e.name),a(),v("for",e.name),v("title",e.name),a(),b(" ",e.name," ")}}function Or(t,d){if(t&1&&(o(0,"div",44)(1,"div",45),p(2,Ar,5,4,"div",46),n()()),t&2){let e=c(2);a(2),l("ngForOf",e.areas)}}function Rr(t,d){t&1&&(K(0),s(1," Ocultar opciones "),W())}function Dr(t,d){t&1&&s(0," Ver opciones ")}function Nr(t,d){if(t&1){let e=C();o(0,"div")(1,"div",41)(2,"input",42),_("click",function(){f(e);let r=c().$implicit,m=c(3);return g(m.setLevel(r.key))}),n(),o(3,"label",43),s(4),n()()()}if(t&2){let e=c().$implicit;a(2),v("id",e.key),a(),v("for",e.key),a(),b(" ",e.value," ")}}function Ur(t,d){if(t&1&&(o(0,"div",40),p(1,Nr,5,3,"div",39),n()),t&2){let e=d.$implicit;a(),l("ngIf",e.key!=="OTHER")}}function $r(t,d){if(t&1){let e=C();o(0,"div",49)(1,"div",50),p(2,Ur,2,1,"div",24),I(3,"keyvalue"),o(4,"div",40)(5,"div",41)(6,"input",51),_("click",function(){f(e);let r=c(2);return g(r.setLevel("otro"))}),n(),o(7,"label",52),s(8," Otro "),n()()()()()}if(t&2){let e=c(2);a(2),l("ngForOf",X(3,1,e.academic_level))}}function qr(t,d){t&1&&(o(0,"div",15)(1,"div",15)(2,"h4",19),s(3," No se encontraron lecciones para los criterios de b\xFAsqueda seleccionados. "),n()()())}function jr(t,d){t&1&&u(0,"div")}function Br(t,d){if(t&1&&(o(0,"div"),p(1,jr,1,0,"div",53),n()),t&2){let e=c(2);a(),l("ngForOf",e.allLessons)}}function Gr(t,d){if(t&1){let e=C();o(0,"div",15)(1,"form",20)(2,"h6",21),u(3,"i",22),s(4," Estados de lecciones "),n(),o(5,"div",23),p(6,Pr,5,3,"div",24),n()(),o(7,"div",25)(8,"div",26)(9,"div",27)(10,"div",25)(11,"div",26)(12,"h6",28),s(13," \xC1rea de conocimiento "),o(14,"button",29),_("click",function(){f(e);let r=c();return g(r.setShowAreas(!0))}),p(15,Vr,2,0,"ng-container",30)(16,Mr,1,0,"ng-template",null,0,B),n()()()(),p(18,Or,3,1,"div",31),n()(),o(19,"div",26)(20,"div",27)(21,"h6",21),u(22,"i",32),s(23," Nivel acad\xE9mico "),o(24,"button",33),_("click",function(){f(e);let r=c();return g(r.setShowLevels(!0))}),p(25,Rr,2,0,"ng-container",30)(26,Dr,1,0,"ng-template",null,0,B),n()(),p(28,$r,9,3,"div",34),n()()(),o(29,"div",35)(30,"div",26)(31,"form")(32,"div",36)(33,"span",37),s(34,"Filtrar:"),n(),u(35,"input",38),n()()()(),p(36,qr,4,0,"div",9)(37,Br,2,1,"div",39),n()}if(t&2){let e=J(17),i=c();a(6),l("ngForOf",i.states),a(9),l("ngIf",i.showAreas)("ngIfElse",e),a(3),l("ngIf",i.showAreas),a(7),l("ngIf",i.showLevels)("ngIfElse",e),a(3),l("ngIf",i.showLevels),a(7),l("formControl",i.filter),a(),l("ngIf",i.allLessons.length>0&&i.filteredLessons.length==0&&!i.loading&&i.filter.value),a(),l("ngIf",!i.filter.value&&i.selectedStates.length==0&&i.selectedAreas.length==0&&i.selectedLevels.length==0)}}function zr(t,d){if(t&1){let e=C();o(0,"div",54)(1,"label",55)(2,"small",19),s(3,"Ordenar por:"),n()(),o(4,"div",56)(5,"select",57),_("change",function(){f(e);let r=c();return g(r.reloadLessons())}),o(6,"option",58),s(7,"M\xE1s vistos"),n(),o(8,"option",59),s(9,"M\xE1s populares"),n()()()()}if(t&2){let e=c();a(5),l("formControl",e.orderControl)}}function Kr(t,d){if(t&1&&(o(0,"button",83),u(1,"i",84),s(2),n()),t&2){let e=c().$implicit;a(2),b(" ",e.score.toFixed(2)," ")}}function Wr(t,d){if(t&1&&(o(0,"button",85)(1,"span"),u(2,"i",78),o(3,"span"),s(4),n()()()),t&2){let e=c().$implicit;a(4),b(" ",e.views,"")}}function Jr(t,d){if(t&1&&(o(0,"small"),s(1),n()),t&2){let e=c().$implicit;a(),b("",e,"...")}}function Hr(t,d){if(t&1&&(o(0,"p",86),p(1,Jr,2,1,"small",39),n()),t&2){let e=d.index;a(),l("ngIf",e==0)}}function Yr(t,d){if(t&1&&(K(0),o(1,"label",43),s(2,"S\xED"),n(),W()),t&2){let e=c(2).index;a(),O("for","lesson",e,"")}}function Qr(t,d){if(t&1&&(o(0,"label",43),s(1,"No"),n()),t&2){let e=c(2).index;O("for","lesson",e,"")}}function Xr(t,d){if(t&1){let e=C();o(0,"div",87)(1,"span",19),s(2,"Visible: "),n(),o(3,"div",88)(4,"input",89),_("click",function(){f(e);let r=c().$implicit,m=c(3);return g(m.editLesson(r,!0))}),n(),p(5,Yr,3,2,"ng-container",30)(6,Qr,2,2,"ng-template",null,2,B),n()()}if(t&2){let e=J(7),i=c(),r=i.$implicit,m=i.index;a(4),O("id","lesson",m,""),l("checked",r.visible),a(),l("ngIf",r.visible)("ngIfElse",e)}}function Zr(t,d){if(t&1&&(o(0,"span",91),s(1),n()),t&2){let e=d.$implicit,i=c(5);a(),b(" ",i.academic_level[e]||e," ")}}function ea(t,d){if(t&1&&(K(0),p(1,Zr,2,1,"span",90),W()),t&2){let e=c().$implicit;a(),l("ngForOf",e.level)}}function ta(t,d){t&1&&(o(0,"small",19),s(1,"No se ha asignado"),n())}function ia(t,d){if(t&1&&(o(0,"small",94),s(1),n()),t&2){let e=d.$implicit;v("title",(e==null?null:e.name)||e),a(),h((e==null?null:e.name)||e)}}function na(t,d){if(t&1&&(o(0,"div",92),p(1,ia,2,2,"small",93),n()),t&2){let e=c().$implicit;a(),l("ngForOf",e.knowledge_area)}}function oa(t,d){t&1&&(o(0,"small",19),s(1,"No se ha asignado"),n())}function ra(t,d){t&1&&u(0,"img",103)}function aa(t,d){if(t&1&&u(0,"img",104),t&2){let e=c().$implicit,i=c(5);v("src",i.url+"get-image-user/"+e.picture,M)}}function sa(t,d){if(t&1&&(o(0,"div",98)(1,"a",99)(2,"button",100),p(3,ra,1,0,"img",101)(4,aa,1,1,"img",102),n()()()),t&2){let e=d.$implicit;a(2),St("title","",e.name," ",e.surname,""),l("routerLink",x(6,$e,e._id)),a(),l("ngIf",!e.picture),a(),l("ngIf",e.picture)}}function la(t,d){if(t&1&&(o(0,"div",25)(1,"div",26)(2,"div",25)(3,"div",26)(4,"strong"),s(5,"Grupo de desarrollo:"),n()()(),o(6,"div",95)(7,"div",96)(8,"div",25),p(9,sa,5,8,"div",97),n()()()()()),t&2){let e=c().$implicit;a(9),l("ngForOf",e.development_group)}}function da(t,d){t&1&&u(0,"img",103)}function ca(t,d){if(t&1&&u(0,"img",104),t&2){let e=c(2).$implicit,i=c(3);v("src",i.url+"get-image-user/"+e.author.picture,M)}}function ma(t,d){if(t&1&&(o(0,"div",25)(1,"div",26)(2,"div",25)(3,"div",26)(4,"strong"),s(5,"Enviada por:"),n()()(),o(6,"div",105)(7,"div",96)(8,"div",25)(9,"div",98)(10,"a",99)(11,"button",106),p(12,da,1,0,"img",101)(13,ca,1,1,"img",102),n()()(),o(14,"div",107)(15,"h6",108)(16,"a",109)(17,"strong")(18,"strong"),s(19),n()()(),u(20,"br"),o(21,"small",19),s(22),I(23,"amFromUnix"),I(24,"amLocale"),I(25,"amDateFormat"),n()()()()()()()()),t&2){let e=c().$implicit;a(11),l("routerLink",x(15,$e,e.author._id)),a(),l("ngIf",!e.author.picture),a(),l("ngIf",e.author.picture),a(3),l("routerLink",x(17,$e,e.author._id)),a(3),V("",e.author==null?null:e.author.name," ",e.author==null?null:e.author.surname,""),a(3),h(L(25,12,L(24,9,X(23,7,e.created_at),"es"),"LLL"))}}function pa(t,d){if(t&1){let e=C();o(0,"button",110),_("click",function(){f(e);let r=c().$implicit,m=c(3);return g(m.openAddCallModal(r))}),u(1,"i",111),s(2," Abrir convocatoria "),n()}}function ua(t,d){if(t&1){let e=C();o(0,"button",110),_("click",function(){f(e);let r=c().$implicit,m=c(3);return g(m.openAddCallModal(r,!0))}),u(1,"i",111),s(2),n()}if(t&2){let e=c().$implicit;a(2),b(" Abrir convocatoria V.",(e.version+1).toFixed(1)," ")}}function _a(t,d){if(t&1&&(o(0,"span",114),s(1),n()),t&2){let e=c(2).$implicit;a(),h(e.call.interested.length)}}function fa(t,d){if(t&1){let e=C();o(0,"button",112),_("click",function(){f(e);let r=c().$implicit,m=c(3);return g(m.openCallModal(r))}),u(1,"i",111),s(2," Ver convocatoria "),p(3,_a,2,1,"span",113),n()}if(t&2){let e=c().$implicit;a(3),l("ngIf",e.call&&e.call.interested&&e.call.interested.length>0)}}function ga(t,d){if(t&1){let e=C();o(0,"div")(1,"div",61)(2,"div",15)(3,"div",62)(4,"div",25)(5,"div",63)(6,"div",25)(7,"div",26)(8,"div",64),u(9,"i",65),n()()(),o(10,"div",66)(11,"div",67)(12,"button",68)(13,"span"),s(14),n()(),p(15,Kr,3,1,"button",69)(16,Wr,5,1,"button",70),n()()(),o(17,"div",26)(18,"div",25)(19,"div",26)(20,"h5",71)(21,"strong"),s(22),n()(),o(23,"small",19),s(24),I(25,"amFromUnix"),I(26,"amLocale"),I(27,"amDateFormat"),n(),o(28,"h5")(29,"span"),s(30),n()(),p(31,Hr,2,1,"p",72),n(),p(32,Xr,8,5,"div",73),n(),o(33,"div",25)(34,"div",47)(35,"div",25)(36,"div",26)(37,"strong"),s(38,"Nivel acad\xE9mico:"),n()()(),o(39,"div",25)(40,"div",26)(41,"p"),p(42,ea,2,1,"ng-container",30)(43,ta,2,0,"ng-template",null,1,B),n()()()(),o(45,"div",47)(46,"div",25)(47,"div",26)(48,"strong"),s(49,"\xC1reas de conocimiento:"),n()()(),o(50,"div",25)(51,"div",26),p(52,na,2,1,"div",74)(53,oa,2,0,"ng-template",null,1,B),n()()()(),p(55,la,10,1,"div",75)(56,ma,26,19,"div",75),n()(),o(57,"div",76)(58,"div",26)(59,"button",77),u(60,"i",78),s(61," Ver lecci\xF3n "),n(),p(62,pa,3,0,"button",79)(63,ua,3,1,"button",79)(64,fa,4,1,"button",80),o(65,"button",81),_("click",function(){let r=f(e).$implicit,m=c(3);return g(m.openDeleteModal(r._id))}),u(66,"i",82),s(67," Eliminar "),n()()()()()()()}if(t&2){let e=d.$implicit,i=J(44),r=c(3);a(8),ee("text-center p-2 py-3 rounded-lg border border-ligth text-center bg-",(r.lesson_states[e.state||"proposed"]==null?null:r.lesson_states[e.state||"proposed"].class)||"secondary",""),a(6),b("V. ",e.version.toFixed(1),""),a(),l("ngIf",e.state=="completed"),a(),l("ngIf",e.state=="completed"),a(6),h(e.title),a(2),b(" ",L(27,29,L(26,26,X(25,24,e.created_at),"es"),"LLL")," "),a(5),ee("badge bg-",(r.lesson_states[e.state||"proposed"]==null?null:r.lesson_states[e.state||"proposed"].class)||"secondary"," me-1"),a(),b(" ",(r.lesson_states[e.state||"proposed"]==null?null:r.lesson_states[e.state||"proposed"].label)||e.state||"proposed"," "),a(),l("ngForOf",e.resume?e.resume.split(`
`):Ee(32,Oi)),a(),l("ngIf",e.state=="completed"),a(10),l("ngIf",e.level&&e.level.length>0)("ngIfElse",i),a(10),l("ngIf",e.knowledge_area&&e.knowledge_area.length>0)("ngIfElse",i),a(3),l("ngIf",(e.development_group==null?null:e.development_group.length)>0&&e.state=="completed"),a(),l("ngIf",!e.development_group||e.development_group.length<=0||e.state=="proposed"),a(3),l("routerLink",x(33,Ri,e._id)),a(3),l("ngIf",Ee(35,Di).includes(e.state)&&!e.call),a(),l("ngIf",Ee(36,Ni).includes(e.state)&&e.call&&!e.son_lesson),a(),l("ngIf",Ee(37,Ui).includes(e.state)&&e.call)}}function va(t,d){if(t&1&&(o(0,"div"),p(1,ga,68,38,"div",53),n()),t&2){let e=c(2);a(),l("ngForOf",e.filteredLessons)}}function ha(t,d){if(t&1&&(o(0,"button",83),u(1,"i",84),s(2),n()),t&2){let e=c().$implicit;a(2),b(" ",e.score.toFixed(2)," ")}}function xa(t,d){if(t&1&&(o(0,"button",85)(1,"span"),u(2,"i",78),o(3,"span"),s(4),n()()()),t&2){let e=c().$implicit;a(4),b(" ",e.views,"")}}function ba(t,d){if(t&1&&(o(0,"small"),s(1),n()),t&2){let e=c().$implicit;a(),b("",e,"...")}}function Ca(t,d){if(t&1&&(o(0,"p",86),p(1,ba,2,1,"small",39),n()),t&2){let e=d.index;a(),l("ngIf",e==0)}}function ya(t,d){if(t&1&&(K(0),o(1,"label",43),s(2,"S\xED"),n(),W()),t&2){let e=c(2).index;a(),O("for","lesson",e,"")}}function Ea(t,d){if(t&1&&(o(0,"label",43),s(1,"No"),n()),t&2){let e=c(2).index;O("for","lesson",e,"")}}function Sa(t,d){if(t&1){let e=C();o(0,"div",87)(1,"span",19),s(2,"Visible: "),n(),o(3,"div",88)(4,"input",89),_("click",function(){f(e);let r=c().$implicit,m=c(3);return g(m.editLesson(r,!0))}),n(),p(5,ya,3,2,"ng-container",30)(6,Ea,2,2,"ng-template",null,2,B),n()()}if(t&2){let e=J(7),i=c(),r=i.$implicit,m=i.index;a(4),O("id","lesson",m,""),l("checked",r.visible),a(),l("ngIf",r.visible)("ngIfElse",e)}}function Ia(t,d){if(t&1&&(o(0,"span",91),s(1),n()),t&2){let e=d.$implicit,i=c(5);a(),b(" ",i.academic_level[e]||e," ")}}function wa(t,d){if(t&1&&(K(0),p(1,Ia,2,1,"span",90),W()),t&2){let e=c().$implicit;a(),l("ngForOf",e.level)}}function ka(t,d){t&1&&(o(0,"small",19),s(1,"No se ha asignado"),n())}function Ta(t,d){if(t&1&&(o(0,"small",116),s(1),n()),t&2){let e=d.$implicit;v("title",(e==null?null:e.name)||e),a(),h((e==null?null:e.name)||e)}}function Fa(t,d){if(t&1&&(o(0,"div",92),p(1,Ta,2,2,"small",115),n()),t&2){let e=c().$implicit;a(),l("ngForOf",e.knowledge_area)}}function La(t,d){t&1&&(o(0,"small",19),s(1,"No se ha asignado"),n())}function Pa(t,d){t&1&&u(0,"img",103)}function Va(t,d){if(t&1&&u(0,"img",104),t&2){let e=c().$implicit,i=c(5);v("src",i.url+"get-image-user/"+e.picture,M)}}function Ma(t,d){if(t&1&&(o(0,"div",98)(1,"a",99)(2,"button",100),p(3,Pa,1,0,"img",101)(4,Va,1,1,"img",102),n()()()),t&2){let e=d.$implicit;a(2),St("title","",e.name," ",e.surname,""),l("routerLink",x(6,$e,e._id)),a(),l("ngIf",!e.picture),a(),l("ngIf",e.picture)}}function Aa(t,d){if(t&1&&(o(0,"div",25)(1,"div",26)(2,"div",25)(3,"div",26)(4,"strong"),s(5,"Grupo de desarrollo:"),n()()(),o(6,"div",95)(7,"div",96)(8,"div",25),p(9,Ma,5,8,"div",97),n()()()()()),t&2){let e=c().$implicit;a(9),l("ngForOf",e.development_group)}}function Oa(t,d){t&1&&u(0,"img",103)}function Ra(t,d){if(t&1&&u(0,"img",104),t&2){let e=c(2).$implicit,i=c(3);l("src",i.url+"get-image-user/"+(e.author==null?null:e.author.picture),M)}}function Da(t,d){if(t&1&&(o(0,"div",25)(1,"div",26)(2,"div",25)(3,"div",26)(4,"strong"),s(5,"Enviada por:"),n()()(),o(6,"div",105)(7,"div",96)(8,"div",25)(9,"div",98)(10,"a",99)(11,"div",117)(12,"a",118),p(13,Oa,1,0,"img",101)(14,Ra,1,1,"img",102),n()()()(),o(15,"div",107)(16,"h6",108)(17,"a",109)(18,"strong"),s(19),n()(),u(20,"br"),o(21,"small",19),s(22),I(23,"amFromUnix"),I(24,"amLocale"),I(25,"amDateFormat"),n()()()()()()()()),t&2){let e=c().$implicit;a(12),l("routerLink",x(15,$e,e.author==null?null:e.author._id)),a(),l("ngIf",!(e.author!=null&&e.author.picture)),a(),l("ngIf",e.author==null?null:e.author.picture),a(3),l("routerLink",x(17,$e,e.author==null?null:e.author._id)),a(2),V("",e.author==null?null:e.author.name," ",e.author==null?null:e.author.surname,""),a(3),h(L(25,12,L(24,9,X(23,7,e.created_at),"es"),"LLL"))}}function Na(t,d){if(t&1){let e=C();o(0,"button",110),_("click",function(){f(e);let r=c().$implicit,m=c(3);return g(m.openAddCallModal(r))}),u(1,"i",111),s(2," Abrir convocatoria "),n()}}function Ua(t,d){if(t&1){let e=C();o(0,"button",110),_("click",function(){f(e);let r=c().$implicit,m=c(3);return g(m.openAddCallModal(r,!0))}),u(1,"i",111),s(2),n()}if(t&2){let e=c().$implicit;a(2),b(" Abrir convocatoria V.",(e.version+1).toFixed(1)," ")}}function $a(t,d){if(t&1&&(o(0,"span",114),s(1),n()),t&2){let e=c(2).$implicit;a(),h(e.call.interested.length)}}function qa(t,d){if(t&1){let e=C();o(0,"button",112),_("click",function(){f(e);let r=c().$implicit,m=c(3);return g(m.openCallModal(r))}),u(1,"i",111),s(2," Ver convocatoria "),p(3,$a,2,1,"span",113),n()}if(t&2){let e=c().$implicit;a(3),l("ngIf",e.call&&e.call.interested&&e.call.interested.length>0)}}function ja(t,d){if(t&1){let e=C();o(0,"div")(1,"div",61)(2,"div",15)(3,"div",62)(4,"div",25)(5,"div",63)(6,"div",25)(7,"div",26)(8,"div",64),u(9,"i",65),n()()(),o(10,"div",66)(11,"div",67)(12,"button",68)(13,"span"),s(14),n()(),p(15,ha,3,1,"button",69)(16,xa,5,1,"button",70),n()()(),o(17,"div",26)(18,"div",25)(19,"div",26)(20,"h5",71)(21,"strong"),s(22),n()(),o(23,"small",19),s(24),I(25,"amFromUnix"),I(26,"amLocale"),I(27,"amDateFormat"),n(),o(28,"h5")(29,"span"),s(30),n()(),p(31,Ca,2,1,"p",72),n(),p(32,Sa,8,5,"div",73),n(),o(33,"div",25)(34,"div",47)(35,"div",25)(36,"div",26)(37,"strong"),s(38,"Nivel acad\xE9mico:"),n()()(),o(39,"div",25)(40,"div",26)(41,"p"),p(42,wa,2,1,"ng-container",30)(43,ka,2,0,"ng-template",null,1,B),n()()()(),o(45,"div",47)(46,"div",25)(47,"div",26)(48,"strong"),s(49,"\xC1reas de conocimiento:"),n()()(),o(50,"div",25)(51,"div",26),p(52,Fa,2,1,"div",74)(53,La,2,0,"ng-template",null,1,B),n()()()(),p(55,Aa,10,1,"div",75)(56,Da,26,19,"div",75),n()(),o(57,"div",76)(58,"div",26)(59,"button",77),u(60,"i",78),s(61," Ver lecci\xF3n "),n(),p(62,Na,3,0,"button",79)(63,Ua,3,1,"button",79)(64,qa,4,1,"button",80),o(65,"button",81),_("click",function(){let r=f(e).$implicit,m=c(3);return g(m.openDeleteModal(r._id))}),u(66,"i",82),s(67," Eliminar "),n()()()()()()()}if(t&2){let e=d.$implicit,i=J(44),r=c(3);a(8),ee("text-center p-2 py-3 rounded-lg border border-ligth text-center bg-",(r.lesson_states[e.state||"proposed"]==null?null:r.lesson_states[e.state||"proposed"].class)||"secondary",""),a(6),b("V. ",e.version.toFixed(1),""),a(),l("ngIf",e.state=="completed"),a(),l("ngIf",e.state=="completed"),a(6),h(e.title),a(2),b(" ",L(27,29,L(26,26,X(25,24,e.created_at),"es"),"LLL")," "),a(5),ee("badge bg-",(r.lesson_states[e.state||"proposed"]==null?null:r.lesson_states[e.state||"proposed"].class)||"secondary"," me-1"),a(),b(" ",(r.lesson_states[e.state||"proposed"]==null?null:r.lesson_states[e.state||"proposed"].label)||e.state||"proposed"," "),a(),l("ngForOf",e.resume?e.resume.split(`
`):Ee(32,Oi)),a(),l("ngIf",e.state=="completed"),a(10),l("ngIf",e.level&&e.level.length>0)("ngIfElse",i),a(10),l("ngIf",e.knowledge_area&&e.knowledge_area.length>0)("ngIfElse",i),a(3),l("ngIf",(e.development_group==null?null:e.development_group.length)>0),a(),l("ngIf",e.development_group.length<=0),a(3),l("routerLink",x(33,Ri,e._id)),a(3),l("ngIf",Ee(35,Di).includes(e.state)&&!e.call),a(),l("ngIf",Ee(36,Ni).includes(e.state)&&e.call&&!e.son_lesson),a(),l("ngIf",Ee(37,Ui).includes(e.state)&&e.call)}}function Ba(t,d){if(t&1&&(o(0,"div"),p(1,ja,68,38,"div",53),n()),t&2){let e=c(2);a(),l("ngForOf",e.filteredLessons)}}function Ga(t,d){if(t&1&&(o(0,"li",122)(1,"a",123),s(2,"Anterior"),n()()),t&2){let e=c(3);a(),l("routerLink",x(1,$i,e.prevPage))}}function za(t,d){if(t&1&&(o(0,"li",122)(1,"a",124),s(2,"Siguiente"),n()()),t&2){let e=c(3);a(),l("routerLink",x(1,$i,e.nextPage))}}function Ka(t,d){if(t&1&&(o(0,"nav",119)(1,"ul",120),p(2,Ga,3,3,"li",121)(3,za,3,3,"li",121),n()()),t&2){let e=c(2);a(2),l("ngIf",e.page>1),a(),l("ngIf",e.page<e.pages&&e.page!=e.pages)}}function Wa(t,d){if(t&1&&(o(0,"div",15),p(1,va,2,1,"div",39)(2,Ba,2,1,"div",39)(3,Ka,4,2,"nav",60),n()),t&2){let e=c();a(),l("ngIf",!e.filter.value&&e.selectedStates.length==0&&e.selectedAreas.length==0&&e.selectedLevels.length==0),a(),l("ngIf",e.filter.value||e.selectedStates.length>0||e.selectedAreas.length>0||e.selectedLevels.length>0),a(),l("ngIf",!e.filter.value&&e.selectedStates.length==0&&e.selectedAreas.length==0&&e.selectedLevels.length==0)}}function Ja(t,d){t&1&&(o(0,"div",15)(1,"div",15)(2,"h4",19),s(3," No se encontraron lecciones para los criterios de b\xFAsqueda seleccionados. "),n()()())}function Ha(t,d){if(t&1){let e=C();o(0,"delete-lesson",125),_("deleted",function(r){f(e);let m=c();return g(m.setNeedReload(r))}),n()}if(t&2){let e=c();l("parent","lesson")("lessonId",e.deleteLessonId)}}function Ya(t,d){if(t&1){let e=C();o(0,"add-call",126),_("added",function(r){f(e);let m=c();return g(m.setNeedReload(r))}),n()}if(t&2){let e=c();l("areas",e.areas)("lesson",e.addCallLesson)("nextVersion",e.nextVersion)}}function Qa(t,d){if(t&1){let e=C();o(0,"call",127),_("assigned",function(r){f(e);let m=c();return g(m.setNeedReload(r))}),n()}if(t&2){let e=c();l("lesson",e.callLesson)}}var At=(()=>{class t{constructor(e,i,r,m,E,te){this.userService=e,this.lessonService=i,this.basicDataService=r,this.router=m,this.route=E,this.cdr=te,this.title="Lecciones",this.url=A.url,this.lessons=[],this.loading=!0,this.filter=new re(""),this.orderControl=new re(""),this.unsubscribe$=new Le,this.allLessons=[],this.filteredLessons=[],this.type={consideration:"Consideraci\xF3n",development:"Desarrollo"},this.academic_level=Te,this.lesson_states=fi,this.visible=new k,this.selectedStates=[],this.selectedAreas=[],this.selectedLevels=[],this.states=[{label:"Propuesta",value:"proposed",class:"secondary"},{label:"Aprobada por Facilitador",value:"approved_by_expert",class:"info"},{label:"Asignada",value:"assigned",class:"warning"},{label:"Desarrollo",value:"development",class:"info"},{label:"Prueba",value:"test",class:"primary"},{label:"Terminada",value:"completed",class:"success"}],this.focusedLessonId=null,this.actionType=null,this.showFocusedLesson=!1,this.showAreas=!1,this.showLevels=!1,this.token=this.userService.getToken(),this.identity=this.userService.getIdentity()}ngOnInit(){this.route.queryParams.subscribe(e=>{this.focusedLessonId=e.lesson||null,this.actionType=e.action||null,this.focusedLessonId&&(this.actionType==="review"||this.actionType==="manage"||this.actionType==="openAddCall"||this.actionType==="openCall")&&(console.log("Enfocando lecci\xF3n desde par\xE1metros (Admin):",this.focusedLessonId,this.actionType),this.showFocusedLesson=!0,this.title=this.actionType==="review"?"Revisar Nueva Lecci\xF3n":"Gestionar Lecci\xF3n")}),this.loadInitialData(),this.filter.valueChanges.pipe(he(this.unsubscribe$)).subscribe(()=>{this.applyFilters(this.allLessons)}),this.filteredLessons=[...this.allLessons]}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}loadInitialData(){this.showFocusedLesson&&this.focusedLessonId?this.getFocusedLesson():this.route.params.pipe(he(this.unsubscribe$)).subscribe(e=>{this.page=+e.page||1,this.fetchLessons(this.page)}),this.basicDataService.getAllKnowledgeAreas().pipe(he(this.unsubscribe$)).subscribe({next:e=>{try{let i=localStorage.getItem("areas");if(i)this.areas=JSON.parse(i);else{let r=e.areas||[];this.areas=r.map(m=>({_id:m._id,name:m.name})),localStorage.setItem("areas",JSON.stringify(this.areas))}}catch(i){console.error("Error parsing areas from localStorage:",i),this.areas=e.areas?e.areas.map(r=>({_id:r._id,name:r.name})):[]}},error:e=>console.error("Error fetching areas:",e)}),this.fetchAllLessons()}setNeedReload(e){console.log(e),this.actualPage(),this.fetchAllLessons(),this.cdr.detectChanges()}getAcademicLevels(e){return e.join(", ")}setState(e){let i=this.selectedStates.indexOf(e);i>-1?this.selectedStates.splice(i,1):this.selectedStates.push(e),this.fetchAllLessons()}setArea(e){let i=this.selectedAreas.indexOf(e);i>-1?this.selectedAreas.splice(i,1):this.selectedAreas.push(e),this.fetchAllLessons()}setLevel(e){let i=this.selectedLevels.indexOf(e);console.log("Selected level: ",e),i>-1?this.selectedLevels.splice(i,1):this.selectedLevels.push(e),this.fetchAllLessons()}setOrder(e){this.orderControl.setValue(e),this.fetchAllLessons()}navigateToPage(e){this.router.navigate(["/admin/lecciones",e])}fetchAllLessons(){let e=this.orderControl.value||"created_at";this.loading=!0,this.lessonService.getAllLessons(this.token,e,!0).pipe(he(this.unsubscribe$)).subscribe({next:i=>{i&&i.lessons?(this.allLessons=i.lessons,this.total=i.total||0,this.pages=i.pages||0,console.log("All Lessons fetched successfully: ",this.allLessons.length),this.applyFilters(this.allLessons)):(console.warn("No lessons data received"),this.allLessons=[],this.filteredLessons=[],this.total=0,this.pages=0),this.loading=!1},error:i=>{console.error("Error fetching all lessons:",i),this.loading=!1,this.allLessons=[],this.filteredLessons=[],this.total=0,this.pages=0}})}applyFilters(e){let i=[...e],r=!!(this.filter.value||this.selectedStates.length>0||this.selectedAreas.length>0||this.selectedLevels.length>0);if(this.filter.value){let m=this.filter.value.toLowerCase();console.log("Filter value: ",m),i=i.filter(E=>E.title&&E.title.toLowerCase().includes(m))}this.selectedStates.length>0&&(i=i.filter(m=>m.state&&this.selectedStates.includes(m.state))),this.selectedAreas.length>0&&(i=i.filter(m=>m.knowledge_area&&m.knowledge_area.some(E=>E&&E.name&&this.selectedAreas.includes(E.name)))),this.selectedLevels.length>0&&(i=i.filter(m=>{console.log(m.level),m.level&&this.selectedLevels.includes(m.level)})),this.filteredLessons=i,console.log("Filters applied:",r),console.log("Filtered Lessons: ",this.filteredLessons.length),console.log("Total lessons available: ",this.allLessons.length)}hasActiveFilters(){return!!(this.filter.value||this.selectedStates.length>0||this.selectedAreas.length>0||this.selectedLevels.length>0)}fetchLessons(e){this.lessonService.getLessons(this.token,e,!0).pipe(he(this.unsubscribe$)).subscribe({next:i=>{this.lessons=i.lessons,this.total=i.total,this.pages=i.pages,this.page=i.currentPage,this.loading=!1,console.log("Lessons fetched successfully:",i)},error:i=>{console.error("Error fetching lessons:",i),this.loading=!1,this.allLessons=[],this.total=0,this.pages=0}})}actualPage(){this.route.params.pipe(he(this.unsubscribe$)).subscribe(e=>{let i=+e.page;this.page=i,i?(this.nextPage=i+1,this.prevPage=this.page-1,this.prevPage<=0&&(this.prevPage=1)):(this.page=1,this.nextPage=this.page+1)})}reloadLessons(){this.fetchAllLessons()}editLesson(e,i=!1){i&&(e.visible=!e.visible),console.log("Enviando actualizaci\xF3n de lecci\xF3n:",{id:e._id,visible:e.visible,visibilityChange:i}),this.lessonService.editLesson(this.token,e).pipe(he(this.unsubscribe$)).subscribe({next:r=>{console.log("Lesson updated:",r),this.fetchAllLessons()},error:r=>{console.error("Error updating lesson:",r),i&&(e.visible=!e.visible);let m="Error al actualizar la lecci\xF3n";r.status===500?m="Error interno del servidor. Por favor, int\xE9ntalo de nuevo.":r.status===400?m=r.error?.message||"Datos inv\xE1lidos en la lecci\xF3n.":r.status===404?m="La lecci\xF3n no fue encontrada.":m=r.error?.message||"Error al actualizar la lecci\xF3n.",console.error(m),alert(m)}})}setDeleteLesson(e){this.deleteLessonId=e}setCallLesson(e){this.callLesson=e}setAddCallLesson(e,i=!1){this.addCallLesson=e,this.nextVersion=i}setShowAreas(e){this.showAreas?this.showAreas=!1:this.showAreas=e}setShowLevels(e){this.showLevels?this.showLevels=!1:this.showLevels=e}openAddModal(){setTimeout(()=>{try{let e=document.getElementById("add");if(e){let i=window.bootstrap?.Modal?.getInstance(e);i&&i.dispose(),new window.bootstrap.Modal(e,{backdrop:"static",keyboard:!1}).show()}}catch(e){console.log("Error al abrir modal de agregar lecci\xF3n:",e)}},0)}openAddCallModal(e,i=!1){this.setAddCallLesson(e,i),setTimeout(()=>{try{let r=document.getElementById("addCall");if(r){let m=window.bootstrap?.Modal?.getInstance(r);m&&m.dispose(),new window.bootstrap.Modal(r,{backdrop:"static",keyboard:!1}).show()}}catch(r){console.log("Error al abrir modal de agregar convocatoria:",r)}},0)}openCallModal(e){this.setCallLesson(e),setTimeout(()=>{try{let i=document.getElementById("call");if(i){let r=window.bootstrap?.Modal?.getInstance(i);r&&r.dispose(),new window.bootstrap.Modal(i,{backdrop:"static",keyboard:!1}).show()}}catch(i){console.log("Error al abrir modal de convocatoria:",i)}},0)}openDeleteModal(e){this.setDeleteLesson(e),setTimeout(()=>{try{let i=document.getElementById("delete");if(i){let r=window.bootstrap?.Modal?.getInstance(i);r&&r.dispose(),new window.bootstrap.Modal(i,{backdrop:"static",keyboard:!1}).show()}}catch(i){console.log("Error al abrir modal de eliminar:",i)}},0)}getFocusedLesson(){this.focusedLessonId&&(console.log("Cargando lecci\xF3n enfocada para admin:",this.focusedLessonId),this.lessonService.getLesson(this.token,this.focusedLessonId).subscribe(e=>{if(e.lesson){if(this.lessons=[e.lesson],this.allLessons=[e.lesson],this.filteredLessons=[e.lesson],this.loading=!1,console.log("Lecci\xF3n enfocada cargada para admin:",e.lesson.title),this.actionType==="openAddCall"){let i=e.lesson?.state==="completed";setTimeout(()=>this.openAddCallModal(e.lesson,i),100)}else this.actionType==="openCall"?setTimeout(()=>this.openCallModal(e.lesson),100):e.lesson.call&&e.lesson.call.visible&&setTimeout(()=>this.openCallModal(e.lesson),100);setTimeout(()=>{let i=document.querySelector(".card-lesson");i&&i.scrollIntoView({behavior:"smooth",block:"center"})},100)}else console.error("No se pudo cargar la lecci\xF3n enfocada"),this.loading=!1},e=>{console.error("Error cargando lecci\xF3n enfocada:",e),this.loading=!1}))}isFocusedLesson(e){return this.focusedLessonId===e._id}static{this.\u0275fac=function(i){return new(i||t)(y(P),y(pe),y(ne),y(j),y(z),y(rt))}}static{this.\u0275cmp=w({type:t,selectors:[["lessons"]],standalone:!1,decls:19,vars:13,consts:[["showOptions",""],["notAssigned",""],["noTemplate",""],[1,"card"],[1,"card-header"],[1,"m-0","text-primary","fw-bolder","float-start"],["type","button",1,"btn","btn-primary","float-end","ms-3",3,"click"],[1,"fas","fa-plus"],[1,"ms-2"],["class","card-body",4,"ngIf"],["class","form-group row mb-3",4,"ngIf"],[3,"parent","lessonId","deleted",4,"ngIf"],[3,"areas","lesson","nextVersion","added",4,"ngIf"],[3,"lesson","assigned",4,"ngIf"],[3,"added"],[1,"card-body"],[1,"text-muted","text-center"],["role","status",1,"spinner-border",2,"width","3rem","height","3rem"],[1,"visually-hidden"],[1,"text-muted"],[1,"categories-form"],[1,"categories-section-title"],[1,"fas","fa-tasks"],[1,"categories-container"],["class","category-item",4,"ngFor","ngForOf"],[1,"row"],[1,"col"],[1,"form-group"],[1,"text-primary","fw-bold","mb-0"],[1,"btn","btn-link",3,"click"],[4,"ngIf","ngIfElse"],["class","knowledge-area-scrollable",4,"ngIf"],[1,"fas","fa-graduation-cap"],[1,"categories-toggle-btn",3,"click"],["class","collapsible-categories expanded",4,"ngIf"],[1,"form-group","row","mb-1"],[1,"input-group","mb-2"],[1,"input-group-text"],["type","text","id","filter","placeholder","Filtro","autocomplete","off",1,"form-control",3,"formControl"],[4,"ngIf"],[1,"category-item"],[1,"form-check"],["type","checkbox",1,"form-check-input",3,"click","id"],[1,"form-check-label",3,"for"],[1,"knowledge-area-scrollable"],[1,"knowledge-area-grid"],["class","col-6",4,"ngFor","ngForOf"],[1,"col-6"],[1,"form-check-label",3,"for","title"],[1,"collapsible-categories","expanded"],[1,"categories-grid"],["type","checkbox","id","otro",1,"form-check-input",3,"click"],["for","otro",1,"form-check-label"],[4,"ngFor","ngForOf"],[1,"form-group","row","mb-3"],["for","order",1,"col-3","offset-6","col-form-label","text-end"],[1,"col-3"],["id","orderOptions",1,"form-control",3,"change","formControl"],["value","views"],["value","score"],["class","mt-3","aria-label","Page navigation",4,"ngIf"],[1,"card","mb-2"],[1,"media-body"],[1,"col-auto"],[2,"width","184px","height","80px","overflow","hidden"],[1,"text-white","fas","fa-chalkboard-teacher",2,"font-size","50px"],[1,"row","mt-1"],[1,"col-12"],["disabled","","title","Versi\xF3n",1,"btn","w-100","btn-sm"],["class","btn w-100 btn-sm","disabled","","title","Calificaci\xF3n",4,"ngIf"],["class","btn w-100 btn-sm","disabled","","title","Visualizaciones",4,"ngIf"],[1,"my-0"],["class","text-justify",4,"ngFor","ngForOf"],["class","text-center col-2",4,"ngIf"],["style","display: flex; flex-wrap: wrap",4,"ngIf","ngIfElse"],["class","row",4,"ngIf"],[1,"row","mt-3","text-end"],[1,"btn","btn-info","ms-2",3,"routerLink"],[1,"fas","fa-eye"],["class","btn btn-warning ms-2",3,"click",4,"ngIf"],["class","btn btn-success ms-2",3,"click",4,"ngIf"],[1,"btn","btn-danger","ms-2",3,"click"],[1,"fas","fa-trash"],["disabled","","title","Calificaci\xF3n",1,"btn","w-100","btn-sm"],[1,"fas","fa-star"],["disabled","","title","Visualizaciones",1,"btn","w-100","btn-sm"],[1,"text-justify"],[1,"text-center","col-2"],[1,"form-check","form-switch"],["type","checkbox",1,"form-check-input",3,"click","id","checked"],["class","badge bg-info me-1 mb-1 d-inline-flex align-items-center",4,"ngFor","ngForOf"],[1,"badge","bg-info","me-1","mb-1","d-inline-flex","align-items-center"],[2,"display","flex","flex-wrap","wrap"],["class","badge bg-success text-white me-1 mb-1 text-truncate",3,"title",4,"ngFor","ngForOf"],[1,"badge","bg-success","text-white","me-1","mb-1","text-truncate",3,"title"],[1,"card","mt-1"],[1,"card-body","p-1"],["class","col-auto pe-0",4,"ngFor","ngForOf"],[1,"col-auto","pe-0"],[1,"text-primary"],[1,"btn","flex-shrink-0","rounded-circle","overflow-hidden","p-0",2,"width","40px","height","40px",3,"routerLink","title"],["class","img-fluid","src","assets/images/user-default.png",4,"ngIf"],["class","img-fluid",3,"src",4,"ngIf"],["src","assets/images/user-default.png",1,"img-fluid"],[1,"img-fluid",3,"src"],[1,"card","mt-2"],[1,"btn","flex-shrink-0","rounded-circle","overflow-hidden","p-0",2,"width","40px","height","40px",3,"routerLink"],[1,"col","rounded","px-2"],[1,"mb-1"],[1,"text-primary",3,"routerLink"],[1,"btn","btn-warning","ms-2",3,"click"],[1,"fas","fa-bullhorn"],[1,"btn","btn-success","ms-2",3,"click"],["class","badge bg-secondary ms-1",4,"ngIf"],[1,"badge","bg-secondary","ms-1"],["class","badge bg-info text-dark me-1 mb-1 text-truncate",3,"title",4,"ngFor","ngForOf"],[1,"badge","bg-info","text-dark","me-1","mb-1","text-truncate",3,"title"],[1,"flex-shrink-0","rounded-circle","border-1","overflow-hidden",2,"width","40px","height","40px","background-color","aqua"],[3,"routerLink"],["aria-label","Page navigation",1,"mt-3"],[1,"pagination","justify-content-end"],["class","page-item",4,"ngIf"],[1,"page-item"],[1,"page-link","bg-primary",3,"routerLink"],[1,"page-link","bg-info",3,"routerLink"],[3,"deleted","parent","lessonId"],[3,"added","areas","lesson","nextVersion"],[3,"assigned","lesson"]],template:function(i,r){i&1&&(o(0,"div",3)(1,"div",4)(2,"h3",5),s(3),n(),o(4,"button",6),_("click",function(){return r.openAddModal()}),u(5,"i",7),o(6,"span",8),s(7,"Agregar tema"),n()()(),p(8,Fr,5,0,"div",9)(9,Lr,3,0,"div",9)(10,Gr,38,10,"div",9)(11,zr,10,1,"div",10)(12,Wa,4,3,"div",9)(13,Ja,4,0,"div",9),I(14,"filter"),n(),p(15,Ha,1,2,"delete-lesson",11)(16,Ya,1,3,"add-call",12)(17,Qa,1,1,"call",13),o(18,"suggest-lesson",14),_("added",function(E){return r.setNeedReload(E)}),n()),i&2&&(a(3),h(r.title),a(5),l("ngIf",r.loading),a(),l("ngIf",r.allLessons.length==0&&!r.loading&&r.filteredLessons.length==0),a(),l("ngIf",r.allLessons.length!=0),a(),l("ngIf",r.selectedStates.includes("completed")),a(),l("ngIf",r.allLessons.length>0),a(),l("ngIf",r.lessons.length>0&&L(14,10,r.allLessons,r.filter.value).length==0&&!r.loading),a(2),l("ngIf",r.deleteLessonId),a(),l("ngIf",r.addCallLesson&&r.areas.length>0),a(),l("ngIf",r.callLesson&&r.areas.length>0))},dependencies:[T,F,q,ce,me,N,de,D,$,Ce,le,R,Li,Vi,Ne,Ai,ti,ue,_e,fe,ye],styles:['.checkbox-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:2px}.knowledge-area-scrollable[_ngcontent-%COMP%]{max-height:200px;overflow-y:auto}.custom-control-input[_ngcontent-%COMP%]{position:absolute;z-index:-1;opacity:0}.custom-control-label[_ngcontent-%COMP%]{position:relative;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:150px;padding-left:25px;cursor:pointer}.custom-control-label[_ngcontent-%COMP%]:before{content:"";position:absolute;left:0;top:50%;transform:translateY(-50%);width:16px;height:16px;border:1px solid #ccc;background-color:#fff;border-radius:2px}.custom-control-input[_ngcontent-%COMP%]:checked + .custom-control-label[_ngcontent-%COMP%]:before{background-color:#007bff;border-color:#007bff}.custom-control-input[_ngcontent-%COMP%]:checked + .custom-control-label[_ngcontent-%COMP%]:after{content:"";position:absolute;left:4px;top:50%;transform:translateY(-50%) rotate(45deg);width:6px;height:10px;border:solid white;border-width:0 2px 2px 0}.knowledge-area-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(130px,1fr));gap:3px}.custom-control-label[_ngcontent-%COMP%]:after{content:attr(title);position:absolute;background-color:#1813a7;border:1px solid #ededed;padding:8px 12px;z-index:10;white-space:normal;min-width:250px;box-shadow:0 2px 5px #0003;border-radius:4px;font-size:14px;line-height:1.5;opacity:0;visibility:hidden;transition:opacity .3s ease,visibility .3s ease;top:110%;left:0}.custom-control-label[_ngcontent-%COMP%]:hover:after{opacity:1;visibility:visible}']})}}return t})();var qi=[{id:"cityName",label:"Ciudad",attr:"name",required:!0},{id:"cityState",label:"Departamento",attr:"state",required:!0},{id:"cityCountry",label:"Pais",attr:"country",required:!0}];var ji=t=>["/admin/ciudades",t],Bi=t=>({"is-invalid":t});function Xa(t,d){t&1&&(o(0,"div",30)(1,"div",31)(2,"div",32)(3,"span",33),s(4,"Loading..."),n()()()())}function Za(t,d){t&1&&(o(0,"div",30)(1,"h4",34),s(2," No se han registrado ciudades. "),n()())}function es(t,d){if(t&1){let e=C();o(0,"tr")(1,"td"),s(2),n(),o(3,"td"),s(4),n(),o(5,"td"),s(6),n(),o(7,"td")(8,"button",47),_("click",function(){let r=f(e).$implicit,m=c(3);return g(m.setEditCity(r))}),u(9,"i",48),o(10,"span",5)(11,"small"),s(12,"Editar"),n()()(),o(13,"button",49),_("click",function(){let r=f(e).$implicit,m=c(3);return g(m.setDeleteCity(r._id))}),u(14,"i",50),o(15,"span",5)(16,"small"),s(17,"Eliminar"),n()()()()()}if(t&2){let e=d.$implicit;a(2),h(e.name),a(2),h(e.state),a(2),h(e.country)}}function ts(t,d){if(t&1&&(o(0,"tbody"),p(1,es,18,3,"tr",46),n()),t&2){let e=c(2);a(),l("ngForOf",e.cities)}}function is(t,d){if(t&1){let e=C();o(0,"tr")(1,"td"),s(2),n(),o(3,"td"),s(4),n(),o(5,"td"),s(6),n(),o(7,"td")(8,"button",47),_("click",function(){let r=f(e).$implicit,m=c(3);return g(m.setEditCity(r))}),u(9,"i",48),o(10,"span",5)(11,"small"),s(12,"Editar"),n()()(),o(13,"button",49),_("click",function(){let r=f(e).$implicit,m=c(3);return g(m.setDeleteCity(r._id))}),u(14,"i",50),o(15,"span",5)(16,"small"),s(17,"Eliminar"),n()()()()()}if(t&2){let e=d.$implicit;a(2),h(e.name),a(2),h(e.state),a(2),h(e.country)}}function ns(t,d){if(t&1&&(o(0,"tbody"),p(1,is,18,3,"tr",46),I(2,"filter"),n()),t&2){let e=c(2);a(),l("ngForOf",L(2,1,e.allCities,e.filter.value))}}function os(t,d){if(t&1&&(o(0,"li",54)(1,"a",55),s(2,"Anterior"),n()()),t&2){let e=c(3);a(),l("routerLink",x(1,ji,e.prevPage))}}function rs(t,d){if(t&1&&(o(0,"li",54)(1,"a",56),s(2,"Siguiente"),n()()),t&2){let e=c(3);a(),l("routerLink",x(1,ji,e.nextPage))}}function as(t,d){if(t&1&&(o(0,"nav",51)(1,"ul",52),p(2,os,3,3,"li",53)(3,rs,3,3,"li",53),n()()),t&2){let e=c(2);a(2),l("ngIf",e.page>1),a(),l("ngIf",e.page<e.pages)}}function ss(t,d){if(t&1&&(o(0,"div",30)(1,"div",35)(2,"div",36)(3,"form")(4,"div",37)(5,"div",38)(6,"div",39),s(7,"Filtrar:"),n()(),u(8,"input",40),n()()()(),o(9,"table",41)(10,"thead",42)(11,"tr")(12,"th",43),s(13,"Ciudades"),n(),o(14,"th",43),s(15,"Departamento"),n(),o(16,"th",43),s(17,"Pais"),n(),o(18,"th",43),s(19,"Opciones"),n()()(),p(20,ts,2,1,"tbody",44)(21,ns,3,4,"tbody",44),n(),p(22,as,4,2,"nav",45),n()),t&2){let e=c();a(8),l("formControl",e.filter),a(12),l("ngIf",!e.filter.value),a(),l("ngIf",e.filter.value),a(),l("ngIf",!e.filter.value)}}function ls(t,d){t&1&&(o(0,"div",57),u(1,"i",58),s(2," La ciudad no fue agregada correctamente. Intentalo de nuevo. "),n())}function ds(t,d){t&1&&(o(0,"div",59),u(1,"i",60),s(2," La ciudad fue agregada correctamente. "),n())}function cs(t,d){if(t&1&&(o(0,"div"),s(1),n()),t&2){let e=c(2).$implicit;a(),b(" El campo ",e.label," es obligatorio. ")}}function ms(t,d){if(t&1&&(o(0,"div",65),p(1,cs,2,1,"div",44),n()),t&2){let e=c().$implicit,i=c();a(),l("ngIf",i.f[e.id].errors.required)}}function ps(t,d){if(t&1){let e=C();o(0,"div",35)(1,"label",61)(2,"strong"),s(3),n()(),o(4,"div",62)(5,"input",63),_("keydown",function(r){f(e);let m=c();return g(m.onKeydown(r))}),n(),p(6,ms,2,1,"div",64),n()()}if(t&2){let e=d.$implicit,i=c();a(),v("for",e.id),a(2),b("",e.label,"*"),a(2),v("id",e.id),v("formControlName",e.id),v("placeholder",e.label),l("ngClass",x(7,Bi,i.submitted&&i.f[e.id].errors)),a(),l("ngIf",i.submitted&&i.f[e.id].errors)}}function us(t,d){t&1&&(o(0,"div",57),u(1,"i",58),s(2," La ciudad no fue agregada correctamente. Intentalo de nuevo. "),n())}function _s(t,d){t&1&&(o(0,"div",59),u(1,"i",60),s(2," Se ha editado correctamente la ciudad. "),n())}function fs(t,d){if(t&1&&(o(0,"div"),s(1),n()),t&2){let e=c(2).$implicit;a(),b(" El campo ",e.label," es obligatorio. ")}}function gs(t,d){if(t&1&&(o(0,"div",65),p(1,fs,2,1,"div",44),n()),t&2){let e=c().$implicit,i=c();a(),l("ngIf",i.f2[e.id].errors.required)}}function vs(t,d){if(t&1){let e=C();o(0,"div",35)(1,"label",61)(2,"strong"),s(3),n()(),o(4,"div",62)(5,"input",63),_("keydown",function(r){f(e);let m=c();return g(m.onKeydown(r))}),n(),p(6,gs,2,1,"div",64),n()()}if(t&2){let e=d.$implicit,i=c();a(),v("for",e.id),a(2),b("",e.label,"*"),a(2),v("id",e.id),v("formControlName",e.id),v("placeholder",e.label),l("ngClass",x(7,Bi,i.submitted&&i.f2[e.id].errors)),a(),l("ngIf",i.submitted&&i.f2[e.id].errors)}}var Ot=(()=>{class t{constructor(e,i,r){this._bDService=e,this._route=i,this._router=r,this.fieldsForm=qi,this.submitted=!1,this.city=new ct,this.cities=[],this.allCities=[],this.loading=!0,this.unsubscribe$=new Le,this.title="Ciudades",this.cityForm=new oe({cityName:new k("",[S.required]),cityState:new k("",[S.required]),cityCountry:new k("",[S.required])}),this.editCityForm=new oe({cityName:new k("",[S.required]),cityState:new k("",[S.required]),cityCountry:new k("",[S.required])}),this.filter=new k}ngOnInit(){this.actualPage(),this.getAllCities()}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}get f(){return this.cityForm.controls}get f2(){return this.editCityForm.controls}setAdd(){this.status=null,this.submitted=!1}onSubmit(){this.status=null,this.submitted=!0,!this.cityForm.invalid&&(this.city.name=this.cityForm.value.cityName,this.city.state=this.cityForm.value.cityState,this.city.country=this.cityForm.value.cityCountry,this._bDService.addCity(this.city).pipe(Qt(e=>{e.city&&e.city._id?(this.cityForm.reset(),this.status="success",this.submitted=!1,this.getCities(this.page),this.getAllCities()):this.status="error"}),ve(e=>(e!=null&&(this.status="error",console.log(e)),Wt(()=>e)))).subscribe())}getAllCities(){return ie(this,null,function*(){try{let e=yield Se(this._bDService.getAllCities());e.cities&&(this.allCities=e.cities,localStorage.setItem("cities",JSON.stringify(this.allCities)))}catch(e){console.error(e)}})}getCities(e){return ie(this,null,function*(){try{let i=yield Se(this._bDService.getCities(e));i.cities&&(this.cities=i.cities,this.total=i.total,this.pages=i.pages,e>this.pages&&this._router.navigate(["/admin/ciudades"]),this.loading=!1)}catch(i){console.error(i)}})}setEditCity(e){this.status=null,this.tempCity=e,this.editCityForm.patchValue({cityName:this.tempCity.name,cityState:this.tempCity.state,cityCountry:this.tempCity.country})}onEditSubmit(){return ie(this,null,function*(){if(this.status=null,this.submitted=!0,!this.editCityForm.invalid){this.city.name=this.editCityForm.value.cityName,this.city.state=this.editCityForm.value.cityState,this.city.country=this.editCityForm.value.cityCountry;try{let e=yield Se(this._bDService.editCity(this.tempCity._id,this.city));e.city&&e.city._id?(this.status="success",this.submitted=!1,yield this.getCities(this.page),yield this.getAllCities()):this.status="error"}catch(e){e!=null&&(this.status="error",console.error(e))}}})}setDeleteCity(e){this.tempCityId=e}delete(){return ie(this,null,function*(){try{let e=yield Se(this._bDService.deleteCity(this.tempCityId));this.tempCityId=null,yield this.getCities(this.page),yield this.getAllCities()}catch(e){console.error(e)}})}actualPage(){return ie(this,null,function*(){this._route.params.subscribe(e=>ie(this,null,function*(){let i=+e.page;this.page=i,i?(this.nextPage=i+1,this.prevPage=i-1,this.prevPage<=0&&(this.prevPage=1)):(this.page=1,this.nextPage=this.page+1),yield this.getCities(this.page)}))})}onKeydown(e){if(e.key==="Enter"){e.preventDefault();let i=document.getElementById("save");i!==null&&i.click()}}onChanges(){this.cityForm.valueChanges.subscribe(e=>{e&&(this.status=null,this.submitted=!1)}),this.editCityForm.valueChanges.subscribe(e=>{e&&(this.status=null,this.submitted=!1)})}static{this.\u0275fac=function(i){return new(i||t)(y(ne),y(z),y(j))}}static{this.\u0275cmp=w({type:t,selectors:[["cities"]],standalone:!1,decls:61,vars:12,consts:[[1,"card"],[1,"card-header"],[1,"m-0","text-primary","font-weight-bolder","float-left"],["type","button","data-bs-toggle","modal","data-bs-target","#addCity",1,"btn","btn-primary","float-right",3,"click"],[1,"fas","fa-plus"],[1,"ms-2"],["class","card-body",4,"ngIf"],["id","addCity","tabindex","-1","role","dialog","aria-labelledby","addCity","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-dialog-centered"],[1,"modal-content"],[3,"ngSubmit","keydown.enter","formGroup"],[1,"modal-header"],["id","addCityTitle",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],["class","alert alert-danger fade show text-center","role","alert",4,"ngIfSuccessMessage","ngIf"],["class","alert alert-success fade show text-center","role","alert",4,"ngIfSuccessMessage","ngIf"],["class","form-group row",4,"ngFor","ngForOf"],[1,"modal-footer"],["data-bs-dismiss","modal",1,"btn","btn-danger"],["id","save","type","submit",1,"btn","btn-success"],["id","editCity","tabindex","-1","role","dialog","aria-labelledby","editCity","aria-hidden","true",1,"modal","fade"],[3,"ngSubmit","input","formGroup"],["id","editCityTitle",1,"modal-title"],["id","deleteCity","tabindex","-1","role","dialog","aria-labelledby","deleteCity","aria-hidden","true",1,"modal","fade"],["id","editCity",1,"modal-title"],["role","alert",1,"alert","alert-warning","mb-0"],[1,"fas","fa-exclamation-triangle","icon-message","me-2"],["data-bs-dismiss","modal",1,"btn","btn-danger",3,"click"],["data-bs-dismiss","modal",1,"btn","btn-primary","text-white"],[1,"card-body"],[1,"text-muted","text-center"],["role","status",1,"spinner-border",2,"width","3rem","height","3rem"],[1,"sr-only"],[1,"text-muted"],[1,"form-group","row"],[1,"col"],[1,"input-group","mb-2"],[1,"input-group-prepend"],[1,"input-group-text"],["type","text","id","inlineFormInputGroup","placeholder","Filtro","autocomplete","off",1,"form-control",3,"formControl"],[1,"table","table-sm","table-hover","table-bordered","text-center"],[1,"thead-dark"],["scope","col"],[4,"ngIf"],["aria-label","Page navigation",4,"ngIf"],[4,"ngFor","ngForOf"],["type","button","data-bs-toggle","modal","data-bs-target","#editCity",1,"btn","btn-warning","btn-sm","mx-1",3,"click"],[1,"fas","fa-pen-square"],["type","button","data-bs-toggle","modal","data-bs-target","#deleteCity",1,"btn","btn-danger","btn-sm","mx-1",3,"click"],[1,"fas","fa-trash"],["aria-label","Page navigation"],[1,"pagination","justify-content-end"],["class","page-item",4,"ngIf"],[1,"page-item"],[1,"page-link","bg-primary",3,"routerLink"],[1,"page-link","bg-info",3,"routerLink"],["role","alert",1,"alert","alert-danger","fade","show","text-center"],[1,"fas","fa-times-circle","icon-message","me-2"],["role","alert",1,"alert","alert-success","fade","show","text-center"],[1,"fas","fa-check-circle","icon-message","me-2"],[1,"col-4","col-form-label",3,"for"],[1,"col-8"],["type","text","autocomplete","off",1,"form-control",3,"keydown","id","formControlName","placeholder","ngClass"],["class","invalid-feedback",4,"ngIf"],[1,"invalid-feedback"]],template:function(i,r){i&1&&(o(0,"div",0)(1,"div",1)(2,"h3",2),s(3),n(),o(4,"button",3),_("click",function(){return r.setAdd()}),u(5,"i",4),o(6,"span",5),s(7,"Agregar"),n()()(),p(8,Xa,5,0,"div",6)(9,Za,3,0,"div",6)(10,ss,23,4,"div",6),n(),o(11,"div",7)(12,"div",8)(13,"div",9)(14,"form",10),_("ngSubmit",function(){return r.onSubmit()})("keydown.enter",function(E){return E.preventDefault(),r.onSubmit()}),o(15,"div",11)(16,"h5",12),s(17,"Agregar una ciudad"),n(),u(18,"button",13),n(),o(19,"div",14),p(20,ls,3,0,"div",15)(21,ds,3,0,"div",16)(22,ps,7,9,"div",17),n(),o(23,"div",18)(24,"button",19),s(25,"Cancelar"),n(),o(26,"button",20),s(27,"Guardar"),n()()()()()(),o(28,"div",21)(29,"div",8)(30,"div",9)(31,"form",22),_("ngSubmit",function(){return r.onEditSubmit()})("input",function(){return r.onChanges()}),o(32,"div",11)(33,"h5",23),s(34,"Editar ciudad"),n(),u(35,"button",13),n(),o(36,"div",14),p(37,us,3,0,"div",15)(38,_s,3,0,"div",16)(39,vs,7,9,"div",17),n(),o(40,"div",18)(41,"button",19),s(42,"Cancelar"),n(),o(43,"button",20),s(44,"Guardar"),n()()()()()(),o(45,"div",24)(46,"div",8)(47,"div",9)(48,"div",11)(49,"h5",25),s(50,"Eliminar ciudad"),n(),u(51,"button",13),n(),o(52,"div",14)(53,"div",26),u(54,"i",27),s(55," \xBFEsta seguro que desea eliminar este registro? "),n()(),o(56,"div",18)(57,"button",28),_("click",function(){return r.delete()}),s(58,"S\xED"),n(),o(59,"button",29),s(60,"No"),n()()()()()),i&2&&(a(3),h(r.title),a(5),l("ngIf",r.loading),a(),l("ngIf",r.cities.length==0&&!r.loading),a(),l("ngIf",r.cities.length!=0),a(4),l("formGroup",r.cityForm),a(6),l("ngIf",r.status==="error"),a(),l("ngIf",r.status==="success"),a(),l("ngForOf",r.fieldsForm),a(9),l("formGroup",r.editCityForm),a(6),l("ngIf",r.status==="error"),a(),l("ngIf",r.status==="success"),a(),l("ngForOf",r.fieldsForm))},dependencies:[G,T,F,q,N,D,$,Ce,le,H,Y,R,ye],encapsulation:2})}}return t})();var Gi=[{id:"institutionName",label:"Nombre",attr:"name",required:!0},{id:"institutionWebsite",label:"Sitio web",attr:"website"},{id:"institutionEmail",label:"Correo electr\xF3nico",attr:"email"},{id:"institutionCity",label:"Ciudad",attr:"city",autocomplete:!0},{id:"institutionTelephone",label:"Tel\xE9fono",attr:"telephone"}];var zi=t=>["/admin/instituciones",t],Ki=t=>({"is-invalid":t});function hs(t,d){t&1&&(o(0,"div",31)(1,"div",32)(2,"div",33)(3,"span",34),s(4,"Loading..."),n()()()())}function xs(t,d){t&1&&(o(0,"div",31)(1,"h4",35),s(2," No se han registrado instituciones. "),n()())}function bs(t,d){if(t&1){let e=C();o(0,"tr")(1,"td"),s(2),n(),o(3,"td")(4,"button",47),_("click",function(){let r=f(e).$implicit,m=c(3);return g(m.setEditInstitution(r))}),u(5,"i",48),o(6,"span",6)(7,"small"),s(8,"Editar"),n()()(),o(9,"button",49),_("click",function(){let r=f(e).$implicit,m=c(3);return g(m.setDeleteInstitution(r._id))}),u(10,"i",50),o(11,"span",6)(12,"small"),s(13,"Eliminar"),n()()()()()}if(t&2){let e=d.$implicit;a(2),h(e.name)}}function Cs(t,d){if(t&1&&(o(0,"tbody"),p(1,bs,14,1,"tr",46),n()),t&2){let e=c(2);a(),l("ngForOf",e.institutions)}}function ys(t,d){if(t&1){let e=C();o(0,"tr")(1,"td"),s(2),n(),o(3,"td")(4,"button",47),_("click",function(){let r=f(e).$implicit,m=c(3);return g(m.setEditInstitution(r))}),u(5,"i",48),o(6,"span",6)(7,"small"),s(8,"Editar"),n()()(),o(9,"button",49),_("click",function(){let r=f(e).$implicit,m=c(3);return g(m.setDeleteInstitution(r._id))}),u(10,"i",50),o(11,"span",6)(12,"small"),s(13,"Eliminar"),n()()()()()}if(t&2){let e=d.$implicit;a(2),h(e.name)}}function Es(t,d){if(t&1&&(o(0,"tbody"),p(1,ys,14,1,"tr",46),I(2,"filter"),n()),t&2){let e=c(2);a(),l("ngForOf",L(2,1,e.allInstitutions,e.filter.value))}}function Ss(t,d){if(t&1&&(o(0,"li",54)(1,"a",55),s(2,"Anterior"),n()()),t&2){let e=c(3);a(),l("routerLink",x(1,zi,e.prevPage))}}function Is(t,d){if(t&1&&(o(0,"li",54)(1,"a",56),s(2,"Siguiente"),n()()),t&2){let e=c(3);a(),l("routerLink",x(1,zi,e.nextPage))}}function ws(t,d){if(t&1&&(o(0,"nav",51)(1,"ul",52),p(2,Ss,3,3,"li",53)(3,Is,3,3,"li",53),n()()),t&2){let e=c(2);a(2),l("ngIf",e.page>1),a(),l("ngIf",e.page<e.pages)}}function ks(t,d){if(t&1&&(o(0,"div",31)(1,"div",36)(2,"div",37)(3,"form")(4,"div",38)(5,"div",39)(6,"div",40),s(7,"Filtrar:"),n()(),u(8,"input",41),n()()()(),o(9,"table",42)(10,"thead",43)(11,"tr")(12,"th"),s(13,"Institucion"),n(),o(14,"th"),s(15,"Opciones"),n()()(),p(16,Cs,2,1,"tbody",44)(17,Es,3,4,"tbody",44),n(),p(18,ws,4,2,"nav",45),n()),t&2){let e=c();a(8),l("formControl",e.filter),a(8),l("ngIf",!e.filter.value),a(),l("ngIf",e.filter.value&&e.allInstitutions),a(),l("ngIf",!e.filter.value)}}function Ts(t,d){t&1&&(o(0,"div",57),u(1,"i",58),s(2," La instituci\xF3n no fue agregada correctamente. Intentalo de nuevo. "),n())}function Fs(t,d){t&1&&(o(0,"div",59),u(1,"i",60),s(2," La instituci\xF3n fue agregada correctamente. "),n())}function Ls(t,d){t&1&&(o(0,"span"),s(1,"*"),n())}function Ps(t,d){if(t&1){let e=C();o(0,"input",66),_("keydown",function(r){f(e);let m=c(3);return g(m.onKeydown(r))}),n()}if(t&2){let e=c(2).$implicit;v("id",e.id),v("formControlName",e.id),v("placeholder",e.label)}}function Vs(t,d){if(t&1&&u(0,"ng-select",67),t&2){let e=c(2).$implicit,i=c();v("formControlName",e.id),v("placeholder",e.label),l("items",i.items[e.id])}}function Ms(t,d){if(t&1&&(o(0,"div",63),p(1,Ps,1,3,"input",64)(2,Vs,1,3,"ng-select",65),n()),t&2){let e=c().$implicit;a(),l("ngIf",!e.autocomplete),a(),l("ngIf",e.autocomplete)}}function As(t,d){if(t&1&&(o(0,"div"),s(1),n()),t&2){let e=c(3).$implicit;a(),b(" El campo ",e.label," es obligatorio. ")}}function Os(t,d){if(t&1&&(o(0,"div",70),p(1,As,2,1,"div",44),n()),t&2){let e=c(3);a(),l("ngIf",e.f.institutionName.errors.required)}}function Rs(t,d){if(t&1){let e=C();o(0,"div",63)(1,"input",68),_("keydown",function(r){f(e);let m=c(2);return g(m.onKeydown(r))}),n(),p(2,Os,2,1,"div",69),n()}if(t&2){let e=c().$implicit,i=c();a(),v("id",e.id),v("formControlName",e.id),v("placeholder",e.label),l("ngClass",x(5,Ki,i.submitted&&i.f[e.id].errors)),a(),l("ngIf",i.submitted&&i.f.institutionName.errors)}}function Ds(t,d){if(t&1&&(o(0,"div",36)(1,"label",61)(2,"strong"),s(3),p(4,Ls,2,0,"span",44),n()(),p(5,Ms,3,2,"div",62)(6,Rs,3,7,"ng-template",null,0,B),n()),t&2){let e=d.$implicit,i=J(7);a(),v("for",e.id),a(2),h(e.label),a(),l("ngIf",e.id=="institutionName"),a(),l("ngIf",e.id!="institutionName")("ngIfElse",i)}}function Ns(t,d){t&1&&(o(0,"div",57),u(1,"i",58),s(2," La instituci\xF3n no fue agregada correctamente. Intentalo de nuevo. "),n())}function Us(t,d){t&1&&(o(0,"div",59),u(1,"i",60),s(2," La instituci\xF3n fue agregada correctamente. "),n())}function $s(t,d){t&1&&(o(0,"span"),s(1,"*"),n())}function qs(t,d){if(t&1){let e=C();o(0,"input",72),_("keydown",function(r){f(e);let m=c(3);return g(m.onKeydown(r))}),n()}if(t&2){let e=c(2).$implicit;v("id",e.id),v("formControlName",e.id),v("placeholder",e.label)}}function js(t,d){if(t&1&&u(0,"ng-select",67),t&2){let e=c(2).$implicit,i=c();v("formControlName",e.id),v("placeholder",e.label),l("items",i.items[e.id])}}function Bs(t,d){if(t&1&&(o(0,"div",63),p(1,qs,1,3,"input",71)(2,js,1,3,"ng-select",65),n()),t&2){let e=c().$implicit;a(),l("ngIf",!e.autocomplete),a(),l("ngIf",e.autocomplete)}}function Gs(t,d){if(t&1&&(o(0,"div"),s(1),n()),t&2){let e=c(3).$implicit;a(),b(" El campo ",e.label," es obligatorio. ")}}function zs(t,d){if(t&1&&(o(0,"div",70),p(1,Gs,2,1,"div",44),n()),t&2){let e=c(2).$implicit,i=c();a(),l("ngIf",i.f2[e.id].errors.required)}}function Ks(t,d){if(t&1){let e=C();o(0,"div",63)(1,"input",73),_("keydown",function(r){f(e);let m=c(2);return g(m.onKeydown(r))}),n(),p(2,zs,2,1,"div",69),n()}if(t&2){let e=c().$implicit,i=c();a(),v("id",e.id),v("formControlName",e.id),v("placeholder",e.label),l("ngClass",x(5,Ki,i.submitted&&i.f2[e.id].errors)),a(),l("ngIf",i.submitted&&i.f2[e.id].errors)}}function Ws(t,d){if(t&1&&(o(0,"div",36)(1,"label",61)(2,"strong"),s(3),p(4,$s,2,0,"span",44),n()(),p(5,Bs,3,2,"div",62)(6,Ks,3,7,"ng-template",null,0,B),n()),t&2){let e=d.$implicit,i=J(7);a(),v("for",e.id),a(2),h(e.label),a(),l("ngIf",e.id=="institutionName"),a(),l("ngIf",e.id!="institutionName")("ngIfElse",i)}}var Rt=(()=>{class t{constructor(e,i,r,m){this._bDService=e,this.config=i,this._route=r,this._router=m,this.fieldsForm=Gi,this.submitted=!1,this.institution=new dt,this.institutions=[],this.allCities=[],this.loading=!0,this.subscriptions=new Kt,this.title="Instituciones",this.institutionForm=new It({institutionName:new re("",[S.required]),institutionWebsite:new re,institutionEmail:new re,institutionCity:new re,institutionTelephone:new re}),this.editInstitutionForm=new It({institutionName:new re("",[S.required]),institutionWebsite:new re,institutionEmail:new re,institutionCity:new re,institutionTelephone:new re}),this.filter=new re,this.config.addTagText="Agregar",this.config.notFoundText="No se encontro",this.items={institutionCity:""}}ngOnInit(){this.allCities=JSON.parse(localStorage.getItem("cities")),this.allCities||this.getAllCities(),this.actualPage(),this.getAllInstitutions(),this.onChanges(),this.subscriptions.add(this.institutionForm.valueChanges.subscribe(e=>{e&&(this.status=null,this.submitted=!1)})),this.subscriptions.add(this.editInstitutionForm.valueChanges.subscribe(e=>{e&&(this.status=null,this.submitted=!1)}))}ngOnDestroy(){this.subscriptions.unsubscribe()}get f(){return this.institutionForm.controls}get f2(){return this.editInstitutionForm.controls}setAdd(){this.status=null,this.submitted=!1,this.items={institutionCity:this.allCities}}onSubmit(){this.submitted=!0,!this.institutionForm.invalid&&(this.institution.name=this.institutionForm.value.institutionName,this.institution.email=this.institutionForm.value.institutionEmail,this.institutionForm.value.institutionCity&&(this.institution.city=this.institutionForm.value.institutionCity._id),this.institution.website=this.institutionForm.value.institutionWebsite,this.institution.telephone=this.institutionForm.value.institutionTelephone,this._bDService.addInstitution(this.institution).subscribe({next:e=>{e.institution&&e.institution._id?(this.institutionForm.reset(),this.status="success",this.submitted=!1,this.getInstitutions(this.page),this.getAllInstitutions()):this.status="error"},error:e=>{e!=null&&(this.status="error",console.log(e))}}))}getAllInstitutions(){this._bDService.getAllInstitutions().pipe(ve(e=>(console.log("Error fetching institutions:",e),ge([])))).subscribe({next:e=>{e.institutions&&(this.allInstitutions=e.institutions,localStorage.setItem("institutions",JSON.stringify(this.allInstitutions)))},error:e=>{console.log(e)}})}getInstitutions(e){this._bDService.getInstitutions(e).pipe(ve(i=>(console.log("Error fetching institutions:",i),ge([])))).subscribe({next:i=>{i.institutions&&(this.institutions=i.institutions,this.total=i.total,this.pages=i.pages,e>this.pages&&this._router.navigate(["/admin/instituciones"]),this.loading=!1)},error:i=>{console.log(i)}})}setEditInstitution(e){this.status=null,this.items={institutionCity:this.allCities},this.tempInstitution=e,this.editInstitutionForm.patchValue({institutionName:this.tempInstitution.name,institutionWebsite:this.tempInstitution.website,institutionEmail:this.tempInstitution.email,institutionCity:this.tempInstitution.city,institutionTelephone:this.tempInstitution.telephone})}onEditSubmit(){this.status=null,this.submitted=!0,!this.editInstitutionForm.invalid&&(this.institution.name=this.editInstitutionForm.value.institutionName,this.institution.email=this.editInstitutionForm.value.institutionEmail,this.institution.city=this.editInstitutionForm.value.institutionCity,this.institution.website=this.editInstitutionForm.value.institutionWebsite,this.institution.telephone=this.editInstitutionForm.value.institutionTelephone,this._bDService.editInstitution(this.tempInstitution._id,this.institution).subscribe({next:e=>{e.institution&&e.institution._id?(this.status="success",this.submitted=!1,this.getInstitutions(this.page),this.getAllInstitutions()):this.status="error"},error:e=>{e!=null&&(this.status="error",console.log(e))}}))}setDeleteInstitution(e){this.tempInstitutionId=e}delete(){this._bDService.deleteInstitution(this.tempInstitutionId).subscribe({next:e=>{this.tempInstitutionId=null,this.getInstitutions(this.page),this.getAllInstitutions()},error:e=>{console.log(e)}})}actualPage(){this._route.params.subscribe(e=>{let i=+e.page;this.page=i,i?(this.nextPage=i+1,this.prevPage=i-1,this.prevPage<=0&&(this.prevPage=1)):(this.page=1,this.nextPage=this.page+1),this.getInstitutions(this.page)})}getAllCities(){this._bDService.getAllCities().pipe(ve(e=>(console.log("Error fetching cities:",e),ge([])))).subscribe({next:e=>{e.cities&&(this.allCities=e.cities,localStorage.setItem("cities",JSON.stringify(this.allCities)),this.items.institutionCity=this.allCities)},error:e=>{console.log(e)}})}onKeydown(e){e.keyCode===13&&(e.preventDefault(),document.getElementById("save").click())}onChanges(){this.subscriptions.add(this.institutionForm.valueChanges.subscribe(e=>{e&&(this.status=null,this.submitted=!1)})),this.subscriptions.add(this.editInstitutionForm.valueChanges.subscribe(e=>{e&&(this.status=null,this.submitted=!1)}))}static{this.\u0275fac=function(i){return new(i||t)(y(ne),y(ai),y(z),y(j))}}static{this.\u0275cmp=w({type:t,selectors:[["institutions"]],standalone:!1,decls:61,vars:12,consts:[["institutionNameInput",""],[1,"card"],[1,"card-header"],[1,"m-0","text-primary","font-weight-bolder","float-left"],["type","button","data-bs-toggle","modal","data-bs-target","#addInstitution",1,"btn","btn-primary","float-right",3,"click"],[1,"fas","fa-plus"],[1,"ms-2"],["class","card-body",4,"ngIf"],["id","addInstitution","tabindex","-1","role","dialog","aria-labelledby","addInstitution","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-dialog-centered"],[1,"modal-content"],[3,"ngSubmit","input","formGroup"],[1,"modal-header"],["id","addInstitutionTitle",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],["class","alert alert-danger fade show text-center","role","alert",4,"ngIfSuccessMessage","ngIf"],["class","alert alert-success fade show text-center","role","alert",4,"ngIfSuccessMessage","ngIf"],["class","form-group row",4,"ngFor","ngForOf"],[1,"modal-footer"],["data-bs-dismiss","modal",1,"btn","btn-danger"],["id","save","type","submit",1,"btn","btn-success"],["id","editInstitution","tabindex","-1","role","dialog","aria-labelledby","editInstitution","aria-hidden","true",1,"modal","fade"],["id","editInstitutionTitle",1,"modal-title"],["id","save","type","submit",1,"btn","btn-warning"],["id","deleteInstitution","tabindex","-1","role","dialog","aria-labelledby","deleteInstitution","aria-hidden","true",1,"modal","fade"],["id","deleteInstitutionTitle",1,"modal-title"],["role","alert",1,"alert","alert-warning","mb-0"],[1,"fas","fa-exclamation-triangle","icon-message","me-2"],["data-bs-dismiss","modal",1,"btn","btn-danger",3,"click"],["data-bs-dismiss","modal",1,"btn","btn-primary","text-white"],[1,"card-body"],[1,"text-muted","text-center"],["role","status",1,"spinner-border",2,"width","3rem","height","3rem"],[1,"sr-only"],[1,"text-muted"],[1,"form-group","row"],[1,"col"],[1,"input-group","mb-2"],[1,"input-group-prepend"],[1,"input-group-text"],["type","text","id","inlineFormInputGroup","placeholder","Filtro","autocomplete","off",1,"form-control",3,"formControl"],[1,"table","table-sm","table-hover","table-bordered","text-center"],[1,"thead-dark"],[4,"ngIf"],["aria-label","Page navigation",4,"ngIf"],[4,"ngFor","ngForOf"],["type","button","data-bs-toggle","modal","data-bs-target","#editInstitution",1,"btn","btn-warning","btn-sm","mx-1",3,"click"],[1,"fas","fa-pen-square"],["type","button","data-bs-toggle","modal","data-bs-target","#deleteInstitution",1,"btn","btn-danger","btn-sm","mx-1",3,"click"],[1,"fas","fa-trash"],["aria-label","Page navigation"],[1,"pagination","justify-content-end"],["class","page-item",4,"ngIf"],[1,"page-item"],[1,"page-link","bg-primary",3,"routerLink"],[1,"page-link","bg-info",3,"routerLink"],["role","alert",1,"alert","alert-danger","fade","show","text-center"],[1,"fas","fa-times-circle","icon-message","me-2"],["role","alert",1,"alert","alert-success","fade","show","text-center"],[1,"fas","fa-check-circle","icon-message","me-2"],[1,"col-4","col-form-label",3,"for"],["class","col-8",4,"ngIf","ngIfElse"],[1,"col-8"],["type","text","class","form-control","autocomplete","off","autocomplete","off",3,"id","formControlName","placeholder","keydown",4,"ngIf"],["bindLabel","name",3,"items","formControlName","placeholder",4,"ngIf"],["type","text","autocomplete","off","autocomplete","off",1,"form-control",3,"keydown","id","formControlName","placeholder"],["bindLabel","name",3,"items","formControlName","placeholder"],["type","text","autocomplete","off",1,"form-control",3,"keydown","id","formControlName","placeholder","ngClass"],["class","invalid-feedback",4,"ngIf"],[1,"invalid-feedback"],["type","text","class","form-control","autocomplete","off",3,"id","formControlName","placeholder","keydown",4,"ngIf"],["type","text","autocomplete","off",1,"form-control",3,"keydown","id","formControlName","placeholder"],["type","text","autocomplete","off","autocomplete","off",1,"form-control",3,"keydown","id","formControlName","placeholder","ngClass"]],template:function(i,r){i&1&&(o(0,"div",1)(1,"div",2)(2,"h3",3),s(3),n(),o(4,"button",4),_("click",function(){return r.setAdd()}),u(5,"i",5),o(6,"span",6),s(7,"Agregar"),n()()(),p(8,hs,5,0,"div",7)(9,xs,3,0,"div",7)(10,ks,19,4,"div",7),n(),o(11,"div",8)(12,"div",9)(13,"div",10)(14,"form",11),_("ngSubmit",function(){return r.onSubmit()})("input",function(){return r.onChanges()}),o(15,"div",12)(16,"h5",13),s(17,"Agregar una instituci\xF3n"),n(),u(18,"button",14),n(),o(19,"div",15),p(20,Ts,3,0,"div",16)(21,Fs,3,0,"div",17)(22,Ds,8,5,"div",18),n(),o(23,"div",19)(24,"button",20),s(25,"Cancelar"),n(),o(26,"button",21),s(27,"Guardar"),n()()()()()(),o(28,"div",22)(29,"div",9)(30,"div",10)(31,"form",11),_("ngSubmit",function(){return r.onEditSubmit()})("input",function(){return r.onChanges()}),o(32,"div",12)(33,"h5",23),s(34,"Editar instituci\xF3n"),n(),u(35,"button",14),n(),o(36,"div",15),p(37,Ns,3,0,"div",16)(38,Us,3,0,"div",17)(39,Ws,8,5,"div",18),n(),o(40,"div",19)(41,"button",20),s(42,"Cancelar"),n(),o(43,"button",24),s(44,"Editar"),n()()()()()(),o(45,"div",25)(46,"div",9)(47,"div",10)(48,"div",12)(49,"h5",26),s(50,"Eliminar instituci\xF3n"),n(),u(51,"button",14),n(),o(52,"div",15)(53,"div",27),u(54,"i",28),s(55," \xBFEsta seguro que desea eliminar este registro? "),n()(),o(56,"div",19)(57,"button",29),_("click",function(){return r.delete()}),s(58,"S\xED"),n(),o(59,"button",30),s(60,"No"),n()()()()()),i&2&&(a(3),h(r.title),a(5),l("ngIf",r.loading),a(),l("ngIf",r.institutions.length==0&&!r.loading),a(),l("ngIf",r.institutions.length!=0),a(4),l("formGroup",r.institutionForm),a(6),l("ngIf",r.status==="error"),a(),l("ngIf",r.status==="success"),a(),l("ngForOf",r.fieldsForm),a(9),l("formGroup",r.editInstitutionForm),a(6),l("ngIf",r.status==="error"),a(),l("ngIf",r.status==="success"),a(),l("ngForOf",r.fieldsForm))},dependencies:[G,T,F,q,N,D,$,Ce,le,H,Y,Ie,R,ye],encapsulation:2})}}return t})();var Wi=t=>["/admin/profesiones",t],Ji=t=>({"is-invalid":t});function Js(t,d){t&1&&(o(0,"div",30)(1,"div",31)(2,"div",32)(3,"span",33),s(4,"Loading..."),n()()()())}function Hs(t,d){t&1&&(o(0,"div",30)(1,"h4",34),s(2," No se han registrado profesiones. "),n()())}function Ys(t,d){if(t&1){let e=C();o(0,"tr")(1,"td"),s(2),n(),o(3,"td")(4,"button",45),_("click",function(){let r=f(e).$implicit,m=c(3);return g(m.setEditProfession(r))}),u(5,"i",46),o(6,"span",6)(7,"small"),s(8,"Editar"),n()()(),o(9,"button",47),_("click",function(){let r=f(e).$implicit,m=c(3);return g(m.setDeleteProfession(r._id))}),u(10,"i",48),o(11,"span",6)(12,"small"),s(13,"Eliminar"),n()()()()()}if(t&2){let e=d.$implicit;a(2),h(e.name)}}function Qs(t,d){if(t&1&&(o(0,"tbody"),p(1,Ys,14,1,"tr",44),n()),t&2){let e=c(2);a(),l("ngForOf",e.professions)}}function Xs(t,d){if(t&1){let e=C();o(0,"tr")(1,"td"),s(2),n(),o(3,"td")(4,"button",45),_("click",function(){let r=f(e).$implicit,m=c(3);return g(m.setEditProfession(r))}),u(5,"i",46),o(6,"span",6)(7,"small"),s(8,"Editar"),n()()(),o(9,"button",47),_("click",function(){let r=f(e).$implicit,m=c(3);return g(m.setDeleteProfession(r._id))}),u(10,"i",48),o(11,"span",6)(12,"small"),s(13,"Eliminar"),n()()()()()}if(t&2){let e=d.$implicit;a(2),h(e.name)}}function Zs(t,d){if(t&1&&(o(0,"tbody"),p(1,Xs,14,1,"tr",44),I(2,"filter"),n()),t&2){let e=c(2);a(),l("ngForOf",L(2,1,e.allProfessions,e.filter.value))}}function el(t,d){if(t&1&&(o(0,"li",52)(1,"a",53),s(2,"Anterior"),n()()),t&2){let e=c(3);a(),l("routerLink",x(1,Wi,e.prevPage))}}function tl(t,d){if(t&1&&(o(0,"li",52)(1,"a",54),s(2,"Siguiente"),n()()),t&2){let e=c(3);a(),l("routerLink",x(1,Wi,e.nextPage))}}function il(t,d){if(t&1&&(o(0,"nav",49)(1,"ul",50),p(2,el,3,3,"li",51)(3,tl,3,3,"li",51),n()()),t&2){let e=c(2);a(2),l("ngIf",e.page>1),a(),l("ngIf",e.page<e.pages)}}function nl(t,d){if(t&1&&(o(0,"div",30)(1,"div",35)(2,"div",3)(3,"form")(4,"div",36)(5,"div",37)(6,"div",38),s(7,"Filtrar:"),n()(),u(8,"input",39),n()()()(),o(9,"table",40)(10,"thead",41)(11,"tr")(12,"th"),s(13,"Profesi\xF3n"),n(),o(14,"th"),s(15,"Opciones"),n()()(),p(16,Qs,2,1,"tbody",42)(17,Zs,3,4,"tbody",42),n(),p(18,il,4,2,"nav",43),n()),t&2){let e=c();a(8),l("formControl",e.filter),a(8),l("ngIf",!e.filter.value),a(),l("ngIf",e.filter.value),a(),l("ngIf",!e.filter.value)}}function ol(t,d){t&1&&(o(0,"div",55),u(1,"i",56),s(2," La profesi\xF3n no fue agregada correctamente. Intentalo de nuevo. "),n())}function rl(t,d){t&1&&(o(0,"div",57),u(1,"i",58),s(2," La profesi\xF3n fue agregada correctamente. "),n())}function al(t,d){if(t&1&&(o(0,"div"),s(1),n()),t&2){let e=c(2).$implicit;a(),b(" El campo ",e.label," es obligatorio. ")}}function sl(t,d){if(t&1&&(o(0,"div",63),p(1,al,2,1,"div",42),n()),t&2){let e=c().$implicit,i=c();a(),l("ngIf",i.f[e.id].errors.required)}}function ll(t,d){if(t&1){let e=C();o(0,"div",35)(1,"label",59)(2,"strong"),s(3),n()(),o(4,"div",60)(5,"input",61),_("keydown",function(r){f(e);let m=c();return g(m.onKeydown(r))}),n(),p(6,sl,2,1,"div",62),n()()}if(t&2){let e=d.$implicit,i=c();a(),v("for",e.id),a(2),b("",e.label,"*"),a(2),v("id",e.id),v("formControlName",e.id),v("placeholder",e.label),l("ngClass",x(7,Ji,i.submitted&&i.f[e.id].errors)),a(),l("ngIf",i.submitted&&i.f[e.id].errors)}}function dl(t,d){t&1&&(o(0,"div",55),u(1,"i",56),s(2," La profesi\xF3n no fue editada correctamente. Intentalo de nuevo. "),n())}function cl(t,d){t&1&&(o(0,"div",57),u(1,"i",58),s(2," Se ha editado correctamente la profesi\xF3n. "),n())}function ml(t,d){if(t&1&&(o(0,"div"),s(1),n()),t&2){let e=c(2).$implicit;a(),b(" El campo ",e.label," es obligatorio. ")}}function pl(t,d){if(t&1&&(o(0,"div",63),p(1,ml,2,1,"div",42),n()),t&2){let e=c().$implicit,i=c();a(),l("ngIf",i.f2[e.id].errors.required)}}function ul(t,d){if(t&1){let e=C();o(0,"div",35)(1,"label",59)(2,"strong"),s(3),n()(),o(4,"div",60)(5,"input",61),_("keydown",function(r){f(e);let m=c();return g(m.onKeydown(r))}),n(),p(6,pl,2,1,"div",62),n()()}if(t&2){let e=d.$implicit,i=c();a(),v("for",e.id),a(2),b("",e.label,"*"),a(2),v("id",e.id),v("formControlName",e.id),v("placeholder",e.label),l("ngClass",x(7,Ji,i.submitted&&i.f2[e.id].errors)),a(),l("ngIf",i.submitted&&i.f2[e.id].errors)}}var Dt=(()=>{class t{constructor(e,i,r){this._bDService=e,this._route=i,this._router=r,this.fieldsForm=[{id:"professionName",label:"Profesi\xF3n",attr:"name",required:!0}],this.submitted=!1,this.profession=new lt(""),this.professions=[],this.allProfessions=[],this.loading=!0,this.title="Profesiones",this.professionForm=new oe({professionName:new k("",[S.required])}),this.editProfessionForm=new oe({professionName:new k("",[S.required])}),this.filter=new k}ngOnInit(){this.actualPage(),this.getAllProfessions()}get f(){return this.professionForm.controls}get f2(){return this.editProfessionForm.controls}setAdd(){this.status=null,this.submitted=!1}onSubmit(){this.submitted=!0,!this.professionForm.invalid&&(this.profession.name=this.professionForm.value.professionName,this._bDService.addProfession(this.profession).subscribe(e=>{e.profession&&e.profession._id?(this.professionForm.reset(),this.status="success",this.submitted=!1,this.getProfessions(this.page),this.getAllProfessions()):this.status="error"},e=>{e!=null&&(this.status="error",console.log(e))}))}getAllProfessions(){this._bDService.getAllProfessions().subscribe(e=>{e.professions&&(this.allProfessions=e.professions,localStorage.setItem("professions",JSON.stringify(this.allProfessions)))},e=>{console.log(e)})}getProfessions(e){this._bDService.getProfessions(e).subscribe(i=>{i.professions&&(this.professions=i.professions,this.total=i.total,this.pages=i.pages,e>this.pages&&this._router.navigate(["/admin/profesiones"]),this.loading=!1)},i=>{console.log(i)})}setEditProfession(e){this.status=null,this.submitted=!1,this.tempProfession=e,this.editProfessionForm.patchValue({professionName:this.tempProfession.name})}onEditSubmit(){this.status=null,this.submitted=!0,!this.editProfessionForm.invalid&&(this.profession.name=this.editProfessionForm.value.professionName,this._bDService.editProfession(this.tempProfession._id,this.profession).subscribe(e=>{e.profession&&e.profession._id?(this.status="success",this.submitted=!1,this.getProfessions(this.page),this.getAllProfessions()):this.status="error"},e=>{e!=null&&(this.status="error",console.log(e))}))}setDeleteProfession(e){this.tempProfessionId=e}delete(){this._bDService.deleteProfession(this.tempProfessionId).subscribe(e=>{this.tempProfessionId=null,this.getProfessions(this.page),this.getAllProfessions()},e=>{console.log(e)})}actualPage(){this._route.params.subscribe(e=>{let i=+e.page;this.page=i,i?(this.nextPage=i+1,this.prevPage=i-1,this.prevPage<=0&&(this.prevPage=1)):(this.page=1,this.nextPage=this.page+1),this.getProfessions(this.page)})}onKeydown(e){e.keyCode===13&&(e.preventDefault(),document.getElementById("save").click())}onChanges(){this.professionForm.valueChanges.subscribe(e=>{e&&(this.status=null,this.submitted=!1)}),this.editProfessionForm.valueChanges.subscribe(e=>{e&&(this.status=null,this.submitted=!1)})}static{this.\u0275fac=function(i){return new(i||t)(y(ne),y(z),y(j))}}static{this.\u0275cmp=w({type:t,selectors:[["professions"]],standalone:!1,decls:62,vars:12,consts:[[1,"card"],[1,"card-header"],[1,"m-0","text-primary","font-weight-bolder","float-left"],[1,"col"],["type","button","data-bs-toggle","modal","data-bs-target","#addProfession",1,"btn","btn-primary","float-right",3,"click"],[1,"fas","fa-plus"],[1,"ms-2"],["class","card-body",4,"ngIf"],["id","addProfession","tabindex","-1","role","dialog","aria-labelledby","addProfession","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-dialog-centered"],[1,"modal-content"],[3,"ngSubmit","input","formGroup"],[1,"modal-header"],["id","addProfession",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],["class","alert alert-danger fade show text-center","role","alert",4,"ngIfSuccessMessage","ngIf"],["class","alert alert-success fade show text-center","role","alert",4,"ngIfSuccessMessage","ngIf"],["class","form-group row",4,"ngFor","ngForOf"],[1,"modal-footer"],["data-bs-dismiss","modal",1,"btn","btn-danger"],["id","save","type","submit",1,"btn","btn-success"],["id","editProfession","tabindex","-1","role","dialog","aria-labelledby","editProfession","aria-hidden","true",1,"modal","fade"],["id","editProfession",1,"modal-title"],["id","save","type","submit",1,"btn","btn-warning"],["id","deleteProfession","tabindex","-1","role","dialog","aria-labelledby","deleteProfession","aria-hidden","true",1,"modal","fade"],["role","alert",1,"alert","alert-warning","mb-0"],[1,"fas","fa-exclamation-triangle","icon-message","me-2"],["data-bs-dismiss","modal",1,"btn","btn-danger",3,"click"],["data-bs-dismiss","modal",1,"btn","btn-primary","text-white"],[1,"card-body"],[1,"text-muted","text-center"],["role","status",1,"spinner-border",2,"width","3rem","height","3rem"],[1,"sr-only"],[1,"text-muted"],[1,"form-group","row"],[1,"input-group","mb-2"],[1,"input-group-prepend"],[1,"input-group-text"],["type","text","id","inlineFormInputGroup","placeholder","Filtro",1,"form-control",3,"formControl"],[1,"table","table-sm","table-hover","table-bordered","text-center"],[1,"thead-dark"],[4,"ngIf"],["aria-label","Page navigation",4,"ngIf"],[4,"ngFor","ngForOf"],["type","button","data-bs-toggle","modal","data-bs-target","#editProfession",1,"btn","btn-warning","btn-sm","mx-1",3,"click"],[1,"fas","fa-pen-square"],["type","button","data-bs-toggle","modal","data-bs-target","#deleteProfession",1,"btn","btn-danger","btn-sm","mx-1",3,"click"],[1,"fas","fa-trash"],["aria-label","Page navigation"],[1,"pagination","justify-content-end"],["class","page-item",4,"ngIf"],[1,"page-item"],[1,"page-link","bg-primary",3,"routerLink"],[1,"page-link","bg-info",3,"routerLink"],["role","alert",1,"alert","alert-danger","fade","show","text-center"],[1,"fas","fa-times-circle","icon-message","me-2"],["role","alert",1,"alert","alert-success","fade","show","text-center"],[1,"fas","fa-check-circle","icon-message","me-2"],[1,"col-5","col-form-label",3,"for"],[1,"col-7"],["type","text","autocomplete","off",1,"form-control",3,"keydown","id","formControlName","placeholder","ngClass"],["class","invalid-feedback",4,"ngIf"],[1,"invalid-feedback"]],template:function(i,r){i&1&&(o(0,"div",0)(1,"div",1)(2,"h3",2),s(3),n(),o(4,"div",3)(5,"button",4),_("click",function(){return r.setAdd()}),u(6,"i",5),o(7,"span",6),s(8,"Agregar"),n()()()(),p(9,Js,5,0,"div",7)(10,Hs,3,0,"div",7)(11,nl,19,4,"div",7),n(),o(12,"div",8)(13,"div",9)(14,"div",10)(15,"form",11),_("ngSubmit",function(){return r.onSubmit()})("input",function(){return r.onChanges()}),o(16,"div",12)(17,"h5",13),s(18,"Agregar una \xE1rea de conocimiento"),n(),u(19,"button",14),n(),o(20,"div",15),p(21,ol,3,0,"div",16)(22,rl,3,0,"div",17)(23,ll,7,9,"div",18),n(),o(24,"div",19)(25,"button",20),s(26,"Cancelar"),n(),o(27,"button",21),s(28,"Guardar"),n()()()()()(),o(29,"div",22)(30,"div",9)(31,"div",10)(32,"form",11),_("ngSubmit",function(){return r.onEditSubmit()})("input",function(){return r.onChanges()}),o(33,"div",12)(34,"h5",23),s(35,"Editar profesi\xF3n"),n(),u(36,"button",14),n(),o(37,"div",15),p(38,dl,3,0,"div",16)(39,cl,3,0,"div",17)(40,ul,7,9,"div",18),n(),o(41,"div",19)(42,"button",20),s(43,"Cancelar"),n(),o(44,"button",24),s(45,"Editar"),n()()()()()(),o(46,"div",25)(47,"div",9)(48,"div",10)(49,"div",12)(50,"h5",23),s(51,"Eliminar profesi\xF3n"),n(),u(52,"button",14),n(),o(53,"div",15)(54,"div",26),u(55,"i",27),s(56," \xBFEsta seguro que desea eliminar este registro? "),n()(),o(57,"div",19)(58,"button",28),_("click",function(){return r.delete()}),s(59,"S\xED"),n(),o(60,"button",29),s(61,"No"),n()()()()()),i&2&&(a(3),h(r.title),a(6),l("ngIf",r.loading),a(),l("ngIf",r.professions.length==0&&!r.loading),a(),l("ngIf",r.professions.length!=0),a(4),l("formGroup",r.professionForm),a(6),l("ngIf",r.status==="error"),a(),l("ngIf",r.status==="success"),a(),l("ngForOf",r.fieldsForm),a(9),l("formGroup",r.editProfessionForm),a(6),l("ngIf",r.status==="error"),a(),l("ngIf",r.status==="success"),a(),l("ngForOf",r.fieldsForm))},dependencies:[G,T,F,q,N,D,$,Ce,le,H,Y,R,ye],encapsulation:2})}}return t})();var Hi=t=>({"is-invalid":t});function _l(t,d){t&1&&(o(0,"div",30)(1,"div",31)(2,"div",32)(3,"span",33),s(4,"Loading..."),n()()()())}function fl(t,d){t&1&&(o(0,"div",30)(1,"h4",34),s(2,"No se han registrado \xE1reas de conocimiento."),n()())}function gl(t,d){if(t&1){let e=C();o(0,"tr")(1,"td"),s(2),n(),o(3,"td")(4,"button",39),_("click",function(){let r=f(e).$implicit,m=c(2);return g(m.setEditArea(r))}),u(5,"i",40),o(6,"span",5)(7,"small"),s(8,"Editar"),n()()(),o(9,"button",41),_("click",function(){let r=f(e).$implicit,m=c(2);return g(m.setDeleteArea(r._id))}),u(10,"i",42),o(11,"span",5)(12,"small"),s(13,"Eliminar"),n()()()()()}if(t&2){let e=d.$implicit;a(2),h(e.name)}}function vl(t,d){if(t&1&&(o(0,"div",30)(1,"table",35)(2,"thead",36)(3,"tr")(4,"th",37),s(5,"\xC1rea de conocimiento"),n(),o(6,"th",37),s(7,"Opciones"),n()()(),o(8,"tbody"),p(9,gl,14,1,"tr",38),n()()()),t&2){let e=c();a(9),l("ngForOf",e.knowledgeAreas)}}function hl(t,d){t&1&&(o(0,"div",43),u(1,"i",44),s(2," El \xE1rea de conocimiento no fue agregada correctamente. Intentalo de nuevo. "),n())}function xl(t,d){t&1&&(o(0,"div",45),u(1,"i",46),s(2," El \xE1rea de conocimiento fue agregada correctamente. "),n())}function bl(t,d){t&1&&(o(0,"div"),s(1,"El campo \xC1rea de conocimiento es obligatorio."),n())}function Cl(t,d){if(t&1&&(o(0,"div",47),p(1,bl,2,0,"div",48),n()),t&2){let e=c();a(),l("ngIf",e.f.areaName.errors.required)}}function yl(t,d){t&1&&(o(0,"div",43),u(1,"i",44),s(2," El \xE1rea de conocimiento no fue editada correctamente. Intentalo de nuevo. "),n())}function El(t,d){t&1&&(o(0,"div",45),u(1,"i",46),s(2," Se ha editado correctamente el \xE1rea de conocimiento. "),n())}function Sl(t,d){t&1&&(o(0,"div"),s(1,"El campo \xC1rea de conocimiento es obligatorio."),n())}function Il(t,d){if(t&1&&(o(0,"div",47),p(1,Sl,2,0,"div",48),n()),t&2){let e=c();a(),l("ngIf",e.f2.areaName.errors.required)}}var Nt=(()=>{class t{constructor(e){this._bDService=e,this.knowledgeAreas=[],this.loading=!0,this.status=null,this.submitted=!1,this.title="\xC1reas de Conocimiento",this.addForm=new oe({areaName:new k("",S.required)}),this.editForm=new oe({areaName:new k("",S.required)})}ngOnInit(){this.getAllAreas()}getAllAreas(){return ie(this,null,function*(){try{let e=yield Se(this._bDService.getAllKnowledgeAreas());this.knowledgeAreas=e.areas,this.loading=!1}catch(e){console.error(e),this.loading=!1}})}get f(){return this.addForm.controls}get f2(){return this.editForm.controls}setAdd(){this.status=null,this.submitted=!1}onSubmit(){return ie(this,null,function*(){if(this.status=null,this.submitted=!0,this.addForm.invalid)return;let e={_id:"",name:this.addForm.value.areaName,used:!1};try{let i=yield Se(this._bDService.addKnowledgeArea(e));i.area&&i.area._id?(this.addForm.reset(),this.status="success",this.submitted=!1,this.getAllAreas()):this.status="error"}catch(i){this.status="error",console.error(i)}})}setEditArea(e){this.status=null,this.tempArea=e,this.editForm.patchValue({areaName:e.name})}onEditSubmit(){return ie(this,null,function*(){if(this.status=null,this.submitted=!0,!this.editForm.invalid){this.tempArea.name=this.editForm.value.areaName;try{let e=yield Se(this._bDService.editKnowledgeArea(this.tempArea._id,this.tempArea));e.area&&e.area._id?(this.status="success",this.submitted=!1,this.getAllAreas()):this.status="error"}catch(e){this.status="error",console.error(e)}}})}setDeleteArea(e){return ie(this,null,function*(){try{let i=yield Se(this._bDService.deleteKnowledgeArea(e));this.getAllAreas()}catch(i){console.error(i)}})}onChanges(){this.addForm.valueChanges.subscribe(()=>{this.status=null,this.submitted=!1}),this.editForm.valueChanges.subscribe(()=>{this.status=null,this.submitted=!1})}onKeydown(e){if(e.key==="Enter"){e.preventDefault();let i=document.getElementById("save");i&&i.click()}}static{this.\u0275fac=function(i){return new(i||t)(y(ne))}}static{this.\u0275cmp=w({type:t,selectors:[["knowledge-areas"]],standalone:!1,decls:57,vars:18,consts:[[1,"card"],[1,"card-header"],[1,"m-0","text-primary","font-weight-bolder","float-left"],["type","button","data-bs-toggle","modal","data-bs-target","#addArea",1,"btn","btn-primary","float-right",3,"click"],[1,"fas","fa-plus"],[1,"ms-2"],["class","card-body",4,"ngIf"],["id","addArea","tabindex","-1","role","dialog","aria-labelledby","addArea","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-dialog-centered"],[1,"modal-content"],[3,"ngSubmit","input","formGroup"],[1,"modal-header"],["id","addAreaTitle",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],["class","alert alert-danger fade show text-center","role","alert",4,"ngIf"],["class","alert alert-success fade show text-center","role","alert",4,"ngIf"],[1,"form-group","row"],["for","areaName",1,"col-5","col-form-label"],[1,"col-7"],["type","text","id","areaName","formControlName","areaName","placeholder","\xC1rea de conocimiento","autocomplete","off",1,"form-control",3,"keydown","ngClass"],["class","invalid-feedback",4,"ngIf"],[1,"modal-footer"],["data-bs-dismiss","modal",1,"btn","btn-danger"],["id","save","type","submit",1,"btn","btn-success"],["id","editArea","tabindex","-1","role","dialog","aria-labelledby","editArea","aria-hidden","true",1,"modal","fade"],["id","editAreaTitle",1,"modal-title"],["for","editAreaName",1,"col-5","col-form-label"],["type","text","id","editAreaName","formControlName","areaName","placeholder","\xC1rea de conocimiento","autocomplete","off",1,"form-control",3,"keydown","ngClass"],["id","save","type","submit",1,"btn","btn-warning"],[1,"card-body"],[1,"text-muted","text-center"],["role","status",1,"spinner-border",2,"width","3rem","height","3rem"],[1,"sr-only"],[1,"text-muted"],[1,"table","table-sm","table-hover","table-bordered","text-center"],[1,"thead-dark"],["scope","col"],[4,"ngFor","ngForOf"],["type","button","data-bs-toggle","modal","data-bs-target","#editArea",1,"btn","btn-warning","btn-sm","mx-1",3,"click"],[1,"fas","fa-pen-square"],["type","button",1,"btn","btn-danger","btn-sm","mx-1",3,"click"],[1,"fas","fa-trash"],["role","alert",1,"alert","alert-danger","fade","show","text-center"],[1,"fas","fa-times-circle","icon-message","me-2"],["role","alert",1,"alert","alert-success","fade","show","text-center"],[1,"fas","fa-check-circle","icon-message","me-2"],[1,"invalid-feedback"],[4,"ngIf"]],template:function(i,r){i&1&&(o(0,"div",0)(1,"div",1)(2,"h3",2),s(3),n(),o(4,"button",3),_("click",function(){return r.setAdd()}),u(5,"i",4),o(6,"span",5),s(7,"Agregar"),n()()(),p(8,_l,5,0,"div",6)(9,fl,3,0,"div",6)(10,vl,10,1,"div",6),n(),o(11,"div",7)(12,"div",8)(13,"div",9)(14,"form",10),_("ngSubmit",function(){return r.onSubmit()})("input",function(){return r.onChanges()}),o(15,"div",11)(16,"h5",12),s(17,"Agregar una \xE1rea de conocimiento"),n(),u(18,"button",13),n(),o(19,"div",14),p(20,hl,3,0,"div",15)(21,xl,3,0,"div",16),o(22,"div",17)(23,"label",18)(24,"strong"),s(25,"\xC1rea de conocimiento*"),n()(),o(26,"div",19)(27,"input",20),_("keydown",function(E){return r.onKeydown(E)}),n(),p(28,Cl,2,1,"div",21),n()()(),o(29,"div",22)(30,"button",23),s(31,"Cancelar"),n(),o(32,"button",24),s(33,"Guardar"),n()()()()()(),o(34,"div",25)(35,"div",8)(36,"div",9)(37,"form",10),_("ngSubmit",function(){return r.onEditSubmit()})("input",function(){return r.onChanges()}),o(38,"div",11)(39,"h5",26),s(40,"Editar \xE1rea de conocimiento"),n(),u(41,"button",13),n(),o(42,"div",14),p(43,yl,3,0,"div",15)(44,El,3,0,"div",16),o(45,"div",17)(46,"label",27)(47,"strong"),s(48,"\xC1rea de conocimiento*"),n()(),o(49,"div",19)(50,"input",28),_("keydown",function(E){return r.onKeydown(E)}),n(),p(51,Il,2,1,"div",21),n()()(),o(52,"div",22)(53,"button",23),s(54,"Cancelar"),n(),o(55,"button",29),s(56,"Editar"),n()()()()()()),i&2&&(a(3),h(r.title),a(5),l("ngIf",r.loading),a(),l("ngIf",!r.loading&&r.knowledgeAreas.length===0),a(),l("ngIf",!r.loading&&r.knowledgeAreas.length>0),a(4),l("formGroup",r.addForm),a(6),l("ngIf",r.status==="error"),a(),l("ngIf",r.status==="success"),a(6),l("ngClass",x(14,Hi,r.submitted&&r.f.areaName.errors)),a(),l("ngIf",r.submitted&&r.f.areaName.errors),a(9),l("formGroup",r.editForm),a(6),l("ngIf",r.status==="error"),a(),l("ngIf",r.status==="success"),a(6),l("ngClass",x(16,Hi,r.submitted&&r.f2.areaName.errors)),a(),l("ngIf",r.submitted&&r.f2.areaName.errors))},dependencies:[G,T,F,q,N,D,$,H,Y],encapsulation:2})}}return t})();var Yi=t=>["/perfil",t];function wl(t,d){if(t&1&&(o(0,"small",28),s(1),n()),t&2){let e=d.$implicit;v("title",e.name),a(),h(e.name)}}function kl(t,d){if(t&1&&(o(0,"div",26),p(1,wl,2,2,"small",27),n()),t&2){let e=c(2);a(),l("ngForOf",e.lesson.knowledge_area)}}function Tl(t,d){if(t&1&&(o(0,"div",7)(1,"label",8)(2,"strong"),s(3,"\xC1reas de conocimiento:"),n()(),o(4,"div",9),p(5,kl,2,1,"div",25),n()()),t&2){let e=c();a(5),l("ngIf",e.lesson.knowledge_area.length>0)}}function Fl(t,d){if(t&1&&(o(0,"p",29),s(1),n()),t&2){let e=d.$implicit;a(),b(" ",e," ")}}function Ll(t,d){if(t&1&&(o(0,"p",29),s(1),n()),t&2){let e=d.$implicit;a(),b(" ",e," ")}}function Pl(t,d){if(t&1&&(o(0,"div",7)(1,"label",8)(2,"strong"),s(3,"Justificaci\xF3n:"),n()(),o(4,"div",9),p(5,Ll,2,1,"p",11),n()()),t&2){let e=c();a(5),l("ngForOf",e.lesson.justification.split(`
`))}}function Vl(t,d){if(t&1&&(o(0,"p",29),s(1),n()),t&2){let e=d.$implicit;a(),b(" ",e," ")}}function Ml(t,d){if(t&1&&(o(0,"div",7)(1,"label",8)(2,"strong"),s(3,"Nivel de desarrollo:"),n()(),o(4,"div",9)(5,"p"),s(6),n()()()),t&2){let e=c();a(6),h(e.level[e.lesson.development_level])}}function Al(t,d){if(t&1&&(o(0,"div",7)(1,"label",8)(2,"strong"),s(3,"Tipo:"),n()(),o(4,"div",9)(5,"p"),s(6),n()()()),t&2){let e=c();a(6),h(e.type[e.lesson.type])}}function Ol(t,d){t&1&&(o(0,"strong"),s(1,"Sugerido por:"),n())}function Rl(t,d){t&1&&(o(0,"strong"),s(1,"Experiencia enviada por:"),n())}function Dl(t,d){t&1&&u(0,"img",30)}function Nl(t,d){if(t&1&&u(0,"img",31),t&2){let e=c();v("src",e.url+"get-image-user/"+e.lesson.author.picture,M)}}var ft=(()=>{class t{constructor(e){this._userService=e,this.level={basic:"B\xE1sico",medium:"Medio",advanced:"Avanzado"},this.type={consideration:"Consideraci\xF3n",development:"Desarrollo"},this.title="Agregar recurso",this.identity=this._userService.getIdentity(),this.token=this._userService.getToken(),this.url=A.url}ngOnInit(){}static{this.\u0275fac=function(i){return new(i||t)(y(P))}}static{this.\u0275cmp=w({type:t,selectors:[["details-lesson"]],inputs:{lesson:"lesson",parent:"parent"},standalone:!1,decls:55,vars:28,consts:[["id","details","tabindex","-1","role","dialog","aria-labelledby","details","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-lg","modal-dialog-scrollable"],[1,"modal-content"],[1,"modal-header"],["id","detailsTitle",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],[1,"row"],[1,"col-3"],[1,"col-9"],["class","row",4,"ngIf"],["class","text-break",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"col-auto","pe-0"],[1,"text-primary"],[1,"flex-shrink-0","rounded-circle","border-1","overflow-hidden",2,"width","40px","height","40px","background-color","aqua"],["data-bs-dismiss","modal",3,"routerLink"],["class","img-fluid","src","assets/images/user-default.png",4,"ngIf"],["class","img-fluid",3,"src",4,"ngIf"],[1,"col","rounded","px-2"],[1,"mb-1"],["data-bs-dismiss","modal",1,"text-primary",3,"routerLink"],[1,"text-muted"],[1,"modal-footer"],["data-bs-dismiss","modal",1,"btn","btn-secondary"],["style","display: flex; flex-wrap: wrap;",4,"ngIf"],[2,"display","flex","flex-wrap","wrap"],["class","badge badge-info me-1 mb-1 text-truncate",3,"title",4,"ngFor","ngForOf"],[1,"badge","badge-info","me-1","mb-1","text-truncate",3,"title"],[1,"text-break"],["src","assets/images/user-default.png",1,"img-fluid"],[1,"img-fluid",3,"src"]],template:function(i,r){i&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h5",4),s(5,"Detalles de la lecci\xF3n propuesta"),n(),u(6,"button",5),n(),o(7,"div",6)(8,"div",7)(9,"label",8)(10,"strong"),s(11,"T\xEDtulo:"),n()(),o(12,"div",9)(13,"p"),s(14),n()()(),p(15,Tl,6,1,"div",10),o(16,"div",7)(17,"label",8)(18,"strong"),s(19,"Resumen:"),n()(),o(20,"div",9),p(21,Fl,2,1,"p",11),n()(),p(22,Pl,6,1,"div",10),o(23,"div",7)(24,"label",8)(25,"strong"),s(26,"Referencias:"),n()(),o(27,"div",9),p(28,Vl,2,1,"p",11),n()(),p(29,Ml,7,1,"div",10)(30,Al,7,1,"div",10),o(31,"div",7)(32,"label",8),p(33,Ol,2,0,"strong",12)(34,Rl,2,0,"strong",12),n(),o(35,"div",13)(36,"a",14)(37,"div",15)(38,"a",16),p(39,Dl,1,0,"img",17)(40,Nl,1,1,"img",18),n()()()(),o(41,"div",19)(42,"h6",20)(43,"a",21)(44,"strong"),s(45),n()(),u(46,"br"),o(47,"small",22),s(48),I(49,"amFromUnix"),I(50,"amLocale"),I(51,"amDateFormat"),n()()()()(),o(52,"div",23)(53,"button",24),s(54,"Cerrar"),n()()()()()),i&2&&(a(14),h(r.lesson.title),a(),l("ngIf",r.parent=="experiences"),a(6),l("ngForOf",r.lesson.resume.split(`
`)),a(),l("ngIf",r.parent=="proposed-lesson"),a(6),l("ngForOf",r.lesson.references.split(`
`)),a(),l("ngIf",r.parent=="experiences"),a(),l("ngIf",r.parent=="experiences"),a(3),l("ngIf",r.parent=="proposed-lesson"),a(),l("ngIf",r.parent=="experiences"),a(4),l("routerLink",x(24,Yi,r.lesson.author._id)),a(),l("ngIf",!r.lesson.author.picture),a(),l("ngIf",r.lesson.author.picture),a(3),l("routerLink",x(26,Yi,r.lesson.author._id)),a(2),V(" ",r.lesson.author.name," ",r.lesson.author.surname," "),a(3),h(L(51,21,L(50,18,X(49,16,r.lesson.created_at),"es"),"LLL")))},dependencies:[T,F,R,ue,_e,fe],encapsulation:2})}}return t})();var Xi=t=>["/perfil",t],Zi=t=>["/admin/experiencias",t];function Ul(t,d){t&1&&(o(0,"div",6)(1,"div",7)(2,"div",8)(3,"span",9),s(4,"Loading..."),n()()()())}function $l(t,d){t&1&&(o(0,"div",6)(1,"h4",10),s(2," Parece que todo el trabajo aqu\xED, ya fue realizado. "),u(3,"i",11),n()())}function ql(t,d){if(t&1&&(o(0,"small",44),s(1),n()),t&2){let e=d.$implicit;v("title",e.name),a(),h(e.name)}}function jl(t,d){if(t&1&&(o(0,"div",42),p(1,ql,2,2,"small",43),n()),t&2){let e=c().$implicit;a(),l("ngForOf",e.knowledge_area)}}function Bl(t,d){if(t&1&&(o(0,"p",45),s(1),n()),t&2){let e=d.$implicit;a(),b(" ",e," ")}}function Gl(t,d){t&1&&u(0,"img",46)}function zl(t,d){if(t&1&&u(0,"img",47),t&2){let e=c().$implicit,i=c(2);v("src",i.url+"get-image-user/"+e.author.picture,M)}}function Kl(t,d){if(t&1){let e=C();o(0,"div")(1,"div",0)(2,"div",6)(3,"div",16)(4,"div",17)(5,"div",18)(6,"div",17)(7,"div",19)(8,"div",20),u(9,"i",21),n()()()(),o(10,"div",22)(11,"h5",23)(12,"strong"),s(13),n(),u(14,"br"),n(),p(15,jl,2,1,"div",24)(16,Bl,2,1,"p",25),o(17,"p")(18,"strong"),s(19,"Enviada por:"),n()(),o(20,"div",17)(21,"div",26)(22,"a",27)(23,"div",28)(24,"a",29),p(25,Gl,1,0,"img",30)(26,zl,1,1,"img",31),n()()()(),o(27,"div",32)(28,"h6",33)(29,"a",34)(30,"strong"),s(31),n()(),u(32,"br"),o(33,"small",10),s(34),I(35,"amFromUnix"),I(36,"amLocale"),I(37,"amDateFormat"),n()()()()(),o(38,"div",35)(39,"div",17)(40,"div",19)(41,"button",36),_("click",function(){let r=f(e).$implicit,m=c(2);return g(m.setDetailLesson(r))}),u(42,"i",37),n(),o(43,"button",38),_("click",function(){let r=f(e).$implicit,m=c(2);return g(m.editLesson(r))}),u(44,"i",39),n(),o(45,"button",40),_("click",function(){let r=f(e).$implicit,m=c(2);return g(m.setDeleteLesson(r._id))}),u(46,"i",41),n()()()()()()()()()}if(t&2){let e=d.$implicit;a(13),h(e.title),a(2),l("ngIf",e.knowledge_area.length>0),a(),l("ngForOf",e.resume.split(`
`)),a(8),l("routerLink",x(18,Xi,e.author._id)),a(),l("ngIf",!e.author.picture),a(),l("ngIf",e.author.picture),a(3),l("routerLink",x(20,Xi,e.author._id)),a(2),V(" ",e.author.name," ",e.author.surname," "),a(3),h(L(37,15,L(36,12,X(35,10,e.created_at),"es"),"LLL"))}}function Wl(t,d){if(t&1&&(o(0,"li",48)(1,"a",49),s(2,"Anterior"),n()()),t&2){let e=c(2);a(),l("routerLink",x(1,Zi,e.prevPage))}}function Jl(t,d){if(t&1&&(o(0,"li",48)(1,"a",50),s(2,"Siguiente"),n()()),t&2){let e=c(2);a(),l("routerLink",x(1,Zi,e.nextPage))}}function Hl(t,d){if(t&1&&(o(0,"div",6),p(1,Kl,47,22,"div",12),o(2,"nav",13)(3,"ul",14),p(4,Wl,3,3,"li",15)(5,Jl,3,3,"li",15),n()()()),t&2){let e=c();a(),l("ngForOf",e.lessons),a(3),l("ngIf",e.page>1),a(),l("ngIf",e.page<e.pages&&e.page!=e.pages)}}function Yl(t,d){if(t&1&&u(0,"details-lesson",51),t&2){let e=c();l("parent","experiences")("lesson",e.detailsLessonItem)}}function Ql(t,d){if(t&1){let e=C();o(0,"delete-lesson",52),_("deleted",function(r){f(e);let m=c();return g(m.setNeedReload(r))}),n()}if(t&2){let e=c();l("parent","experiences")("lessonId",e.deleteLessonId)}}var Ut=(()=>{class t{constructor(e,i,r,m){this._userService=e,this._lessonService=i,this._router=r,this._route=m,this.lessons=[],this.loading=!0,this.title="Experiencias",this.url=A.url,this.token=this._userService.getToken(),this.identity=this._userService.getIdentity()}ngOnInit(){this.actualPage()}ngDoCheck(){this.needReloadData&&(this.actualPage(),this.needReloadData=!1)}getLessons(e=1){this._lessonService.getExperiences(this.token,e).subscribe(i=>{i.lessons&&(this.lessons=i.lessons,this.total=i.total,this.pages=i.pages,e>this.pages&&this._router.navigate(["/admin/experiencias"]),this.loading=!1)},i=>{console.log(i)})}actualPage(){this._route.params.subscribe(e=>{let i=+e.page;this.page=i,i?(this.nextPage=i+1,this.prevPage=i-1,this.prevPage<=0&&(this.prevPage=1)):(this.page=1,this.nextPage=this.page+1),this.getLessons(this.page)})}editLesson(e){e.accepted=!0,e.type=="consideration"?(e.state="development",e.development_group.push(e.author),e.leader=e.author):e.type=="development"&&(e.state="proposed"),this._lessonService.editLesson(this.token,e).subscribe(i=>{i&&i.lesson._id&&this.getLessons(this.page)},i=>{console.log(i)})}setDetailLesson(e){this.detailsLessonItem=e}setDeleteLesson(e){this.deleteLessonId=e}setNeedReload(e){this.needReloadData=!0}static{this.\u0275fac=function(i){return new(i||t)(y(P),y(pe),y(j),y(z))}}static{this.\u0275cmp=w({type:t,selectors:[["experiences"]],standalone:!1,decls:9,vars:6,consts:[[1,"card"],[1,"card-header"],[1,"m-0","text-primary","font-weight-bolder","float-left"],["class","card-body",4,"ngIf"],[3,"parent","lesson",4,"ngIf"],[3,"parent","lessonId","deleted",4,"ngIf"],[1,"card-body"],[1,"text-muted","text-center"],["role","status",1,"spinner-border",2,"width","3rem","height","3rem"],[1,"sr-only"],[1,"text-muted"],[1,"fas","fa-laugh","icon-message"],[4,"ngFor","ngForOf"],["aria-label","Page navigation",1,"mt-3"],[1,"pagination","justify-content-end"],["class","page-item",4,"ngIf"],[1,"media-body"],[1,"row"],[1,"col-2"],[1,"col"],[1,"text-center","p-2","rounded-lg","border","border-ligth","bg-warning",2,"width","80px","height","80px","overflow","hidden"],[1,"text-white","fas","fa-flask",2,"font-size","62px"],[1,"col-7"],[1,"my-0","text-truncate"],["style","display: flex; flex-wrap: wrap;",4,"ngIf"],["class","text-break",4,"ngFor","ngForOf"],[1,"col-auto","pe-0"],[1,"text-primary"],[1,"flex-shrink-0","rounded-circle","border-1","overflow-hidden",2,"width","40px","height","40px","background-color","aqua"],[3,"routerLink"],["class","img-fluid","src","assets/images/user-default.png",4,"ngIf"],["class","img-fluid",3,"src",4,"ngIf"],[1,"col","rounded","px-2"],[1,"mb-1"],[1,"text-primary",3,"routerLink"],[1,"col-auto"],["title","Ver detalles","data-bs-toggle","modal","data-bs-target","#details",1,"btn","btn-info","me-2",3,"click"],[1,"fas","fa-eye"],["title","Avalar lecci\xF3n",1,"btn","btn-success","me-2",3,"click"],[1,"fas","fa-check-square"],["title","Eliminar lecci\xF3n","data-bs-toggle","modal","data-bs-target","#delete",1,"btn","btn-danger","me-2",3,"click"],[1,"fas","fa-trash"],[2,"display","flex","flex-wrap","wrap"],["class","badge badge-info me-1 mb-1 text-truncate",3,"title",4,"ngFor","ngForOf"],[1,"badge","badge-info","me-1","mb-1","text-truncate",3,"title"],[1,"text-break"],["src","assets/images/user-default.png",1,"img-fluid"],[1,"img-fluid",3,"src"],[1,"page-item"],[1,"page-link","bg-primary",3,"routerLink"],[1,"page-link","bg-info",3,"routerLink"],[3,"parent","lesson"],[3,"deleted","parent","lessonId"]],template:function(i,r){i&1&&(o(0,"div",0)(1,"div",1)(2,"h3",2),s(3),n()(),p(4,Ul,5,0,"div",3)(5,$l,4,0,"div",3)(6,Hl,6,3,"div",3),n(),p(7,Yl,1,2,"details-lesson",4)(8,Ql,1,2,"delete-lesson",5)),i&2&&(a(3),h(r.title),a(),l("ngIf",r.loading),a(),l("ngIf",r.lessons.length==0&&!r.loading),a(),l("ngIf",r.lessons.length>0),a(),l("ngIf",r.detailsLessonItem),a(),l("ngIf",r.deleteLessonId))},dependencies:[T,F,R,ft,Ne,ue,_e,fe],encapsulation:2})}}return t})();var en=t=>["/perfil",t],tn=t=>["/admin/lecciones-propuestas",t];function Xl(t,d){t&1&&(o(0,"div",6)(1,"div",7)(2,"div",8)(3,"span",9),s(4,"Loading..."),n()()()())}function Zl(t,d){t&1&&(o(0,"div",6)(1,"h4",10),s(2," Parece que todo el trabajo aqu\xED, ya fue realizado. "),u(3,"i",11),n()())}function ed(t,d){if(t&1&&(o(0,"p",40)(1,"small"),s(2),n()()),t&2){let e=d.$implicit;a(2),h(e)}}function td(t,d){t&1&&u(0,"img",41)}function id(t,d){if(t&1&&u(0,"img",42),t&2){let e=c().$implicit,i=c(2);v("src",i.url+"get-image-user/"+e.author.picture,M)}}function nd(t,d){if(t&1){let e=C();o(0,"div")(1,"div",0)(2,"div",6)(3,"div",16)(4,"div",17)(5,"div",18)(6,"div",17)(7,"div",19)(8,"div",20),u(9,"i",21),n()()()(),o(10,"div",19)(11,"h5",22)(12,"strong"),s(13),n()(),p(14,ed,3,1,"p",23),o(15,"p",24)(16,"strong"),s(17,"Enviada por:"),n()(),o(18,"div",17)(19,"div",25)(20,"a",26)(21,"div",27)(22,"a",28),p(23,td,1,0,"img",29)(24,id,1,1,"img",30),n()()()(),o(25,"div",31)(26,"h6",32)(27,"a",33)(28,"strong"),s(29),n()(),u(30,"br"),o(31,"small",10),s(32),I(33,"amFromUnix"),I(34,"amLocale"),I(35,"amDateFormat"),n()()()()(),o(36,"div",18)(37,"div",17)(38,"div",19)(39,"button",34),_("click",function(){let r=f(e).$implicit,m=c(2);return g(m.setDetailLesson(r))}),u(40,"i",35),n(),o(41,"button",36),_("click",function(){let r=f(e).$implicit,m=c(2);return g(m.editLesson(r))}),u(42,"i",37),n(),o(43,"button",38),_("click",function(){let r=f(e).$implicit,m=c(2);return g(m.setDeleteLesson(r._id))}),u(44,"i",39),n()()()()()()()()()}if(t&2){let e=d.$implicit;a(13),h(e.title),a(),l("ngForOf",e.resume.split(`
`)),a(8),l("routerLink",x(17,en,e.author._id)),a(),l("ngIf",!e.author.picture),a(),l("ngIf",e.author.picture),a(3),l("routerLink",x(19,en,e.author._id)),a(2),V(" ",e.author.name," ",e.author.surname," "),a(3),h(L(35,14,L(34,11,X(33,9,e.created_at),"es"),"LLL"))}}function od(t,d){if(t&1&&(o(0,"li",43)(1,"a",44),s(2,"Anterior"),n()()),t&2){let e=c(2);a(),l("routerLink",x(1,tn,e.prevPage))}}function rd(t,d){if(t&1&&(o(0,"li",43)(1,"a",45),s(2,"Siguiente"),n()()),t&2){let e=c(2);a(),l("routerLink",x(1,tn,e.nextPage))}}function ad(t,d){if(t&1&&(o(0,"div",6),p(1,nd,45,21,"div",12),o(2,"nav",13)(3,"ul",14),p(4,od,3,3,"li",15)(5,rd,3,3,"li",15),n()()()),t&2){let e=c();a(),l("ngForOf",e.lessons),a(3),l("ngIf",e.page>1),a(),l("ngIf",e.page<e.pages&&e.page!=e.pages)}}function sd(t,d){if(t&1&&u(0,"details-lesson",46),t&2){let e=c();l("parent","proposed-lesson")("lesson",e.detailsLessonItem)}}var $t=(()=>{class t{constructor(e,i,r,m,E){this._userService=e,this._lessonService=i,this._router=r,this._route=m,this._notificationService=E,this.lessons=[],this.loading=!0,this.title="Lecciones propuestas",this.url=A.url,this.token=this._userService.getToken(),this.identity=this._userService.getIdentity()}ngOnInit(){this._route.queryParams.subscribe(e=>{let i=e.lesson;i?(this.actualPage(),setTimeout(()=>{try{let r=document.querySelector(`#lesson-${i}`);r&&r.scrollIntoView({behavior:"smooth",block:"center"})}catch{}},300)):this.actualPage()})}ngDoCheck(){this.needReloadData&&(this.actualPage(),this.needReloadData=!1)}getLessons(e=1){this._lessonService.getSuggestedLesson(this.token,e).subscribe(i=>{i.lessons&&(this.lessons=i.lessons,this.total=i.total,this.pages=i.pages,e>this.pages&&this._router.navigate(["/admin/lecciones-propuestas"]),this.loading=!1)},i=>{console.log(i)})}actualPage(){this._route.params.subscribe(e=>{let i=+e.page;this.page=i,i?(this.nextPage=i+1,this.prevPage=i-1,this.prevPage<=0&&(this.prevPage=1)):(this.page=1,this.nextPage=this.page+1),this.getLessons(this.page)})}editLesson(e){e.accepted=!0,e.state="proposed",console.log("Attempting to update lesson",e),this._lessonService.editLesson(this.token,e).subscribe({next:i=>{if(i&&i.lesson._id){console.log("Lesson updated successfully",i.lesson);try{let r=i.lesson,m=r.leader&&(r.leader._id||r.leader)||r.author&&(r.author._id||r.author);if(m){let E={user:m,type:"lesson",title:"\xA1Tu lecci\xF3n ha sido aprobada!",content:`Un administrador ha aprobado tu lecci\xF3n "${r.title}". Ahora puedes gestionar la convocatoria y activar la lecci\xF3n cuando tengas suficientes participantes.`,link:`/inicio/convocatorias?lesson=${r._id}&action=manage`,relatedId:r._id,relatedModel:"Lesson",from:this.identity?._id,priority:"high"};this._notificationService.createNotification(E).subscribe({next:()=>console.log("Notificaci\xF3n enviada al l\xEDder/autor para abrir convocatoria"),error:te=>console.error("Error enviando notificaci\xF3n al l\xEDder/autor:",te)})}else console.warn("No se pudo determinar el l\xEDder/autor para notificar")}catch(r){console.error("Excepci\xF3n preparando notificaci\xF3n:",r)}this.getLessons(this.page)}},error:i=>{console.error("Error updating lesson",i)}})}setDetailLesson(e){this.detailsLessonItem=e}setDeleteLesson(e){this.deleteLessonId=e}setNeedReload(e){this.needReloadData=!0}static{this.\u0275fac=function(i){return new(i||t)(y(P),y(pe),y(j),y(z),y(ui))}}static{this.\u0275cmp=w({type:t,selectors:[["proposed"]],standalone:!1,decls:9,vars:7,consts:[[1,"card"],[1,"card-header"],[1,"m-0","text-primary","font-weight-bolder","float-left"],["class","card-body",4,"ngIf"],[3,"parent","lesson",4,"ngIf"],[3,"deleted","parent","lessonId"],[1,"card-body"],[1,"text-muted","text-center"],["role","status",1,"spinner-border",2,"width","3rem","height","3rem"],[1,"sr-only"],[1,"text-muted"],[1,"fas","fa-laugh","icon-message"],[4,"ngFor","ngForOf"],["aria-label","Page navigation",1,"mt-3"],[1,"pagination","justify-content-end"],["class","page-item",4,"ngIf"],[1,"media-body"],[1,"row"],[1,"col-auto"],[1,"col"],[1,"text-center","p-2","rounded-lg","border","border-ligth","bg-warning",2,"width","100%","height","80px","overflow","hidden"],[1,"text-white","fas","fa-file-alt",2,"font-size","62px"],[1,"mt-0","text-truncate"],["class","text-break mb-1",4,"ngFor","ngForOf"],[1,"mt-1"],[1,"col-auto","pe-0"],[1,"text-primary"],[1,"flex-shrink-0","rounded-circle","border-1","overflow-hidden",2,"width","40px","height","40px","background-color","aqua"],[3,"routerLink"],["class","img-fluid","src","assets/images/user-default.png",4,"ngIf"],["class","img-fluid",3,"src",4,"ngIf"],[1,"col","rounded","px-2"],[1,"mb-1"],[1,"text-primary",3,"routerLink"],["title","Ver detalles","data-bs-toggle","modal","data-bs-target","#details",1,"btn","btn-info","me-2",3,"click"],[1,"fas","fa-eye"],["title","Avalar lecci\xF3n",1,"btn","btn-success","me-2",3,"click"],[1,"fas","fa-check-square"],["title","Eliminar lecci\xF3n","data-bs-toggle","modal","data-bs-target","#delete",1,"btn","btn-danger","me-2",3,"click"],[1,"fas","fa-trash"],[1,"text-break","mb-1"],["src","assets/images/user-default.png",1,"img-fluid"],[1,"img-fluid",3,"src"],[1,"page-item"],[1,"page-link","bg-primary",3,"routerLink"],[1,"page-link","bg-info",3,"routerLink"],[3,"parent","lesson"]],template:function(i,r){i&1&&(o(0,"div",0)(1,"div",1)(2,"h3",2),s(3),n()(),p(4,Xl,5,0,"div",3)(5,Zl,4,0,"div",3)(6,ad,6,3,"div",3),n(),p(7,sd,1,2,"details-lesson",4),o(8,"delete-lesson",5),_("deleted",function(E){return r.setNeedReload(E)}),n()),i&2&&(a(3),h(r.title),a(),l("ngIf",r.loading),a(),l("ngIf",r.lessons.length==0&&!r.loading),a(),l("ngIf",r.lessons.length>0),a(),l("ngIf",r.detailsLessonItem),a(),l("parent","proposed-lesson")("lessonId",r.deleteLessonId))},dependencies:[T,F,R,ft,Ne,ue,_e,fe],encapsulation:2})}}return t})();var je=[{id:"name",label:"Nombre",type:"text",attr:"name",required:!0},{id:"description",label:"Descripci\xF3n",type:"textarea",attr:"description",required:!0},{id:"type",label:"Tipo",type:"select",attr:"type",required:!0,options:[{label:"Documento",value:"document"},{label:"Enlace",value:"link"},{label:"Video",value:"video"},{label:"Software",value:"software"}]},{id:"url",label:"Enlace",type:"text",attr:"url",required:!0},{id:"file",label:"Archivo",type:"file",attr:"file",required:!0},{id:"source",label:"Fuente",type:"textarea",attr:"source",required:!0}],nn=[{label:"Documentos",value:"document"},{label:"Enlaces",value:"link"},{label:"Video",value:"video"},{label:"Software",value:"software"}];var ld=["closeBtn"],vt=t=>({"is-invalid":t});function dd(t,d){if(t&1&&(o(0,"div",31),u(1,"i",32),s(2),n()),t&2){let e=c();a(2),b(" ",e.errorMsg," ")}}function cd(t,d){if(t&1&&(o(0,"div",33),u(1,"i",34),s(2),n()),t&2){let e=c();a(2),b(" ",e.successMsg," ")}}function md(t,d){if(t&1&&(o(0,"div",35),u(1,"i",34),s(2),n()),t&2){let e=c();a(2),b(" ",e.warningMsg," ")}}function pd(t,d){if(t&1&&(o(0,"div",36),u(1,"i",34),s(2),n()),t&2){let e=c();a(2),b(" ",e.deletedMsg," ")}}function ud(t,d){t&1&&(o(0,"span"),s(1,"*"),n())}function _d(t,d){if(t&1&&u(0,"input",45),t&2){let e=c().$implicit,i=c();v("id",e.id),v("formControlName",e.id),l("ngClass",x(3,vt,i.submitted&&i.f[e.id].errors))}}function fd(t,d){if(t&1&&(o(0,"textarea",46),s(1,"                            "),n()),t&2){let e=c().$implicit,i=c();v("id",e.id),v("formControlName",e.id),l("ngClass",x(3,vt,i.submitted&&i.f[e.id].errors))}}function gd(t,d){if(t&1&&(o(0,"option",49),s(1),n()),t&2){let e=d.$implicit;v("value",e.value),a(),b(" ",e.label,"")}}function vd(t,d){if(t&1){let e=C();o(0,"select",47),_("input",function(){f(e);let r=c(2);return g(r.setDisabled())}),p(1,gd,2,2,"option",48),n()}if(t&2){let e=c().$implicit,i=c();v("formControlName",e.id),v("id",e.id),l("ngClass",x(4,vt,i.submitted&&i.f[e.id].errors)),a(),l("ngForOf",e.options)}}function hd(t,d){if(t&1){let e=C();o(0,"input",52),_("change",function(r){f(e);let m=c(3);return g(m.fileChangeEvent(r))}),n()}if(t&2){let e=c(2).$implicit,i=c();v("formControlName",e.id),v("id",e.id),l("ngClass",x(3,vt,i.submitted&&i.f[e.id].errors||i.maxSizeError))}}function xd(t,d){if(t&1&&(o(0,"div",53)(1,"div",54,1),s(3),n()()),t&2){let e=c(3);a(),Qe("width",e.barWidth),a(2),h(e.barWidth)}}function bd(t,d){t&1&&(o(0,"div"),s(1," El archivo es demasiado grande, el tama\xF1o maximo permitido es de 20MB. "),n())}function Cd(t,d){if(t&1&&(o(0,"div",55),p(1,bd,2,0,"div",39),n()),t&2){let e=c(3);a(),l("ngIf",e.maxSizeError)}}function yd(t,d){if(t&1&&(o(0,"div"),p(1,hd,1,5,"input",50)(2,xd,4,3,"div",51)(3,Cd,2,1,"div",44),n()),t&2){let e=c().$implicit,i=c();a(),l("ngIf",e.type=="file"),a(),l("ngIf",i.filesToUpload!=null||i.barWidth!="0%"),a(),l("ngIf",i.maxSizeError&&e.id=="file")}}function Ed(t,d){if(t&1&&(o(0,"div"),s(1),n()),t&2){let e=c(2).$implicit;a(),b(" El campo ",e.label," es obligatorio. ")}}function Sd(t,d){if(t&1&&(o(0,"div",55),p(1,Ed,2,1,"div",39),n()),t&2){let e=c().$implicit,i=c();a(),l("ngIf",i.f[e.id].errors.required)}}function Id(t,d){if(t&1&&(o(0,"div",37)(1,"label",38)(2,"strong"),s(3),p(4,ud,2,0,"span",39),n()(),o(5,"div",40),p(6,_d,1,5,"input",41)(7,fd,2,5,"textarea",42)(8,vd,2,6,"select",43)(9,yd,4,3,"div",39)(10,Sd,2,1,"div",44),n()()),t&2){let e=d.$implicit,i=c();a(),v("for",e.id),a(2),h(e.label),a(),l("ngIf",e.required),a(2),l("ngIf",e.type=="text"),a(),l("ngIf",e.type==="textarea"),a(),l("ngIf",e.type=="select"),a(),l("ngIf",e.type=="file"),a(),l("ngIf",i.submitted&&i.f[e.id].errors)}}function wd(t,d){t&1&&u(0,"span",56)}var on=(()=>{class t{constructor(e,i,r){this._userService=e,this._resourceService=i,this._uploadService=r,this.MAX_FILE_SIZE=20,this.maxSize=20*1024*1024,this.maxSizeError=!1,this.barWidth="0%",this.resourceId="",this.added=new se,this.title="Agregar recurso",this.identity=this._userService.getIdentity(),this.token=this._userService.getToken(),this.url=A.url,this.fields=je,this.errorMsg="Hubo un error agregando el nuevo recurso. Intentalo de nuevo m\xE1s tarde.",this.warningMsg="Se estan subiendo los archivos, por favor evita cerrar la ventana. ",this.successMsg="Se ha guardado el nuevo recurso correctamente. Si deseas, puedes enviar otro recurso",this.deletedMsg="Se ha cancelado correctamente el recurso. Puedes volver a enviar un recurso",this.addForm=new oe({name:new k("",S.required),type:new k("",S.required),description:new k("",S.required),source:new k("",S.required),file:new k("",S.required),url:new k("",S.required)})}ngOnInit(){}ngAfterViewInit(){this.closeBtn&&this.closeBtn.nativeElement}get f(){return this.addForm.controls}restartValues(){this.status=null,this.loading==!0&&this.cancelResource(),this.addForm.reset(),this.disableForm(!1),this.submitted=!1,this.maxSizeError=!1,this.barWidth="0%",(this.loading==!1||this.loading==null)&&(console.log(this.closeBtn),this.closeBtn&&this.closeBtn.nativeElement&&this.closeBtn.nativeElement.click())}getValue(){return this.resourceId}setResId(e){this.resourceId=e}ngOnDestroy(){this.subscriptionResource$&&this.subscriptionResource$.unsubscribe(),this.subscriptionFile$&&this.subscriptionFile$.unsubscribe()}cancelResource(){console.log("Cancelling resource..."),this.warningMsg="Se est\xE1 cancelando el recurso",this.status="warning",ge(this.subscriptionFile$,this.subscriptionResource$).pipe(Jt(e=>(e&&e.unsubscribe(),this._resourceService.deleteResource(this.token,this.getValue()))),ve(e=>(console.error(e),this.errorMsg="Hubo un error, por favor comun\xEDcate con el Administrador",this.status="error",this.loading=!1,ge(e)))).subscribe(e=>{e&&e.resource&&(console.log("Resource deleted:",e),this.status="deleted",this.warningMsg="Recurso cancelado con \xE9xito.",this.errorMsg="Hubo un error al enviar el recurso. Int\xE9ntalo de nuevo m\xE1s tarde.",this.loading=!1)})}disableForm(e){e==!0?(this.addForm.controls.name.disable(),this.addForm.controls.type.disable(),this.addForm.controls.description.disable(),this.addForm.controls.source.disable(),this.addForm.controls.file.disable()):(this.addForm.controls.name.enable(),this.addForm.controls.type.enable(),this.addForm.controls.description.enable(),this.addForm.controls.source.enable(),this.addForm.controls.file.enable())}setDisabled(){this.addForm.get("type").valueChanges.subscribe(e=>{["video","document","software"].includes(e)?(this.addForm.controls.url.disable(),this.addForm.controls.url.setValue(""),this.addForm.controls.file.enable()):(this.addForm.controls.url.enable(),this.addForm.controls.file.setValue(""),this.filesToUpload=null,this.addForm.controls.file.disable())})}fileChangeEvent(e){if(this.filesToUpload=e.target.files,this.maxSize<e.target.files[0].size){this.maxSizeError=!0;return}this.maxSizeError=!1}onSubmit(){if(this.submitted=!0,this.loading=!0,this.addForm.invalid||this.maxSizeError){this.loading=!1;return}this.resource=new ze(this.addForm.value.name,this.addForm.value.type,this.addForm.value.source,this.addForm.value.description,this.identity._id),this.addForm.value.url&&(this.resource.url=this.addForm.value.url),this.resource.accepted=!0,this._resourceService.addResource(this.token,this.resource).pipe(Pe(e=>{if(!e.resource||!e.resource._id)throw new Error("Failed to create resource");return this.setResId(e.resource._id),!this.filesToUpload||this.filesToUpload.length===0?ge(e):this._uploadService.makeFileRequest(this.url+"upload-resource/"+e.resource._id,[],this.filesToUpload,this.token,"file")}),Ht(()=>{this.loading=!1,this.submitted=!1,this.addForm.reset(),this.status="success"}),ve(e=>(console.error(e),this.status="error",ge(e)))).subscribe(e=>{e.type===Ve.UploadProgress?(this.status="warning",this.barWidth=Math.round(e.loaded/e.total*100).toString()+"%"):e.type===Ve.Response&&this.added.emit()})}onChanges(){this.loading==!1&&(console.log("changes"),this.status=null,this.addForm.valueChanges.subscribe(e=>{e&&(this.status=null,this.barWidth="0%",this.submitted=!1)}))}static{this.\u0275fac=function(i){return new(i||t)(y(P),y(we),y(Ae))}}static{this.\u0275cmp=w({type:t,selectors:[["add-resource"]],viewQuery:function(i,r){if(i&1&&Xe(ld,5),i&2){let m;Ze(m=et())&&(r.closeBtn=m.first)}},outputs:{added:"added"},standalone:!1,decls:43,vars:8,consts:[["closeBtn",""],["progress",""],["id","add","tabindex","-1","aria-labelledby","addTitle","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog","modal-lg","modal-dialog-scrollable"],["enctype","multipart/form-data",1,"modal-content",3,"ngSubmit","input","formGroup"],[1,"modal-header"],["id","addTitle",1,"modal-title"],["type","button","data-bs-dismiss","modal",1,"buttonClose",2,"display","none"],["type","button","data-bs-toggle","modal","data-bs-target","#cancelModal","aria-label","Close",1,"btn-close"],["aria-hidden","true"],[1,"modal-body"],["class","alert alert-danger fade show text-center","role","alert",4,"ngIfSuccessMessage","ngIf"],["class","alert alert-success fade show text-center","role","alert",4,"ngIfSuccessMessage","ngIf"],["class","alert alert-warning fade show text-center","role","alert",4,"ngIfSuccessMessage","ngIf"],["class","alert alert-primary fade show text-center","role","alert",4,"ngIfSuccessMessage","ngIf"],["class","mb-3 row",4,"ngFor","ngForOf"],[1,"modal-footer"],["data-bs-toggle","modal","data-bs-target","#cancelModal"],["type","button",1,"btn","btn-danger"],["type","submit",1,"btn","btn-success",3,"disabled"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],[1,"visually-hidden"],["id","cancelModal","tabindex","-1","role","dialog","aria-labelledby","cancelBtn","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-dialog-centered"],[1,"modal-content"],["id","cancelUpload",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],["role","alert",1,"alert","alert-warning","mb-0"],[1,"fas","fa-exclamation-triangle","icon-message","me-2"],["data-bs-dismiss","modal",1,"btn","btn-danger",3,"click"],["data-bs-dismiss","modal",1,"btn","btn-primary","text-white"],["role","alert",1,"alert","alert-danger","fade","show","text-center"],[1,"fas","fa-times-circle","icon-message","me-2"],["role","alert",1,"alert","alert-success","fade","show","text-center"],[1,"fas","fa-check-circle","icon-message","me-2"],["role","alert",1,"alert","alert-warning","fade","show","text-center"],["role","alert",1,"alert","alert-primary","fade","show","text-center"],[1,"mb-3","row"],[1,"col-3","col-form-label",3,"for"],[4,"ngIf"],[1,"col-9"],["type","text","class","form-control","autocomplete","off",3,"id","formControlName","ngClass",4,"ngIf"],["class","form-control","rows","3",3,"id","formControlName","ngClass",4,"ngIf"],["class","form-control",3,"formControlName","id","ngClass","input",4,"ngIf"],["class","invalid-feedback",4,"ngIf"],["type","text","autocomplete","off",1,"form-control",3,"id","formControlName","ngClass"],["rows","3",1,"form-control",3,"id","formControlName","ngClass"],[1,"form-control",3,"input","formControlName","id","ngClass"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["type","file","class","form-control","name","file",3,"formControlName","id","ngClass","change",4,"ngIf"],["class","progress",4,"ngIf"],["type","file","name","file",1,"form-control",3,"change","formControlName","id","ngClass"],[1,"progress"],["role","progressbar","aria-valuenow","barWidth","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","progress-bar-striped","progress-bar-animated"],[1,"invalid-feedback"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"]],template:function(i,r){if(i&1){let m=C();o(0,"div",2)(1,"div",3)(2,"form",4),_("ngSubmit",function(){return f(m),g(r.onSubmit())})("input",function(){return f(m),g(r.onChanges())}),o(3,"div",5)(4,"h5",6),s(5,"Agregar un recurso"),n(),o(6,"button",7,0),s(8," Close"),n(),o(9,"button",8)(10,"span",9),s(11,"\xD7"),n()()(),o(12,"div",10),p(13,dd,3,1,"div",11)(14,cd,3,1,"div",12)(15,md,3,1,"div",13)(16,pd,3,1,"div",14)(17,Id,11,8,"div",15),n(),o(18,"div",16)(19,"div",17)(20,"button",18),s(21,"Cancelar"),n()(),o(22,"button",19),p(23,wd,1,0,"span",20),o(24,"span",21),s(25,"Guardar"),n(),s(26," Guardar "),n()()()()(),o(27,"div",22)(28,"div",23)(29,"div",24)(30,"div",5)(31,"h5",25),s(32,"Cancelar recurso para el Repositorio"),n(),u(33,"button",26),n(),o(34,"div",10)(35,"div",27),u(36,"i",28),s(37," \xBFEstas seguro que quieres Salir? Si continuas se cancelar\xE1 el recurso que est\xE9s creando. "),n()(),o(38,"div",16)(39,"button",29),_("click",function(){return f(m),g(r.restartValues())}),s(40,"S\xED"),n(),o(41,"button",30),s(42,"No"),n()()()()()}i&2&&(a(2),l("formGroup",r.addForm),a(11),l("ngIf",r.status==="error"),a(),l("ngIf",r.status==="success"),a(),l("ngIf",r.status==="warning"),a(),l("ngIf",r.status==="deleted"),a(),l("ngForOf",r.fields),a(5),l("disabled",r.loading),a(),l("ngIf",r.loading&&!r.addForm.invalid))},dependencies:[G,T,F,q,ce,me,N,de,D,$,H,Y],encapsulation:2})}}return t})();var rn=t=>["/perfil",t];function Td(t,d){if(t&1&&(o(0,"label",16)(1,"strong"),s(2),n()()),t&2){let e=c().$implicit;v("for",e.id),a(2),b("",e.label,":")}}function Fd(t,d){if(t&1&&(o(0,"p"),s(1),n()),t&2){let e=c().$implicit,i=c();a(),h(i.types[i.resource[e.id]].label)}}function Ld(t,d){if(t&1&&(o(0,"p"),s(1),n()),t&2){let e=c().$implicit,i=c();a(),b(" ",i.resource[e.id]," ")}}function Pd(t,d){if(t&1&&(o(0,"p")(1,"a",17),s(2),n()()),t&2){let e=c(2);a(),v("href",e.getLink(e.resource.url),M),a(),b(" ",e.resource.url," ")}}function Vd(t,d){if(t&1&&(o(0,"p")(1,"a",18),u(2,"i",19),s(3),n()()),t&2){let e=c(2);a(),O("title","Descargar recurso: ",e.resource.file,""),v("href",e.url+"get-resource/"+e.resource.file,M),a(2),b(" ",e.resource.file," ")}}function Md(t,d){if(t&1&&(o(0,"div",12),p(1,Td,3,2,"label",13),o(2,"div",14),p(3,Fd,2,1,"p",15)(4,Ld,2,1,"p",15)(5,Pd,3,2,"p",15)(6,Vd,4,4,"p",15),n()()),t&2){let e=d.$implicit,i=c();a(),l("ngIf",i.resource[e.id]),a(2),l("ngIf",i.resource[e.id]&&e.id=="type"),a(),l("ngIf",i.resource[e.id]&&e.type!="file"&&e.id!="type"&&e.id!="url"),a(),l("ngIf",i.resource[e.id]&&e.id=="url"),a(),l("ngIf",i.resource[e.id]&&e.type=="file")}}function Ad(t,d){if(t&1&&(o(0,"div",12)(1,"label",20)(2,"strong"),s(3,"Calificaci\xF3n:"),n()(),o(4,"div",14)(5,"p")(6,"button",21),u(7,"i",22),s(8),n()()()()),t&2){let e=c();a(8),b(" ",e.resource.score.toFixed(2)," ")}}function Od(t,d){if(t&1&&(o(0,"div",12)(1,"label",20)(2,"strong"),s(3,"Descargas:"),n()(),o(4,"div",14)(5,"p")(6,"button",23),u(7,"i",19),s(8),n()()()()),t&2){let e=c();a(8),b(" ",e.resource.downloads," ")}}function Rd(t,d){t&1&&u(0,"img",36)}function Dd(t,d){if(t&1&&u(0,"img",37),t&2){let e=c().$implicit,i=c();v("src",i.url+"get-image-user/"+e.user.picture,M)}}function Nd(t,d){if(t&1&&(o(0,"div",24)(1,"div",25)(2,"a",26)(3,"div",27),p(4,Rd,1,0,"img",28)(5,Dd,1,1,"img",29),n()()(),o(6,"div",30)(7,"h6",31)(8,"a",26)(9,"strong"),s(10),n()(),u(11,"br"),o(12,"small",32),s(13),I(14,"amFromUnix"),I(15,"amLocale"),I(16,"amDateFormat"),n()(),o(17,"p",33),s(18),n()(),o(19,"div",34)(20,"button",35),u(21,"i",22),s(22),n()()()),t&2){let e=d.$implicit;a(2),l("routerLink",x(17,rn,e.user._id)),a(2),l("ngIf",!e.user.picture),a(),l("ngIf",e.user.picture),a(3),l("routerLink",x(19,rn,e.user._id)),a(2),V(" ",e.user.name," ",e.user.surname," "),a(3),b(" ",L(16,14,L(15,11,X(14,9,e.created_at),"es"),"LLL")," "),a(5),b(" ",e.text," "),a(4),b(" ",e.score," ")}}var ht=(()=>{class t{constructor(e){this._userService=e,this.title="Agregar recurso",this.identity=this._userService.getIdentity(),this.token=this._userService.getToken(),this.url=A.url,this.fields=je,this.types=Oe}ngOnInit(){this.parent=="proposed-resource"&&this.fields.push({id:"justification",label:"Justificaci\xF3n",type:"textarea",attr:"justification",required:!0})}ngOnDestroy(){this.fields.pop()}getLink(e){return e.includes("http://")||e.includes("https://")?e:`http://${e}`}static{this.\u0275fac=function(i){return new(i||t)(y(P))}}static{this.\u0275cmp=w({type:t,selectors:[["details-resource"]],inputs:{resource:"resource",parent:"parent"},standalone:!1,decls:15,vars:4,consts:[["id","details","tabindex","-1","role","dialog","aria-labelledby","details","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-dialog-scrollable"],[1,"modal-content"],[1,"modal-header"],["id","detailsTitle",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],["class","row",4,"ngFor","ngForOf"],["class","row",4,"ngIf"],["class","row mt-2",4,"ngFor","ngForOf"],[1,"modal-footer"],["data-bs-dismiss","modal",1,"btn","btn-secondary"],[1,"row"],["class","col-3",3,"for",4,"ngIf"],[1,"col"],[4,"ngIf"],[1,"col-3",3,"for"],["target","_blank",3,"href"],["target","_blank",1,"btn","btn-info",3,"title","href"],[1,"fas","fa-download"],[1,"col-3"],[1,"btn","btn-sm","btn-warning"],[1,"fas","fa-star"],[1,"btn","btn-sm","btn-info"],[1,"row","mt-2"],[1,"col-auto"],["data-bs-dismiss","modal",1,"text-primary",3,"routerLink"],[1,"flex-shrink-0","rounded-circle","border-1","overflow-hidden",2,"width","40px","height","40px"],["class","img-fluid","src","assets/images/user-default.png",4,"ngIf"],["class","img-fluid",3,"src",4,"ngIf"],[1,"col","bg-light","rounded-left","p-2"],[1,"mb-1"],[1,"text-muted"],[1,"card-text"],[1,"col-auto","bg-light","rounded-right","p-2","me-3","align-items-center"],[1,"btn","btn-warning","py-0","ms-1"],["src","assets/images/user-default.png",1,"img-fluid"],[1,"img-fluid",3,"src"]],template:function(i,r){i&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h5",4),s(5,"Detalles del recurso"),n(),u(6,"button",5),n(),o(7,"div",6),p(8,Md,7,5,"div",7)(9,Ad,9,1,"div",8)(10,Od,9,1,"div",8)(11,Nd,23,21,"div",9),n(),o(12,"div",10)(13,"button",11),s(14,"Cerrar"),n()()()()()),i&2&&(a(8),l("ngForOf",r.fields),a(),l("ngIf",r.parent!="proposed-resource"),a(),l("ngIf",r.parent!="proposed-resource"),a(),l("ngForOf",r.resource.comments))},dependencies:[T,F,R,ue,_e,fe],encapsulation:2})}}return t})();var Be=t=>({"is-invalid":t});function Ud(t,d){if(t&1){let e=C();o(0,"button",32),_("click",function(){f(e);let r=c();return g(r.restartValues())}),o(1,"span",33),s(2,"\xD7"),n()()}}function $d(t,d){if(t&1&&(o(0,"div",34),u(1,"i",35),s(2),n()),t&2){let e=c();a(2),b(" ",e.errorMsg," ")}}function qd(t,d){if(t&1&&(o(0,"div",36),u(1,"i",37),s(2),n()),t&2){let e=c();a(2),b(" ",e.warningMsg," ")}}function jd(t,d){if(t&1&&(o(0,"div",38),u(1,"i",37),s(2),n()),t&2){let e=c();a(2),b(" ",e.successMsg," ")}}function Bd(t,d){t&1&&(o(0,"div"),s(1," El campo nombre es obligatorio. "),n())}function Gd(t,d){if(t&1&&(o(0,"div",39),p(1,Bd,2,0,"div",40),n()),t&2){let e=c();a(),l("ngIf",e.f.name.errors.required)}}function zd(t,d){t&1&&(o(0,"div"),s(1," El campo descripci\xF3n es obligatorio. "),n())}function Kd(t,d){if(t&1&&(o(0,"div",39),p(1,zd,2,0,"div",40),n()),t&2){let e=c();a(),l("ngIf",e.f.description.errors.required)}}function Wd(t,d){t&1&&(o(0,"div"),s(1," El campo descripci\xF3n es obligatorio. "),n())}function Jd(t,d){if(t&1&&(o(0,"div",39),p(1,Wd,2,0,"div",40),n()),t&2){let e=c();a(),l("ngIf",e.f.type.errors.required)}}function Hd(t,d){t&1&&(o(0,"div"),s(1," El campo enlace es obligatorio. "),n())}function Yd(t,d){if(t&1&&(o(0,"div",39),p(1,Hd,2,0,"div",40),n()),t&2){let e=c(2);a(),l("ngIf",e.f.url.errors.required)}}function Qd(t,d){if(t&1&&(o(0,"div",11)(1,"label",41)(2,"strong"),s(3,"Enlace*"),n()(),o(4,"div",13),u(5,"input",42),p(6,Yd,2,1,"div",15),n()()),t&2){let e=c();a(5),l("ngClass",x(2,Be,e.submitted&&e.f.url.errors)),a(),l("ngIf",e.submitted&&e.f.url.errors)}}function Xd(t,d){if(t&1&&(o(0,"div",11)(1,"label",18)(2,"strong"),s(3,"Archivo actual*"),n()(),o(4,"div",13)(5,"a",43),u(6,"i",44),s(7),n()()()),t&2){let e=c();a(5),O("title","Descargar recurso: ",e.resource.file,""),v("href",e.url+"get-resource/"+e.resource.file,M),a(2),b(" ",e.resource.file," ")}}function Zd(t,d){if(t&1&&(o(0,"div",47)(1,"div",48,0),s(3),n()()),t&2){let e=c(2);a(),Qe("width",e.barWidth),a(2),h(e.barWidth)}}function ec(t,d){if(t&1&&(o(0,"div"),s(1),n()),t&2){let e=c(3);a(),b(" El archivo es demasiado grande, el tama\xF1o maximo permitido es de ",e.MAX_FILE_SIZE,"MB. ")}}function tc(t,d){if(t&1&&(o(0,"div",39),p(1,ec,2,1,"div",40),n()),t&2){let e=c(2);a(),l("ngIf",e.maxSizeError)}}function ic(t,d){if(t&1){let e=C();o(0,"div",11)(1,"label",18)(2,"strong"),s(3,"Nuevo archivo"),n()(),o(4,"div",13)(5,"input",45),_("change",function(r){f(e);let m=c();return g(m.fileChangeEvent(r))}),n(),p(6,Zd,4,3,"div",46)(7,tc,2,1,"div",15),n()()}if(t&2){let e=c();a(5),l("ngClass",x(3,Be,e.submitted&&e.f.file.errors||e.maxSizeError)),a(),l("ngIf",e.filesToUpload!=null||e.barWidth!="0%"),a(),l("ngIf",e.maxSizeError)}}function nc(t,d){t&1&&(o(0,"div"),s(1," El campo fuente es obligatorio. "),n())}function oc(t,d){if(t&1&&(o(0,"div",39),p(1,nc,2,0,"div",40),n()),t&2){let e=c();a(),l("ngIf",e.f.source.errors.required)}}function rc(t,d){if(t&1){let e=C();o(0,"button",49),_("click",function(){f(e);let r=c();return g(r.restartValues())}),s(1,"Cancelar"),n()}}function ac(t,d){t&1&&u(0,"span",50)}var sn=(()=>{class t{constructor(e,i,r){this._userService=e,this._resourceService=i,this._uploadService=r,this.loading=!1,this.prevResource=new ze("","","","",""),this.resource=new ze("","","","",""),this.edited=new se,this.MAX_FILE_SIZE=20,this.maxSize=20*1024*1024,this.maxSizeError=!1,this.barWidth="0%",this.title="Editar recurso",this.identity=this._userService.getIdentity(),this.token=this._userService.getToken(),this.url=A.url,this.fields=je,this.errorMsg="Hubo un error al editar el recurso. Intentalo de nuevo m\xE1s tarde.",this.successMsg="Se ha editado el recurso correctamente. Tambi\xE9n puedes editar nuevamente el recurso",this.warningMsg="Se estan subiendo los archivos, por favor evita cerrar la ventana. ",this.editForm=new oe({name:new k("",S.required),type:new k("",S.required),description:new k("",S.required),source:new k("",S.required),file:new k(""),url:new k("",S.required)}),this.editForm.controls.type.disable()}ngOnInit(){this.editForm.patchValue({name:this.resource.name,type:this.resource.type,description:this.resource.description,source:this.resource.source,url:this.resource.url})}ngDoCheck(){this.prevResource._id!=this.resource._id&&(this.editForm.patchValue({name:this.resource.name,type:this.resource.type,description:this.resource.description,source:this.resource.source,url:this.resource.url}),["video","document","software"].includes(this.resource.type)?(this.editForm.controls.url.disable(),this.editForm.controls.url.setValue(""),this.editForm.controls.file.enable()):(this.editForm.controls.url.enable(),this.editForm.controls.file.setValue(""),this.filesToUpload=null,this.editForm.controls.file.disable()),this.prevResource=this.resource)}get f(){return this.editForm.controls}restartValues(){this.status=null,this.submitted=!1,this.edited.emit(),this.editForm.controls.file.reset()}disableForm(e){e==!0?(this.editForm.controls.name.disable(),this.editForm.controls.type.disable(),this.editForm.controls.description.disable(),this.editForm.controls.source.disable(),this.editForm.controls.file.disable()):(this.editForm.controls.name.enable(),this.editForm.controls.type.enable(),this.editForm.controls.description.enable(),this.editForm.controls.source.enable(),this.editForm.controls.file.enable())}setDisabled(){this.editForm.get("type").valueChanges.subscribe(e=>{["video","document","software"].includes(e)?(this.editForm.controls.url.disable(),this.editForm.controls.url.setValue(""),this.editForm.controls.file.enable()):(this.editForm.controls.url.enable(),this.editForm.controls.file.setValue(""),this.filesToUpload=null,this.editForm.controls.file.disable())})}fileChangeEvent(e){if(this.filesToUpload=e.target.files,this.maxSize<e.target.files[0].size){this.maxSizeError=!0;return}this.maxSizeError=!1}onSubmit(){this.submitted=!0,this.loading=!0,this.status="warning",!this.editForm.invalid&&(this.editForm.value.url&&(this.resource.url=this.editForm.value.url),this.resource.name=this.editForm.value.name,this.resource.description=this.editForm.value.description,this.resource.source=this.editForm.value.source,this._resourceService.editResource(this.token,this.resource).subscribe(e=>{e.resource&&e.resource._id?(this.resource=e.resource,this.filesToUpload?this.filesToUpload&&this.filesToUpload.length>0?(this.disableForm(!0),this._uploadService.makeFileRequest(this.url+"upload-resource/"+e.resource._id,[],this.filesToUpload,this.token,"file").subscribe(i=>{switch(i.type){case Ve.UploadProgress:this.status="warning",this.barWidth=Math.round(i.loaded/i.total*100).toString()+"%";break;case Ve.Response:console.log("User successfully added!",i.body),this.disableForm(!1),this.resource=i.body.resource,this.barWidth="0%",this.loading=!1,this.status="success"}},i=>{this.status="error",this.barWidth="0%",this.loading=!1,console.log(i)})):(this.status="error",this.barWidth="0%",this.loading=!1):(this.status="success",this.loading=!1)):(this.status="error",this.barWidth="0%",this.loading=!1)},e=>{this.status="error",this.barWidth="0%",this.loading=!1,console.log(e)}),document.querySelector(".modal-body").scrollTop=0,this.submitted=!1)}onChanges(){this.loading==!1&&(console.log("changes"),this.status=null,this.editForm.valueChanges.subscribe(e=>{e&&(this.status=null,this.barWidth="0%",this.submitted=!1)}))}static{this.\u0275fac=function(i){return new(i||t)(y(P),y(we),y(Ae))}}static{this.\u0275cmp=w({type:t,selectors:[["edit-resource"]],inputs:{resource:"resource"},outputs:{edited:"edited"},standalone:!1,decls:59,vars:28,consts:[["progress",""],["id","edit","tabindex","-1","role","dialog","aria-labelledby","edit","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-lg","modal-dialog-scrollable"],["enctype","multipart/form-data",1,"modal-content",3,"ngSubmit","input","formGroup"],[1,"modal-header"],["id","editTitle",1,"modal-title"],["type","button","class","btn-close","data-bs-dismiss","modal","aria-label","Close",3,"click",4,"ngIf"],["id","body",1,"modal-body"],["class","alert alert-danger fade show text-center","role","alert",4,"ngIfSuccessMessage","ngIf"],["class","alert alert-warning fade show text-center","role","alert",4,"ngIfSuccessMessage","ngIf"],["class","alert alert-success fade show text-center","role","alert",4,"ngIfSuccessMessage","ngIf"],[1,"mb-3","row"],["for","name",1,"col-3","col-form-label"],[1,"col-9"],["type","text","id","name","autocomplete","off","formControlName","name",1,"form-control",3,"ngClass"],["class","invalid-feedback",4,"ngIf"],["for","description",1,"col-3","col-form-label"],["id","description","rows","3","formControlName","description",1,"form-control",3,"ngClass"],["for","type",1,"col-3","col-form-label"],["formControlName","type","id","type",1,"form-control",3,"input","ngClass"],["value","document"],["value","link"],["value","video"],["value","software"],["class","mb-3 row",4,"ngIf"],["for","source",1,"col-3","col-form-label"],["id","source","rows","3","formControlName","source",1,"form-control",3,"ngClass"],[1,"modal-footer"],["class","btn btn-danger","data-bs-dismiss","modal",3,"click",4,"ngIf"],["type","submit",1,"btn","btn-success",3,"disabled"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],[1,"visually-hidden"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close",3,"click"],["aria-hidden","true"],["role","alert",1,"alert","alert-danger","fade","show","text-center"],[1,"fas","fa-times-circle","icon-message","me-2"],["role","alert",1,"alert","alert-warning","fade","show","text-center"],[1,"fas","fa-check-circle","icon-message","me-2"],["role","alert",1,"alert","alert-success","fade","show","text-center"],[1,"invalid-feedback"],[4,"ngIf"],["for","url",1,"col-3","col-form-label"],["type","text","id","url","autocomplete","off","formControlName","url",1,"form-control",3,"ngClass"],["target","_blank",1,"btn","btn-info",3,"title","href"],[1,"fas","fa-download"],["formControlName","file","type","file","name","file","id","file",1,"form-control",3,"change","ngClass"],["class","progress",4,"ngIf"],[1,"progress"],["role","progressbar","aria-valuenow","barWidth","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","progress-bar-striped","progress-bar-animated"],["data-bs-dismiss","modal",1,"btn","btn-danger",3,"click"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"]],template:function(i,r){i&1&&(o(0,"div",1)(1,"div",2)(2,"form",3),_("ngSubmit",function(){return r.onSubmit()})("input",function(){return r.onChanges()}),o(3,"div",4)(4,"h5",5),s(5),n(),p(6,Ud,3,0,"button",6),n(),o(7,"div",7),p(8,$d,3,1,"div",8)(9,qd,3,1,"div",9)(10,jd,3,1,"div",10),o(11,"div",11)(12,"label",12)(13,"strong"),s(14,"Nombre*"),n()(),o(15,"div",13),u(16,"input",14),p(17,Gd,2,1,"div",15),n()(),o(18,"div",11)(19,"label",16)(20,"strong"),s(21,"Descripci\xF3n*"),n()(),o(22,"div",13)(23,"textarea",17),s(24,"                                    "),n(),p(25,Kd,2,1,"div",15),n()(),o(26,"div",11)(27,"label",18)(28,"strong"),s(29,"Tipo*"),n()(),o(30,"div",13)(31,"select",19),_("input",function(){return r.setDisabled()}),o(32,"option",20),s(33,"Documento"),n(),o(34,"option",21),s(35,"Enlace"),n(),o(36,"option",22),s(37,"Video"),n(),o(38,"option",23),s(39,"Software"),n()(),p(40,Jd,2,1,"div",15),n()(),p(41,Qd,7,4,"div",24)(42,Xd,8,4,"div",24)(43,ic,8,5,"div",24),o(44,"div",11)(45,"label",25)(46,"strong"),s(47,"Fuente*"),n()(),o(48,"div",13)(49,"textarea",26),s(50,"                                        "),n(),p(51,oc,2,1,"div",15),n()()(),o(52,"div",27),p(53,rc,2,0,"button",28),o(54,"button",29),p(55,ac,1,0,"span",30),o(56,"span",31),s(57,"Guardar"),n(),s(58," Guardar "),n()()()()()),i&2&&(a(2),l("formGroup",r.editForm),a(3),h(r.title),a(),l("ngIf",r.loading==!1),a(2),l("ngIf",r.status==="error"),a(),l("ngIf",r.status==="warning"),a(),l("ngIf",r.status==="success"),a(6),l("ngClass",x(20,Be,r.submitted&&r.f.name.errors)),a(),l("ngIf",r.submitted&&r.f.name.errors),a(6),l("ngClass",x(22,Be,r.submitted&&r.f.description.errors)),a(2),l("ngIf",r.submitted&&r.f.description.errors),a(6),l("ngClass",x(24,Be,r.submitted&&r.f.type.errors)),a(9),l("ngIf",r.submitted&&r.f.type.errors),a(),l("ngIf",r.resource.type=="link"),a(),l("ngIf",r.resource.type!="link"),a(),l("ngIf",r.resource.type!="link"),a(6),l("ngClass",x(26,Be,r.submitted&&r.f.source.errors)),a(2),l("ngIf",r.submitted&&r.f.source.errors),a(2),l("ngIf",r.loading==!1),a(),l("disabled",r.loading),a(),l("ngIf",r.loading&&!r.editForm.invalid))},dependencies:[G,F,q,ce,me,N,de,D,$,H,Y],encapsulation:2})}}return t})();var xt=(()=>{class t{constructor(e,i){this._userService=e,this._resourceService=i,this.resourceId="",this.deleted=new se,this.title="Eliminar recurso",this.identity=this._userService.getIdentity(),this.token=this._userService.getToken(),this.url=A.url}ngOnInit(){}delete(){this._resourceService.deleteResource(this.token,this.resourceId).subscribe(e=>{if(e&&e.resource){this.deleted.emit();let i=document.getElementById("delete");if(i){let r=window.bootstrap?.Modal?.getInstance(i);r&&r.hide()}}},e=>{console.log(e)})}static{this.\u0275fac=function(i){return new(i||t)(y(P),y(we))}}static{this.\u0275cmp=w({type:t,selectors:[["delete-resource"]],inputs:{resourceId:"resourceId"},outputs:{deleted:"deleted"},standalone:!1,decls:16,vars:1,consts:[["id","delete","tabindex","-1","aria-labelledby","deleteTitle","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog","modal-dialog-centered"],[1,"modal-content"],[1,"modal-header"],["id","deleteTitle",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],["role","alert",1,"alert","alert-warning","mb-0"],[1,"fas","fa-exclamation-triangle","icon-message","me-2"],[1,"modal-footer"],[1,"btn","btn-danger",3,"click"],["data-bs-dismiss","modal",1,"btn","btn-primary","text-white"]],template:function(i,r){i&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h5",4),s(5),n(),u(6,"button",5),n(),o(7,"div",6)(8,"div",7),u(9,"i",8),s(10," \xBFEsta seguro que desea eliminar el recurso? "),n()(),o(11,"div",9)(12,"button",10),_("click",function(){return r.delete()}),s(13,"S\xED"),n(),o(14,"button",11),s(15,"No"),n()()()()()),i&2&&(a(5),h(r.title))},encapsulation:2})}}return t})();var bt=t=>["/perfil",t],dn=t=>["/admin/recursos",t];function lc(t,d){t&1&&(o(0,"div",13)(1,"div",14)(2,"div",15)(3,"span",16),s(4,"Loading..."),n()()()())}function dc(t,d){t&1&&(o(0,"div",13)(1,"h4",17),s(2," No se han creado recursos. "),n()())}function cc(t,d){if(t&1){let e=C();o(0,"div",31)(1,"div",32)(2,"input",33),_("click",function(){let r=f(e).$implicit,m=c(2);return g(m.setType(r.value))}),n(),o(3,"label",34),s(4),n()()()}if(t&2){let e=d.$implicit;a(2),v("id",e.value),a(),v("for",e.value),a(),b(" ",e.label," ")}}function mc(t,d){if(t&1){let e=C();o(0,"div",35)(1,"label",36)(2,"small",17),s(3,"Ordenar por:"),n()(),o(4,"div",37)(5,"select",38),_("change",function(){f(e);let r=c(2);return g(r.reloadResources())}),o(6,"option",39),s(7,"M\xE1s descargados"),n(),o(8,"option",40),s(9," M\xE1s populares"),n()()()()}if(t&2){let e=c(2);a(5),l("formControl",e.orderControl)}}function pc(t,d){t&1&&u(0,"img",75)}function uc(t,d){if(t&1&&u(0,"img",76),t&2){let e=c().$implicit,i=c(3);v("src",i.url+"get-image-user/"+e.author.picture,M)}}function _c(t,d){if(t&1){let e=C();K(0),o(1,"button",77),_("click",function(){f(e);let r=c().$implicit,m=c(3);return g(m.goToUrl(r.url))}),u(2,"i",78),n(),W()}}function fc(t,d){if(t&1&&(o(0,"a",79),u(1,"i",52),n()),t&2){let e=c().$implicit,i=c(3);O("title","Descargar recurso: ",e.file,""),v("href",i.url+"get-resource/"+e.file,M)}}function gc(t,d){if(t&1&&(K(0),o(1,"label",34),s(2,"S\xED"),n(),W()),t&2){let e=c().index;a(),O("for","resource",e,"")}}function vc(t,d){if(t&1&&(o(0,"label",34),s(1,"No"),n()),t&2){let e=c().index;O("for","resource",e,"")}}function hc(t,d){if(t&1){let e=C();o(0,"div")(1,"div",2)(2,"div",13)(3,"div",42)(4,"div",43)(5,"div",44)(6,"div",43)(7,"div",24)(8,"div",45),u(9,"i",46),n()()(),o(10,"div",47)(11,"div",48)(12,"button",49),u(13,"i",50),s(14),n(),o(15,"button",51)(16,"span"),u(17,"i",52),o(18,"span"),s(19),n()()()()()(),o(20,"div",24)(21,"h5",53)(22,"strong"),s(23),n()(),o(24,"p",54),s(25),n(),o(26,"p")(27,"strong"),s(28,"Subido por:"),n()(),o(29,"div",43)(30,"div",55)(31,"a",56)(32,"div",57)(33,"a",58),p(34,pc,1,0,"img",59)(35,uc,1,1,"img",60),n()()()(),o(36,"div",61)(37,"h6",62)(38,"a",63)(39,"strong"),s(40),n()(),u(41,"br"),o(42,"small",17),s(43),I(44,"amFromUnix"),I(45,"amLocale"),I(46,"amDateFormat"),n()()()()(),o(47,"div",44)(48,"div",43)(49,"div",24)(50,"button",64),_("click",function(){let r=f(e).$implicit,m=c(3);return g(m.openDetailsModal(r))}),u(51,"i",65),n(),o(52,"button",66),_("click",function(){let r=f(e).$implicit,m=c(3);return g(m.openEditModal(r))}),u(53,"i",67),n(),o(54,"button",68),_("click",function(){let r=f(e).$implicit,m=c(3);return g(m.openDeleteModal(r._id))}),u(55,"i",69),n(),p(56,_c,3,0,"ng-container",70)(57,fc,2,3,"ng-template",null,0,B),n()(),o(59,"div",71)(60,"div",72)(61,"span",17),s(62,"Visible: "),n(),o(63,"div",73)(64,"input",74),_("click",function(){let r=f(e).$implicit,m=c(3);return g(m.editResource(r,!0))}),n(),p(65,gc,3,2,"ng-container",70)(66,vc,2,2,"ng-template",null,1,B),n()()()()()()()()()}if(t&2){let e=d.$implicit,i=d.index,r=J(58),m=J(67),E=c(3);a(8),ee("text-center p-2 rounded-lg border border-ligth ",E.iconResource[e.type].class,""),a(),ee("text-white fas ",E.iconResource[e.type].icon,""),a(5),b(" ",e.score.toFixed(2)," "),a(5),b(" ",e.downloads,""),a(4),h(e.name),a(2),h(e.description),a(8),l("routerLink",x(32,bt,e.author._id)),a(),l("ngIf",!e.author.picture),a(),l("ngIf",e.author.picture),a(3),l("routerLink",x(34,bt,e.author._id)),a(2),V(" ",e.author.name," ",e.author.surname," "),a(3),h(L(46,29,L(45,26,X(44,24,e.created_at),"es"),"LLL")),a(13),l("ngIf",e.type=="link")("ngIfElse",r),a(8),O("id","resource",i,""),l("checked",e.visible),a(),l("ngIf",e.visible)("ngIfElse",m)}}function xc(t,d){if(t&1&&(o(0,"div"),p(1,hc,68,36,"div",41),n()),t&2){let e=c(2);a(),l("ngForOf",e.resources)}}function bc(t,d){t&1&&u(0,"img",75)}function Cc(t,d){if(t&1&&u(0,"img",76),t&2){let e=c().$implicit,i=c(3);v("src",i.url+"get-image-user/"+e.author.picture,M)}}function yc(t,d){if(t&1){let e=C();K(0),o(1,"button",77),_("click",function(){f(e);let r=c().$implicit,m=c(3);return g(m.goToUrl(r.url))}),u(2,"i",78),n(),W()}}function Ec(t,d){if(t&1&&(o(0,"a",79),u(1,"i",52),n()),t&2){let e=c().$implicit,i=c(3);O("title","Descargar recurso: ",e.file,""),v("href",i.url+"get-resource/"+e.file,M)}}function Sc(t,d){if(t&1&&(K(0),o(1,"label",34),s(2,"S\xED"),n(),W()),t&2){let e=c().index;a(),O("for","resource",e,"")}}function Ic(t,d){if(t&1&&(o(0,"label",34),s(1,"No"),n()),t&2){let e=c().index;O("for","resource",e,"")}}function wc(t,d){if(t&1){let e=C();o(0,"div")(1,"div",2)(2,"div",13)(3,"div",42)(4,"div",43)(5,"div",44)(6,"div",43)(7,"div",24)(8,"div",45),u(9,"i",46),n()()(),o(10,"div",47)(11,"div",48)(12,"button",49),u(13,"i",50),s(14),n(),o(15,"button",80)(16,"span"),u(17,"i",52),o(18,"span"),s(19),n()()()()()(),o(20,"div",24)(21,"h5",53)(22,"strong"),s(23),n()(),o(24,"p"),s(25),n(),o(26,"p")(27,"strong"),s(28,"Subido por:"),n()(),o(29,"div",43)(30,"div",55)(31,"a",56)(32,"div",57)(33,"a",58),p(34,bc,1,0,"img",59)(35,Cc,1,1,"img",60),n()()()(),o(36,"div",61)(37,"h6",62)(38,"a",63)(39,"strong"),s(40),n()(),u(41,"br"),o(42,"small",17),s(43),I(44,"amFromUnix"),I(45,"amLocale"),I(46,"amDateFormat"),n()()()()(),o(47,"div",44)(48,"div",43)(49,"div",24)(50,"button",64),_("click",function(){let r=f(e).$implicit,m=c(3);return g(m.openDetailsModal(r))}),u(51,"i",65),n(),o(52,"button",66),_("click",function(){let r=f(e).$implicit,m=c(3);return g(m.openEditModal(r))}),u(53,"i",67),n(),o(54,"button",68),_("click",function(){let r=f(e).$implicit,m=c(3);return g(m.openDeleteModal(r._id))}),u(55,"i",69),n(),p(56,yc,3,0,"ng-container",70)(57,Ec,2,3,"ng-template",null,0,B),n()(),o(59,"div",71)(60,"div",72)(61,"span",17),s(62,"Visible: "),n(),o(63,"div",73)(64,"input",74),_("click",function(){let r=f(e).$implicit,m=c(3);return g(m.editResource(r,!0))}),n(),p(65,Sc,3,2,"ng-container",70)(66,Ic,2,2,"ng-template",null,1,B),n()()()()()()()()()}if(t&2){let e=d.$implicit,i=d.index,r=J(58),m=J(67),E=c(3);a(8),ee("text-center p-2 rounded-lg border border-ligth ",E.iconResource[e.type].class,""),a(),ee("text-white fas ",E.iconResource[e.type].icon,""),a(5),b(" ",e.score.toFixed(2)," "),a(5),b(" ",e.downloads,""),a(4),h(e.name),a(2),h(e.description),a(8),l("routerLink",x(32,bt,e.author._id)),a(),l("ngIf",!e.author.picture),a(),l("ngIf",e.author.picture),a(3),l("routerLink",x(34,bt,e.author._id)),a(2),V(" ",e.author.name," ",e.author.surname," "),a(3),h(L(46,29,L(45,26,X(44,24,e.created_at),"es"),"LLL")),a(13),l("ngIf",e.type=="link")("ngIfElse",r),a(8),O("id","resource",i,""),l("checked",e.visible),a(),l("ngIf",e.visible)("ngIfElse",m)}}function kc(t,d){if(t&1&&(o(0,"div"),p(1,wc,68,36,"div",41),I(2,"filter"),n()),t&2){let e=c(2);a(),l("ngForOf",L(2,1,e.allResources,e.filter.value))}}function Tc(t,d){if(t&1&&(o(0,"li",84)(1,"a",85),s(2,"Anterior"),n()()),t&2){let e=c(3);a(),l("routerLink",x(1,dn,e.prevPage))}}function Fc(t,d){if(t&1&&(o(0,"li",84)(1,"a",86),s(2,"Siguiente"),n()()),t&2){let e=c(3);a(),l("routerLink",x(1,dn,e.nextPage))}}function Lc(t,d){if(t&1&&(o(0,"nav",81)(1,"ul",82),p(2,Tc,3,3,"li",83)(3,Fc,3,3,"li",83),n()()),t&2){let e=c(2);a(2),l("ngIf",e.page>1),a(),l("ngIf",e.page<e.pages&&e.page!=e.pages)}}function Pc(t,d){if(t&1&&(o(0,"div",13)(1,"form",18)(2,"h6",19),u(3,"i",20),s(4," Tipos de recursos "),n(),o(5,"div",21),p(6,cc,5,3,"div",22),n()(),o(7,"div",23)(8,"div",24)(9,"form")(10,"div",25)(11,"span",26),s(12,"Filtrar:"),n(),u(13,"input",27),n()()()(),p(14,mc,10,1,"div",28)(15,xc,2,1,"div",29)(16,kc,3,4,"div",29)(17,Lc,4,2,"nav",30),n()),t&2){let e=c();a(6),l("ngForOf",e.types),a(7),l("formControl",e.filter),a(),l("ngIf",e.filter.value||e.selectedTypes.length>0),a(),l("ngIf",!e.filter.value&&e.selectedTypes.length==0),a(),l("ngIf",e.filter.value||e.selectedTypes.length>0),a(),l("ngIf",!e.filter.value&&e.selectedTypes.length==0)}}function Vc(t,d){if(t&1&&u(0,"details-resource",87),t&2){let e=c();l("resource",e.detailsResourceItem)}}function Mc(t,d){if(t&1){let e=C();o(0,"edit-resource",88),_("edited",function(r){f(e);let m=c();return g(m.setNeedReload(r))}),n()}if(t&2){let e=c();l("resource",e.editResourceItem)}}function Ac(t,d){if(t&1){let e=C();o(0,"delete-resource",89),_("deleted",function(r){f(e);let m=c();return g(m.setNeedReload(r))}),n()}if(t&2){let e=c();l("resourceId",e.deleteResourceId)}}var qt=(()=>{class t{constructor(e,i,r,m){this._userService=e,this._resourceService=i,this._router=r,this._route=m,this.allResources=[],this.resources=[],this.iconResource=Oe,this.visible=new k,this.selectedTypes=[],this.selectedOrder=[],this.loading=!0,this.title="Repositorio",this.url=A.url,this.token=this._userService.getToken(),this.identity=this._userService.getIdentity(),this.areas=localStorage.getItem("areas"),this.types=nn,this.orderControl=new k(""),this.filter=new k("")}ngOnInit(){this.getAllResources(),this.actualPage()}ngDoCheck(){this.needReloadData&&(this.actualPage(),this.getAllResources(),this.needReloadData=!1)}setOrder(){if(this.orderControl){if(this.orderControl.value=="downloads")return"downloads";if(this.orderControl.value=="score")return"score"}return""}getAllResources(){let e=[],i=this.setOrder();this._resourceService.getAllResources(this.token,i,!1).subscribe(r=>{r.resources&&(this.allResources=r.resources,this.selectedTypes.length>0&&(this.selectedTypes.forEach(m=>{e=e.concat(this.allResources.filter(E=>E.type==m))}),this.allResources=e))},r=>{console.log(r)})}getResources(e=1){this._resourceService.getResources(this.token,e,!1).subscribe(i=>{i.resources&&(this.resources=i.resources,this.total=i.total,this.pages=i.pages,e>this.pages&&this._router.navigate(["/admin/recursos"]),this.loading=!1)},i=>{console.log(i)})}actualPage(){this._route.params.subscribe(e=>{let i=+e.page;this.page=i,i?(this.nextPage=i+1,this.prevPage=i-1,this.prevPage<=0&&(this.prevPage=1)):(this.page=1,this.nextPage=this.page+1),this.getResources(this.page)})}setType(e){this.selectedTypes.indexOf(e)>=0?this.selectedTypes.splice(this.selectedTypes.indexOf(e),1):this.selectedTypes.push(e),this.getAllResources()}reloadResources(){this.getAllResources()}goToUrl(e){e.includes("http://")||e.includes("https://")?window.open(e,"_blank"):window.open(`http://${e}`,"_blank")}editResource(e,i=null){i&&(e.visible?e.visible=!1:e.visible=!0),this._resourceService.editResource(this.token,e).subscribe(r=>{r&&r.resource._id&&this.getResources(this.page)},r=>{console.log(r)})}setDetailResource(e){this.detailsResourceItem=e}setEditResource(e){this.reloadForm=!0,this.editResourceItem=e}setDeleteResource(e){this.deleteResourceId=e}deleteResourceConfirm(e){confirm("\xBFEst\xE1 seguro que desea eliminar este recurso?")&&this._resourceService.deleteResource(this.token,e).subscribe(i=>{i&&i.resource&&this.getResources(this.page)},i=>{console.log(i)})}setNeedReload(e){this.needReloadData=!0}openAddModal(){setTimeout(()=>{try{let e=document.getElementById("add");if(e){let i=window.bootstrap?.Modal?.getInstance(e);i&&i.dispose(),new window.bootstrap.Modal(e,{backdrop:"static",keyboard:!1}).show()}}catch(e){console.log("Error al abrir modal de agregar:",e)}},0)}openDetailsModal(e){this.setDetailResource(e),setTimeout(()=>{try{let i=document.getElementById("details");if(i){let r=window.bootstrap?.Modal?.getInstance(i);r&&r.dispose(),new window.bootstrap.Modal(i,{backdrop:"static",keyboard:!1}).show()}}catch(i){console.log("Error al abrir modal de detalles:",i),alert(`Detalles del recurso: ${e.name}
Descripci\xF3n: ${e.description}`)}},0)}openEditModal(e){this.setEditResource(e),setTimeout(()=>{try{let i=document.getElementById("edit");if(i){let r=window.bootstrap?.Modal?.getInstance(i);r&&r.dispose(),new window.bootstrap.Modal(i,{backdrop:"static",keyboard:!1}).show()}}catch(i){console.log("Error al abrir modal de editar:",i)}},0)}openDeleteModal(e){this.setDeleteResource(e),setTimeout(()=>{try{let i=document.getElementById("delete");if(i){let r=window.bootstrap?.Modal?.getInstance(i);r&&r.dispose(),new window.bootstrap.Modal(i,{backdrop:"static",keyboard:!1}).show()}}catch(i){console.log("Error al abrir modal de eliminar:",i)}},0)}static{this.\u0275fac=function(i){return new(i||t)(y(P),y(we),y(j),y(z))}}static{this.\u0275cmp=w({type:t,selectors:[["resources"]],standalone:!1,decls:15,vars:7,consts:[["getResource",""],["noTemplate",""],[1,"card"],[1,"card-header"],[1,"m-0","text-primary","fw-bolder","float-start"],["type","button",1,"btn","btn-primary","float-end",3,"click"],[1,"fas","fa-plus"],[1,"ms-2"],["class","card-body",4,"ngIf"],[3,"added"],[3,"resource",4,"ngIf"],[3,"resource","edited",4,"ngIf"],[3,"resourceId","deleted",4,"ngIf"],[1,"card-body"],[1,"text-muted","text-center"],["role","status",1,"spinner-border",2,"width","3rem","height","3rem"],[1,"visually-hidden"],[1,"text-muted"],[1,"categories-form"],[1,"categories-section-title"],[1,"fas","fa-folder-open"],[1,"categories-container"],["class","category-item",4,"ngFor","ngForOf"],[1,"mb-3","row","mb-1"],[1,"col"],[1,"input-group","mb-2"],[1,"input-group-text"],["type","text","id","filter","placeholder","Filtro","autocomplete","off",1,"form-control",3,"formControl"],["class","mb-3 row mb-3",4,"ngIf"],[4,"ngIf"],["class","mt-3","aria-label","Page navigation",4,"ngIf"],[1,"category-item"],[1,"form-check"],["type","checkbox",1,"form-check-input",3,"click","id"],[1,"form-check-label",3,"for"],[1,"mb-3","row","mb-3"],["for","order",1,"col-3","offset-6","col-form-label","text-end"],[1,"col-3"],["id","orderOptions",1,"form-control",3,"change","formControl"],["value","downloads"],["value","score"],[4,"ngFor","ngForOf"],[1,"media-body"],[1,"row"],[1,"col-auto"],[2,"width","80px","height","80px","overflow","hidden"],[2,"font-size","62px"],[1,"row","mt-1"],[1,"col-12"],["disabled","","title","Calificaci\xF3n",1,"btn","w-100","btn-sm"],[1,"fas","fa-star"],["disabled","","title","Descargas",1,"btn","w-100","btn-sm"],[1,"fas","fa-download"],[1,"mt-0","text-truncate"],[1,"text-break"],[1,"col-auto","pe-0"],[1,"text-primary"],[1,"flex-shrink-0","rounded-circle","border-1","overflow-hidden",2,"width","40px","height","40px","background-color","aqua"],[3,"routerLink"],["class","img-fluid","src","assets/images/user-default.png",4,"ngIf"],["class","img-fluid",3,"src",4,"ngIf"],[1,"col","rounded","px-2"],[1,"mb-1"],[1,"text-primary",3,"routerLink"],["title","Ver detalles",1,"btn","btn-info","me-2",3,"click"],[1,"fas","fa-eye"],["title","Editar recurso",1,"btn","btn-warning","me-2",3,"click"],[1,"fas","fa-pen-square"],["title","Eliminar recurso",1,"btn","btn-danger","me-2",3,"click"],[1,"fas","fa-trash"],[4,"ngIf","ngIfElse"],[1,"row","mt-3"],[1,"text-center","col"],[1,"form-check","form-switch"],["type","checkbox",1,"form-check-input",3,"click","id","checked"],["src","assets/images/user-default.png",1,"img-fluid"],[1,"img-fluid",3,"src"],["title","Ir al enlace",1,"btn","btn-secondary",3,"click"],[1,"fas","fa-hand-pointer"],["target","_blank",1,"btn","btn-secondary",3,"title","href"],["disabled","",1,"btn","w-100","btn-sm","text-truncate"],["aria-label","Page navigation",1,"mt-3"],[1,"pagination","justify-content-end"],["class","page-item",4,"ngIf"],[1,"page-item"],[1,"page-link","bg-primary",3,"routerLink"],[1,"page-link","bg-info",3,"routerLink"],[3,"resource"],[3,"edited","resource"],[3,"deleted","resourceId"]],template:function(i,r){i&1&&(o(0,"div",2)(1,"div",3)(2,"h3",4),s(3),n(),o(4,"button",5),_("click",function(){return r.openAddModal()}),u(5,"i",6),o(6,"span",7),s(7,"Agregar recurso"),n()()(),p(8,lc,5,0,"div",8)(9,dc,3,0,"div",8)(10,Pc,18,6,"div",8),n(),o(11,"add-resource",9),_("added",function(E){return r.setNeedReload(E)}),n(),p(12,Vc,1,1,"details-resource",10)(13,Mc,1,1,"edit-resource",11)(14,Ac,1,1,"delete-resource",12)),i&2&&(a(3),h(r.title),a(5),l("ngIf",r.loading),a(),l("ngIf",r.resources.length==0&&!r.loading),a(),l("ngIf",r.resources.length!=0),a(2),l("ngIf",r.detailsResourceItem),a(),l("ngIf",r.editResourceItem),a(),l("ngIf",r.deleteResourceId))},dependencies:[T,F,q,ce,me,N,de,D,$,Ce,le,R,on,ht,sn,xt,ue,_e,fe,ye],encapsulation:2})}}return t})();var cn=t=>["/perfil",t],mn=t=>["/admin/recursos-propuestos",t];function Oc(t,d){t&1&&(o(0,"div",7)(1,"div",8)(2,"div",9)(3,"span",10),s(4,"Loading..."),n()()()())}function Rc(t,d){t&1&&(o(0,"div",7)(1,"h4",11),s(2," Parece que todo el trabajo aqu\xED, ya fue realizado. "),u(3,"i",12),n()())}function Dc(t,d){t&1&&u(0,"img",40)}function Nc(t,d){if(t&1&&u(0,"img",41),t&2){let e=c().$implicit,i=c(2);v("src",i.url+"get-image-user/"+e.author.picture,M)}}function Uc(t,d){if(t&1){let e=C();K(0),o(1,"button",42),_("click",function(){f(e);let r=c().$implicit,m=c(2);return g(m.goToUrl(r.url))}),u(2,"i",43),n(),W()}}function $c(t,d){if(t&1&&(o(0,"a",44),u(1,"i",45),n()),t&2){let e=c().$implicit,i=c(2);O("title","Descargar recurso: ",e.file,""),v("href",i.url+"get-resource/"+e.file,M)}}function qc(t,d){if(t&1){let e=C();o(0,"div")(1,"div",1)(2,"div",7)(3,"div",17)(4,"div",18)(5,"div",19)(6,"div",18)(7,"div",20)(8,"div",21),u(9,"i",22),n()()()(),o(10,"div",20)(11,"h5",23)(12,"strong"),s(13),n()(),o(14,"p"),s(15),n(),o(16,"p")(17,"strong"),s(18,"Subido por:"),n()(),o(19,"div",18)(20,"div",24)(21,"a",25)(22,"div",26)(23,"a",27),p(24,Dc,1,0,"img",28)(25,Nc,1,1,"img",29),n()()()(),o(26,"div",30)(27,"h6",31)(28,"a",32)(29,"strong"),s(30),n()(),u(31,"br"),o(32,"small",11),s(33),I(34,"amFromUnix"),I(35,"amLocale"),I(36,"amDateFormat"),n()()()()(),o(37,"div",19)(38,"div",18)(39,"div",20)(40,"button",33),_("click",function(){let r=f(e).$implicit,m=c(2);return g(m.setDetailResource(r))}),u(41,"i",34),n(),o(42,"button",35),_("click",function(){let r=f(e).$implicit,m=c(2);return g(m.editResource(r))}),u(43,"i",36),n(),o(44,"button",37),_("click",function(){let r=f(e).$implicit,m=c(2);return g(m.setDeleteResource(r._id))}),u(45,"i",38),n(),p(46,Uc,3,0,"ng-container",39)(47,$c,2,3,"ng-template",null,0,B),n()()()()()()()()}if(t&2){let e=d.$implicit,i=J(48),r=c(2);be("id",e._id),a(8),ee("text-center p-2 rounded-lg border border-ligth ",r.iconResource[e.type].class,""),a(),ee("text-white fas ",r.iconResource[e.type].icon,""),a(4),h(e.name),a(2),h(e.description),a(8),l("routerLink",x(26,cn,e.author._id)),a(),l("ngIf",!e.author.picture),a(),l("ngIf",e.author.picture),a(3),l("routerLink",x(28,cn,e.author._id)),a(2),V(" ",e.author.name," ",e.author.surname," "),a(3),h(L(36,23,L(35,20,X(34,18,e.created_at),"es"),"LLL")),a(13),l("ngIf",e.type=="link")("ngIfElse",i)}}function jc(t,d){if(t&1&&(o(0,"li",46)(1,"a",47),s(2,"Anterior"),n()()),t&2){let e=c(2);a(),l("routerLink",x(1,mn,e.prevPage))}}function Bc(t,d){if(t&1&&(o(0,"li",46)(1,"a",48),s(2,"Siguiente"),n()()),t&2){let e=c(2);a(),l("routerLink",x(1,mn,e.nextPage))}}function Gc(t,d){if(t&1&&(o(0,"div",7),p(1,qc,49,30,"div",13),o(2,"nav",14)(3,"ul",15),p(4,jc,3,3,"li",16)(5,Bc,3,3,"li",16),n()()()),t&2){let e=c();a(),l("ngForOf",e.resources),a(3),l("ngIf",e.page>1),a(),l("ngIf",e.page<e.pages&&e.page!=e.pages)}}function zc(t,d){if(t&1&&u(0,"details-resource",49),t&2){let e=c();l("parent","proposed-resource")("resource",e.detailsResourceItem)}}function Kc(t,d){if(t&1){let e=C();o(0,"delete-resource",50),_("deleted",function(r){f(e);let m=c();return g(m.setNeedReload(r))}),n()}if(t&2){let e=c();l("resourceId",e.deleteResourceId)}}var jt=(()=>{class t{constructor(e,i,r,m){this._userService=e,this._resourceService=i,this._router=r,this._route=m,this.resources=[],this.iconResource=Oe,this.loading=!0,this.title="Recursos propuestos",this.url=A.url,this.token=this._userService.getToken(),this.identity=this._userService.getIdentity(),this.areas=localStorage.getItem("areas")}ngOnInit(){this.actualPage(),this._route.queryParams.subscribe(e=>{let i=e.resourceId;i&&setTimeout(()=>this.focusResource(i),0)})}ngDoCheck(){this.needReloadData&&(this.actualPage(),this.needReloadData=!1)}getResources(e=1){this._resourceService.getSuggestedResources(this.token,e).subscribe(i=>{if(i.resources){this.resources=i.resources,this.total=i.total,this.pages=i.pages,e>this.pages&&this._router.navigate(["/admin/recursos-propuestos"]),this.loading=!1;let r=this._route.snapshot.queryParamMap.get("resourceId");r&&setTimeout(()=>this.focusResource(r),0)}},i=>{console.log(i)})}actualPage(){this._route.params.subscribe(e=>{let i=+e.page;this.page=i,i?(this.nextPage=i+1,this.prevPage=i-1,this.prevPage<=0&&(this.prevPage=1)):(this.page=1,this.nextPage=this.page+1),this.getResources(this.page)})}focusResource(e){let i=document.getElementById(e)||document.getElementById("res-"+e);if(i){i.scrollIntoView({behavior:"smooth",block:"center"});try{i.classList.add("focus-ring"),setTimeout(()=>i.classList.remove("focus-ring"),2e3)}catch{}}}editResource(e){e.accepted=!0,this._resourceService.editResource(this.token,e).subscribe(i=>{i&&i.resource._id&&(console.log(i),this.getResources(this.page))},i=>{console.log(i)})}goToUrl(e){e.includes("http://")||e.includes("https://")?window.open(e,"_blank"):window.open(`http://${e}`,"_blank")}setDetailResource(e){this.detailsResourceItem=e}setEditResource(e){this.reloadForm=!0,this.editResourceItem=e}setDeleteResource(e){this.deleteResourceId=e}setNeedReload(e){this.needReloadData=!0}static{this.\u0275fac=function(i){return new(i||t)(y(P),y(we),y(j),y(z))}}static{this.\u0275cmp=w({type:t,selectors:[["proposed-resource"]],standalone:!1,decls:9,vars:6,consts:[["getResource",""],[1,"card"],[1,"card-header"],[1,"m-0","text-primary","fw-bolder","float-start"],["class","card-body",4,"ngIf"],[3,"parent","resource",4,"ngIf"],[3,"resourceId","deleted",4,"ngIf"],[1,"card-body"],[1,"text-muted","text-center"],["role","status",1,"spinner-border",2,"width","3rem","height","3rem"],[1,"visually-hidden"],[1,"text-muted"],[1,"fas","fa-laugh","icon-message"],[4,"ngFor","ngForOf"],["aria-label","Page navigation",1,"mt-3"],[1,"pagination","justify-content-end"],["class","page-item",4,"ngIf"],[1,"media-body"],[1,"row"],[1,"col-auto"],[1,"col"],[2,"width","80px","height","80px","overflow","hidden"],[2,"font-size","62px"],[1,"mt-0","text-truncate"],[1,"col-auto","pe-0"],[1,"text-primary"],[1,"flex-shrink-0","rounded-circle","border-1","overflow-hidden",2,"width","40px","height","40px","background-color","aqua"],[3,"routerLink"],["class","img-fluid","src","assets/images/user-default.png",4,"ngIf"],["class","img-fluid",3,"src",4,"ngIf"],[1,"col","rounded","px-2"],[1,"mb-1"],[1,"text-primary",3,"routerLink"],["title","Ver detalles","data-bs-toggle","modal","data-bs-target","#details",1,"btn","btn-info","me-2",3,"click"],[1,"fas","fa-eye"],["title","Avalar recurso",1,"btn","btn-success","me-2",3,"click"],[1,"fas","fa-check-square"],["title","Eliminar recurso","data-bs-toggle","modal","data-bs-target","#delete",1,"btn","btn-danger","me-2",3,"click"],[1,"fas","fa-trash"],[4,"ngIf","ngIfElse"],["src","assets/images/user-default.png",1,"img-fluid"],[1,"img-fluid",3,"src"],["title","Ir al enlace",1,"btn","btn-secondary",3,"click"],[1,"fas","fa-hand-pointer"],["target","_blank",1,"btn","btn-secondary",3,"title","href"],[1,"fas","fa-download"],[1,"page-item"],[1,"page-link","bg-primary",3,"routerLink"],[1,"page-link","bg-info",3,"routerLink"],[3,"parent","resource"],[3,"deleted","resourceId"]],template:function(i,r){i&1&&(o(0,"div",1)(1,"div",2)(2,"h3",3),s(3),n()(),p(4,Oc,5,0,"div",4)(5,Rc,4,0,"div",4)(6,Gc,6,3,"div",4),n(),p(7,zc,1,2,"details-resource",5)(8,Kc,1,1,"delete-resource",6)),i&2&&(a(3),h(r.title),a(),l("ngIf",r.loading),a(),l("ngIf",r.resources.length==0&&!r.loading),a(),l("ngIf",r.resources.length>0),a(),l("ngIf",r.detailsResourceItem),a(),l("ngIf",r.deleteResourceId))},dependencies:[T,F,R,ht,xt,ue,_e,fe],encapsulation:2})}}return t})();function Hc(t,d){if(t&1&&(o(0,"option",21),s(1),n()),t&2){let e=d.$implicit;l("value",e),a(),h(e)}}function Yc(t,d){if(t&1&&(o(0,"option",21),s(1),n()),t&2){let e=d.$implicit;l("value",e),a(),h(e)}}function Qc(t,d){if(t&1&&(o(0,"div",22),s(1),n()),t&2){let e=c();a(),h(e.errorMessage)}}function Xc(t,d){if(t&1&&(o(0,"div",23),s(1),n()),t&2){let e=c();a(),h(e.successMessage)}}var pn=(()=>{class t{constructor(e,i,r){this.fb=e,this.errorService=i,this.activeModal=r,this.file=null,this.errorTypes=["Fallo / Bug","Mejora","Caracter\xEDstica deseada"],this.modules=["Modulo Inicio","Modulo Lecciones","Repositorio","Publicaciones","Perfil","Mensajes"],this.errorMessage=null,this.successMessage=null}ngOnInit(){this.editErrorForm=this.fb.group({type:[this.errorReport.type,S.required],module:[this.errorReport.module,S.required],description:[this.errorReport.description,S.required],steps:[this.errorReport.steps,S.required]})}onFileChange(e){e.target.files.length>0&&(this.file=e.target.files[0])}onSubmit(){if(this.editErrorForm.valid){let e=this.editErrorForm.value;this.errorService.updateErrorReport(this.errorReport._id,e,this.file).subscribe({next:()=>{this.successMessage="Reporte actualizado con \xE9xito.",setTimeout(()=>{this.activeModal.close("success")},1e3)},error:i=>{this.errorMessage="Error al actualizar el reporte: "+(i.error.message||i.message||"Error desconocido")}})}}static{this.\u0275fac=function(i){return new(i||t)(y(Me),y(pt),y(li))}}static{this.\u0275cmp=w({type:t,selectors:[["app-edit-error"]],inputs:{errorReport:"errorReport"},standalone:!1,decls:34,vars:6,consts:[[1,"modal-header"],["id","editErrorModalLabel",1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[3,"ngSubmit","formGroup"],[1,"form-group"],["for","type"],["formControlName","type",1,"form-control"],[3,"value",4,"ngFor","ngForOf"],["for","module"],["formControlName","module",1,"form-control"],["for","description"],["formControlName","description",1,"form-control"],["for","steps"],["formControlName","steps",1,"form-control"],["for","attachment"],["type","file",1,"form-control",3,"change"],["class","alert alert-danger",4,"ngIf"],["class","alert alert-success",4,"ngIf"],["type","submit",1,"btn","btn-primary",3,"disabled"],[3,"value"],[1,"alert","alert-danger"],[1,"alert","alert-success"]],template:function(i,r){i&1&&(o(0,"div",0)(1,"h5",1),s(2,"Editar Error"),n(),o(3,"button",2),_("click",function(){return r.activeModal.dismiss()}),o(4,"span",3),s(5,"\xD7"),n()()(),o(6,"div",4)(7,"form",5),_("ngSubmit",function(){return r.onSubmit()}),o(8,"div",6)(9,"label",7),s(10,"Tipo"),n(),o(11,"select",8),p(12,Hc,2,2,"option",9),n()(),o(13,"div",6)(14,"label",10),s(15,"M\xF3dulo"),n(),o(16,"select",11),p(17,Yc,2,2,"option",9),n()(),o(18,"div",6)(19,"label",12),s(20,"Descripci\xF3n"),n(),u(21,"textarea",13),n(),o(22,"div",6)(23,"label",14),s(24,"Pasos"),n(),u(25,"textarea",15),n(),o(26,"div",6)(27,"label",16),s(28,"Archivo Adjunto"),n(),o(29,"input",17),_("change",function(E){return r.onFileChange(E)}),n()(),p(30,Qc,2,1,"div",18)(31,Xc,2,1,"div",19),o(32,"button",20),s(33,"Guardar Cambios"),n()()()),i&2&&(a(7),l("formGroup",r.editErrorForm),a(5),l("ngForOf",r.errorTypes),a(5),l("ngForOf",r.modules),a(13),l("ngIf",r.errorMessage),a(),l("ngIf",r.successMessage),a(),l("disabled",r.editErrorForm.invalid))},dependencies:[T,F,q,ce,me,N,de,D,$,H,Y],encapsulation:2})}}return t})();var un=t=>["/inicio/publicacion",t],Ct=t=>["/perfil",t];function Zc(t,d){if(t&1){let e=C();o(0,"div",29)(1,"input",46),_("change",function(){let r=f(e).$implicit,m=c();return g(m.toggleFilterType(r))}),n(),o(2,"label",47),s(3),n()()}if(t&2){let e=d.$implicit,i=c();a(),l("id",e)("checked",i.filterType.includes(e)),a(),l("for",e),a(),h(e)}}function em(t,d){if(t&1){let e=C();o(0,"div",29)(1,"input",46),_("change",function(){let r=f(e).$implicit,m=c();return g(m.toggleFilterModule(r))}),n(),o(2,"label",47),s(3),n()()}if(t&2){let e=d.$implicit,i=c();a(),l("id",e)("checked",i.filterModule.includes(e)),a(),l("for",e),a(),h(e)}}function tm(t,d){t&1&&(o(0,"div"),s(1,"Cargando reportes t\xE9cnicos..."),n())}function im(t,d){t&1&&(o(0,"div"),s(1,"No hay reportes t\xE9cnicos."),n())}function nm(t,d){if(t&1){let e=C();K(0),o(1,"a",59),_("click",function(){f(e);let r=c().$implicit,m=c(2);return g(m.getFile(r.attachment[0].fileName))}),s(2),n(),W()}if(t&2){let e=c().$implicit;a(2),h(e.attachment[0].originalName)}}function om(t,d){t&1&&s(0,"No hay adjunto")}function rm(t,d){if(t&1){let e=C();o(0,"tr")(1,"td"),s(2),n(),o(3,"td"),s(4),n(),o(5,"td"),s(6),n(),o(7,"td"),s(8),n(),o(9,"td"),p(10,nm,3,1,"ng-container",54)(11,om,1,0,"ng-template",null,0,B),n(),o(13,"td")(14,"button",55),u(15,"i",56),n(),o(16,"button",57),_("click",function(){let r=f(e).$implicit,m=c(2);return g(m.openEditModal(r))}),s(17,"Editar"),n(),o(18,"button",58),_("click",function(){let r=f(e).$implicit,m=c(2);return g(m.confirmDeleteReport(r))}),s(19,"Eliminar"),n()()()}if(t&2){let e=d.$implicit,i=d.index,r=J(12);a(2),h(e.type),a(2),h(e.module||"N/A"),a(2),h(e.description),a(2),h(e.steps),a(2),l("ngIf",e.attachment&&e.attachment.length>0)("ngIfElse",r),a(4),be("data-bs-target","#technicalDetailsModal-"+(e._id||i))}}function am(t,d){if(t&1){let e=C();K(0),o(1,"div")(2,"a",59),_("click",function(){f(e);let r=c().$implicit,m=c(2);return g(m.getFile(r.attachment[0].fileName))}),s(3),n()(),W()}if(t&2){let e=c().$implicit;a(3),h(e.attachment[0].originalName)}}function sm(t,d){t&1&&s(0,"No hay adjunto")}function lm(t,d){if(t&1&&(o(0,"div")(1,"div",60)(2,"div",61)(3,"div",36)(4,"div",37)(5,"h5",38),s(6,"Detalle del reporte t\xE9cnico"),n(),u(7,"button",39),n(),o(8,"div",40)(9,"div",62)(10,"strong"),s(11,"Tipo:"),n(),s(12),n(),o(13,"div",62)(14,"strong"),s(15,"M\xF3dulo:"),n(),s(16),n(),o(17,"div",62)(18,"strong"),s(19,"Descripci\xF3n:"),n(),u(20,"br"),s(21),n(),o(22,"div",62)(23,"strong"),s(24,"Pasos:"),n(),u(25,"br"),s(26),n(),o(27,"div",62)(28,"strong"),s(29,"Adjuntos:"),n(),p(30,am,4,1,"ng-container",54)(31,sm,1,0,"ng-template",null,1,B),n()(),o(33,"div",43)(34,"button",44),s(35,"Cerrar"),n()()()()()()),t&2){let e=d.$implicit,i=d.index,r=J(32);a(),O("id","technicalDetailsModal-",e._id||i,""),a(11),b(" ",e.type,""),a(4),b(" ",e.module||"N/A",""),a(5),h(e.description),a(5),h(e.steps||"N/A"),a(4),l("ngIf",e.attachment&&e.attachment.length>0)("ngIfElse",r)}}function dm(t,d){if(t&1){let e=C();o(0,"div")(1,"table",48)(2,"thead")(3,"tr")(4,"th"),s(5,"Tipo"),n(),o(6,"th"),s(7,"M\xF3dulo"),n(),o(8,"th"),s(9,"Descripci\xF3n"),n(),o(10,"th"),s(11,"Pasos"),n(),o(12,"th"),s(13,"Archivo Adjunto"),n(),o(14,"th"),s(15,"Acciones"),n()()(),o(16,"tbody"),p(17,rm,20,7,"tr",49),n()(),o(18,"div",50)(19,"button",51),_("click",function(){f(e);let r=c();return g(r.previousTechnicalPage())}),s(20,"Anterior"),n(),o(21,"span",52),s(22),n(),o(23,"button",53),_("click",function(){f(e);let r=c();return g(r.nextTechnicalPage())}),s(24,"Siguiente"),n()(),p(25,lm,36,8,"div",49),n()}if(t&2){let e=c();a(17),l("ngForOf",e.technicalReports),a(2),l("disabled",e.currentTechnicalPage===1),a(3),V("P\xE1gina ",e.currentTechnicalPage," de ",e.totalTechnicalPages,""),a(),l("disabled",e.currentTechnicalPage===e.totalTechnicalPages),a(2),l("ngForOf",e.technicalReports)}}function cm(t,d){t&1&&(o(0,"div"),s(1,"Cargando denuncias..."),n())}function mm(t,d){t&1&&(o(0,"div"),s(1,"No hay denuncias."),n())}function pm(t,d){t&1&&(o(0,"span",74),u(1,"i",75),s(2,"Publicaci\xF3n "),n())}function um(t,d){t&1&&(o(0,"span",76),u(1,"i",77),s(2,"Usuario "),n())}function _m(t,d){if(t&1&&(o(0,"a",78),u(1,"i",79),s(2," Ver "),n()),t&2){let e=c().$implicit;l("routerLink",x(1,un,e.publicationId._id||e.publicationId))}}function fm(t,d){if(t&1&&(o(0,"a",78),u(1,"i",80),s(2),n()),t&2){let e=c().$implicit;l("routerLink",x(2,Ct,(e.reportedUser==null?null:e.reportedUser._id)||e.reportedUserId._id||e.reportedUserId)),a(2),b(" ",(e.reportedUser==null?null:e.reportedUser.name)||"Ver"," ")}}function gm(t,d){if(t&1&&(o(0,"a",81),s(1),n()),t&2){let e=c().$implicit;l("routerLink",x(3,Ct,e.reporter._id)),a(),V(" ",e.reporter==null?null:e.reporter.name," ",e.reporter==null?null:e.reporter.surname," ")}}function vm(t,d){if(t&1&&(o(0,"span"),s(1),n()),t&2){let e=c().$implicit;a(),b(" ",(e.reporter==null?null:e.reporter.name)||"N/A"," ")}}function hm(t,d){if(t&1){let e=C();o(0,"button",82),_("click",function(){f(e);let r=c().$implicit,m=c(2);return g(m.confirmDeletePublication(r))}),u(1,"i",83),s(2," Eliminar "),n()}}function xm(t,d){if(t&1){let e=C();o(0,"button",84),_("click",function(){f(e);let r=c().$implicit,m=c(2);return g(m.openWarningModal(r))}),u(1,"i",85),s(2," Advertir "),n()}}function bm(t,d){if(t&1){let e=C();o(0,"tr")(1,"td"),s(2),n(),o(3,"td"),p(4,pm,3,0,"span",63)(5,um,3,0,"span",64),n(),o(6,"td"),p(7,_m,3,3,"a",65)(8,fm,3,4,"a",65),n(),o(9,"td")(10,"span",66),s(11),n()(),o(12,"td"),p(13,gm,2,5,"a",67)(14,vm,2,1,"span",23),n(),o(15,"td")(16,"div",68)(17,"button",69),u(18,"i",56),s(19," Detalle "),n(),p(20,hm,3,0,"button",70)(21,xm,3,0,"button",71),o(22,"button",72),_("click",function(){let r=f(e).$implicit,m=c(2);return g(m.resolveComplaint(r,!1))}),u(23,"i",73),s(24," Resolver "),n()()()()}if(t&2){let e=d.$implicit,i=d.index;a(2),h(e.type),a(2),l("ngIf",e.category==="publication"),a(),l("ngIf",e.category==="user"),a(2),l("ngIf",e.category==="publication"&&e.publicationId),a(),l("ngIf",e.category==="user"&&e.reportedUserId),a(2),l("title",e.description),a(),b(" ",e.description," "),a(2),l("ngIf",e.reporter==null?null:e.reporter._id),a(),l("ngIf",!(e.reporter!=null&&e.reporter._id)),a(3),be("data-bs-target","#complaintDetailsModal-"+(e._id||i)),a(3),l("ngIf",e.category==="publication"),a(),l("ngIf",e.category==="user")}}function Cm(t,d){if(t&1&&(o(0,"a",81),s(1),n()),t&2){let e=c().$implicit;l("routerLink",x(3,Ct,e.reporter._id)),a(),V(" ",e.reporter==null?null:e.reporter.name," ",e.reporter==null?null:e.reporter.surname," ")}}function ym(t,d){if(t&1&&(o(0,"span"),s(1),n()),t&2){let e=c().$implicit;a(),V(" ",e.reporter==null?null:e.reporter.name," ",e.reporter==null?null:e.reporter.surname," ")}}function Em(t,d){if(t&1&&(o(0,"div",62)(1,"strong"),s(2,"Publicaci\xF3n denunciada:"),n(),u(3,"br"),o(4,"a",87),u(5,"i",88),s(6,"Ver publicaci\xF3n "),n()()),t&2){let e=c().$implicit;a(4),l("routerLink",x(1,un,e.publicationId._id||e.publicationId))}}function Sm(t,d){if(t&1&&(o(0,"div",62)(1,"strong"),s(2,"Usuario denunciado:"),n(),u(3,"br"),o(4,"a",87),u(5,"i",89),s(6),n()()),t&2){let e=c().$implicit;a(4),l("routerLink",x(3,Ct,(e.reportedUser==null?null:e.reportedUser._id)||e.reportedUserId._id||e.reportedUserId)),a(2),V("",e.reportedUser==null?null:e.reportedUser.name," ",e.reportedUser==null?null:e.reportedUser.surname," ")}}function Im(t,d){if(t&1){let e=C();K(0),o(1,"div")(2,"a",59),_("click",function(){f(e);let r=c().$implicit,m=c(2);return g(m.getFile(r.attachment[0].fileName))}),s(3),n()(),W()}if(t&2){let e=c().$implicit;a(3),h(e.attachment[0].originalName)}}function wm(t,d){t&1&&s(0,"No hay adjunto")}function km(t,d){if(t&1&&(o(0,"div")(1,"div",60)(2,"div",61)(3,"div",36)(4,"div",37)(5,"h5",38),s(6,"Detalle de la denuncia"),n(),u(7,"button",39),n(),o(8,"div",40)(9,"div",62)(10,"strong"),s(11,"Categor\xEDa:"),n(),s(12),n(),o(13,"div",62)(14,"strong"),s(15,"Tipo:"),n(),s(16),n(),o(17,"div",62)(18,"strong"),s(19,"Denunciante:"),n(),p(20,Cm,2,5,"a",67)(21,ym,2,2,"span",23),n(),p(22,Em,7,3,"div",86)(23,Sm,7,5,"div",86),o(24,"div",62)(25,"strong"),s(26,"Descripci\xF3n:"),n(),u(27,"br"),s(28),n(),o(29,"div",62)(30,"strong"),s(31,"Detalles adicionales:"),n(),u(32,"br"),s(33),n(),o(34,"div",62)(35,"strong"),s(36,"Adjuntos:"),n(),p(37,Im,4,1,"ng-container",54)(38,wm,1,0,"ng-template",null,2,B),n()(),o(40,"div",43)(41,"button",44),s(42,"Cerrar"),n()()()()()()),t&2){let e=d.$implicit,i=d.index,r=J(39);a(),O("id","complaintDetailsModal-",e._id||i,""),a(11),b(" ",e.category==="publication"?"Denuncia de publicaci\xF3n":"Denuncia de usuario",""),a(4),b(" ",e.type,""),a(4),l("ngIf",e.reporter==null?null:e.reporter._id),a(),l("ngIf",!(e.reporter!=null&&e.reporter._id)),a(),l("ngIf",e.publicationId),a(),l("ngIf",e.reportedUserId),a(5),h(e.description),a(5),h(e.steps||"N/A"),a(4),l("ngIf",e.attachment&&e.attachment.length>0)("ngIfElse",r)}}function Tm(t,d){if(t&1){let e=C();o(0,"div")(1,"table",48)(2,"thead")(3,"tr")(4,"th"),s(5,"Tipo"),n(),o(6,"th"),s(7,"Categor\xEDa"),n(),o(8,"th"),s(9,"Objetivo"),n(),o(10,"th"),s(11,"Descripci\xF3n"),n(),o(12,"th"),s(13,"Denunciante"),n(),o(14,"th"),s(15,"Acciones"),n()()(),o(16,"tbody"),p(17,bm,25,12,"tr",49),n()(),o(18,"div",50)(19,"button",51),_("click",function(){f(e);let r=c();return g(r.previousComplaintsPage())}),s(20,"Anterior"),n(),o(21,"span",52),s(22),n(),o(23,"button",53),_("click",function(){f(e);let r=c();return g(r.nextComplaintsPage())}),s(24,"Siguiente"),n()(),p(25,km,43,12,"div",49),n()}if(t&2){let e=c();a(17),l("ngForOf",e.complaints),a(2),l("disabled",e.currentComplaintsPage===1),a(3),V("P\xE1gina ",e.currentComplaintsPage," de ",e.totalComplaintsPages,""),a(),l("disabled",e.currentComplaintsPage===e.totalComplaintsPages),a(2),l("ngForOf",e.complaints)}}var _n=(()=>{class t{constructor(e,i,r,m){this.errorService=e,this.modalService=i,this.publicationService=r,this.userService=m,this.technicalReports=[],this.loadingTechnical=!1,this.currentTechnicalPage=1,this.totalTechnicalPages=0,this.complaints=[],this.loadingComplaints=!1,this.currentComplaintsPage=1,this.totalComplaintsPages=0,this.complaintFilter=["publication","user"],this.pageSize=10,this.filterType=[],this.filterModule=[],this.errorTypes=["Fallo / Bug","Mejora","Caracter\xEDstica deseada"],this.modules=["Modulo Inicio","Modulo Lecciones","Repositorio","Publicaciones","Perfil","Mensajes"],this.selectedComplaint=null,this.warningMessage="",this.token="",this.errorReports=[],this.loading=!1,this.currentPage=1,this.totalPages=0,this.url=A.url,this.token=this.userService.getToken()||""}ngOnInit(){this.loadTechnicalReports(),this.loadComplaints(),this.loadErrorReports()}loadErrorReports(e=1){this.loading=!0;let i=this.filterType.length>0?this.filterType.join(","):"",r=this.filterModule.length>0?this.filterModule.join(","):"";this.errorService.getErrorReports(e,this.pageSize,i,r).subscribe({next:m=>{this.errorReports=m.data,this.totalPages=Math.ceil(m.total/this.pageSize),this.loading=!1},error:m=>{console.error("Error al obtener los reportes de error:",m),this.loading=!1}})}nextPage(){this.currentPage<this.totalPages&&(this.currentPage++,this.loadErrorReports(this.currentPage))}previousPage(){this.currentPage>1&&(this.currentPage--,this.loadErrorReports(this.currentPage))}toggleFilterType(e){let i=this.filterType.indexOf(e);i>-1?this.filterType.splice(i,1):this.filterType.push(e),this.filterErrors()}toggleFilterModule(e){let i=this.filterModule.indexOf(e);i>-1?this.filterModule.splice(i,1):this.filterModule.push(e),this.filterErrors()}filterErrors(){this.currentPage=1,this.loadErrorReports()}openEditModal(e){let i=this.modalService.open(pn,{size:"lg"});i.componentInstance.errorReport=e,console.log("trying to  load Edit"),i.result.then(r=>{r==="success"&&(console.log("success loading Edit"),this.loadErrorReports(this.currentPage))}).catch(r=>{console.log("failed to  load Edit"),console.error("Error al abrir el modal:",r)})}confirmDeleteReport(e){confirm("\xBFEst\xE1s seguro de que deseas eliminar este reporte?")&&this.deleteReport(e._id)}deleteReport(e){this.errorService.deleteErrorReport(e).subscribe({next:()=>this.loadErrorReports(this.currentPage),error:i=>console.error("Error al eliminar el reporte:",i)})}getFile(e){this.errorService.getFile(e).subscribe({next:i=>{let r=window.URL.createObjectURL(i);window.open(r)},error:i=>{console.error("Error al obtener el archivo:",i)}})}filePath(e){return`${this.url}/files/${e}`}loadTechnicalReports(e=1){this.loadingTechnical=!0;let i=this.filterType.length>0?this.filterType.join(","):"",r=this.filterModule.length>0?this.filterModule.join(","):"";this.errorService.getErrorReports(e,this.pageSize,i,r,"technical").subscribe({next:m=>{this.technicalReports=m.data,this.totalTechnicalPages=Math.ceil(m.total/this.pageSize),this.loadingTechnical=!1},error:m=>{console.error("Error al obtener los reportes t\xE9cnicos:",m),this.loadingTechnical=!1}})}nextTechnicalPage(){this.currentTechnicalPage<this.totalTechnicalPages&&(this.currentTechnicalPage++,this.loadTechnicalReports(this.currentTechnicalPage))}previousTechnicalPage(){this.currentTechnicalPage>1&&(this.currentTechnicalPage--,this.loadTechnicalReports(this.currentTechnicalPage))}loadComplaints(e=1){this.loadingComplaints=!0;let i=this.complaintFilter.length>0?this.complaintFilter.join(","):"";this.errorService.getErrorReports(e,this.pageSize,"","",i).subscribe({next:r=>{this.complaints=r.data,this.totalComplaintsPages=Math.ceil(r.total/this.pageSize),this.loadingComplaints=!1},error:r=>{console.error("Error al obtener las denuncias:",r),this.loadingComplaints=!1}})}nextComplaintsPage(){this.currentComplaintsPage<this.totalComplaintsPages&&(this.currentComplaintsPage++,this.loadComplaints(this.currentComplaintsPage))}previousComplaintsPage(){this.currentComplaintsPage>1&&(this.currentComplaintsPage--,this.loadComplaints(this.currentComplaintsPage))}toggleComplaintFilter(e){let i=this.complaintFilter.indexOf(e);i>-1?this.complaintFilter.splice(i,1):this.complaintFilter.push(e),this.currentComplaintsPage=1,this.loadComplaints()}confirmDeletePublication(e){confirm("\xBFEst\xE1s seguro de que deseas eliminar esta publicaci\xF3n? Esta acci\xF3n no se puede deshacer.")&&this.deletePublicationFromComplaint(e)}deletePublicationFromComplaint(e){if(!e.publicationId){alert("No se encontr\xF3 el ID de la publicaci\xF3n.");return}this.publicationService.removePost(this.token,e.publicationId).subscribe({next:i=>{console.log("Publicaci\xF3n eliminada correctamente"),this.resolveComplaint(e,!0),alert("La publicaci\xF3n ha sido eliminada correctamente y el denunciante ha sido notificado.")},error:i=>{console.error("Error al eliminar la publicaci\xF3n:",i),alert("Error al eliminar la publicaci\xF3n. Por favor, int\xE9ntalo nuevamente.")}})}openWarningModal(e){this.selectedComplaint=e,this.warningMessage=`Estimado/a usuario/a,

Hemos recibido una denuncia sobre tu comportamiento en la plataforma RedDin\xE1mica. Te recordamos que es importante mantener un ambiente respetuoso y colaborativo.

Si contin\xFAas con este tipo de comportamiento, tu cuenta podr\xEDa ser suspendida o eliminada de forma permanente.

Por favor, revisa nuestras pol\xEDticas de uso y aseg\xFArate de cumplirlas.

Atentamente,
Equipo de Administraci\xF3n de RedDin\xE1mica`;let i=document.getElementById("warningModal");i&&new bootstrap.Modal(i).show()}sendWarning(){if(!this.selectedComplaint||!this.selectedComplaint.reportedUserId){alert("No se encontr\xF3 el usuario denunciado.");return}if(!this.warningMessage||this.warningMessage.trim()===""){alert("Por favor, escribe un mensaje de advertencia.");return}this.errorService.sendWarningToUser(this.selectedComplaint.reportedUserId,this.warningMessage).subscribe({next:e=>{console.log("Advertencia enviada correctamente");let i=document.getElementById("warningModal");i&&bootstrap.Modal.getInstance(i)?.hide(),this.resolveComplaint(this.selectedComplaint,!0),alert("La advertencia ha sido enviada correctamente y el denunciante ha sido notificado."),this.warningMessage="",this.selectedComplaint=null},error:e=>{console.error("Error al enviar la advertencia:",e),alert("Error al enviar la advertencia. Por favor, int\xE9ntalo nuevamente.")}})}resolveComplaint(e,i){if(!e._id){alert("No se encontr\xF3 el ID de la denuncia.");return}let r=i?"Se ha tomado acci\xF3n sobre tu denuncia. Gracias por ayudarnos a mantener un ambiente seguro.":"Hemos revisado tu denuncia. Tras una evaluaci\xF3n cuidadosa, hemos determinado que no se requiere acci\xF3n adicional en este momento.";this.errorService.resolveComplaint(e._id,e.reporter,r).subscribe({next:m=>{console.log("Denuncia resuelta y notificaci\xF3n enviada"),this.loadComplaints(this.currentComplaintsPage),i||alert("La denuncia ha sido marcada como resuelta y el denunciante ha sido notificado.")},error:m=>{console.error("Error al resolver la denuncia:",m),alert("Error al resolver la denuncia. Por favor, int\xE9ntalo nuevamente.")}})}static{this.\u0275fac=function(i){return new(i||t)(y(pt),y(di),y(_i),y(P))}}static{this.\u0275cmp=w({type:t,selectors:[["app-view-errors"]],standalone:!1,decls:78,vars:13,consts:[["noAttachment",""],["noAttachmentModal",""],["noAttachmentModal2",""],[1,"container"],["id","reportsTabs","role","tablist",1,"nav","nav-tabs","mb-3"],["role","presentation",1,"nav-item"],["id","technical-tab","data-bs-toggle","tab","data-bs-target","#technical","type","button","role","tab","aria-controls","technical","aria-selected","true",1,"nav-link","active"],["id","complaints-tab","data-bs-toggle","tab","data-bs-target","#complaints","type","button","role","tab","aria-controls","complaints","aria-selected","false",1,"nav-link"],["id","reportsTabsContent",1,"tab-content"],["id","technical","role","tabpanel","aria-labelledby","technical-tab",1,"tab-pane","fade","show","active"],[1,"mb-3"],["id","filterAccordion",1,"accordion"],[1,"card"],["id","headingType",1,"card-header"],[1,"mb-0"],["type","button","data-bs-toggle","collapse","data-bs-target","#collapseType","aria-expanded","true","aria-controls","collapseType",1,"btn","btn-link"],["id","collapseType","aria-labelledby","headingType","data-parent","#filterAccordion",1,"collapse"],[1,"card-body"],[1,"form-group"],["class","form-check",4,"ngFor","ngForOf"],["id","headingModule",1,"card-header"],["type","button","data-bs-toggle","collapse","data-bs-target","#collapseModule","aria-expanded","false","aria-controls","collapseModule",1,"btn","btn-link","collapsed"],["id","collapseModule","aria-labelledby","headingModule","data-parent","#filterAccordion",1,"collapse"],[4,"ngIf"],["id","complaints","role","tabpanel","aria-labelledby","complaints-tab",1,"tab-pane","fade"],["id","complaintsFilterAccordion",1,"accordion"],["id","headingComplaintType",1,"card-header"],["type","button","data-bs-toggle","collapse","data-bs-target","#collapseComplaintType","aria-expanded","true","aria-controls","collapseComplaintType",1,"btn","btn-link"],["id","collapseComplaintType","aria-labelledby","headingComplaintType","data-parent","#complaintsFilterAccordion",1,"collapse"],[1,"form-check"],["type","checkbox","id","publicationComplaint",1,"form-check-input",3,"change","checked"],["for","publicationComplaint",1,"form-check-label"],["type","checkbox","id","userComplaint",1,"form-check-input",3,"change","checked"],["for","userComplaint",1,"form-check-label"],["id","warningModal","tabindex","-1","role","dialog","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-dialog-centered"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],["for","warningMessage"],["id","warningMessage","rows","4","placeholder","Escribe el mensaje de advertencia aqu\xED...",1,"form-control",3,"ngModelChange","ngModel"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],["type","button",1,"btn","btn-warning",3,"click"],["type","checkbox",1,"form-check-input",3,"change","id","checked"],[1,"form-check-label",3,"for"],[1,"table","table-striped"],[4,"ngFor","ngForOf"],[1,"pagination-controls"],[1,"btn","btn-secondary","me-2",3,"click","disabled"],[1,"mx-2"],[1,"btn","btn-secondary",3,"click","disabled"],[4,"ngIf","ngIfElse"],["data-bs-toggle","modal",1,"btn","btn-secondary","btn-sm","me-2"],[1,"fas","fa-eye"],[1,"btn","btn-info","btn-sm","me-2",3,"click"],[1,"btn","btn-danger","btn-sm",3,"click"],[2,"cursor","pointer","color","blue",3,"click"],["tabindex","-1","role","dialog","aria-hidden","true",1,"modal","fade",3,"id"],["role","document",1,"modal-dialog","modal-lg","modal-dialog-centered"],[1,"mb-2"],["class","badge bg-warning",4,"ngIf"],["class","badge bg-danger",4,"ngIf"],["target","_blank","class","btn btn-sm btn-outline-primary",3,"routerLink",4,"ngIf"],[1,"text-truncate","d-inline-block",2,"max-width","200px",3,"title"],["class","text-primary",3,"routerLink",4,"ngIf"],["role","group",1,"btn-group-vertical"],["data-bs-toggle","modal",1,"btn","btn-secondary","btn-sm","mb-1"],["class","btn btn-danger btn-sm mb-1",3,"click",4,"ngIf"],["class","btn btn-warning btn-sm mb-1",3,"click",4,"ngIf"],[1,"btn","btn-success","btn-sm",3,"click"],[1,"fas","fa-check"],[1,"badge","bg-warning"],[1,"fas","fa-newspaper","me-1"],[1,"badge","bg-danger"],[1,"fas","fa-user","me-1"],["target","_blank",1,"btn","btn-sm","btn-outline-primary",3,"routerLink"],[1,"fas","fa-external-link-alt"],[1,"fas","fa-user"],[1,"text-primary",3,"routerLink"],[1,"btn","btn-danger","btn-sm","mb-1",3,"click"],[1,"fas","fa-trash"],[1,"btn","btn-warning","btn-sm","mb-1",3,"click"],[1,"fas","fa-exclamation-triangle"],["class","mb-2",4,"ngIf"],["target","_blank",1,"btn","btn-sm","btn-outline-primary","mt-1",3,"routerLink"],[1,"fas","fa-external-link-alt","me-2"],[1,"fas","fa-user","me-2"]],template:function(i,r){i&1&&(o(0,"div",3)(1,"h2"),s(2,"Gesti\xF3n de Reportes y Denuncias"),n(),o(3,"ul",4)(4,"li",5)(5,"button",6),s(6," Errores y Sugerencias "),n()(),o(7,"li",5)(8,"button",7),s(9," Denuncias "),n()()(),o(10,"div",8)(11,"div",9)(12,"div",10)(13,"div",11)(14,"div",12)(15,"div",13)(16,"h2",14)(17,"button",15),s(18," Filtrar por tipo "),n()()(),o(19,"div",16)(20,"div",17)(21,"div",18),p(22,Zc,4,4,"div",19),n()()()(),o(23,"div",12)(24,"div",20)(25,"h2",14)(26,"button",21),s(27," Filtrar por m\xF3dulo "),n()()(),o(28,"div",22)(29,"div",17)(30,"div",18),p(31,em,4,4,"div",19),n()()()()()(),p(32,tm,2,0,"div",23)(33,im,2,0,"div",23)(34,dm,26,6,"div",23),n(),o(35,"div",24)(36,"div",10)(37,"div",25)(38,"div",12)(39,"div",26)(40,"h2",14)(41,"button",27),s(42," Filtrar por tipo de denuncia "),n()()(),o(43,"div",28)(44,"div",17)(45,"div",18)(46,"div",29)(47,"input",30),_("change",function(){return r.toggleComplaintFilter("publication")}),n(),o(48,"label",31),s(49,"Denuncias de publicaci\xF3n"),n()(),o(50,"div",29)(51,"input",32),_("change",function(){return r.toggleComplaintFilter("user")}),n(),o(52,"label",33),s(53,"Denuncias de usuario"),n()()()()()()()(),p(54,cm,2,0,"div",23)(55,mm,2,0,"div",23)(56,Tm,26,6,"div",23),n()()(),o(57,"div",34)(58,"div",35)(59,"div",36)(60,"div",37)(61,"h5",38),s(62,"Enviar Advertencia al Usuario"),n(),u(63,"button",39),n(),o(64,"div",40)(65,"p")(66,"strong"),s(67,"Usuario:"),n(),s(68),n(),o(69,"div",18)(70,"label",41),s(71,"Mensaje de advertencia:"),n(),o(72,"textarea",42),ot("ngModelChange",function(E){return nt(r.warningMessage,E)||(r.warningMessage=E),E}),n()()(),o(73,"div",43)(74,"button",44),s(75,"Cancelar"),n(),o(76,"button",45),_("click",function(){return r.sendWarning()}),s(77,"Enviar Advertencia"),n()()()()()),i&2&&(a(22),l("ngForOf",r.errorTypes),a(9),l("ngForOf",r.modules),a(),l("ngIf",r.loadingTechnical),a(),l("ngIf",!r.loadingTechnical&&r.technicalReports.length===0),a(),l("ngIf",!r.loadingTechnical&&r.technicalReports.length>0),a(13),l("checked",r.complaintFilter.includes("publication")),a(4),l("checked",r.complaintFilter.includes("user")),a(3),l("ngIf",r.loadingComplaints),a(),l("ngIf",!r.loadingComplaints&&r.complaints.length===0),a(),l("ngIf",!r.loadingComplaints&&r.complaints.length>0),a(12),V(" ",r.selectedComplaint==null||r.selectedComplaint.reportedUser==null?null:r.selectedComplaint.reportedUser.name," ",r.selectedComplaint==null||r.selectedComplaint.reportedUser==null?null:r.selectedComplaint.reportedUser.surname,""),a(4),it("ngModel",r.warningMessage))},dependencies:[T,F,N,D,at,R],styles:[".container[_ngcontent-%COMP%]{padding:20px}.pagination-controls[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-top:20px}@media (max-width: 768px){.container[_ngcontent-%COMP%]{padding:10px}.pagination-controls[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-top:10px}.form-group[_ngcontent-%COMP%]{margin-bottom:1rem}.form-check[_ngcontent-%COMP%]{margin-bottom:.5rem}}.theme-dark[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .theme-dark[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%], .theme-dark[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .theme-dark[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{color:var(--rd-text)!important}.theme-dark[_ngcontent-%COMP%]   .accordion[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%], .theme-dark[_ngcontent-%COMP%]   .accordion[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%], .theme-dark[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%], .theme-dark[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%], .theme-dark[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]{background-color:var(--rd-surface)!important;color:var(--rd-text)!important;border-color:#2a2f36!important}.theme-dark[_ngcontent-%COMP%]   .btn.btn-link[_ngcontent-%COMP%], .theme-dark[_ngcontent-%COMP%]   .form-check-label[_ngcontent-%COMP%], .theme-dark[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{color:var(--rd-text)!important}.theme-dark[_ngcontent-%COMP%]   .form-check-input[_ngcontent-%COMP%]{background-color:#11161a!important;border-color:#2a2f36!important}.theme-dark[_ngcontent-%COMP%]   .form-check-input[_ngcontent-%COMP%]:checked{background-color:var(--rd-primary)!important;border-color:var(--rd-primary)!important}.theme-dark[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#9ec1ff}.theme-dark[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#c5d9ff}"]})}}return t})();var yt=(()=>{class t{constructor(e,i){this._router=e,this._userService=i}canActivate(){let e=this._userService.getIdentity(),i=this._userService.getToken();return e&&(e.role=="admin"||e.role=="delegated_admin"||e.role=="lesson_manager")?!0:i?(this._router.navigate(["/inicio"]),!1):(this._router.navigate(["/landing"]),!1)}static{this.\u0275fac=function(i){return new(i||t)(Et(j),Et(P))}}static{this.\u0275prov=Xt({token:t,factory:t.\u0275fac})}}return t})();var Fm=[{path:"",component:yi,canActivate:[yt],children:[{path:"",component:Ke},{path:"usuarios-nuevos",component:Ke},{path:"usuarios-nuevos/:page",component:Ke},{path:"usuarios",component:Pt},{path:"usuarios/:page",component:Pt},{path:"lecciones",component:At},{path:"lecciones/:page",component:At},{path:"ciudades",component:Ot},{path:"ciudades/:page",component:Ot},{path:"instituciones",component:Rt},{path:"instituciones/:page",component:Rt},{path:"leccion/:id",component:hi},{path:"lecciones-propuestas",component:$t},{path:"lecciones-propuestas/:page",component:$t},{path:"experiencias",component:Ut},{path:"experiencias/:page",component:Ut},{path:"recursos",component:qt},{path:"recursos/:page",component:qt},{path:"recursos-propuestos",component:jt},{path:"recursos-propuestos/:page",component:jt},{path:"areas",component:Nt},{path:"areas/:page",component:Nt},{path:"profesiones",component:Dt},{path:"profesiones/:page",component:Dt},{path:"view-errors",component:_n},{path:"tareas",loadComponent:()=>import("./chunk-BDQ4MBRV.js").then(t=>t.PendingTasksComponent)},{path:"academico/grupos",loadComponent:()=>import("./chunk-HVHWVU6P.js").then(t=>t.GroupManagementComponent)},{path:"academico/lecciones",loadComponent:()=>import("./chunk-QPNHUBZU.js").then(t=>t.LessonManagementComponent)},{path:"academico/destacadas",component:Ci},{path:"**",component:Ke}]}],fn=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=Ye({type:t})}static{this.\u0275inj=He({imports:[wt.forChild(Fm),wt]})}}return t})();var w_=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=Ye({type:t})}static{this.\u0275inj=He({providers:[yt],imports:[ii,ni,oi,si,fn,xi,gi,ci]})}}return t})();export{w_ as AdminModule};
