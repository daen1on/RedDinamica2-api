import{a as fe}from"./chunk-ZTCIQEDA.js";import{B as D,c as O,e as T,f as de,i as me,l as F,m as pe,s as W,t as q,u as $}from"./chunk-GWDAXWU7.js";import{$b as ge,Da as d,Ea as ie,Fa as oe,Hb as te,Ib as j,Jb as L,Na as o,Oa as s,Ob as B,Pa as p,Qa as Z,Ra as ee,Rb as P,Ta as v,Ua as f,Va as l,a as K,ab as se,b as Y,ba as g,bb as ae,bc as ue,ca as u,cb as re,db as y,eb as r,ec as _e,fb as x,ga as C,gb as M,hb as le,ib as ce,jb as A,kb as R,lb as U,na as ne,nb as N,pa as a,sa as X,sb as z,ta as E,ub as G,vb as w,ya as _}from"./chunk-3BHHYQXT.js";var he=()=>({standalone:!0});function we(n,m){if(n&1){let e=v();o(0,"button",19),f("click",function(){g(e);let i=l();return u(i.showNewConversationForm=!i.showNewConversationForm)}),p(1,"i",20),r(2,"Nueva Conversaci\xF3n "),s()}}function Ie(n,m){if(n&1&&(o(0,"option",23),r(1),s()),n&2){let e=m.$implicit;d("value",e._id),a(),le(" ",e.title," (",(e.messages==null?null:e.messages.length)||0,") ")}}function Se(n,m){if(n&1){let e=v();o(0,"div")(1,"select",21),U("ngModelChange",function(i){g(e);let c=l();return R(c.currentConversationId,i)||(c.currentConversationId=i),u(i)}),f("ngModelChange",function(i){g(e);let c=l();return u(c.currentConversationIdChange.emit(i))}),_(2,Ie,2,3,"option",22),s()()}if(n&2){let e=l();a(),A("ngModel",e.currentConversationId),a(),d("ngForOf",e.lesson==null?null:e.lesson.conversations)}}function ke(n,m){n&1&&(o(0,"div",24),r(1,"Sin conversaciones"),s())}function Ee(n,m){if(n&1){let e=v();Z(0),o(1,"div",25)(2,"h6",26),p(3,"i",27),r(4,"Crear Nueva Conversaci\xF3n"),s(),o(5,"div",26)(6,"input",28),U("ngModelChange",function(i){g(e);let c=l();return R(c.newConversationTitle,i)||(c.newConversationTitle=i),u(i)}),s()(),o(7,"div",26),p(8,"textarea",29,2),s(),o(10,"div",30)(11,"button",31),f("click",function(){g(e);let i=l();return u(i.onCreateConversation())}),p(12,"i",32),r(13,"Crear "),s(),o(14,"button",33),f("click",function(){g(e);let i=l();return u(i.showNewConversationForm=!1)}),r(15,"Cancelar"),s()()(),ee()}if(n&2){let e=l();a(6),A("ngModel",e.newConversationTitle),d("disabled",e.loading),a(5),d("disabled",!(e.newConversationTitle!=null&&e.newConversationTitle.trim())||e.loading)}}function Le(n,m){if(n&1&&(Z(0),p(1,"img",47),ee()),n&2){let e=m.ngIf;a(),d("src",e,ne)}}function Pe(n,m){n&1&&p(0,"i",48)}function Oe(n,m){n&1&&(o(0,"small",49),r(1,"(editado)"),s())}function Te(n,m){if(n&1){let e=v();o(0,"div",50)(1,"button",51),f("click",function(){g(e);let i=l().$implicit,c=l(4);return u(c.startEdit(i))}),p(2,"i",52),s(),o(3,"button",53),f("click",function(){g(e);let i=l().$implicit,c=l(4);return u(c.confirmDelete(i))}),p(4,"i",54),s()()}}function Fe(n,m){if(n&1){let e=v();o(0,"div")(1,"textarea",55),U("ngModelChange",function(i){g(e);let c=l(5);return R(c.editingContent,i)||(c.editingContent=i),u(i)}),s(),o(2,"div",56)(3,"button",57),f("click",function(){g(e);let i=l(5);return u(i.confirmEdit())}),p(4,"i",58),r(5,"Guardar"),s(),o(6,"button",59),f("click",function(){g(e);let i=l(5);return u(i.cancelEdit())}),r(7,"Cancelar"),s()()()}if(n&2){let e=l(5);a(),A("ngModel",e.editingContent),d("ngModelOptions",N(2,he))}}function De(n,m){if(n&1&&(o(0,"p",60),r(1),s()),n&2){let e=l().$implicit;a(),x(e.content)}}function Ve(n,m){if(n&1&&(o(0,"div",39)(1,"div",40),_(2,Le,2,1,"ng-container",17)(3,Pe,1,0,"ng-template",null,6,w),s(),o(5,"div",41)(6,"div",42)(7,"div",43)(8,"strong"),r(9),s(),o(10,"small",44),r(11),z(12,"date"),s(),_(13,Oe,2,0,"small",45),s(),_(14,Te,5,0,"div",46),s(),_(15,Fe,8,3,"div",17)(16,De,2,1,"ng-template",null,7,w),s()()),n&2){let e=m.$implicit,t=y(4),i=y(17),c=l(4);a(2),d("ngIf",c.userPictureUrl(e.author))("ngIfElse",t),a(7),x(c.displayUserName(e.author)),a(2),x(G(12,8,e.timestamp,"short")),a(2),d("ngIf",e.edited),a(),d("ngIf",c.isEditable(e)&&c.currentConversationId!=="default"),a(),d("ngIf",c.editingMessageId===e._id)("ngIfElse",i)}}function Ae(n,m){if(n&1&&(o(0,"div",37,5),_(2,Ve,18,11,"div",38),s()),n&2){let e=l().ngIf;a(2),d("ngForOf",e.messages)}}function Re(n,m){n&1&&(o(0,"div",61),p(1,"i",62),o(2,"p",63),r(3,"A\xFAn no hay mensajes en esta conversaci\xF3n"),s()())}function Ue(n,m){if(n&1){let e=v();o(0,"div",64)(1,"div",65)(2,"textarea",66),f("ngModelChange",function(i){g(e);let c=l(3);return u(c.onTyping(i))}),s(),o(3,"button",31),f("click",function(){g(e);let i=l(3);return u(i.onSendMessage())}),p(4,"i",67),s()()()}if(n&2){let e=l(3);a(2),d("ngModel",e.chatMessage)("ngModelOptions",N(3,he)),a(),d("disabled",!(e.chatMessage!=null&&e.chatMessage.trim())||e.loading)}}function Ne(n,m){if(n&1&&(Z(0),_(1,Ae,3,1,"div",35)(2,Re,4,0,"ng-template",null,4,w)(4,Ue,5,4,"div",36),ee()),n&2){let e=m.ngIf,t=y(3),i=l(2);a(),d("ngIf",e.messages==null?null:e.messages.length)("ngIfElse",t),a(3),d("ngIf",i.canChat&&i.currentConversationId)}}function je(n,m){n&1&&(o(0,"span"),r(1,"Crea una nueva conversaci\xF3n para comenzar."),s())}function ze(n,m){if(n&1&&(o(0,"div",68),p(1,"i",69),o(2,"p",63),r(3,"No hay conversaciones disponibles. "),_(4,je,2,0,"span",70),s()()),n&2){let e=l(2);a(4),d("ngIf",e.canEdit)}}function Ge(n,m){if(n&1&&(o(0,"div",34),_(1,Ne,5,3,"ng-container",17)(2,ze,5,1,"ng-template",null,3,w),s()),n&2){let e=y(3),t=l();a(),d("ngIf",t.getCurrentConversation())("ngIfElse",e)}}var be=(()=>{class n{constructor(){this.lesson=null,this.loading=!1,this.canEdit=!1,this.canChat=!1,this.currentConversationId="",this.currentConversationIdChange=new C,this.createConversation=new C,this.sendMessage=new C,this.editMessage=new C,this.deleteMessage=new C,this.typingChange=new C,this.displayUserName=()=>"Usuario",this.userPictureUrl=()=>"",this.showNewConversationForm=!1,this.newConversationTitle="",this.chatMessage="",this.editingMessageId="",this.editingContent=""}onCreateConversation(){let e=(this.newConversationTitle||"").trim();e&&(this.createConversation.emit(e),this.newConversationTitle="",this.showNewConversationForm=!1)}onSendMessage(){let e=(this.chatMessage||"").trim();!e||!this.currentConversationId||(this.sendMessage.emit({conversationId:this.currentConversationId,content:e}),this.chatMessage="",this.typingChange.emit(!1))}onTyping(e){this.chatMessage=e,this.typingChange.emit(!!e&&e.trim().length>0)}isEditable(e){if(!e)return!1;let t=new Date(e.timestamp||e.createdAt||new Date);return Date.now()-t.getTime()<=30*60*1e3}startEdit(e){this.isEditable(e)&&(this.editingMessageId=e._id,this.editingContent=e.content)}cancelEdit(){this.editingMessageId="",this.editingContent=""}confirmEdit(){let e=(this.editingContent||"").trim();!e||!this.currentConversationId||!this.editingMessageId||(this.editMessage.emit({conversationId:this.currentConversationId,messageId:this.editingMessageId,content:e}),this.cancelEdit())}confirmDelete(e){this.isEditable(e)&&this.currentConversationId&&this.deleteMessage.emit({conversationId:this.currentConversationId,messageId:e._id})}getCurrentConversation(){return!this.lesson||!this.lesson.conversations||!this.currentConversationId?null:this.lesson.conversations.find(e=>e._id===this.currentConversationId)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=E({type:n,selectors:[["app-lesson-conversations"]],inputs:{lesson:"lesson",loading:"loading",canEdit:"canEdit",canChat:"canChat",currentConversationId:"currentConversationId",displayUserName:"displayUserName",userPictureUrl:"userPictureUrl"},outputs:{currentConversationIdChange:"currentConversationIdChange",createConversation:"createConversation",sendMessage:"sendMessage",editMessage:"editMessage",deleteMessage:"deleteMessage",typingChange:"typingChange"},decls:19,vars:5,consts:[["noConvsLeft",""],["chatArea",""],["initialMsg",""],["noConversation",""],["noMessages",""],["messagesList",""],["noAvatar",""],["showText",""],[1,"content-card"],[1,"d-flex","justify-content-between","align-items-center","mb-3"],[1,"card-title","mb-0"],[1,"fas","fa-comments","me-2"],["class","btn btn-sm btn-outline-primary",3,"click",4,"ngIf"],[1,"row","g-3"],[1,"col-md-3"],[1,"border","rounded","p-2","h-100"],[1,"form-label","mb-2"],[4,"ngIf","ngIfElse"],[1,"col-md-9"],[1,"btn","btn-sm","btn-outline-primary",3,"click"],[1,"fas","fa-plus","me-1"],["size","8",1,"form-select",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"text-muted","small"],[1,"p-3","border","rounded","bg-light"],[1,"mb-3"],[1,"fas","fa-plus-circle","me-2"],["type","text","placeholder","T\xEDtulo de la conversaci\xF3n...",1,"form-control",3,"ngModelChange","ngModel","disabled"],["rows","4","placeholder","Mensaje inicial (opcional)",1,"form-control"],[1,"d-flex","gap-2"],[1,"btn","btn-primary",3,"click","disabled"],[1,"fas","fa-check","me-1"],[1,"btn","btn-outline-secondary",3,"click"],[1,"chat-container"],["class","messages-list border rounded p-2 mb-2","style","height: 420px; overflow-y: auto; display: flex; flex-direction: column; gap: 12px;",4,"ngIf","ngIfElse"],["class","chat-input-container",4,"ngIf"],[1,"messages-list","border","rounded","p-2","mb-2",2,"height","420px","overflow-y","auto","display","flex","flex-direction","column","gap","12px"],["class","message-item d-flex gap-2",4,"ngFor","ngForOf"],[1,"message-item","d-flex","gap-2"],[1,"message-avatar"],[1,"message-content","flex-grow-1"],[1,"d-flex","justify-content-between","align-items-center"],[1,"message-header"],[1,"text-muted"],["class","text-muted ms-2","title","Editado",4,"ngIf"],["class","btn-group",4,"ngIf"],["alt","Avatar",1,"avatar",3,"src"],[1,"fas","fa-user-circle"],["title","Editado",1,"text-muted","ms-2"],[1,"btn-group"],[1,"btn","btn-sm","btn-link","text-decoration-none",3,"click"],[1,"fas","fa-pen"],[1,"btn","btn-sm","btn-link","text-danger","text-decoration-none",3,"click"],[1,"fas","fa-trash"],["rows","3","name","editingContent",1,"form-control",3,"ngModelChange","ngModel","ngModelOptions"],[1,"mt-2","d-flex","gap-2"],[1,"btn","btn-sm","btn-primary",3,"click"],[1,"fas","fa-save","me-1"],[1,"btn","btn-sm","btn-outline-secondary",3,"click"],[1,"mb-0"],[1,"empty-state","border","rounded","p-4","text-center","mb-2"],[1,"fas","fa-comments","text-muted"],[1,"text-muted","mb-0"],[1,"chat-input-container"],[1,"input-group"],["rows","3","placeholder","Escribe un mensaje (puedes usar p\xE1rrafos con Enter)...","name","chatMessage",1,"form-control",3,"ngModelChange","ngModel","ngModelOptions"],[1,"fas","fa-paper-plane"],[1,"empty-state","border","rounded","p-4","text-center"],[1,"fas","fa-comment-slash","text-muted"],[4,"ngIf"]],template:function(t,i){if(t&1&&(o(0,"div",8)(1,"div",9)(2,"h5",10),p(3,"i",11),r(4,"Conversaciones del Equipo"),s(),_(5,we,3,0,"button",12),s(),o(6,"div",13)(7,"div",14)(8,"div",15)(9,"label",16)(10,"strong"),r(11,"Conversaci\xF3n"),s()(),_(12,Se,3,2,"div",17)(13,ke,2,0,"ng-template",null,0,w),s()(),o(15,"div",18),_(16,Ee,16,3,"ng-container",17)(17,Ge,4,2,"ng-template",null,1,w),s()()()),t&2){let c=y(14),b=y(18);a(5),d("ngIf",i.canEdit),a(7),d("ngIf",(i.lesson==null?null:i.lesson.conversations)&&i.lesson.conversations.length>0)("ngIfElse",c),a(4),d("ngIf",i.showNewConversationForm)("ngIfElse",b)}},dependencies:[P,j,L,B,D,q,$,O,W,T,F],styles:[".messages-list[_ngcontent-%COMP%]{max-height:420px;overflow-y:auto;padding-right:6px;background:transparent;border:1px solid rgba(0,0,0,.08);border-radius:.5rem}.message-item[_ngcontent-%COMP%]{display:flex;gap:12px;padding:10px 12px;border-bottom:1px solid rgba(0,0,0,.05)}.message-avatar[_ngcontent-%COMP%]{color:#6c757d;font-size:28px;width:40px;height:40px;display:flex;align-items:center;justify-content:center}.message-avatar[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;object-fit:cover;border:1px solid rgba(0,0,0,.1)}.message-header[_ngcontent-%COMP%]{display:flex;align-items:baseline;justify-content:space-between;gap:12px}.chat-input-container[_ngcontent-%COMP%]{margin-top:12px}.conversation-selector[_ngcontent-%COMP%]   select.form-select[_ngcontent-%COMP%]{height:420px;font-size:.9rem}[_ngcontent-%COMP%]:root[data-bs-theme=dark]   .messages-list[_ngcontent-%COMP%], body.dark[_ngcontent-%COMP%]   .messages-list[_ngcontent-%COMP%]{background:#000;border-color:#ffffff1f}[_ngcontent-%COMP%]:root[data-bs-theme=dark]   .message-item[_ngcontent-%COMP%], body.dark[_ngcontent-%COMP%]   .message-item[_ngcontent-%COMP%]{color:#e6edf3}[_ngcontent-%COMP%]:root[data-bs-theme=dark]   .message-header[_ngcontent-%COMP%]   small[_ngcontent-%COMP%], body.dark[_ngcontent-%COMP%]   .message-header[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:#ffffffa6!important}[_ngcontent-%COMP%]:root[data-bs-theme=dark]   .chat-input-container[_ngcontent-%COMP%]   textarea.form-control[_ngcontent-%COMP%], body.dark[_ngcontent-%COMP%]   .chat-input-container[_ngcontent-%COMP%]   textarea.form-control[_ngcontent-%COMP%]{background:#0b0f16;color:#e6edf3;border-color:#ffffff26}[_ngcontent-%COMP%]:root[data-bs-theme=dark]   .chat-input-container[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%], body.dark[_ngcontent-%COMP%]   .chat-input-container[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]{background-color:#4776e6;border-color:#4776e6}"]})}}return n})();var Be=()=>({standalone:!0});function We(n,m){if(n&1){let e=v();o(0,"button",19),f("click",function(){g(e);let i=l().$implicit,c=l(2);return u(c.onDelete(i))}),p(1,"i",20),s()}}function qe(n,m){if(n&1){let e=v();o(0,"div",8)(1,"div",9),p(2,"i",10),s(),o(3,"div",11)(4,"strong",12),r(5),s(),o(6,"small",13),r(7),s(),o(8,"small",14),r(9),s()(),o(10,"div",15)(11,"button",16),f("click",function(){let i=g(e).$implicit,c=l(2);return u(c.onDownload(i))}),p(12,"i",17),s(),_(13,We,2,0,"button",18),s()()}if(n&2){let e=m.$implicit,t=l(2);a(5),x(e.name),a(2),M("",(e.size/1024).toFixed(2)," KB"),a(2),M("Subido por: ",t.getUploaderName(e.uploadedBy),""),a(4),d("ngIf",t.lesson==null?null:t.lesson.leader)}}function $e(n,m){if(n&1&&(o(0,"div",6),_(1,qe,14,4,"div",7),s()),n&2){let e=l();a(),d("ngForOf",e.lesson==null?null:e.lesson.files)}}function He(n,m){n&1&&(o(0,"div",21),p(1,"i",22),o(2,"p",23),r(3,"No hay archivos subidos a\xFAn"),s()())}function Qe(n,m){n&1&&(o(0,"span"),p(1,"i",36),r(2,"Subir"),s())}function Je(n,m){n&1&&(o(0,"span"),p(1,"span",37),r(2,"Subiendo... "),s())}function Ke(n,m){if(n&1){let e=v();o(0,"div",24),p(1,"hr",25),o(2,"h6"),p(3,"i",26),r(4,"Subir nuevo archivo"),s(),o(5,"form",27),f("submit",function(i){g(e);let c=l();return i.preventDefault(),u(c.upload.emit())}),o(6,"div",28)(7,"div",29)(8,"input",30),f("change",function(i){g(e);let c=l();return u(c.onFileSelected(i))}),s()(),o(9,"div",31)(10,"input",32),f("ngModelChange",function(i){g(e);let c=l();return u(c.resourceDescriptionChange.emit(i))}),s()(),o(11,"div",33)(12,"button",34),_(13,Qe,3,0,"span",35)(14,Je,3,0,"span",35),s()()()()()}if(n&2){let e=l();a(8),d("disabled",e.uploading),a(2),d("ngModel",e.resourceDescription)("disabled",e.uploading)("ngModelOptions",N(7,Be)),a(2),d("disabled",!e.selectedFile||e.uploading),a(),d("ngIf",!e.uploading),a(),d("ngIf",e.uploading)}}var ve=(()=>{class n{constructor(){this.lesson=null,this.userRole="",this.uploading=!1,this.selectedFile=null,this.resourceDescription="",this.resourceDescriptionChange=new C,this.fileSelected=new C,this.upload=new C,this.deleteFile=new C,this.downloadFile=new C}onFileSelected(e){let t=e?.target?.files?.[0]||null;this.fileSelected.emit(t)}onDownload(e){this.downloadFile.emit(e)}onDelete(e){this.deleteFile.emit(e)}getUploaderName(e){return typeof e=="object"&&e!==null?e.name||"Usuario desconocido":e}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=E({type:n,selectors:[["app-lesson-files"]],inputs:{lesson:"lesson",userRole:"userRole",uploading:"uploading",selectedFile:"selectedFile",resourceDescription:"resourceDescription"},outputs:{resourceDescriptionChange:"resourceDescriptionChange",fileSelected:"fileSelected",upload:"upload",deleteFile:"deleteFile",downloadFile:"downloadFile"},decls:8,vars:3,consts:[["noFiles",""],[1,"content-card"],[1,"card-title"],[1,"fas","fa-paperclip","me-2"],["class","files-grid",4,"ngIf","ngIfElse"],["class","upload-section",4,"ngIf"],[1,"files-grid"],["class","file-card",4,"ngFor","ngForOf"],[1,"file-card"],[1,"file-icon"],[1,"fas","fa-file-alt"],[1,"file-info"],[1,"file-name"],[1,"text-muted","d-block"],[1,"text-muted"],[1,"file-actions"],["title","Descargar","type","button",1,"btn","btn-sm","btn-outline-primary",3,"click"],[1,"fas","fa-download"],["class","btn btn-sm btn-outline-danger ms-2","title","Eliminar","type","button",3,"click",4,"ngIf"],["title","Eliminar","type","button",1,"btn","btn-sm","btn-outline-danger","ms-2",3,"click"],[1,"fas","fa-trash"],[1,"empty-state"],[1,"fas","fa-file","text-muted"],[1,"text-muted","mb-0"],[1,"upload-section"],[1,"my-4"],[1,"fas","fa-cloud-upload-alt","me-2"],[3,"submit"],[1,"row","g-3"],[1,"col-md-6"],["type","file",1,"form-control",3,"change","disabled"],[1,"col-md-4"],["type","text","name","resourceDescription","placeholder","Descripci\xF3n (opcional)",1,"form-control",3,"ngModelChange","ngModel","disabled","ngModelOptions"],[1,"col-md-2"],["type","submit",1,"btn","btn-primary","w-100",3,"disabled"],[4,"ngIf"],[1,"fas","fa-upload","me-2"],[1,"spinner-border","spinner-border-sm","me-2"]],template:function(t,i){if(t&1&&(o(0,"div",1)(1,"h5",2),p(2,"i",3),r(3,"Archivos del Proyecto"),s(),_(4,$e,2,1,"div",4)(5,He,4,0,"ng-template",null,0,w)(7,Ke,15,8,"div",5),s()),t&2){let c=y(6);a(4),d("ngIf",i.lesson==null||i.lesson.files==null?null:i.lesson.files.length)("ngIfElse",c),a(3),d("ngIf",i.lesson==null?null:i.lesson.leader)}},dependencies:[P,j,L,D,pe,O,T,de,F,me],encapsulation:2})}}return n})();function Ye(n,m){if(n&1&&(o(0,"div",8)(1,"div",9),p(2,"i",10),s(),o(3,"div",11)(4,"strong"),r(5),s(),o(6,"span",12),r(7),s(),o(8,"small",13),r(9),z(10,"date"),s()()()),n&2){let e=m.$implicit,t=l(2);a(5),x(t.displayUserName(e.user)),a(2),x(t.translateRole(e.role)),a(2),M("Se uni\xF3: ",G(10,3,e.joinedAt,"short"),"")}}function Xe(n,m){if(n&1&&(o(0,"div",6),_(1,Ye,11,6,"div",7),s()),n&2){let e=l();a(),d("ngForOf",e.lesson==null?null:e.lesson.development_group)}}function Ze(n,m){n&1&&(o(0,"div",14),p(1,"i",15),o(2,"p",16),r(3,"A\xFAn no hay miembros en el equipo"),s()())}function et(n,m){if(n&1&&(o(0,"option",31),r(1),s()),n&2){let e=m.$implicit;d("value",e._id),a(),ce(" ",e.name,"",e.surname?" "+e.surname:""," - ",e.email||""," ")}}function tt(n,m){if(n&1){let e=v();o(0,"div",17),p(1,"hr",18),o(2,"h6"),p(3,"i",19),r(4,"Invitar estudiante del grupo"),s(),o(5,"p",20),r(6,"Selecciona a un compa\xF1ero del grupo para invitarlo a colaborar en esta lecci\xF3n."),s(),o(7,"div",21)(8,"div",22)(9,"label",23),r(10,"Estudiante"),s(),o(11,"select",24),f("ngModelChange",function(i){g(e);let c=l();return u(c.inviteStudentIdChange.emit(i))}),o(12,"option",25),r(13,"Seleccione estudiante..."),s(),_(14,et,2,4,"option",26),s()(),o(15,"div",22)(16,"label",27),r(17,"Mensaje de invitaci\xF3n"),s(),o(18,"textarea",28),f("ngModelChange",function(i){g(e);let c=l();return u(c.inviteMessageChange.emit(i))}),s()(),o(19,"div",22)(20,"button",29),f("click",function(){g(e);let i=l();return u(i.invite.emit())}),p(21,"i",30),r(22,"Enviar Invitaci\xF3n "),s()()()()}if(n&2){let e=l();a(11),d("ngModel",e.inviteStudentId)("disabled",e.loading),a(3),d("ngForOf",e.getAvailableGroupStudents()),a(4),d("ngModel",e.inviteMessage)("disabled",e.loading),a(2),d("disabled",!e.inviteStudentId||e.loading)}}var xe=(()=>{class n{constructor(){this.lesson=null,this.loading=!1,this.canEdit=!1,this.groupStudents=[],this.inviteStudentId="",this.inviteMessage="",this.inviteStudentIdChange=new C,this.inviteMessageChange=new C,this.invite=new C}displayUserName(e){return e?typeof e=="string"?e:e.name||e.fullname||e.username||e.email||"Usuario":"Usuario"}getAvailableGroupStudents(){if(!this.groupStudents||!this.groupStudents.length)return[];let e=new Set((this.lesson?.development_group||[]).map(t=>{let i=t.user;return typeof i=="string"?i:i?._id}).filter(Boolean));return this.groupStudents.filter(t=>!e.has(t._id))}translateRole(e){if(!e)return"miembro";switch(e){case"leader":return"l\xEDder";case"collaborator":return"colaborador";case"reviewer":return"revisor";default:return e}}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=E({type:n,selectors:[["app-lesson-team"]],inputs:{lesson:"lesson",loading:"loading",canEdit:"canEdit",groupStudents:"groupStudents",inviteStudentId:"inviteStudentId",inviteMessage:"inviteMessage"},outputs:{inviteStudentIdChange:"inviteStudentIdChange",inviteMessageChange:"inviteMessageChange",invite:"invite"},decls:8,vars:3,consts:[["noTeam",""],[1,"content-card"],[1,"card-title"],[1,"fas","fa-user-friends","me-2"],["class","team-list",4,"ngIf","ngIfElse"],["class","invite-section",4,"ngIf"],[1,"team-list"],["class","team-member",4,"ngFor","ngForOf"],[1,"team-member"],[1,"member-avatar"],[1,"fas","fa-user-circle"],[1,"member-info"],[1,"badge","bg-secondary","ms-2"],[1,"text-muted","d-block"],[1,"empty-state"],[1,"fas","fa-users","text-muted"],[1,"text-muted","mb-0"],[1,"invite-section"],[1,"my-4"],[1,"fas","fa-user-plus","me-2"],[1,"text-muted","small"],[1,"row","g-3"],[1,"col-md-12"],["for","selectStudent",1,"form-label"],["id","selectStudent",1,"form-select",3,"ngModelChange","ngModel","disabled"],["value",""],[3,"value",4,"ngFor","ngForOf"],["for","inviteMessageInput",1,"form-label"],["id","inviteMessageInput","rows","3","placeholder","Escribe un mensaje personalizado...",1,"form-control","invite-textarea",3,"ngModelChange","ngModel","disabled"],[1,"btn","btn-primary","w-100",3,"click","disabled"],[1,"fas","fa-paper-plane","me-2"],[3,"value"]],template:function(t,i){if(t&1&&(o(0,"div",1)(1,"h5",2),p(2,"i",3),r(3,"Equipo de Desarrollo"),s(),_(4,Xe,2,1,"div",4)(5,Ze,4,0,"ng-template",null,0,w)(7,tt,23,6,"div",5),s()),t&2){let c=y(6);a(4),d("ngIf",i.lesson==null||i.lesson.development_group==null?null:i.lesson.development_group.length)("ngIfElse",c),a(3),d("ngIf",i.canEdit)}},dependencies:[P,j,L,B,D,q,$,O,W,T,F],styles:[".invite-textarea[_ngcontent-%COMP%]{background:#f8fafc;border:1px solid #dbe2ea;box-shadow:inset 0 1px 2px #00000008}.team-member[_ngcontent-%COMP%]{display:flex;gap:12px;padding:10px 0;border-bottom:1px solid rgba(0,0,0,.05)}.member-avatar[_ngcontent-%COMP%]{color:#6c757d;font-size:32px}"]})}}return n})();var nt=()=>({standalone:!0});function it(n,m){if(n&1){let e=v();o(0,"button",16),f("click",function(){g(e);let i=l().$implicit,c=l(2);return u(c.deleteComment.emit(i._id))}),p(1,"i",17),s()}if(n&2){let e=l(3);d("disabled",e.loading)}}function ot(n,m){if(n&1&&(o(0,"div",8)(1,"div",9)(2,"div",10),p(3,"i",11),o(4,"strong"),r(5),s(),o(6,"span",12),r(7),s()(),o(8,"div",10)(9,"small",13),r(10),z(11,"date"),s(),_(12,it,2,1,"button",14),s()(),o(13,"p",15),r(14),s()()),n&2){let e=m.$implicit,t=l(2);a(5),x(t.getAuthorName(e.author)),a(),d("ngClass",t.getCommentTypeBadge(e.type)),a(),x(t.getCommentTypeLabel(e.type)),a(3),x(G(11,6,e.timestamp,"short")),a(2),d("ngIf",t.canDelete(e)),a(2),x(e.content)}}function st(n,m){if(n&1&&(o(0,"div",6),_(1,ot,15,9,"div",7),s()),n&2){let e=l();a(),d("ngForOf",e.lesson==null?null:e.lesson.comments)}}function at(n,m){n&1&&(o(0,"div",18),p(1,"i",19),o(2,"p",20),r(3,"A\xFAn no hay retroalimentaci\xF3n del docente"),s()())}function rt(n,m){if(n&1){let e=v();o(0,"div",21),p(1,"hr",22),o(2,"h6"),p(3,"i",23),r(4,"Agregar retroalimentaci\xF3n"),s(),o(5,"div",24)(6,"div",25)(7,"select",26),f("ngModelChange",function(i){g(e);let c=l();return u(c.teacherCommentTypeChange.emit(i))}),o(8,"option",27),r(9,"Feedback"),s(),o(10,"option",28),r(11,"Sugerencia"),s(),o(12,"option",29),r(13,"Aprobaci\xF3n"),s(),o(14,"option",30),r(15,"Correcci\xF3n"),s()()(),o(16,"div",31)(17,"div",32)(18,"textarea",33),f("ngModelChange",function(i){g(e);let c=l();return u(c.teacherFeedbackChange.emit(i))}),s(),o(19,"button",34),f("click",function(){g(e);let i=l();return u(i.addComment.emit())}),p(20,"i",35),r(21," Enviar "),s()()()()()}if(n&2){let e=l();a(7),d("ngModel",e.teacherCommentType)("disabled",e.loading),a(11),d("ngModel",e.teacherFeedback)("ngModelOptions",N(6,nt))("disabled",e.loading),a(),d("disabled",!(e.teacherFeedback!=null&&e.teacherFeedback.trim())||e.loading)}}var Ce=(()=>{class n{constructor(){this.lesson=null,this.loading=!1,this.canAddFeedback=!1,this.teacherFeedback="",this.teacherCommentType="feedback",this.currentUserId="",this.teacherFeedbackChange=new C,this.teacherCommentTypeChange=new C,this.addComment=new C,this.deleteComment=new C}getCommentTypeBadge(e){return{feedback:"bg-info",suggestion:"bg-warning",approval:"bg-success",correction:"bg-danger"}[e]||"bg-secondary"}getAuthorName(e){return typeof e=="string"?e:e&&e.name?e.name:"Autor desconocido"}getCommentTypeLabel(e){return{feedback:"Retroalimentaci\xF3n",suggestion:"Sugerencia",approval:"Aprobaci\xF3n",correction:"Correcci\xF3n"}[e]||e}canDelete(e){try{let t=typeof e?.author=="string"?String(e.author):String(e?.author?._id||e?.author?.id||"");return!!t&&!!this.currentUserId&&t===this.currentUserId}catch{return!1}}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=E({type:n,selectors:[["app-lesson-feedback"]],inputs:{lesson:"lesson",loading:"loading",canAddFeedback:"canAddFeedback",teacherFeedback:"teacherFeedback",teacherCommentType:"teacherCommentType",currentUserId:"currentUserId"},outputs:{teacherFeedbackChange:"teacherFeedbackChange",teacherCommentTypeChange:"teacherCommentTypeChange",addComment:"addComment",deleteComment:"deleteComment"},decls:8,vars:3,consts:[["noFeedback",""],[1,"content-card"],[1,"card-title"],[1,"fas","fa-chalkboard-teacher","me-2"],["class","feedback-list",4,"ngIf","ngIfElse"],["class","feedback-form",4,"ngIf"],[1,"feedback-list"],["class","feedback-item",4,"ngFor","ngForOf"],[1,"feedback-item"],[1,"feedback-header"],[1,"d-flex","align-items-center","gap-2"],[1,"fas","fa-user-circle","text-primary"],[1,"badge",3,"ngClass"],[1,"text-muted"],["class","btn btn-sm btn-outline-danger","title","Eliminar comentario",3,"disabled","click",4,"ngIf"],[1,"feedback-content"],["title","Eliminar comentario",1,"btn","btn-sm","btn-outline-danger",3,"click","disabled"],[1,"fas","fa-trash-alt"],[1,"empty-state"],[1,"fas","fa-comment-slash","text-muted"],[1,"text-muted","mb-0"],[1,"feedback-form"],[1,"my-4"],[1,"fas","fa-comment-medical","me-2"],[1,"row","g-3"],[1,"col-md-3"],[1,"form-select",3,"ngModelChange","ngModel","disabled"],["value","feedback"],["value","suggestion"],["value","approval"],["value","correction"],[1,"col-md-9"],[1,"input-group"],["rows","2","placeholder","Escribe tu comentario...","name","teacherFeedback",1,"form-control",3,"ngModelChange","ngModel","ngModelOptions","disabled"],[1,"btn","btn-primary",3,"click","disabled"],[1,"fas","fa-paper-plane"]],template:function(t,i){if(t&1&&(o(0,"div",1)(1,"h5",2),p(2,"i",3),r(3,"Retroalimentaci\xF3n del Docente"),s(),_(4,st,2,1,"div",4)(5,at,4,0,"ng-template",null,0,w)(7,rt,22,7,"div",5),s()),t&2){let c=y(6);a(4),d("ngIf",i.lesson==null||i.lesson.comments==null?null:i.lesson.comments.length)("ngIfElse",c),a(3),d("ngIf",i.canAddFeedback)}},dependencies:[P,te,j,L,B,D,q,$,O,W,T,F],encapsulation:2})}}return n})();function lt(n,m){n&1&&p(0,"span",31)}function ct(n,m){n&1&&p(0,"i",32)}function dt(n,m){if(n&1){let e=v();o(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"h5",5),p(5,"i",6),r(6,"Calificar Lecci\xF3n "),s(),o(7,"button",7),f("click",function(){g(e);let i=l();return u(i.close.emit())}),s()(),o(8,"div",8)(9,"div",9)(10,"div",10)(11,"div",11)(12,"label",12)(13,"strong"),r(14,"Calificaci\xF3n "),o(15,"span",13),r(16,"*"),s()()(),o(17,"select",14),U("ngModelChange",function(i){g(e);let c=l();return R(c.gradeData.grade,i)||(c.gradeData.grade=i),u(i)}),o(18,"option",15),r(19,"Seleccione..."),s(),o(20,"option",16),r(21,"1.0 - Deficiente"),s(),o(22,"option",17),r(23,"2.0 - Insuficiente"),s(),o(24,"option",18),r(25,"3.0 - Aceptable"),s(),o(26,"option",19),r(27,"4.0 - Bueno"),s(),o(28,"option",20),r(29,"5.0 - Excelente"),s()(),o(30,"small",21),r(31,"Escala de 1 a 5"),s()()(),o(32,"div",22)(33,"div",11)(34,"label",23)(35,"strong"),r(36,"Retroalimentaci\xF3n Detallada "),o(37,"span",13),r(38,"*"),s()()(),o(39,"textarea",24),U("ngModelChange",function(i){g(e);let c=l();return R(c.gradeData.feedback,i)||(c.gradeData.feedback=i),u(i)}),s()()()()(),o(40,"div",25)(41,"button",26),f("click",function(){g(e);let i=l();return u(i.close.emit())}),p(42,"i",27),r(43,"Cancelar "),s(),o(44,"button",28),f("click",function(){g(e);let i=l();return u(i.save.emit())}),_(45,lt,1,0,"span",29)(46,ct,1,0,"i",30),r(47),s()()()()()}if(n&2){let e=l();a(17),A("ngModel",e.gradeData.grade),d("disabled",e.loading),a(22),A("ngModel",e.gradeData.feedback),d("disabled",e.loading),a(2),d("disabled",e.loading),a(3),d("disabled",e.gradeData.grade===0||!(e.gradeData.feedback!=null&&e.gradeData.feedback.trim())||e.loading),a(),d("ngIf",e.loading),a(),d("ngIf",!e.loading),a(),M(" ",e.loading?"Calificando...":"Guardar Calificaci\xF3n"," ")}}var Me=(()=>{class n{constructor(){this.show=!1,this.loading=!1,this.gradeData={grade:0,feedback:""},this.close=new C,this.save=new C}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=E({type:n,selectors:[["app-lesson-rating"]],inputs:{show:"show",loading:"loading",gradeData:"gradeData"},outputs:{close:"close",save:"save"},decls:1,vars:1,consts:[["class","modal fade show","style","display: block; background: rgba(0,0,0,0.5);","tabindex","-1",4,"ngIf"],["tabindex","-1",1,"modal","fade","show",2,"display","block","background","rgba(0,0,0,0.5)"],[1,"modal-dialog","modal-dialog-centered","modal-lg"],[1,"modal-content"],[1,"modal-header","bg-primary","text-white"],[1,"modal-title"],[1,"fas","fa-clipboard-check","me-2"],["type","button",1,"btn-close","btn-close-white",3,"click"],[1,"modal-body"],[1,"row"],[1,"col-md-4"],[1,"mb-3"],["for","gradeValue",1,"form-label"],[1,"text-danger"],["id","gradeValue",1,"form-select","form-select-lg",3,"ngModelChange","ngModel","disabled"],["value","0","disabled",""],["value","1"],["value","2"],["value","3"],["value","4"],["value","5"],[1,"form-text","text-muted"],[1,"col-md-8"],["for","gradeFeedback",1,"form-label"],["id","gradeFeedback","rows","6","placeholder","Proporciona retroalimentaci\xF3n detallada...",1,"form-control",3,"ngModelChange","ngModel","disabled"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click","disabled"],[1,"fas","fa-times","me-1"],["type","button",1,"btn","btn-primary",3,"click","disabled"],["class","spinner-border spinner-border-sm me-2","role","status",4,"ngIf"],["class","fas fa-check me-1",4,"ngIf"],["role","status",1,"spinner-border","spinner-border-sm","me-2"],[1,"fas","fa-check","me-1"]],template:function(t,i){t&1&&_(0,dt,48,9,"div",0),t&2&&d("ngIf",i.show)},dependencies:[P,L,D,q,$,O,W,T,F],encapsulation:2})}}return n})();var mt=["messagesList"],ye=()=>({standalone:!0});function pt(n,m){n&1&&(o(0,"div",8)(1,"div",9)(2,"span",10),r(3,"Cargando..."),s()()())}function gt(n,m){if(n&1){let e=v();o(0,"div",11),p(1,"i",12),r(2),o(3,"button",13),f("click",function(){g(e);let i=l();return u(i.successMessage="")}),s()()}if(n&2){let e=l();a(2),M("",e.successMessage," ")}}function ut(n,m){if(n&1){let e=v();o(0,"div",14),p(1,"i",15),r(2),o(3,"button",13),f("click",function(){g(e);let i=l();return u(i.errorMessage="")}),s()()}if(n&2){let e=l();a(2),M("",e.errorMessage," ")}}function _t(n,m){if(n&1&&(o(0,"span",91),p(1,"i",92),r(2),s()),n&2){let e=l(2);a(2),M("",e.lesson.academicSettings.academicLevel," ")}}function ft(n,m){if(n&1&&(o(0,"span",93),p(1,"i",94),r(2),s()),n&2){let e=l(2);a(2),M("",e.lesson.academicSettings.grade," ")}}function ht(n,m){if(n&1&&(o(0,"span",95),p(1,"i",96),r(2),s()),n&2){let e=l(2);a(2),M("",e.lesson.grade,"/5 ")}}function bt(n,m){n&1&&(o(0,"span",97),p(1,"i",98),r(2,"Exportada "),s())}function vt(n,m){n&1&&(o(0,"span",99),p(1,"i",100),r(2,"Pendiente de Exportaci\xF3n "),s())}function xt(n,m){if(n&1){let e=v();o(0,"button",101),f("click",function(){g(e);let i=l(2);return u(i.editLesson())}),p(1,"i",102),r(2," Editar "),s()}}function Ct(n,m){if(n&1){let e=v();o(0,"button",103),f("click",function(){g(e);let i=l(2);return u(i.deleteLesson())}),p(1,"i",104),r(2," Eliminar "),s()}}function Mt(n,m){if(n&1){let e=v();o(0,"button",105),f("click",function(){g(e);let i=l(2);return u(i.leaveLesson())}),p(1,"i",106),r(2," Retirarse "),s()}}function yt(n,m){if(n&1){let e=v();o(0,"button",107),f("click",function(){g(e);let i=l(2);return u(i.openApproveModal())}),p(1,"i",108),r(2," Aprobar "),s()}}function wt(n,m){if(n&1){let e=v();o(0,"button",109),f("click",function(){g(e);let i=l(2);return u(i.openRejectModal())}),p(1,"i",110),r(2," Rechazar "),s()}}function It(n,m){if(n&1){let e=v();o(0,"button",111),f("click",function(){g(e);let i=l(2);return u(i.openGradeModal())}),p(1,"i",112),r(2," Calificar "),s()}}function St(n,m){if(n&1){let e=v();o(0,"button",113),f("click",function(){g(e);let i=l(2);return u(i.exportLesson())}),p(1,"i",114),r(2," Solicitar Exportaci\xF3n "),s()}}function kt(n,m){if(n&1&&(o(0,"div",40)(1,"div",41),p(2,"i",115),o(3,"div")(4,"small",43),r(5,"Colaboradores"),s(),o(6,"strong"),r(7),s()()()()),n&2){let e=l(2);a(7),x(e.lesson.development_group.length)}}function Et(n,m){if(n&1&&(o(0,"div",116)(1,"span",117),r(2),s()()),n&2){let e=m.$implicit;oe("active",e.active)("completed",e.completed),a(2),x(e.label)}}function Lt(n,m){if(n&1&&(o(0,"span",121),r(1),s()),n&2){let e=l(3);a(),x(e.lesson.chatMessages.length)}}function Pt(n,m){if(n&1&&(o(0,"li",56)(1,"button",118),p(2,"i",119),r(3,"Conversaci\xF3n "),_(4,Lt,2,1,"span",120),s()()),n&2){let e=l(2);a(4),d("ngIf",e.lesson.chatMessages==null?null:e.lesson.chatMessages.length)}}function Ot(n,m){if(n&1&&(o(0,"span",122),r(1),s()),n&2){let e=l(2);a(),x(e.lesson.files.length)}}function Tt(n,m){if(n&1&&(o(0,"span",125),r(1),s()),n&2){let e=l(3);a(),x(e.lesson.comments.length)}}function Ft(n,m){if(n&1&&(o(0,"li",56)(1,"button",123),p(2,"i",75),r(3,"Retroalimentaci\xF3n "),_(4,Tt,2,1,"span",124),s()()),n&2){let e=l(2);a(4),d("ngIf",e.lesson.comments==null?null:e.lesson.comments.length)}}function Dt(n,m){n&1&&(o(0,"li")(1,"strong"),r(2,"Pendiente:"),s(),r(3," Debes agregar referencias bibliogr\xE1ficas "),s())}function Vt(n,m){n&1&&(o(0,"li")(1,"strong"),r(2,"Pendiente:"),s(),r(3," Debes subir al menos un archivo con recursos "),s())}function At(n,m){n&1&&(o(0,"li",131),p(1,"i",98),r(2,"Todos los requisitos cumplidos. Puedes proponer la lecci\xF3n. "),s())}function Rt(n,m){if(n&1&&(o(0,"div",126)(1,"h6",127),p(2,"i",128),r(3,"Requisitos para proponer la lecci\xF3n"),s(),o(4,"ul",129),_(5,Dt,4,0,"li",84)(6,Vt,4,0,"li",84)(7,At,3,0,"li",130),s()()),n&2){let e=l(2);a(5),d("ngIf",!e.lesson.references||!e.lesson.references.trim()),a(),d("ngIf",!e.lesson.files||e.lesson.files.length===0),a(),d("ngIf",e.lesson.references&&e.lesson.references.trim()&&e.lesson.files&&e.lesson.files.length>0)}}function Ut(n,m){if(n&1&&(o(0,"div")(1,"p",132),r(2),s()()),n&2){let e=l(2);a(2),x(e.lesson.references)}}function Nt(n,m){n&1&&(o(0,"p",133),p(1,"i",58),r(2," No se han agregado referencias a\xFAn. Las referencias son obligatorias antes de proponer la lecci\xF3n. "),s())}function jt(n,m){if(n&1&&(o(0,"span",99),r(1),s()),n&2){let e=m.$implicit;a(),M(" ",(e==null?null:e.name)||e," ")}}function zt(n,m){if(n&1&&(o(0,"div",70)(1,"h5",71),p(2,"i",134),r(3,"\xC1reas de Conocimiento"),s(),o(4,"div",135),_(5,jt,2,1,"span",136),s()()),n&2){let e=l(2);a(5),d("ngForOf",e.lesson.knowledge_areas)}}function Gt(n,m){if(n&1&&(o(0,"span",93),r(1),s()),n&2){let e=m.$implicit;a(),M(" #",e," ")}}function Bt(n,m){if(n&1&&(o(0,"div",70)(1,"h5",71),p(2,"i",137),r(3,"Etiquetas"),s(),o(4,"div",135),_(5,Gt,2,1,"span",138),s()()),n&2){let e=l(2);a(5),d("ngForOf",e.lesson.tags)}}function Wt(n,m){if(n&1&&(o(0,"li")(1,"strong"),r(2,"Materias:"),s(),o(3,"span",76),r(4),s()()),n&2){let e=l(2);a(4),x(e.lesson.academicSettings.subjects.join(", "))}}function qt(n,m){if(n&1&&(o(0,"li")(1,"strong"),r(2,"Nivel:"),s(),o(3,"span",76),r(4),s()()),n&2){let e=l(2);a(4),x(e.lesson.academicSettings.academicLevel)}}function $t(n,m){if(n&1){let e=v();o(0,"div",139)(1,"app-lesson-conversations",140),U("currentConversationIdChange",function(i){g(e);let c=l(2);return R(c.currentConversationId,i)||(c.currentConversationId=i),u(i)}),f("createConversation",function(i){g(e);let c=l(2);return u(c.onCreateConversation(i))})("sendMessage",function(i){g(e);let c=l(2);return u(c.onSendMessage(i))})("typingChange",function(i){g(e);let c=l(2);return u(c.onTypingChange(i))})("editMessage",function(i){g(e);let c=l(2);return u(c.onEditMessage(i))})("deleteMessage",function(i){g(e);let c=l(2);return u(c.onDeleteMessage(i))}),s()()}if(n&2){let e=l(2);a(),d("lesson",e.lesson)("loading",e.loading)("canEdit",e.canEdit())("canChat",e.canChat()),A("currentConversationId",e.currentConversationId),d("displayUserName",e.displayUserName.bind(e))("userPictureUrl",e.userPictureUrl)}}function Ht(n,m){if(n&1){let e=v();o(0,"div",141)(1,"app-lesson-feedback",142),f("teacherFeedbackChange",function(i){g(e);let c=l(2);return u(c.teacherFeedback=i)})("teacherCommentTypeChange",function(i){g(e);let c=l(2);return u(c.teacherCommentType=i)})("addComment",function(){g(e);let i=l(2);return u(i.addTeacherComment())})("deleteComment",function(i){g(e);let c=l(2);return u(c.onDeleteTeacherComment(i))}),s()()}if(n&2){let e=l(2);a(),d("lesson",e.lesson)("loading",e.loading)("canAddFeedback",e.canAddFeedback())("currentUserId",e.currentUserId)("teacherFeedback",e.teacherFeedback)("teacherCommentType",e.teacherCommentType)}}function Qt(n,m){if(n&1){let e=v();o(0,"div",16)(1,"div",17)(2,"div",18)(3,"div",19)(4,"h1",20),r(5),s(),o(6,"p",21),r(7),s(),o(8,"div",22)(9,"span",23),p(10,"i",24),r(11),s(),_(12,_t,3,1,"span",25)(13,ft,3,1,"span",26)(14,ht,3,1,"span",27)(15,bt,3,0,"span",28)(16,vt,3,0,"span",29),s()(),o(17,"div",30),_(18,xt,3,0,"button",31)(19,Ct,3,0,"button",32)(20,Mt,3,0,"button",33)(21,yt,3,0,"button",34)(22,wt,3,0,"button",35)(23,It,3,0,"button",36)(24,St,3,0,"button",37),s()(),o(25,"div",38)(26,"div",39)(27,"div",40)(28,"div",41),p(29,"i",42),o(30,"div")(31,"small",43),r(32,"Autor"),s(),o(33,"strong"),r(34),s()()()(),o(35,"div",40)(36,"div",41),p(37,"i",44),o(38,"div")(39,"small",43),r(40,"Grupo"),s(),o(41,"strong"),r(42),s()()()(),_(43,kt,8,1,"div",45),o(44,"div",40)(45,"div",41),p(46,"i",46),o(47,"div")(48,"small",43),r(49,"Actualizada"),s(),o(50,"strong"),r(51),z(52,"date"),s()()()()()()(),o(53,"div",47)(54,"div",48)(55,"span",49),r(56,"Progreso de la Lecci\xF3n"),s(),o(57,"span",50),r(58),s()(),o(59,"div",51),p(60,"div",52),s(),o(61,"div",53),_(62,Et,3,5,"div",54),s()(),o(63,"ul",55)(64,"li",56)(65,"button",57),p(66,"i",58),r(67,"Informaci\xF3n "),s()(),_(68,Pt,5,1,"li",59),o(69,"li",56)(70,"button",60),p(71,"i",61),r(72,"Archivos "),_(73,Ot,2,1,"span",62),s()(),o(74,"li",56)(75,"button",63),p(76,"i",64),r(77,"Equipo "),s()(),_(78,Ft,5,1,"li",59),s(),o(79,"div",65)(80,"div",66),_(81,Rt,8,3,"div",67),o(82,"div",68)(83,"div",69)(84,"div",70)(85,"h5",71),p(86,"i",72),r(87,"Justificaci\xF3n de la Lecci\xF3n"),s(),o(88,"div",73)(89,"h6",74),p(90,"i",75),r(91,"Metodolog\xEDa"),s(),o(92,"p",76),r(93),s()(),o(94,"div")(95,"h6",74),p(96,"i",77),r(97,"Objetivos de Aprendizaje"),s(),o(98,"p",76),r(99),s()()(),o(100,"div",70)(101,"h5",71),p(102,"i",78),r(103,"Referencias Bibliogr\xE1ficas"),s(),_(104,Ut,3,1,"div",79)(105,Nt,3,0,"ng-template",null,0,w),s(),_(107,zt,6,1,"div",80)(108,Bt,6,1,"div",80),s(),o(109,"div",81)(110,"div",70)(111,"h5",71),p(112,"i",82),r(113,"Configuraci\xF3n"),s(),o(114,"ul",83),_(115,Wt,5,1,"li",84)(116,qt,5,1,"li",84),o(117,"li")(118,"strong"),r(119,"Creada:"),s(),o(120,"span",76),r(121),z(122,"date"),s()()()()()()(),_(123,$t,2,7,"div",85),o(124,"div",86)(125,"app-lesson-files",87),f("resourceDescriptionChange",function(i){g(e);let c=l();return u(c.resourceDescription=i)})("fileSelected",function(i){g(e);let c=l();return u(c.selectedFile=i)})("upload",function(){g(e);let i=l();return u(i.uploadResource())})("deleteFile",function(i){g(e);let c=l();return u(c.onDeleteFile(i))})("downloadFile",function(i){g(e);let c=l();return u(c.onDownloadFile(i))}),s()(),o(126,"div",88)(127,"app-lesson-team",89),f("inviteStudentIdChange",function(i){g(e);let c=l();return u(c.inviteStudentId=i)})("inviteMessageChange",function(i){g(e);let c=l();return u(c.inviteMessage=i)})("invite",function(){g(e);let i=l();return u(i.inviteCollaborator())}),s()(),_(128,Ht,2,6,"div",90),s()()}if(n&2){let e=y(106),t=l();a(5),x(t.lesson.title),a(2),x(t.lesson.resume),a(2),d("ngClass","bg-"+t.getStatusColor(t.lesson.status)),a(2),M("",t.getStatusLabel(t.lesson.status)," "),a(),d("ngIf",t.lesson.academicSettings==null?null:t.lesson.academicSettings.academicLevel),a(),d("ngIf",t.lesson.academicSettings==null?null:t.lesson.academicSettings.grade),a(),d("ngIf",t.lesson.grade),a(),d("ngIf",t.lesson.isExported),a(),d("ngIf",t.lesson.state==="ready_for_migration"&&!t.lesson.isExported),a(2),d("ngIf",t.canEdit()),a(),d("ngIf",t.canDelete()),a(),d("ngIf",t.canLeaveLesson()),a(),d("ngIf",t.canApprove()),a(),d("ngIf",t.canApprove()),a(),d("ngIf",t.canGrade()),a(),d("ngIf",t.canExport()),a(10),x(t.displayUserName(t.lesson.author)),a(8),x(t.displayGroupName(t.lesson.academicGroup)),a(),d("ngIf",t.lesson.development_group==null?null:t.lesson.development_group.length),a(8),x(G(52,50,t.lesson.updatedAt,"short")),a(7),M("",t.getProgressPercentage(),"%"),a(2),ie("width",t.getProgressPercentage(),"%"),a(2),d("ngForOf",t.getProgressStages()),a(6),d("ngIf",t.canSeePrivateTabs()),a(5),d("ngIf",t.lesson.files==null?null:t.lesson.files.length),a(5),d("ngIf",t.canSeePrivateTabs()),a(3),d("ngIf",t.lesson.status==="draft"),a(12),x((t.lesson.justification==null?null:t.lesson.justification.methodology)||"No especificada"),a(6),x((t.lesson.justification==null?null:t.lesson.justification.objectives)||"No especificados"),a(5),d("ngIf",t.lesson.references&&t.lesson.references.trim())("ngIfElse",e),a(3),d("ngIf",t.lesson.knowledge_areas==null?null:t.lesson.knowledge_areas.length),a(),d("ngIf",t.lesson.tags==null?null:t.lesson.tags.length),a(7),d("ngIf",t.lesson.academicSettings==null||t.lesson.academicSettings.subjects==null?null:t.lesson.academicSettings.subjects.length),a(),d("ngIf",t.lesson.academicSettings==null?null:t.lesson.academicSettings.academicLevel),a(5),x(G(122,53,t.lesson.createdAt,"short")),a(2),d("ngIf",t.canSeePrivateTabs()),a(2),d("lesson",t.lesson)("userRole",t.userRole)("uploading",t.uploading)("selectedFile",t.selectedFile)("resourceDescription",t.resourceDescription),a(2),d("lesson",t.lesson)("loading",t.loading)("canEdit",t.userRole==="student"&&t.canEdit())("groupStudents",t.groupStudents)("inviteStudentId",t.inviteStudentId)("inviteMessage",t.inviteMessage),a(),d("ngIf",t.canSeePrivateTabs())}}function Jt(n,m){n&1&&p(0,"span",162)}function Kt(n,m){n&1&&p(0,"i",163)}function Yt(n,m){if(n&1){let e=v();o(0,"div",143)(1,"div",144)(2,"div",145)(3,"div",146)(4,"h5",147),p(5,"i",12),r(6,"Aprobar Lecci\xF3n "),s(),o(7,"button",148),f("click",function(){g(e);let i=l();return u(i.closeApproveModal())}),s()(),o(8,"div",149)(9,"p",150),r(10,"Est\xE1s aprobando la lecci\xF3n "),o(11,"strong"),r(12),s()(),o(13,"div",150)(14,"label",151)(15,"strong"),r(16,"Retroalimentaci\xF3n "),o(17,"span",152),r(18,"*"),s()()(),o(19,"textarea",153),U("ngModelChange",function(i){g(e);let c=l();return R(c.approveData.feedback,i)||(c.approveData.feedback=i),u(i)}),s(),o(20,"small",154),r(21," Estos comentarios ser\xE1n visibles para el equipo de desarrollo. "),s()(),o(22,"div",155),p(23,"i",58),o(24,"strong"),r(25,"Nota:"),s(),r(26,' Al aprobar, la lecci\xF3n cambiar\xE1 a estado "Aprobada" y el equipo podr\xE1 comenzar a desarrollarla. '),s()(),o(27,"div",156)(28,"button",157),f("click",function(){g(e);let i=l();return u(i.closeApproveModal())}),p(29,"i",158),r(30,"Cancelar "),s(),o(31,"button",159),f("click",function(){g(e);let i=l();return u(i.approveLesson())}),_(32,Jt,1,0,"span",160)(33,Kt,1,0,"i",161),r(34),s()()()()()}if(n&2){let e=l();a(12),M('"',e.lesson==null?null:e.lesson.title,'"'),a(7),A("ngModel",e.approveData.feedback),d("ngModelOptions",N(9,ye))("disabled",e.loading),a(9),d("disabled",e.loading),a(3),d("disabled",!(e.approveData.feedback!=null&&e.approveData.feedback.trim())||e.loading),a(),d("ngIf",e.loading),a(),d("ngIf",!e.loading),a(),M(" ",e.loading?"Aprobando...":"Aprobar Lecci\xF3n"," ")}}function Xt(n,m){n&1&&p(0,"span",162)}function Zt(n,m){n&1&&p(0,"i",158)}function en(n,m){if(n&1){let e=v();o(0,"div",143)(1,"div",144)(2,"div",145)(3,"div",164)(4,"h5",147),p(5,"i",165),r(6,"Rechazar Lecci\xF3n "),s(),o(7,"button",148),f("click",function(){g(e);let i=l();return u(i.closeRejectModal())}),s()(),o(8,"div",149)(9,"p",150),r(10,"Est\xE1s rechazando la lecci\xF3n "),o(11,"strong"),r(12),s()(),o(13,"div",150)(14,"label",166)(15,"strong"),r(16,"Motivo del Rechazo "),o(17,"span",152),r(18,"*"),s()()(),o(19,"textarea",167),U("ngModelChange",function(i){g(e);let c=l();return R(c.rejectReason,i)||(c.rejectReason=i),u(i)}),s(),o(20,"small",154),r(21," Proporciona retroalimentaci\xF3n clara y constructiva para que puedan mejorar la propuesta. "),s()(),o(22,"div",168),p(23,"i",128),o(24,"strong"),r(25,"Nota:"),s(),r(26,' Al rechazar, la lecci\xF3n volver\xE1 a estado "Borrador" y el equipo podr\xE1 editarla y volver a proponerla. '),s()(),o(27,"div",156)(28,"button",157),f("click",function(){g(e);let i=l();return u(i.closeRejectModal())}),p(29,"i",169),r(30,"Cancelar "),s(),o(31,"button",170),f("click",function(){g(e);let i=l();return u(i.rejectLesson())}),_(32,Xt,1,0,"span",160)(33,Zt,1,0,"i",171),r(34),s()()()()()}if(n&2){let e=l();a(12),M('"',e.lesson==null?null:e.lesson.title,'"'),a(7),A("ngModel",e.rejectReason),d("ngModelOptions",N(9,ye))("disabled",e.loading),a(9),d("disabled",e.loading),a(3),d("disabled",!(e.rejectReason!=null&&e.rejectReason.trim())||e.loading),a(),d("ngIf",e.loading),a(),d("ngIf",!e.loading),a(),M(" ",e.loading?"Rechazando...":"Rechazar Lecci\xF3n"," ")}}var Hn=(()=>{class n{constructor(e,t,i){this.route=e,this.router=t,this.academicLessonService=i,this.lesson=null,this.lessonId="",this.userRole="",this.authUserRole="",this.currentUserId="",this.loading=!1,this.errorMessage="",this.successMessage="",this.showApproveModal=!1,this.showRejectModal=!1,this.showGradeModal=!1,this.approveData={feedback:"",grade:0},this.rejectReason="",this.gradeData={grade:0,feedback:""},this.inviteStudentId="",this.inviteMessage="Te invito a colaborar en esta lecci\xF3n acad\xE9mica. \xA1\xDAnete al equipo!",this.groupStudents=[],this.chatMessage="",this.uploading=!1,this.selectedFile=null,this.resourceDescription="",this.resourceCategory="document",this.teacherFeedback="",this.teacherCommentType="feedback",this.currentConversationId="",this.newConversationTitle="",this.showNewConversationForm=!1,this.pendingFocusTab=null,this.chatPollingHandle=null,this.isUserTyping=!1,this.userPictureUrl=c=>{try{let b=c;return b&&b.picture?`${window?.API_BASE_URL||"http://localhost:3800/api/"}get-image-user/${b.picture}`:""}catch{return""}}}ngOnInit(){this.lessonId=this.route.snapshot.params.id,this.loadUserInfo(),this.loadLesson(),this.startChatPolling()}ngOnDestroy(){this.stopChatPolling()}loadUserInfo(){try{let e=localStorage.getItem("user")||localStorage.getItem("identity")||"{}",t=JSON.parse(e);this.currentUserId=String(t._id||t.id||t.uid||"")}catch{this.currentUserId=""}}startChatPolling(){this.stopChatPolling();let e=()=>this.isUserTyping?3e3:5e3,t=()=>{try{if(!this.lessonId)return;this.refreshLessonSilently()}catch{}this.chatPollingHandle=setTimeout(t,e())};this.chatPollingHandle=setTimeout(t,e())}stopChatPolling(){if(this.chatPollingHandle)try{clearTimeout(this.chatPollingHandle)}catch{}this.chatPollingHandle=null}refreshLessonSilently(){this.academicLessonService.getLessonById(this.lessonId).subscribe({next:e=>{let t=e.data||{},c=(Array.isArray(t.messages)?t.messages:[]).map(h=>({_id:String(h._id||""),content:String(h.content||""),author:h.author||"",timestamp:h.timestamp||h.created_at||new Date().toISOString(),edited:!!h.edited,editedAt:h.editedAt,type:"text"}));this.lesson?(this.lesson.chatMessages=c,Object.assign(this.lesson,e.data)):this.lesson=Y(K({},e.data),{chatMessages:c});let b=Array.isArray(e.data?.conversations)?e.data.conversations:[],S={_id:"default",title:"Conversaci\xF3n General",participants:[],messages:this.lesson.chatMessages||[],createdAt:this.lesson.createdAt};this.lesson.conversations=[S,...b.filter(h=>h&&h._id!=="default")],!(this.currentConversationId?this.lesson.conversations.some(h=>h._id===this.currentConversationId):!1)&&this.lesson.conversations.length>0&&(this.currentConversationId=this.lesson.conversations[0]._id||""),setTimeout(()=>this.scrollMessagesToBottom(),0)},error:()=>{}})}onTypingChange(e){this.isUserTyping=e,this.startChatPolling()}loadLesson(){this.loading=!0,this.academicLessonService.getLessonById(this.lessonId).subscribe({next:e=>{let t=e.data||{},c=(Array.isArray(t.messages)?t.messages:[]).map(h=>({_id:String(h._id||""),content:String(h.content||""),author:h.author||"",timestamp:h.timestamp||h.created_at||new Date().toISOString(),edited:!!h.edited,editedAt:h.editedAt,type:"text"}));this.lesson=Y(K({},e.data),{chatMessages:c});let b=Array.isArray(e.data?.conversations)?e.data.conversations:[],S={_id:"default",title:"Conversaci\xF3n General",participants:[],messages:this.lesson.chatMessages||[],createdAt:this.lesson.createdAt};this.lesson.conversations=[S,...b.filter(h=>h&&h._id!=="default")],!(this.currentConversationId?this.lesson.conversations.some(h=>h._id===this.currentConversationId):!1)&&this.lesson.conversations.length>0&&(this.currentConversationId=this.lesson.conversations[0]._id||"");try{let h=this.lesson.academicGroup;console.log("\u{1F50D} [loadLesson] academicGroup completo:",h);let V=Array.isArray(h?.students)?h.students:[];console.log("\u{1F50D} [loadLesson] students array crudo:",V),this.groupStudents=V.map(I=>({_id:String(I._id||I),name:I.name||I.fullname||I.username||I.email||"Estudiante",surname:I.surname||I.lastname||"",email:I.email||""})),console.log("\u{1F50D} [loadLesson] groupStudents mapeados:",this.groupStudents)}catch(h){console.error("\u274C [loadLesson] Error al cargar estudiantes del grupo:",h)}if(this.userRole=this.computeContextRole(),this.loading=!1,setTimeout(()=>this.scrollMessagesToBottom(),0),this.pendingFocusTab){let h=`${this.pendingFocusTab}-tab`;setTimeout(()=>{let V=document.getElementById(h);if(V)try{V.click()}catch{}this.pendingFocusTab=null},0)}},error:e=>{this.errorMessage="Error al cargar la lecci\xF3n",this.loading=!1,console.error("Error loading lesson:",e)}})}deleteLesson(){confirm("\xBFEst\xE1 seguro de que desea eliminar esta lecci\xF3n?")&&(this.loading=!0,this.academicLessonService.deleteLesson(this.lessonId).subscribe({next:e=>{this.successMessage=e.message,setTimeout(()=>{this.router.navigate(["/academia/lessons"])},2e3)},error:e=>{this.errorMessage=e.error?.message||"Error al eliminar la lecci\xF3n",this.loading=!1}}))}editLesson(){this.router.navigate(["/academia/lessons",this.lesson._id,"edit"])}openApproveModal(){this.showApproveModal=!0,this.approveData={feedback:"",grade:0}}closeApproveModal(){this.showApproveModal=!1}openRejectModal(){this.showRejectModal=!0,this.rejectReason=""}closeRejectModal(){this.showRejectModal=!1}openGradeModal(){this.showGradeModal=!0,this.gradeData={grade:0,feedback:""}}closeGradeModal(){this.showGradeModal=!1}approveLesson(){if(!this.lesson||!this.approveData.feedback?.trim()){this.errorMessage="Debes proporcionar comentarios de retroalimentaci\xF3n al aprobar";return}this.loading=!0,this.academicLessonService.approveLesson(this.lessonId,{feedback:this.approveData.feedback,grade:this.approveData.grade}).subscribe({next:e=>{this.successMessage=e.message||"Lecci\xF3n aprobada exitosamente",this.closeApproveModal(),this.loadLesson(),this.loading=!1,setTimeout(()=>this.successMessage="",3e3)},error:e=>{this.errorMessage=e.error?.message||"Error al aprobar la lecci\xF3n",this.loading=!1}})}rejectLesson(){if(!this.lesson||!this.rejectReason?.trim()){this.errorMessage="Debes proporcionar un motivo para rechazar la lecci\xF3n";return}this.loading=!0,this.academicLessonService.rejectLesson(this.lessonId,this.rejectReason).subscribe({next:e=>{this.successMessage=e.message||"Lecci\xF3n rechazada",this.closeRejectModal(),this.loadLesson(),this.loading=!1,setTimeout(()=>this.successMessage="",3e3)},error:e=>{this.errorMessage=e.error?.message||"Error al rechazar la lecci\xF3n",this.loading=!1}})}gradeLesson(){if(this.lesson){if(this.gradeData.grade<0||this.gradeData.grade>5){this.errorMessage="La calificaci\xF3n debe estar entre 0 y 5";return}if(!this.gradeData.feedback?.trim()){this.errorMessage="Debes proporcionar retroalimentaci\xF3n con la calificaci\xF3n";return}this.loading=!0,this.academicLessonService.gradeLesson(this.lessonId,{grade:this.gradeData.grade,feedback:this.gradeData.feedback}).subscribe({next:e=>{this.successMessage=e.message||"Lecci\xF3n calificada exitosamente",this.closeGradeModal(),this.loadLesson(),this.loading=!1,setTimeout(()=>this.successMessage="",3e3)},error:e=>{this.errorMessage=e.error?.message||"Error al calificar la lecci\xF3n",this.loading=!1}})}}exportLesson(){this.lesson&&confirm("\xBFEst\xE1s seguro de solicitar la exportaci\xF3n de esta lecci\xF3n a RedDin\xE1mica principal? Los administradores revisar\xE1n y aprobar\xE1n la solicitud.")&&(this.loading=!0,this.academicLessonService.requestExport(this.lessonId).subscribe({next:e=>{this.successMessage=e.message||"Solicitud de exportaci\xF3n enviada. Los administradores revisar\xE1n tu lecci\xF3n.",this.loadLesson(),this.loading=!1,setTimeout(()=>this.successMessage="",5e3)},error:e=>{this.errorMessage=e.error?.message||"Error al solicitar la exportaci\xF3n",this.loading=!1}}))}canEdit(){if(!this.lesson)return!1;let e=this.getIdFromRef(this.lesson?.leader);return e&&e===this.currentUserId&&!(this.lesson.status==="completed"||this.lesson.status==="graded")}canDelete(){if(!this.lesson)return!1;let e=this.isCurrentUserAuthor(),t=this.isCurrentUserInGroupStudents();return e&&t&&["draft","proposed"].includes(this.lesson.status||"")}canApprove(){return this.lesson?this.getIdFromRef(this.lesson?.academicGroup?.teacher)===this.currentUserId&&this.lesson?.status==="proposed":!1}canGrade(){return this.lesson?this.getIdFromRef(this.lesson?.academicGroup?.teacher)===this.currentUserId&&this.lesson?.status==="completed":!1}canExport(){return this.lesson?this.getIdFromRef(this.lesson?.academicGroup?.teacher)===this.currentUserId&&this.lesson?.status==="graded"&&!this.lesson?.isExported&&this.lesson?.state!=="ready_for_migration":!1}getStatusLabel(e){return{draft:"Borrador",proposed:"Propuesta",approved:"Aprobada",rejected:"Rechazada",in_development:"En Desarrollo",completed:"Completada",graded:"Calificada",ready_for_migration:"Lista para Migraci\xF3n"}[e]||e}getStatusBadgeClass(e){return{draft:"badge-secondary",proposed:"badge-warning",approved:"badge-success",rejected:"badge-danger",in_development:"badge-info",completed:"badge-primary",graded:"badge-success",ready_for_migration:"badge-success"}[e]||"badge-secondary"}getDifficultyLabel(e){return{F\u00E1cil:"F\xE1cil",Moderado:"Moderado",Dif\u00EDcil:"Dif\xEDcil"}[e]||e}getDifficultyBadgeClass(e){return{F\u00E1cil:"badge-success",Moderado:"badge-warning",Dif\u00EDcil:"badge-danger"}[e]||"badge-secondary"}getDurationLabel(e){if(e<60)return`${e} minutos`;{let t=Math.floor(e/60),i=e%60;return i===0?`${t} hora${t>1?"s":""}`:`${t} hora${t>1?"s":""} ${i} minutos`}}getIdFromRef(e){if(!e)return"";if(typeof e=="string")return String(e);if(typeof e=="object"){if(e._id||e.id)return String(e._id||e.id);if(e.user&&(e.user._id||e.user.id))return String(e.user._id||e.user.id)}return""}isCurrentUserAuthor(){if(!this.lesson||!this.currentUserId)return!1;let e=this.getIdFromRef(this.lesson.author);return e&&e===this.currentUserId}isCurrentUserInGroupStudents(){if(!this.lesson||!this.currentUserId)return!1;let e=this.lesson.academicGroup,c=(Array.isArray(e?.students)?e.students:[]).map(V=>this.getIdFromRef(V)).filter(V=>!!V).includes(this.currentUserId),b=this.getIdFromRef(e?.teacher),S=b&&b===this.currentUserId,k=this.getIdFromRef(this.lesson?.leader),h=k&&k===this.currentUserId;return c||S||h}computeContextRole(){return this.authUserRole==="teacher"?"teacher":this.isCurrentUserInGroupStudents()?"student":""}displayUserName(e){if(!e)return"Usuario";if(typeof e=="string")return e;let t=e.name||"Usuario",i=e.email?` <${e.email}>`:"";return`${t}${i}`}displayGroupName(e){return e?typeof e=="string"?e:e.name||"N/A":"N/A"}getStatusColor(e){return{draft:"secondary",proposed:"warning",approved:"success",rejected:"danger",in_development:"info",completed:"primary",graded:"dark"}[e]||"secondary"}getCommentTypeLabel(e){return{feedback:"Retroalimentaci\xF3n",suggestion:"Sugerencia",approval:"Aprobaci\xF3n",correction:"Correcci\xF3n"}[e]||e}getCommentTypeBadge(e){return{feedback:"bg-info",suggestion:"bg-warning",approval:"bg-success",correction:"bg-danger"}[e]||"bg-secondary"}getProgressPercentage(){return this.lesson&&{draft:15,proposed:30,in_development:50,approved:65,completed:85,graded:100,rejected:30}[this.lesson.status||"draft"]||0}getProgressStages(){if(!this.lesson)return[];let e=this.lesson.status||"draft",t=[{label:"Borrador",key:"draft"},{label:"Propuesta",key:"proposed"},{label:"En Desarrollo",key:"in_development"},{label:"Completada",key:"completed"},{label:"Calificada",key:"graded"}],i=["draft","proposed","in_development","approved","completed","graded"],c=i.indexOf(e);return t.map((b,S)=>{let k=i.indexOf(b.key);return Y(K({},b),{completed:k<c,active:k===c||e==="approved"&&b.key==="in_development"})})}inviteCollaborator(){if(!this.lesson)return;if(!this.inviteStudentId){this.errorMessage="Seleccione un estudiante del grupo.";return}let e={lessonId:this.lesson._id,userId:this.inviteStudentId,message:this.inviteMessage};this.loading=!0,this.academicLessonService.inviteCollaborator(e).subscribe({next:t=>{console.log("\u2705 [inviteCollaborator] Respuesta exitosa:",t),this.successMessage=t.message||"Invitaci\xF3n enviada",this.inviteStudentId="",this.inviteMessage="",this.loadLesson(),this.loading=!1,setTimeout(()=>this.successMessage="",3e3)},error:t=>{console.error("\u274C [inviteCollaborator] Error completo:",t),console.error("\u274C [inviteCollaborator] Error response:",t.error),console.error("\u274C [inviteCollaborator] Error status:",t.status),this.errorMessage=t.error?.message||t.message||"Error al invitar colaborador",this.loading=!1}})}sendChatMessage(){if(!this.lesson||!this.currentConversationId)return;let e=(this.chatMessage||"").trim();if(!e)return;this.loading=!0,this.pendingFocusTab="chat",(this.currentConversationId==="default"?this.academicLessonService.sendChatMessage({lessonId:this.lesson._id,content:e,type:"text"}):this.academicLessonService.sendMessageToConversation(this.lesson._id,this.currentConversationId,e)).subscribe({next:i=>{this.successMessage=i.message||"Mensaje enviado",this.chatMessage="",this.loadLesson(),this.loading=!1,setTimeout(()=>this.successMessage="",3e3)},error:i=>{this.errorMessage=i.error?.message||"Error al enviar mensaje",this.loading=!1}})}onCreateConversation(e){this.newConversationTitle=e,this.createConversation()}onSendMessage(e){this.currentConversationId=e.conversationId,this.chatMessage=e.content,this.sendChatMessage()}onEditMessage(e){this.lesson&&e.conversationId!=="default"&&(this.loading=!0,this.academicLessonService.updateConversationMessage(this.lesson._id,e.conversationId,e.messageId,e.content).subscribe({next:t=>{this.successMessage=t.message||"Mensaje actualizado",this.loadLesson(),this.loading=!1,setTimeout(()=>this.successMessage="",3e3)},error:t=>{this.errorMessage=t.error?.message||"No se pudo editar el mensaje",this.loading=!1}}))}onDeleteMessage(e){this.lesson&&e.conversationId!=="default"&&confirm("\xBFEliminar este mensaje?")&&(this.loading=!0,this.academicLessonService.deleteConversationMessage(this.lesson._id,e.conversationId,e.messageId).subscribe({next:t=>{this.successMessage=t.message||"Mensaje eliminado",this.loadLesson(),this.loading=!1,setTimeout(()=>this.successMessage="",3e3)},error:t=>{this.errorMessage=t.error?.message||"No se pudo eliminar el mensaje",this.loading=!1}}))}canChat(){if(!this.lesson||!this.currentUserId)return!1;let e=this.isCurrentUserAuthor(),t=this.isCurrentUserInGroupStudents(),i=(()=>{let b=this.lesson?.academicGroup,S=this.getIdFromRef(b?.teacher);return S&&S===this.currentUserId})(),c=(Array.isArray(this.lesson?.development_group)?this.lesson.development_group:[]).map(k=>this.getIdFromRef(k?.user)).filter(k=>!!k).includes(this.currentUserId);return e||t||i||c}canSeePrivateTabs(){if(!this.lesson||!this.currentUserId)return!1;let e=this.getIdFromRef(this.lesson?.leader),t=e&&e===this.currentUserId,i=this.isCurrentUserAuthor(),c=this.lesson?.academicGroup,b=this.getIdFromRef(c?.teacher),S=b&&b===this.currentUserId,V=(Array.isArray(this.lesson?.development_group)?this.lesson.development_group:[]).map(I=>this.getIdFromRef(I?.user)).filter(I=>!!I).includes(this.currentUserId);return t||i||S||V}scrollMessagesToBottom(){try{let e=this.messagesList?.nativeElement;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})}catch{}}onFileSelected(e){let t=e?.target?.files?.[0];this.selectedFile=t||null}uploadResource(){!this.lesson||!this.selectedFile||(this.uploading=!0,this.academicLessonService.uploadResource({lessonId:this.lesson._id,file:this.selectedFile,description:this.resourceDescription,category:this.resourceCategory}).subscribe({next:e=>{this.successMessage=e.message||"Archivo subido",this.selectedFile=null,this.resourceDescription="",this.loadLesson(),this.uploading=!1,setTimeout(()=>this.successMessage="",3e3)},error:e=>{this.errorMessage=e.error?.message||"Error al subir archivo",this.uploading=!1}}))}onDownloadFile(e){if(!e)return;let t=window?.API_BASE_URL||"http://localhost:3800/",i=e.url?String(e.url):`${t.replace(/\/$/,"/")}${String(e.path).replace(/^\//,"")}`;try{window.open(i,"_blank")}catch{}}onDeleteFile(e){if(!this.lesson||!e||!confirm("\xBFEliminar este archivo de la lecci\xF3n?"))return;let c={files:(Array.isArray(this.lesson.files)?this.lesson.files:[]).filter(b=>b._id&&e._id?b._id!==e._id:b.path!==e.path)};this.loading=!0,this.academicLessonService.updateLesson(this.lesson._id,c).subscribe({next:b=>{this.successMessage=b.message||"Archivo eliminado",this.loadLesson(),this.loading=!1,setTimeout(()=>this.successMessage="",3e3)},error:b=>{this.errorMessage=b.error?.message||"No se pudo eliminar el archivo",this.loading=!1}})}addTeacherComment(){if(!this.lesson)return;let e=(this.teacherFeedback||"").trim();e&&(this.loading=!0,this.pendingFocusTab="feedback",this.academicLessonService.addTeacherComment(this.lesson._id,e,this.teacherCommentType).subscribe({next:t=>{this.successMessage=t.message||"Comentario agregado",this.teacherFeedback="",this.loadLesson(),this.loading=!1,setTimeout(()=>this.successMessage="",3e3)},error:t=>{this.errorMessage=t.error?.message||"Error al agregar comentario",this.loading=!1}}))}onDeleteTeacherComment(e){!this.lesson||!e||confirm("\xBFEliminar este comentario?")&&(this.loading=!0,this.pendingFocusTab="feedback",this.academicLessonService.deleteTeacherComment(this.lesson._id,e).subscribe({next:t=>{this.successMessage=t.message||"Comentario eliminado",this.loadLesson(),this.loading=!1,setTimeout(()=>this.successMessage="",3e3)},error:t=>{this.errorMessage=t.error?.message||"Error al eliminar comentario",this.loading=!1}}))}canAddFeedback(){if(!this.lesson||!this.currentUserId)return!1;let e=this.getIdFromRef(this.lesson?.academicGroup?.teacher)===this.currentUserId,t=this.getIdFromRef(this.lesson?.leader)===this.currentUserId,i=this.isCurrentUserAuthor();return e||t||i}leaveLesson(){!this.lesson||!this.currentUserId||confirm("\xBFEst\xE1s seguro de que deseas retirarte de esta lecci\xF3n?")&&(this.loading=!0,this.academicLessonService.leaveLesson(this.lessonId).subscribe({next:e=>{this.successMessage=e.message||"Te has retirado de la lecci\xF3n",setTimeout(()=>{this.router.navigate(["/academia/lessons"])},2e3)},error:e=>{this.errorMessage=e.error?.message||"Error al retirarse de la lecci\xF3n",this.loading=!1}}))}canLeaveLesson(){if(!this.lesson||!this.currentUserId)return!1;let e=this.getIdFromRef(this.lesson?.leader);return e&&e===this.currentUserId?!1:(Array.isArray(this.lesson?.development_group)?this.lesson.development_group:[]).map(b=>this.getIdFromRef(b?.user)).filter(b=>!!b).includes(this.currentUserId)}getCurrentConversation(){return!this.lesson||!this.lesson.conversations||!this.currentConversationId?null:this.lesson.conversations.find(e=>e._id===this.currentConversationId)}createConversation(){if(!this.lesson)return;let e=(this.newConversationTitle||"").trim();e&&(this.loading=!0,this.academicLessonService.createConversation(this.lesson._id,e).subscribe({next:t=>{this.successMessage=t.message||"Conversaci\xF3n creada",this.newConversationTitle="",this.showNewConversationForm=!1;let i=t?.data?.conversationId;this.pendingFocusTab="chat",this.loadLesson(),i&&setTimeout(()=>{this.currentConversationId=i},0),this.loading=!1,setTimeout(()=>this.successMessage="",3e3)},error:t=>{this.errorMessage=t.error?.message||"Error al crear conversaci\xF3n",this.loading=!1}}))}static{this.\u0275fac=function(t){return new(t||n)(X(ge),X(ue),X(fe))}}static{this.\u0275cmp=E({type:n,selectors:[["app-lesson-detail"]],viewQuery:function(t,i){if(t&1&&se(mt,5),t&2){let c;ae(c=re())&&(i.messagesList=c.first)}},decls:8,vars:9,consts:[["noReferences",""],[1,"lesson-detail-container"],["class","loading-container",4,"ngIf"],["class","alert alert-success alert-dismissible fade show","role","alert",4,"ngIf"],["class","alert alert-danger alert-dismissible fade show","role","alert",4,"ngIf"],["class","lesson-wrapper",4,"ngIf"],["class","modal fade show","style","display: block; background: rgba(0,0,0,0.5);","tabindex","-1",4,"ngIf"],[3,"close","save","show","loading","gradeData"],[1,"loading-container"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],["role","alert",1,"alert","alert-success","alert-dismissible","fade","show"],[1,"fas","fa-check-circle","me-2"],["type","button","aria-label","Close",1,"btn-close",3,"click"],["role","alert",1,"alert","alert-danger","alert-dismissible","fade","show"],[1,"fas","fa-exclamation-circle","me-2"],[1,"lesson-wrapper"],[1,"lesson-header-card"],[1,"d-flex","justify-content-between","align-items-start"],[1,"flex-grow-1"],[1,"lesson-title"],[1,"lesson-description","text-muted"],[1,"d-flex","flex-wrap","gap-2","mt-3"],[1,"badge",3,"ngClass"],[1,"fas","fa-circle-notch","me-1"],["class","badge bg-secondary",4,"ngIf"],["class","badge bg-info",4,"ngIf"],["class","badge bg-warning text-dark",4,"ngIf"],["class","badge bg-success",4,"ngIf"],["class","badge bg-primary",4,"ngIf"],[1,"action-buttons-group"],["class","btn btn-outline-primary btn-sm","title","Editar lecci\xF3n",3,"click",4,"ngIf"],["class","btn btn-outline-danger btn-sm",3,"click",4,"ngIf"],["class","btn btn-outline-warning btn-sm",3,"click",4,"ngIf"],["class","btn btn-success btn-sm","title","Aprobar propuesta",3,"click",4,"ngIf"],["class","btn btn-danger btn-sm","title","Rechazar propuesta",3,"click",4,"ngIf"],["class","btn btn-primary btn-sm","title","Calificar lecci\xF3n",3,"click",4,"ngIf"],["class","btn btn-info btn-sm","title","Solicitar exportaci\xF3n a RedDin\xE1mica",3,"click",4,"ngIf"],[1,"quick-info","mt-4"],[1,"row","g-3"],[1,"col-md-3"],[1,"info-card"],[1,"fas","fa-user","text-primary"],[1,"text-muted","d-block"],[1,"fas","fa-users","text-success"],["class","col-md-3",4,"ngIf"],[1,"fas","fa-clock","text-warning"],[1,"lesson-progress-bar"],[1,"progress-header"],[1,"progress-title"],[1,"progress-percentage"],[1,"progress-track"],[1,"progress-fill"],[1,"progress-stages"],["class","progress-stage",3,"active","completed",4,"ngFor","ngForOf"],["role","tablist",1,"nav","nav-tabs","lesson-tabs"],["role","presentation",1,"nav-item"],["id","info-tab","data-bs-toggle","tab","data-bs-target","#info","type","button","role","tab",1,"nav-link","active"],[1,"fas","fa-info-circle","me-2"],["class","nav-item","role","presentation",4,"ngIf"],["id","files-tab","data-bs-toggle","tab","data-bs-target","#files","type","button","role","tab",1,"nav-link"],[1,"fas","fa-paperclip","me-2"],["class","badge bg-secondary ms-2",4,"ngIf"],["id","team-tab","data-bs-toggle","tab","data-bs-target","#team","type","button","role","tab",1,"nav-link"],[1,"fas","fa-user-friends","me-2"],[1,"tab-content","lesson-tab-content"],["id","info","role","tabpanel",1,"tab-pane","fade","show","active"],["class","alert alert-warning","role","alert",4,"ngIf"],[1,"row","g-4"],[1,"col-lg-8"],[1,"content-card"],[1,"card-title"],[1,"fas","fa-lightbulb","me-2"],[1,"mb-4"],[1,"text-primary"],[1,"fas","fa-chalkboard-teacher","me-2"],[1,"text-muted"],[1,"fas","fa-bullseye","me-2"],[1,"fas","fa-book","me-2"],[4,"ngIf","ngIfElse"],["class","content-card",4,"ngIf"],[1,"col-lg-4"],[1,"fas","fa-cog","me-2"],[1,"list-unstyled","config-list"],[4,"ngIf"],["class","tab-pane fade","id","chat","role","tabpanel",4,"ngIf"],["id","files","role","tabpanel",1,"tab-pane","fade"],[3,"resourceDescriptionChange","fileSelected","upload","deleteFile","downloadFile","lesson","userRole","uploading","selectedFile","resourceDescription"],["id","team","role","tabpanel",1,"tab-pane","fade"],[3,"inviteStudentIdChange","inviteMessageChange","invite","lesson","loading","canEdit","groupStudents","inviteStudentId","inviteMessage"],["class","tab-pane fade","id","feedback","role","tabpanel",4,"ngIf"],[1,"badge","bg-secondary"],[1,"fas","fa-school","me-1"],[1,"badge","bg-info"],[1,"fas","fa-graduation-cap","me-1"],[1,"badge","bg-warning","text-dark"],[1,"fas","fa-star","me-1"],[1,"badge","bg-success"],[1,"fas","fa-check-circle","me-1"],[1,"badge","bg-primary"],[1,"fas","fa-hourglass-half","me-1"],["title","Editar lecci\xF3n",1,"btn","btn-outline-primary","btn-sm",3,"click"],[1,"fas","fa-edit"],[1,"btn","btn-outline-danger","btn-sm",3,"click"],[1,"fas","fa-trash"],[1,"btn","btn-outline-warning","btn-sm",3,"click"],[1,"fas","fa-sign-out-alt"],["title","Aprobar propuesta",1,"btn","btn-success","btn-sm",3,"click"],[1,"fas","fa-check"],["title","Rechazar propuesta",1,"btn","btn-danger","btn-sm",3,"click"],[1,"fas","fa-times"],["title","Calificar lecci\xF3n",1,"btn","btn-primary","btn-sm",3,"click"],[1,"fas","fa-clipboard-check"],["title","Solicitar exportaci\xF3n a RedDin\xE1mica",1,"btn","btn-info","btn-sm",3,"click"],[1,"fas","fa-paper-plane"],[1,"fas","fa-user-friends","text-info"],[1,"progress-stage"],[1,"stage-label"],["id","chat-tab","data-bs-toggle","tab","data-bs-target","#chat","type","button","role","tab",1,"nav-link"],[1,"fas","fa-comments","me-2"],["class","badge bg-primary ms-2",4,"ngIf"],[1,"badge","bg-primary","ms-2"],[1,"badge","bg-secondary","ms-2"],["id","feedback-tab","data-bs-toggle","tab","data-bs-target","#feedback","type","button","role","tab",1,"nav-link"],["class","badge bg-info ms-2",4,"ngIf"],[1,"badge","bg-info","ms-2"],["role","alert",1,"alert","alert-warning"],[1,"alert-heading"],[1,"fas","fa-exclamation-triangle","me-2"],[1,"mb-0"],["class","text-white",4,"ngIf"],[1,"text-white"],[1,"text-muted",2,"white-space","pre-wrap"],[1,"text-muted","fst-italic"],[1,"fas","fa-tags","me-2"],[1,"d-flex","flex-wrap","gap-2"],["class","badge bg-primary",4,"ngFor","ngForOf"],[1,"fas","fa-hashtag","me-2"],["class","badge bg-info",4,"ngFor","ngForOf"],["id","chat","role","tabpanel",1,"tab-pane","fade"],[3,"currentConversationIdChange","createConversation","sendMessage","typingChange","editMessage","deleteMessage","lesson","loading","canEdit","canChat","currentConversationId","displayUserName","userPictureUrl"],["id","feedback","role","tabpanel",1,"tab-pane","fade"],[3,"teacherFeedbackChange","teacherCommentTypeChange","addComment","deleteComment","lesson","loading","canAddFeedback","currentUserId","teacherFeedback","teacherCommentType"],["tabindex","-1",1,"modal","fade","show",2,"display","block","background","rgba(0,0,0,0.5)"],[1,"modal-dialog","modal-dialog-centered"],[1,"modal-content"],[1,"modal-header","bg-success","text-white"],[1,"modal-title"],["type","button",1,"btn-close","btn-close-white",3,"click"],[1,"modal-body"],[1,"mb-3"],["for","approveFeedback",1,"form-label"],[1,"text-danger"],["id","approveFeedback","rows","4","placeholder","Proporciona comentarios constructivos sobre la lecci\xF3n...","name","approveFeedback",1,"form-control",3,"ngModelChange","ngModel","ngModelOptions","disabled"],[1,"form-text","text-muted"],[1,"alert","alert-info","mb-0"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click","disabled"],[1,"fas","fa-times","me-1"],["type","button",1,"btn","btn-success",3,"click","disabled"],["class","spinner-border spinner-border-sm me-2","role","status",4,"ngIf"],["class","fas fa-check me-1",4,"ngIf"],["role","status",1,"spinner-border","spinner-border-sm","me-2"],[1,"fas","fa-check","me-1"],[1,"modal-header","bg-danger","text-white"],[1,"fas","fa-times-circle","me-2"],["for","rejectReason",1,"form-label"],["id","rejectReason","rows","4","placeholder","Explica por qu\xE9 la lecci\xF3n no cumple con los requisitos...","name","rejectReason",1,"form-control",3,"ngModelChange","ngModel","ngModelOptions","disabled"],[1,"alert","alert-warning","mb-0"],[1,"fas","fa-arrow-left","me-1"],["type","button",1,"btn","btn-danger",3,"click","disabled"],["class","fas fa-times me-1",4,"ngIf"]],template:function(t,i){t&1&&(o(0,"div",1),_(1,pt,4,0,"div",2)(2,gt,4,1,"div",3)(3,ut,4,1,"div",4)(4,Qt,129,56,"div",5),s(),_(5,Yt,35,10,"div",6)(6,en,35,10,"div",6),o(7,"app-lesson-rating",7),f("close",function(){return i.closeGradeModal()})("save",function(){return i.gradeLesson()}),s()),t&2&&(a(),d("ngIf",i.loading),a(),d("ngIf",i.successMessage),a(),d("ngIf",i.errorMessage),a(),d("ngIf",!i.loading&&i.lesson),a(),d("ngIf",i.showApproveModal),a(),d("ngIf",i.showRejectModal),a(),d("show",i.showGradeModal)("loading",i.loading)("gradeData",i.gradeData))},dependencies:[P,te,j,L,B,D,O,T,F,_e,be,ve,xe,Ce,Me],styles:['[_ngcontent-%COMP%]:root{--bg-primary: #ffffff;--bg-secondary: #f8f9fa;--bg-tertiary: #e9ecef;--text-primary: #212529;--text-secondary: #6c757d;--text-muted: #868e96;--border-color: #dee2e6;--shadow-sm: 0 2px 8px rgba(0, 0, 0, .08);--shadow-md: 0 4px 16px rgba(0, 0, 0, .12);--card-hover-shadow: 0 8px 24px rgba(0, 0, 0, .15);--tab-border: #007bff}[data-bs-theme=dark][_ngcontent-%COMP%]{--bg-primary: #212529;--bg-secondary: #343a40;--bg-tertiary: #495057;--text-primary: #f8f9fa;--text-secondary: #adb5bd;--text-muted: #868e96;--border-color: #495057;--shadow-sm: 0 2px 8px rgba(0, 0, 0, .3);--shadow-md: 0 4px 16px rgba(0, 0, 0, .4);--card-hover-shadow: 0 8px 24px rgba(0, 0, 0, .5);--tab-border: #0d6efd}.lesson-detail-container[_ngcontent-%COMP%]{padding:24px;max-width:1400px;margin:0 auto;background:var(--bg-secondary);min-height:100vh}.lesson-wrapper[_ngcontent-%COMP%]{border:3px solid #0b254b;border-radius:16px;overflow:hidden;box-shadow:0 8px 32px #0d6efd26;background:var(--bg-primary)}[_ngcontent-%COMP%]:root.theme-dark   .lesson-wrapper[_ngcontent-%COMP%], [data-bs-theme=dark][_ngcontent-%COMP%]   .lesson-wrapper[_ngcontent-%COMP%]{border-color:#fff;box-shadow:0 8px 32px #ffffff1a}.lesson-header-card[_ngcontent-%COMP%]{background:var(--bg-primary);border-radius:0;padding:32px;margin-bottom:0;box-shadow:none;border:none;border-bottom:1px solid var(--border-color)}.lesson-progress-bar[_ngcontent-%COMP%]{padding:24px 32px 16px;background:var(--bg-primary);border-bottom:1px solid var(--border-color)}.progress-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}.progress-title[_ngcontent-%COMP%]{font-size:.875rem;font-weight:600;color:var(--text-secondary);text-transform:uppercase;letter-spacing:.5px}.progress-percentage[_ngcontent-%COMP%]{font-size:.875rem;font-weight:700;color:#0d6efd}[_ngcontent-%COMP%]:root.theme-dark   .progress-percentage[_ngcontent-%COMP%], [data-bs-theme=dark][_ngcontent-%COMP%]   .progress-percentage[_ngcontent-%COMP%]{color:#fff}.progress-track[_ngcontent-%COMP%]{height:8px;background:var(--bg-secondary);border-radius:4px;overflow:hidden;position:relative}.progress-fill[_ngcontent-%COMP%]{height:100%;background:linear-gradient(90deg,#0d6efd,#0a58ca);border-radius:4px;transition:width .6s ease;position:relative;overflow:hidden}[_ngcontent-%COMP%]:root.theme-dark   .progress-fill[_ngcontent-%COMP%], [data-bs-theme=dark][_ngcontent-%COMP%]   .progress-fill[_ngcontent-%COMP%]{background:linear-gradient(90deg,#fff,#e9ecef)}.progress-fill[_ngcontent-%COMP%]:after{content:"";position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.3),transparent);animation:_ngcontent-%COMP%_shimmer 2s infinite}@keyframes _ngcontent-%COMP%_shimmer{0%{left:-100%}to{left:100%}}.progress-stages[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-top:12px;gap:8px}.progress-stage[_ngcontent-%COMP%]{flex:1;text-align:center;font-size:.75rem;color:var(--text-muted);padding-top:8px;position:relative}.progress-stage[_ngcontent-%COMP%]:before{content:"";position:absolute;top:-4px;left:50%;transform:translate(-50%);width:12px;height:12px;border-radius:50%;background:var(--bg-tertiary);border:2px solid var(--border-color)}.progress-stage.active[_ngcontent-%COMP%]{color:#0d6efd;font-weight:600}[_ngcontent-%COMP%]:root.theme-dark   .progress-stage.active[_ngcontent-%COMP%], [data-bs-theme=dark][_ngcontent-%COMP%]   .progress-stage.active[_ngcontent-%COMP%]{color:#fff}.progress-stage.active[_ngcontent-%COMP%]:before{background:#0d6efd;border-color:#0d6efd;box-shadow:0 0 0 4px #0d6efd33}[_ngcontent-%COMP%]:root.theme-dark   .progress-stage.active[_ngcontent-%COMP%]:before, [data-bs-theme=dark][_ngcontent-%COMP%]   .progress-stage.active[_ngcontent-%COMP%]:before{background:#fff;border-color:#fff;box-shadow:0 0 0 4px #fff3}.progress-stage.completed[_ngcontent-%COMP%]:before{background:#28a745;border-color:#28a745}.stage-label[_ngcontent-%COMP%]{display:block;margin-top:4px}.lesson-title[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;color:var(--text-primary);margin-bottom:12px;line-height:1.2}.lesson-description[_ngcontent-%COMP%]{font-size:1.1rem;line-height:1.6;margin-bottom:0;color:var(--text-secondary)}.action-buttons-group[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:8px}.quick-info[_ngcontent-%COMP%]{padding-top:24px;border-top:1px solid var(--border-color)}.info-card[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:16px;background:var(--bg-secondary);border-radius:8px;height:100%;border:1px solid var(--border-color)}.info-card[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.5rem}.info-card[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:var(--text-muted)}.info-card[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:var(--text-primary)}.lesson-tabs[_ngcontent-%COMP%]{background:var(--bg-primary);border-radius:0;padding:0 16px;margin-bottom:0;border:none;border-bottom:2px solid var(--border-color)}.lesson-tabs[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{border:none;color:var(--text-secondary);padding:16px 24px;font-weight:500;transition:all .3s ease;border-bottom:3px solid transparent;margin-bottom:-2px}.lesson-tabs[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]:hover{color:var(--tab-border);background:transparent}.lesson-tabs[_ngcontent-%COMP%]   .nav-link.active[_ngcontent-%COMP%]{color:var(--tab-border);background:transparent;border-bottom-color:var(--tab-border)}.lesson-tabs[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{opacity:.7}.lesson-tabs[_ngcontent-%COMP%]   .nav-link.active[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{opacity:1}.lesson-tab-content[_ngcontent-%COMP%]{background:var(--bg-primary);border-radius:0;padding:32px;box-shadow:none;min-height:400px;border:none}.content-card[_ngcontent-%COMP%]{background:var(--bg-secondary);border-radius:8px;padding:24px;margin-bottom:24px;border:1px solid var(--border-color)}.content-card[_ngcontent-%COMP%]:last-child{margin-bottom:0}.card-title[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:var(--text-primary);margin-bottom:20px;display:flex;align-items:center}.card-title[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#007bff}.chat-container[_ngcontent-%COMP%]{background:var(--bg-primary);border-radius:8px;padding:20px;border:1px solid var(--border-color)}.messages-list[_ngcontent-%COMP%]{max-height:500px;overflow-y:auto;margin-bottom:20px}.message-item[_ngcontent-%COMP%]{display:flex;gap:12px;margin-bottom:20px;padding-bottom:20px;border-bottom:1px solid var(--border-color)}.message-item[_ngcontent-%COMP%]:last-child{border-bottom:none;margin-bottom:0;padding-bottom:0}.message-avatar[_ngcontent-%COMP%]{flex-shrink:0}.message-avatar[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:2rem;color:var(--text-secondary)}.message-content[_ngcontent-%COMP%]{flex:1}.message-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}.message-header[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:var(--text-primary)}.message-header[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:var(--text-muted)}.message-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-secondary);line-height:1.5}.chat-input-container[_ngcontent-%COMP%]{border-top:1px solid var(--border-color);padding-top:20px;margin-top:20px}.files-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:16px;margin-bottom:20px}.file-card[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;padding:16px;background:var(--bg-primary);border:1px solid var(--border-color);border-radius:8px;transition:all .3s ease}.file-card[_ngcontent-%COMP%]:hover{box-shadow:var(--shadow-md);transform:translateY(-2px)}.file-icon[_ngcontent-%COMP%]{flex-shrink:0;width:48px;height:48px;background:#007bff1a;border-radius:8px;display:flex;align-items:center;justify-content:center}.file-icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.5rem;color:#007bff}.file-info[_ngcontent-%COMP%]{flex:1;min-width:0}.file-name[_ngcontent-%COMP%]{display:block;font-size:.95rem;color:var(--text-primary);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-bottom:4px;font-weight:500}.file-info[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:var(--text-muted)}.file-actions[_ngcontent-%COMP%]{flex-shrink:0}.upload-section[_ngcontent-%COMP%]{background:var(--bg-primary);padding:20px;border-radius:8px;border:2px dashed var(--border-color)}.upload-section[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{color:var(--text-primary)}.team-list[_ngcontent-%COMP%]{margin-bottom:20px}.team-member[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;padding:16px;background:var(--bg-primary);border:1px solid var(--border-color);border-radius:8px;margin-bottom:12px}.team-member[_ngcontent-%COMP%]:last-child{margin-bottom:0}.member-avatar[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:2.5rem;color:#007bff}.member-info[_ngcontent-%COMP%]{flex:1}.member-info[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block;color:var(--text-primary);margin-bottom:4px}.member-info[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:var(--text-muted)}.invite-section[_ngcontent-%COMP%]{background:var(--bg-primary);padding:20px;border-radius:8px;border:2px dashed var(--border-color)}.invite-section[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{color:var(--text-primary)}.feedback-list[_ngcontent-%COMP%]{margin-bottom:20px}.feedback-item[_ngcontent-%COMP%]{padding:20px;background:var(--bg-primary);border:1px solid var(--border-color);border-radius:8px;margin-bottom:16px}.feedback-item[_ngcontent-%COMP%]:last-child{margin-bottom:0}.feedback-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;padding-bottom:12px;border-bottom:1px solid var(--border-color)}.feedback-header[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:var(--text-primary)}.feedback-header[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:var(--text-muted)}.feedback-content[_ngcontent-%COMP%]{color:var(--text-secondary);line-height:1.6;margin:0}.feedback-form[_ngcontent-%COMP%]{background:var(--bg-primary);padding:20px;border-radius:8px;border:2px dashed var(--border-color)}.feedback-form[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{color:var(--text-primary)}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:60px 20px}.empty-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:4rem;margin-bottom:16px;display:block;color:var(--text-muted);opacity:.5}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-muted)}.config-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:12px 0;border-bottom:1px solid var(--border-color)}.config-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:last-child{border-bottom:none}.config-list[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:inline-block;min-width:100px;color:var(--text-primary)}.config-list[_ngcontent-%COMP%]   .text-muted[_ngcontent-%COMP%]{color:var(--text-secondary)!important}.loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:400px}.form-control[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%]{background:var(--bg-secondary);border:1px solid var(--border-color);color:var(--text-primary)}.form-control[_ngcontent-%COMP%]:focus, .form-select[_ngcontent-%COMP%]:focus{background:var(--bg-primary);border-color:#007bff;box-shadow:0 0 0 .2rem #007bff40;color:var(--text-primary)}.form-control[_ngcontent-%COMP%]::placeholder{color:var(--text-muted)}[data-bs-theme=dark][_ngcontent-%COMP%]   .alert-success[_ngcontent-%COMP%]{background-color:#28a74533;border-color:#28a745;color:#51cf66}[data-bs-theme=dark][_ngcontent-%COMP%]   .alert-danger[_ngcontent-%COMP%]{background-color:#dc354533;border-color:#dc3545;color:#ff6b6b}[data-bs-theme=dark][_ngcontent-%COMP%]   .badge.bg-light[_ngcontent-%COMP%]{background-color:var(--bg-tertiary)!important;color:var(--text-primary)!important}@media (max-width: 768px){.lesson-detail-container[_ngcontent-%COMP%]{padding:16px}.lesson-wrapper[_ngcontent-%COMP%]{border-width:2px}.lesson-header-card[_ngcontent-%COMP%]{padding:20px}.lesson-progress-bar[_ngcontent-%COMP%]{padding:16px 20px 12px}.progress-stages[_ngcontent-%COMP%]{flex-wrap:wrap}.progress-stage[_ngcontent-%COMP%]{flex:1 1 25%;font-size:.7rem}.lesson-title[_ngcontent-%COMP%]{font-size:1.5rem}.lesson-description[_ngcontent-%COMP%]{font-size:1rem}.action-buttons-group[_ngcontent-%COMP%]{width:100%}.action-buttons-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{flex:1}.lesson-tabs[_ngcontent-%COMP%]{padding:0 8px}.lesson-tabs[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{padding:12px 16px;font-size:.9rem}.lesson-tab-content[_ngcontent-%COMP%]{padding:20px}.files-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}[data-bs-theme=dark][_ngcontent-%COMP%]   .messages-list[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px}[data-bs-theme=dark][_ngcontent-%COMP%]   .messages-list[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:var(--bg-secondary);border-radius:4px}[data-bs-theme=dark][_ngcontent-%COMP%]   .messages-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:var(--bg-tertiary);border-radius:4px}[data-bs-theme=dark][_ngcontent-%COMP%]   .messages-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#6c757d}.bg-draft[_ngcontent-%COMP%]{background-color:#6c757d!important}.bg-proposed[_ngcontent-%COMP%]{background-color:#ffc107!important}.bg-approved[_ngcontent-%COMP%]{background-color:#28a745!important}.bg-rejected[_ngcontent-%COMP%]{background-color:#dc3545!important}.bg-in_development[_ngcontent-%COMP%]{background-color:#17a2b8!important}.bg-completed[_ngcontent-%COMP%]{background-color:#007bff!important}.bg-graded[_ngcontent-%COMP%]{background-color:#6610f2!important}']})}}return n})();export{Hn as a};
